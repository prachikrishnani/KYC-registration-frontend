(self.webpackChunkKYC_registration_frontend=self.webpackChunkKYC_registration_frontend||[]).push([[179],{402:(ap,rw,xu)=>{"use strict";function st(t){return"function"==typeof t}function up(t){const e=t(r=>{Error.call(r),r.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}const cp=up(t=>function(e){t(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((r,i)=>`${i+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function lp(t,n){if(t){const e=t.indexOf(n);0<=e&&t.splice(e,1)}}class Jn{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const o of e)o.remove(this);else e.remove(this);const{initialTeardown:r}=this;if(st(r))try{r()}catch(o){n=o instanceof cp?o.errors:[o]}const{_finalizers:i}=this;if(i){this._finalizers=null;for(const o of i)try{sw(o)}catch(s){n=n??[],s instanceof cp?n=[...n,...s.errors]:n.push(s)}}if(n)throw new cp(n)}}add(n){var e;if(n&&n!==this)if(this.closed)sw(n);else{if(n instanceof Jn){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(n)}}_hasParent(n){const{_parentage:e}=this;return e===n||Array.isArray(e)&&e.includes(n)}_addParent(n){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(n),e):e?[e,n]:n}_removeParent(n){const{_parentage:e}=this;e===n?this._parentage=null:Array.isArray(e)&&lp(e,n)}remove(n){const{_finalizers:e}=this;e&&lp(e,n),n instanceof Jn&&n._removeParent(this)}}Jn.EMPTY=(()=>{const t=new Jn;return t.closed=!0,t})();const iw=Jn.EMPTY;function ow(t){return t instanceof Jn||t&&"closed"in t&&st(t.remove)&&st(t.add)&&st(t.unsubscribe)}function sw(t){st(t)?t():t.unsubscribe()}const Qo={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ll={setTimeout(t,n,...e){const{delegate:r}=Ll;return r?.setTimeout?r.setTimeout(t,n,...e):setTimeout(t,n,...e)},clearTimeout(t){const{delegate:n}=Ll;return(n?.clearTimeout||clearTimeout)(t)},delegate:void 0};function aw(t){Ll.setTimeout(()=>{const{onUnhandledError:n}=Qo;if(!n)throw t;n(t)})}function dp(){}const iN=fp("C",void 0,void 0);function fp(t,n,e){return{kind:t,value:n,error:e}}let Jo=null;function Bl(t){if(Qo.useDeprecatedSynchronousErrorHandling){const n=!Jo;if(n&&(Jo={errorThrown:!1,error:null}),t(),n){const{errorThrown:e,error:r}=Jo;if(Jo=null,e)throw r}}else t()}class hp extends Jn{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,ow(n)&&n.add(this)):this.destination=dN}static create(n,e,r){return new Eu(n,e,r)}next(n){this.isStopped?gp(function sN(t){return fp("N",t,void 0)}(n),this):this._next(n)}error(n){this.isStopped?gp(function oN(t){return fp("E",void 0,t)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?gp(iN,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const uN=Function.prototype.bind;function pp(t,n){return uN.call(t,n)}class cN{constructor(n){this.partialObserver=n}next(n){const{partialObserver:e}=this;if(e.next)try{e.next(n)}catch(r){Vl(r)}}error(n){const{partialObserver:e}=this;if(e.error)try{e.error(n)}catch(r){Vl(r)}else Vl(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(e){Vl(e)}}}class Eu extends hp{constructor(n,e,r){let i;if(super(),st(n)||!n)i={next:n??void 0,error:e??void 0,complete:r??void 0};else{let o;this&&Qo.useDeprecatedNextContext?(o=Object.create(n),o.unsubscribe=()=>this.unsubscribe(),i={next:n.next&&pp(n.next,o),error:n.error&&pp(n.error,o),complete:n.complete&&pp(n.complete,o)}):i=n}this.destination=new cN(i)}}function Vl(t){Qo.useDeprecatedSynchronousErrorHandling?function aN(t){Qo.useDeprecatedSynchronousErrorHandling&&Jo&&(Jo.errorThrown=!0,Jo.error=t)}(t):aw(t)}function gp(t,n){const{onStoppedNotification:e}=Qo;e&&Ll.setTimeout(()=>e(t,n))}const dN={closed:!0,next:dp,error:function lN(t){throw t},complete:dp},mp="function"==typeof Symbol&&Symbol.observable||"@@observable";function ao(t){return t}function uw(t){return 0===t.length?ao:1===t.length?t[0]:function(e){return t.reduce((r,i)=>i(r),e)}}let Lt=(()=>{class t{constructor(e){e&&(this._subscribe=e)}lift(e){const r=new t;return r.source=this,r.operator=e,r}subscribe(e,r,i){const o=function pN(t){return t&&t instanceof hp||function hN(t){return t&&st(t.next)&&st(t.error)&&st(t.complete)}(t)&&ow(t)}(e)?e:new Eu(e,r,i);return Bl(()=>{const{operator:s,source:a}=this;o.add(s?s.call(o,a):a?this._subscribe(o):this._trySubscribe(o))}),o}_trySubscribe(e){try{return this._subscribe(e)}catch(r){e.error(r)}}forEach(e,r){return new(r=cw(r))((i,o)=>{const s=new Eu({next:a=>{try{e(a)}catch(u){o(u),s.unsubscribe()}},error:o,complete:i});this.subscribe(s)})}_subscribe(e){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(e)}[mp](){return this}pipe(...e){return uw(e)(this)}toPromise(e){return new(e=cw(e))((r,i)=>{let o;this.subscribe(s=>o=s,s=>i(s),()=>r(o))})}}return t.create=n=>new t(n),t})();function cw(t){var n;return null!==(n=t??Qo.Promise)&&void 0!==n?n:Promise}const gN=up(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let mr=(()=>{class t extends Lt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const r=new lw(this,this);return r.operator=e,r}_throwIfClosed(){if(this.closed)throw new gN}next(e){Bl(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(e)}})}error(e){Bl(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:r}=this;for(;r.length;)r.shift().error(e)}})}complete(){Bl(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:r,isStopped:i,observers:o}=this;return r||i?iw:(this.currentObservers=null,o.push(e),new Jn(()=>{this.currentObservers=null,lp(o,e)}))}_checkFinalizedStatuses(e){const{hasError:r,thrownError:i,isStopped:o}=this;r?e.error(i):o&&e.complete()}asObservable(){const e=new Lt;return e.source=this,e}}return t.create=(n,e)=>new lw(n,e),t})();class lw extends mr{constructor(n,e){super(),this.destination=n,this.source=e}next(n){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===r||r.call(e,n)}error(n){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===r||r.call(e,n)}complete(){var n,e;null===(e=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===e||e.call(n)}_subscribe(n){var e,r;return null!==(r=null===(e=this.source)||void 0===e?void 0:e.subscribe(n))&&void 0!==r?r:iw}}function dw(t){return st(t?.lift)}function zt(t){return n=>{if(dw(n))return n.lift(function(e){try{return t(e,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Bt(t,n,e,r,i){return new mN(t,n,e,r,i)}class mN extends hp{constructor(n,e,r,i,o,s){super(n),this.onFinalize=o,this.shouldUnsubscribe=s,this._next=e?function(a){try{e(a)}catch(u){n.error(u)}}:super._next,this._error=i?function(a){try{i(a)}catch(u){n.error(u)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(a){n.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function at(t,n){return zt((e,r)=>{let i=0;e.subscribe(Bt(r,o=>{r.next(t.call(n,o,i++))}))})}function uo(t){return this instanceof uo?(this.v=t,this):new uo(t)}function gw(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=function wp(t){var n="function"==typeof Symbol&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(o){e[o]=t[o]&&function(s){return new Promise(function(a,u){!function i(o,s,a,u){Promise.resolve(u).then(function(c){o({value:c,done:a})},s)}(a,u,(s=t[o](s)).done,s.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const mw=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function vw(t){return st(t?.then)}function yw(t){return st(t[mp])}function bw(t){return Symbol.asyncIterator&&st(t?.[Symbol.asyncIterator])}function ww(t){return new TypeError(`You provided ${null!==t&&"object"==typeof t?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const _w=function BN(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Cw(t){return st(t?.[_w])}function xw(t){return function pw(t,n,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=e.apply(t,n||[]),o=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(f){r[f]&&(i[f]=function(h){return new Promise(function(p,g){o.push([f,h,p,g])>1||a(f,h)})})}function a(f,h){try{!function u(f){f.value instanceof uo?Promise.resolve(f.value.v).then(c,l):d(o[0][2],f)}(r[f](h))}catch(p){d(o[0][3],p)}}function c(f){a("next",f)}function l(f){a("throw",f)}function d(f,h){f(h),o.shift(),o.length&&a(o[0][0],o[0][1])}}(this,arguments,function*(){const e=t.getReader();try{for(;;){const{value:r,done:i}=yield uo(e.read());if(i)return yield uo(void 0);yield yield uo(r)}}finally{e.releaseLock()}})}function Ew(t){return st(t?.getReader)}function er(t){if(t instanceof Lt)return t;if(null!=t){if(yw(t))return function VN(t){return new Lt(n=>{const e=t[mp]();if(st(e.subscribe))return e.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(t);if(mw(t))return function UN(t){return new Lt(n=>{for(let e=0;e<t.length&&!n.closed;e++)n.next(t[e]);n.complete()})}(t);if(vw(t))return function HN(t){return new Lt(n=>{t.then(e=>{n.closed||(n.next(e),n.complete())},e=>n.error(e)).then(null,aw)})}(t);if(bw(t))return Dw(t);if(Cw(t))return function jN(t){return new Lt(n=>{for(const e of t)if(n.next(e),n.closed)return;n.complete()})}(t);if(Ew(t))return function WN(t){return Dw(xw(t))}(t)}throw ww(t)}function Dw(t){return new Lt(n=>{(function zN(t,n){var e,r,i,o;return function fw(t,n,e,r){return new(e||(e=Promise))(function(o,s){function a(l){try{c(r.next(l))}catch(d){s(d)}}function u(l){try{c(r.throw(l))}catch(d){s(d)}}function c(l){l.done?o(l.value):function i(o){return o instanceof e?o:new e(function(s){s(o)})}(l.value).then(a,u)}c((r=r.apply(t,n||[])).next())})}(this,void 0,void 0,function*(){try{for(e=gw(t);!(r=yield e.next()).done;)if(n.next(r.value),n.closed)return}catch(s){i={error:s}}finally{try{r&&!r.done&&(o=e.return)&&(yield o.call(e))}finally{if(i)throw i.error}}n.complete()})})(t,n).catch(e=>n.error(e))})}function Si(t,n,e,r=0,i=!1){const o=n.schedule(function(){e(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(o),!i)return o}function sn(t,n,e=1/0){return st(n)?sn((r,i)=>at((o,s)=>n(r,o,i,s))(er(t(r,i))),e):("number"==typeof n&&(e=n),zt((r,i)=>function GN(t,n,e,r,i,o,s,a){const u=[];let c=0,l=0,d=!1;const f=()=>{d&&!u.length&&!c&&n.complete()},h=g=>c<r?p(g):u.push(g),p=g=>{o&&n.next(g),c++;let m=!1;er(e(g,l++)).subscribe(Bt(n,v=>{i?.(v),o?h(v):n.next(v)},()=>{m=!0},void 0,()=>{if(m)try{for(c--;u.length&&c<r;){const v=u.shift();s?Si(n,s,()=>p(v)):p(v)}f()}catch(v){n.error(v)}}))};return t.subscribe(Bt(n,h,()=>{d=!0,f()})),()=>{a?.()}}(r,i,t,e)))}function Us(t=1/0){return sn(ao,t)}const Qr=new Lt(t=>t.complete());function _p(t){return t[t.length-1]}function Iw(t){return st(_p(t))?t.pop():void 0}function Du(t){return function qN(t){return t&&st(t.schedule)}(_p(t))?t.pop():void 0}function Sw(t,n=0){return zt((e,r)=>{e.subscribe(Bt(r,i=>Si(r,t,()=>r.next(i),n),()=>Si(r,t,()=>r.complete(),n),i=>Si(r,t,()=>r.error(i),n)))})}function Tw(t,n=0){return zt((e,r)=>{r.add(t.schedule(()=>e.subscribe(r),n))})}function Mw(t,n){if(!t)throw new Error("Iterable cannot be null");return new Lt(e=>{Si(e,n,()=>{const r=t[Symbol.asyncIterator]();Si(e,n,()=>{r.next().then(i=>{i.done?e.complete():e.next(i.value)})},0,!0)})})}function Jt(t,n){return n?function ek(t,n){if(null!=t){if(yw(t))return function YN(t,n){return er(t).pipe(Tw(n),Sw(n))}(t,n);if(mw(t))return function ZN(t,n){return new Lt(e=>{let r=0;return n.schedule(function(){r===t.length?e.complete():(e.next(t[r++]),e.closed||this.schedule())})})}(t,n);if(vw(t))return function XN(t,n){return er(t).pipe(Tw(n),Sw(n))}(t,n);if(bw(t))return Mw(t,n);if(Cw(t))return function QN(t,n){return new Lt(e=>{let r;return Si(e,n,()=>{r=t[_w](),Si(e,n,()=>{let i,o;try{({value:i,done:o}=r.next())}catch(s){return void e.error(s)}o?e.complete():e.next(i)},0,!0)}),()=>st(r?.return)&&r.return()})}(t,n);if(Ew(t))return function JN(t,n){return Mw(xw(t),n)}(t,n)}throw ww(t)}(t,n):er(t)}class vr extends mr{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const e=super._subscribe(n);return!e.closed&&n.next(this._value),e}getValue(){const{hasError:n,thrownError:e,_value:r}=this;if(n)throw e;return this._throwIfClosed(),r}next(n){super.next(this._value=n)}}function we(...t){return Jt(t,Du(t))}function Aw(t={}){const{connector:n=(()=>new mr),resetOnError:e=!0,resetOnComplete:r=!0,resetOnRefCountZero:i=!0}=t;return o=>{let s,a,u,c=0,l=!1,d=!1;const f=()=>{a?.unsubscribe(),a=void 0},h=()=>{f(),s=u=void 0,l=d=!1},p=()=>{const g=s;h(),g?.unsubscribe()};return zt((g,m)=>{c++,!d&&!l&&f();const v=u=u??n();m.add(()=>{c--,0===c&&!d&&!l&&(a=Cp(p,i))}),v.subscribe(m),!s&&c>0&&(s=new Eu({next:y=>v.next(y),error:y=>{d=!0,f(),a=Cp(h,e,y),v.error(y)},complete:()=>{l=!0,f(),a=Cp(h,r),v.complete()}}),er(g).subscribe(s))})(o)}}function Cp(t,n,...e){if(!0===n)return void t();if(!1===n)return;const r=new Eu({next:()=>{r.unsubscribe(),t()}});return er(n(...e)).subscribe(r)}function Jr(t,n){return zt((e,r)=>{let i=null,o=0,s=!1;const a=()=>s&&!i&&r.complete();e.subscribe(Bt(r,u=>{i?.unsubscribe();let c=0;const l=o++;er(t(u,l)).subscribe(i=Bt(r,d=>r.next(n?n(u,d,l,c++):d),()=>{i=null,a()}))},()=>{s=!0,a()}))})}function rk(t,n){return t===n}function nt(t){for(let n in t)if(t[n]===nt)return n;throw Error("Could not find renamed property on target object.")}function Ul(t,n){for(const e in n)n.hasOwnProperty(e)&&!t.hasOwnProperty(e)&&(t[e]=n[e])}function Gt(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(Gt).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const n=t.toString();if(null==n)return""+n;const e=n.indexOf("\n");return-1===e?n:n.substring(0,e)}function xp(t,n){return null==t||""===t?null===n?"":n:null==n||""===n?t:t+" "+n}const ik=nt({__forward_ref__:nt});function ut(t){return t.__forward_ref__=ut,t.toString=function(){return Gt(this())},t}function ye(t){return Ep(t)?t():t}function Ep(t){return"function"==typeof t&&t.hasOwnProperty(ik)&&t.__forward_ref__===ut}function Dp(t){return t&&!!t.\u0275providers}const Rw="https://g.co/ng/security#xss";class $ extends Error{constructor(n,e){super(function Hl(t,n){return`NG0${Math.abs(t)}${n?": "+n:""}`}(n,e)),this.code=n}}function _e(t){return"string"==typeof t?t:null==t?"":String(t)}function Ip(t,n){throw new $(-201,!1)}function yr(t,n){null==t&&function me(t,n,e,r){throw new Error(`ASSERTION ERROR: ${t}`+(null==r?"":` [Expected=> ${e} ${r} ${n} <=Actual]`))}(n,t,null,"!=")}function fe(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function yt(t){return{providers:t.providers||[],imports:t.imports||[]}}function jl(t){return Ow(t,zl)||Ow(t,Nw)}function Ow(t,n){return t.hasOwnProperty(n)?t[n]:null}function Wl(t){return t&&(t.hasOwnProperty(Sp)||t.hasOwnProperty(fk))?t[Sp]:null}const zl=nt({\u0275prov:nt}),Sp=nt({\u0275inj:nt}),Nw=nt({ngInjectableDef:nt}),fk=nt({ngInjectorDef:nt});var Ne=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}(Ne||{});let Tp;function jn(t){const n=Tp;return Tp=t,n}function Pw(t,n,e){const r=jl(t);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:e&Ne.Optional?null:void 0!==n?n:void Ip(Gt(t))}const dt=globalThis;class se{constructor(n,e){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=fe({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Iu={},Np="__NG_DI_FLAG__",Gl="ngTempTokenPath",gk=/\n/gm,Lw="__source";let Hs;function co(t){const n=Hs;return Hs=t,n}function yk(t,n=Ne.Default){if(void 0===Hs)throw new $(-203,!1);return null===Hs?Pw(t,void 0,n):Hs.get(t,n&Ne.Optional?null:void 0,n)}function pe(t,n=Ne.Default){return(function kw(){return Tp}()||yk)(ye(t),n)}function re(t,n=Ne.Default){return pe(t,$l(n))}function $l(t){return typeof t>"u"||"number"==typeof t?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function kp(t){const n=[];for(let e=0;e<t.length;e++){const r=ye(t[e]);if(Array.isArray(r)){if(0===r.length)throw new $(900,!1);let i,o=Ne.Default;for(let s=0;s<r.length;s++){const a=r[s],u=bk(a);"number"==typeof u?-1===u?i=a.token:o|=u:i=a}n.push(pe(i,o))}else n.push(pe(r))}return n}function Su(t,n){return t[Np]=n,t.prototype[Np]=n,t}function bk(t){return t[Np]}function Ti(t){return{toString:t}.toString()}var ql=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(ql||{}),Ar=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(Ar||{});const ei={},Ke=[],Kl=nt({\u0275cmp:nt}),Pp=nt({\u0275dir:nt}),Fp=nt({\u0275pipe:nt}),Vw=nt({\u0275mod:nt}),Mi=nt({\u0275fac:nt}),Tu=nt({__NG_ELEMENT_ID__:nt}),Uw=nt({__NG_ENV_ID__:nt});function Hw(t,n,e){let r=t.length;for(;;){const i=t.indexOf(n,e);if(-1===i)return i;if(0===i||t.charCodeAt(i-1)<=32){const o=n.length;if(i+o===r||t.charCodeAt(i+o)<=32)return i}e=i+1}}function Lp(t,n,e){let r=0;for(;r<e.length;){const i=e[r];if("number"==typeof i){if(0!==i)break;r++;const o=e[r++],s=e[r++],a=e[r++];t.setAttribute(n,s,a,o)}else{const o=i,s=e[++r];Ww(o)?t.setProperty(n,o,s):t.setAttribute(n,o,s),r++}}return r}function jw(t){return 3===t||4===t||6===t}function Ww(t){return 64===t.charCodeAt(0)}function Mu(t,n){if(null!==n&&0!==n.length)if(null===t||0===t.length)t=n.slice();else{let e=-1;for(let r=0;r<n.length;r++){const i=n[r];"number"==typeof i?e=i:0===e||zw(t,e,i,null,-1===e||2===e?n[++r]:null)}}return t}function zw(t,n,e,r,i){let o=0,s=t.length;if(-1===n)s=-1;else for(;o<t.length;){const a=t[o++];if("number"==typeof a){if(a===n){s=-1;break}if(a>n){s=o-1;break}}}for(;o<t.length;){const a=t[o];if("number"==typeof a)break;if(a===e){if(null===r)return void(null!==i&&(t[o+1]=i));if(r===t[o+1])return void(t[o+2]=i)}o++,null!==r&&o++,null!==i&&o++}-1!==s&&(t.splice(s,0,n),o=s+1),t.splice(o++,0,e),null!==r&&t.splice(o++,0,r),null!==i&&t.splice(o++,0,i)}const Gw="ng-template";function Ck(t,n,e){let r=0,i=!0;for(;r<t.length;){let o=t[r++];if("string"==typeof o&&i){const s=t[r++];if(e&&"class"===o&&-1!==Hw(s.toLowerCase(),n,0))return!0}else{if(1===o){for(;r<t.length&&"string"==typeof(o=t[r++]);)if(o.toLowerCase()===n)return!0;return!1}"number"==typeof o&&(i=!1)}}return!1}function $w(t){return 4===t.type&&t.value!==Gw}function xk(t,n,e){return n===(4!==t.type||e?t.value:Gw)}function Ek(t,n,e){let r=4;const i=t.attrs||[],o=function Sk(t){for(let n=0;n<t.length;n++)if(jw(t[n]))return n;return t.length}(i);let s=!1;for(let a=0;a<n.length;a++){const u=n[a];if("number"!=typeof u){if(!s)if(4&r){if(r=2|1&r,""!==u&&!xk(t,u,e)||""===u&&1===n.length){if(Rr(r))return!1;s=!0}}else{const c=8&r?u:n[++a];if(8&r&&null!==t.attrs){if(!Ck(t.attrs,c,e)){if(Rr(r))return!1;s=!0}continue}const d=Dk(8&r?"class":u,i,$w(t),e);if(-1===d){if(Rr(r))return!1;s=!0;continue}if(""!==c){let f;f=d>o?"":i[d+1].toLowerCase();const h=8&r?f:null;if(h&&-1!==Hw(h,c,0)||2&r&&c!==f){if(Rr(r))return!1;s=!0}}}}else{if(!s&&!Rr(r)&&!Rr(u))return!1;if(s&&Rr(u))continue;s=!1,r=u|1&r}}return Rr(r)||s}function Rr(t){return 0==(1&t)}function Dk(t,n,e,r){if(null===n)return-1;let i=0;if(r||!e){let o=!1;for(;i<n.length;){const s=n[i];if(s===t)return i;if(3===s||6===s)o=!0;else{if(1===s||2===s){let a=n[++i];for(;"string"==typeof a;)a=n[++i];continue}if(4===s)break;if(0===s){i+=4;continue}}i+=o?1:2}return-1}return function Tk(t,n){let e=t.indexOf(4);if(e>-1)for(e++;e<t.length;){const r=t[e];if("number"==typeof r)return-1;if(r===n)return e;e++}return-1}(n,t)}function qw(t,n,e=!1){for(let r=0;r<n.length;r++)if(Ek(t,n[r],e))return!0;return!1}function Mk(t,n){e:for(let e=0;e<n.length;e++){const r=n[e];if(t.length===r.length){for(let i=0;i<t.length;i++)if(t[i]!==r[i])continue e;return!0}}return!1}function Kw(t,n){return t?":not("+n.trim()+")":n}function Ak(t){let n=t[0],e=1,r=2,i="",o=!1;for(;e<t.length;){let s=t[e];if("string"==typeof s)if(2&r){const a=t[++e];i+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else 8&r?i+="."+s:4&r&&(i+=" "+s);else""!==i&&!Rr(s)&&(n+=Kw(o,i),i=""),r=s,o=o||!Rr(r);e++}return""!==i&&(n+=Kw(o,i)),n}function an(t){return Ti(()=>{const n=Xw(t),e={...n,decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===ql.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&t.dependencies||null,getStandaloneInjector:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||Ar.Emulated,styles:t.styles||Ke,_:null,schemas:t.schemas||null,tView:null,id:""};Zw(e);const r=t.dependencies;return e.directiveDefs=Yl(r,!1),e.pipeDefs=Yl(r,!0),e.id=function Bk(t){let n=0;const e=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,t.consts,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery].join("|");for(const i of e)n=Math.imul(31,n)+i.charCodeAt(0)<<0;return n+=2147483648,"c"+n}(e),e})}function kk(t){return Ve(t)||un(t)}function Pk(t){return null!==t}function _t(t){return Ti(()=>({type:t.type,bootstrap:t.bootstrap||Ke,declarations:t.declarations||Ke,imports:t.imports||Ke,exports:t.exports||Ke,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function Yw(t,n){if(null==t)return ei;const e={};for(const r in t)if(t.hasOwnProperty(r)){let i=t[r],o=i;Array.isArray(i)&&(o=i[1],i=i[0]),e[i]=r,n&&(n[i]=o)}return e}function ge(t){return Ti(()=>{const n=Xw(t);return Zw(n),n})}function Tn(t){return{type:t.type,name:t.name,factory:null,pure:!1!==t.pure,standalone:!0===t.standalone,onDestroy:t.type.prototype.ngOnDestroy||null}}function Ve(t){return t[Kl]||null}function un(t){return t[Pp]||null}function Mn(t){return t[Fp]||null}function nr(t,n){const e=t[Vw]||null;if(!e&&!0===n)throw new Error(`Type ${Gt(t)} does not have '\u0275mod' property.`);return e}function Xw(t){const n={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:t.inputs||ei,exportAs:t.exportAs||null,standalone:!0===t.standalone,signals:!0===t.signals,selectors:t.selectors||Ke,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Yw(t.inputs,n),outputs:Yw(t.outputs)}}function Zw(t){t.features?.forEach(n=>n(t))}function Yl(t,n){if(!t)return null;const e=n?Mn:kk;return()=>("function"==typeof t?t():t).map(r=>e(r)).filter(Pk)}const Mt=0,J=1,Ie=2,Ct=3,Or=4,Au=5,mn=6,Ws=7,Nt=8,lo=9,zs=10,Ce=11,Ru=12,Qw=13,Gs=14,kt=15,Ou=16,$s=17,ti=18,Nu=19,Jw=20,fo=21,Ai=22,ku=23,Pu=24,ke=25,Bp=1,e_=2,ni=7,qs=9,cn=11;function Wn(t){return Array.isArray(t)&&"object"==typeof t[Bp]}function An(t){return Array.isArray(t)&&!0===t[Bp]}function Vp(t){return 0!=(4&t.flags)}function ts(t){return t.componentOffset>-1}function Zl(t){return 1==(1&t.flags)}function Nr(t){return!!t.template}function Up(t){return 0!=(512&t[Ie])}function ns(t,n){return t.hasOwnProperty(Mi)?t[Mi]:null}let ln=null,Ql=!1;function br(t){const n=ln;return ln=t,n}const r_={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function o_(t){if(!Lu(t)||t.dirty){if(!t.producerMustRecompute(t)&&!u_(t))return void(t.dirty=!1);t.producerRecomputeValue(t),t.dirty=!1}}function a_(t){t.dirty=!0,function s_(t){if(void 0===t.liveConsumerNode)return;const n=Ql;Ql=!0;try{for(const e of t.liveConsumerNode)e.dirty||a_(e)}finally{Ql=n}}(t),t.consumerMarkedDirty?.(t)}function jp(t){return t&&(t.nextProducerIndex=0),br(t)}function Wp(t,n){if(br(n),t&&void 0!==t.producerNode&&void 0!==t.producerIndexOfThis&&void 0!==t.producerLastReadVersion){if(Lu(t))for(let e=t.nextProducerIndex;e<t.producerNode.length;e++)Jl(t.producerNode[e],t.producerIndexOfThis[e]);for(;t.producerNode.length>t.nextProducerIndex;)t.producerNode.pop(),t.producerLastReadVersion.pop(),t.producerIndexOfThis.pop()}}function u_(t){Ks(t);for(let n=0;n<t.producerNode.length;n++){const e=t.producerNode[n],r=t.producerLastReadVersion[n];if(r!==e.version||(o_(e),r!==e.version))return!0}return!1}function c_(t){if(Ks(t),Lu(t))for(let n=0;n<t.producerNode.length;n++)Jl(t.producerNode[n],t.producerIndexOfThis[n]);t.producerNode.length=t.producerLastReadVersion.length=t.producerIndexOfThis.length=0,t.liveConsumerNode&&(t.liveConsumerNode.length=t.liveConsumerIndexOfThis.length=0)}function Jl(t,n){if(function d_(t){t.liveConsumerNode??=[],t.liveConsumerIndexOfThis??=[]}(t),Ks(t),1===t.liveConsumerNode.length)for(let r=0;r<t.producerNode.length;r++)Jl(t.producerNode[r],t.producerIndexOfThis[r]);const e=t.liveConsumerNode.length-1;if(t.liveConsumerNode[n]=t.liveConsumerNode[e],t.liveConsumerIndexOfThis[n]=t.liveConsumerIndexOfThis[e],t.liveConsumerNode.length--,t.liveConsumerIndexOfThis.length--,n<t.liveConsumerNode.length){const r=t.liveConsumerIndexOfThis[n],i=t.liveConsumerNode[n];Ks(i),i.producerIndexOfThis[r]=n}}function Lu(t){return t.consumerIsAlwaysLive||(t?.liveConsumerNode?.length??0)>0}function Ks(t){t.producerNode??=[],t.producerIndexOfThis??=[],t.producerLastReadVersion??=[]}let f_=null;const m_=()=>{},Zk=(()=>({...r_,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:t=>{t.schedule(t.ref)},hasRun:!1,cleanupFn:m_}))();class Qk{constructor(n,e,r){this.previousValue=n,this.currentValue=e,this.firstChange=r}isFirstChange(){return this.firstChange}}function rr(){return v_}function v_(t){return t.type.prototype.ngOnChanges&&(t.setInput=eP),Jk}function Jk(){const t=b_(this),n=t?.current;if(n){const e=t.previous;if(e===ei)t.previous=n;else for(let r in n)e[r]=n[r];t.current=null,this.ngOnChanges(n)}}function eP(t,n,e,r){const i=this.declaredInputs[e],o=b_(t)||function tP(t,n){return t[y_]=n}(t,{previous:ei,current:null}),s=o.current||(o.current={}),a=o.previous,u=a[i];s[i]=new Qk(u&&u.currentValue,n,a===ei),t[r]=n}rr.ngInherit=!0;const y_="__ngSimpleChanges__";function b_(t){return t[y_]||null}const ri=function(t,n,e){};function ft(t){for(;Array.isArray(t);)t=t[Mt];return t}function ed(t,n){return ft(n[t])}function zn(t,n){return ft(n[t.index])}function C_(t,n){return t.data[n]}function ir(t,n){const e=n[t];return Wn(e)?e:e[Mt]}function po(t,n){return null==n?null:t[n]}function x_(t){t[$s]=0}function aP(t){1024&t[Ie]||(t[Ie]|=1024,D_(t,1))}function E_(t){1024&t[Ie]&&(t[Ie]&=-1025,D_(t,-1))}function D_(t,n){let e=t[Ct];if(null===e)return;e[Au]+=n;let r=e;for(e=e[Ct];null!==e&&(1===n&&1===r[Au]||-1===n&&0===r[Au]);)e[Au]+=n,r=e,e=e[Ct]}const ve={lFrame:F_(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function T_(){return ve.bindingsEnabled}function Xs(){return null!==ve.skipHydrationRootTNode}function j(){return ve.lFrame.lView}function Ue(){return ve.lFrame.tView}function Ri(t){return ve.lFrame.contextLView=t,t[Nt]}function Oi(t){return ve.lFrame.contextLView=null,t}function dn(){let t=M_();for(;null!==t&&64===t.type;)t=t.parent;return t}function M_(){return ve.lFrame.currentTNode}function ii(t,n){const e=ve.lFrame;e.currentTNode=t,e.isParent=n}function Kp(){return ve.lFrame.isParent}function Yp(){ve.lFrame.isParent=!1}function Rn(){const t=ve.lFrame;let n=t.bindingRootIndex;return-1===n&&(n=t.bindingRootIndex=t.tView.bindingStartIndex),n}function Zs(){return ve.lFrame.bindingIndex++}function ki(t){const n=ve.lFrame,e=n.bindingIndex;return n.bindingIndex=n.bindingIndex+t,e}function bP(t,n){const e=ve.lFrame;e.bindingIndex=e.bindingRootIndex=t,Xp(n)}function Xp(t){ve.lFrame.currentDirectiveIndex=t}function N_(){return ve.lFrame.currentQueryIndex}function Qp(t){ve.lFrame.currentQueryIndex=t}function _P(t){const n=t[J];return 2===n.type?n.declTNode:1===n.type?t[mn]:null}function k_(t,n,e){if(e&Ne.SkipSelf){let i=n,o=t;for(;!(i=i.parent,null!==i||e&Ne.Host||(i=_P(o),null===i||(o=o[Gs],10&i.type))););if(null===i)return!1;n=i,t=o}const r=ve.lFrame=P_();return r.currentTNode=n,r.lView=t,!0}function Jp(t){const n=P_(),e=t[J];ve.lFrame=n,n.currentTNode=e.firstChild,n.lView=t,n.tView=e,n.contextLView=t,n.bindingIndex=e.bindingStartIndex,n.inI18n=!1}function P_(){const t=ve.lFrame,n=null===t?null:t.child;return null===n?F_(t):n}function F_(t){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=n),n}function L_(){const t=ve.lFrame;return ve.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const B_=L_;function eg(){const t=L_();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function On(){return ve.lFrame.selectedIndex}function rs(t){ve.lFrame.selectedIndex=t}function Et(){const t=ve.lFrame;return C_(t.tView,t.selectedIndex)}function tg(){ve.lFrame.currentNamespace="svg"}let U_=!0;function td(){return U_}function go(t){U_=t}function nd(t,n){for(let e=n.directiveStart,r=n.directiveEnd;e<r;e++){const o=t.data[e].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:u,ngAfterViewChecked:c,ngOnDestroy:l}=o;s&&(t.contentHooks??=[]).push(-e,s),a&&((t.contentHooks??=[]).push(e,a),(t.contentCheckHooks??=[]).push(e,a)),u&&(t.viewHooks??=[]).push(-e,u),c&&((t.viewHooks??=[]).push(e,c),(t.viewCheckHooks??=[]).push(e,c)),null!=l&&(t.destroyHooks??=[]).push(e,l)}}function rd(t,n,e){H_(t,n,3,e)}function id(t,n,e,r){(3&t[Ie])===e&&H_(t,n,e,r)}function ng(t,n){let e=t[Ie];(3&e)===n&&(e&=8191,e+=1,t[Ie]=e)}function H_(t,n,e,r){const o=r??-1,s=n.length-1;let a=0;for(let u=void 0!==r?65535&t[$s]:0;u<s;u++)if("number"==typeof n[u+1]){if(a=n[u],null!=r&&a>=r)break}else n[u]<0&&(t[$s]+=65536),(a<o||-1==o)&&(TP(t,e,n,u),t[$s]=(4294901760&t[$s])+u+2),u++}function j_(t,n){ri(4,t,n);const e=br(null);try{n.call(t)}finally{br(e),ri(5,t,n)}}function TP(t,n,e,r){const i=e[r]<0,o=e[r+1],a=t[i?-e[r]:e[r]];i?t[Ie]>>13<t[$s]>>16&&(3&t[Ie])===n&&(t[Ie]+=8192,j_(a,o)):j_(a,o)}const Qs=-1;class Vu{constructor(n,e,r){this.factory=n,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=r}}function ig(t){return t!==Qs}function Uu(t){return 32767&t}function Hu(t,n){let e=function OP(t){return t>>16}(t),r=n;for(;e>0;)r=r[Gs],e--;return r}let og=!0;function od(t){const n=og;return og=t,n}const W_=255,z_=5;let NP=0;const oi={};function sd(t,n){const e=G_(t,n);if(-1!==e)return e;const r=n[J];r.firstCreatePass&&(t.injectorIndex=n.length,sg(r.data,t),sg(n,null),sg(r.blueprint,null));const i=ad(t,n),o=t.injectorIndex;if(ig(i)){const s=Uu(i),a=Hu(i,n),u=a[J].data;for(let c=0;c<8;c++)n[o+c]=a[s+c]|u[s+c]}return n[o+8]=i,o}function sg(t,n){t.push(0,0,0,0,0,0,0,0,n)}function G_(t,n){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===n[t.injectorIndex+8]?-1:t.injectorIndex}function ad(t,n){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let e=0,r=null,i=n;for(;null!==i;){if(r=Q_(i),null===r)return Qs;if(e++,i=i[Gs],-1!==r.injectorIndex)return r.injectorIndex|e<<16}return Qs}function ag(t,n,e){!function kP(t,n,e){let r;"string"==typeof e?r=e.charCodeAt(0)||0:e.hasOwnProperty(Tu)&&(r=e[Tu]),null==r&&(r=e[Tu]=NP++);const i=r&W_;n.data[t+(i>>z_)]|=1<<i}(t,n,e)}function $_(t,n,e){if(e&Ne.Optional||void 0!==t)return t;Ip()}function q_(t,n,e,r){if(e&Ne.Optional&&void 0===r&&(r=null),!(e&(Ne.Self|Ne.Host))){const i=t[lo],o=jn(void 0);try{return i?i.get(n,r,e&Ne.Optional):Pw(n,r,e&Ne.Optional)}finally{jn(o)}}return $_(r,0,e)}function K_(t,n,e,r=Ne.Default,i){if(null!==t){if(2048&n[Ie]&&!(r&Ne.Self)){const s=function UP(t,n,e,r,i){let o=t,s=n;for(;null!==o&&null!==s&&2048&s[Ie]&&!(512&s[Ie]);){const a=Y_(o,s,e,r|Ne.Self,oi);if(a!==oi)return a;let u=o.parent;if(!u){const c=s[Jw];if(c){const l=c.get(e,oi,r);if(l!==oi)return l}u=Q_(s),s=s[Gs]}o=u}return i}(t,n,e,r,oi);if(s!==oi)return s}const o=Y_(t,n,e,r,oi);if(o!==oi)return o}return q_(n,e,r,i)}function Y_(t,n,e,r,i){const o=function LP(t){if("string"==typeof t)return t.charCodeAt(0)||0;const n=t.hasOwnProperty(Tu)?t[Tu]:void 0;return"number"==typeof n?n>=0?n&W_:VP:n}(e);if("function"==typeof o){if(!k_(n,t,r))return r&Ne.Host?$_(i,0,r):q_(n,e,r,i);try{let s;if(s=o(r),null!=s||r&Ne.Optional)return s;Ip()}finally{B_()}}else if("number"==typeof o){let s=null,a=G_(t,n),u=Qs,c=r&Ne.Host?n[kt][mn]:null;for((-1===a||r&Ne.SkipSelf)&&(u=-1===a?ad(t,n):n[a+8],u!==Qs&&Z_(r,!1)?(s=n[J],a=Uu(u),n=Hu(u,n)):a=-1);-1!==a;){const l=n[J];if(X_(o,a,l.data)){const d=FP(a,n,e,s,r,c);if(d!==oi)return d}u=n[a+8],u!==Qs&&Z_(r,n[J].data[a+8]===c)&&X_(o,a,n)?(s=l,a=Uu(u),n=Hu(u,n)):a=-1}}return i}function FP(t,n,e,r,i,o){const s=n[J],a=s.data[t+8],l=ud(a,s,e,null==r?ts(a)&&og:r!=s&&0!=(3&a.type),i&Ne.Host&&o===a);return null!==l?is(n,s,l,a):oi}function ud(t,n,e,r,i){const o=t.providerIndexes,s=n.data,a=1048575&o,u=t.directiveStart,l=o>>20,f=i?a+l:t.directiveEnd;for(let h=r?a:a+l;h<f;h++){const p=s[h];if(h<u&&e===p||h>=u&&p.type===e)return h}if(i){const h=s[u];if(h&&Nr(h)&&h.type===e)return u}return null}function is(t,n,e,r){let i=t[e];const o=n.data;if(function MP(t){return t instanceof Vu}(i)){const s=i;s.resolving&&function ok(t,n){const e=n?`. Dependency path: ${n.join(" > ")} > ${t}`:"";throw new $(-200,`Circular dependency in DI detected for ${t}${e}`)}(function tt(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():_e(t)}(o[e]));const a=od(s.canSeeViewProviders);s.resolving=!0;const c=s.injectImpl?jn(s.injectImpl):null;k_(t,r,Ne.Default);try{i=t[e]=s.factory(void 0,o,t,r),n.firstCreatePass&&e>=r.directiveStart&&function SP(t,n,e){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:o}=n.type.prototype;if(r){const s=v_(n);(e.preOrderHooks??=[]).push(t,s),(e.preOrderCheckHooks??=[]).push(t,s)}i&&(e.preOrderHooks??=[]).push(0-t,i),o&&((e.preOrderHooks??=[]).push(t,o),(e.preOrderCheckHooks??=[]).push(t,o))}(e,o[e],n)}finally{null!==c&&jn(c),od(a),s.resolving=!1,B_()}}return i}function X_(t,n,e){return!!(e[n+(t>>z_)]&1<<t)}function Z_(t,n){return!(t&Ne.Self||t&Ne.Host&&n)}class Nn{constructor(n,e){this._tNode=n,this._lView=e}get(n,e,r){return K_(this._tNode,this._lView,n,$l(r),e)}}function VP(){return new Nn(dn(),j())}function $t(t){return Ti(()=>{const n=t.prototype.constructor,e=n[Mi]||ug(n),r=Object.prototype;let i=Object.getPrototypeOf(t.prototype).constructor;for(;i&&i!==r;){const o=i[Mi]||ug(i);if(o&&o!==e)return o;i=Object.getPrototypeOf(i)}return o=>new o})}function ug(t){return Ep(t)?()=>{const n=ug(ye(t));return n&&n()}:ns(t)}function Q_(t){const n=t[J],e=n.type;return 2===e?n.declTNode:1===e?t[mn]:null}const ea="__parameters__";function na(t,n,e){return Ti(()=>{const r=function cg(t){return function(...e){if(t){const r=t(...e);for(const i in r)this[i]=r[i]}}}(n);function i(...o){if(this instanceof i)return r.apply(this,o),this;const s=new i(...o);return a.annotation=s,a;function a(u,c,l){const d=u.hasOwnProperty(ea)?u[ea]:Object.defineProperty(u,ea,{value:[]})[ea];for(;d.length<=l;)d.push(null);return(d[l]=d[l]||[]).push(s),u}}return e&&(i.prototype=Object.create(e.prototype)),i.prototype.ngMetadataName=t,i.annotationCls=i,i})}function ia(t,n){t.forEach(e=>Array.isArray(e)?ia(e,n):n(e))}function e1(t,n,e){n>=t.length?t.push(e):t.splice(n,0,e)}function ld(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}function zu(t,n){const e=[];for(let r=0;r<t;r++)e.push(n);return e}function or(t,n,e){let r=oa(t,n);return r>=0?t[1|r]=e:(r=~r,function qP(t,n,e,r){let i=t.length;if(i==n)t.push(e,r);else if(1===i)t.push(r,t[0]),t[0]=e;else{for(i--,t.push(t[i-1],t[i]);i>n;)t[i]=t[i-2],i--;t[n]=e,t[n+1]=r}}(t,r,n,e)),r}function lg(t,n){const e=oa(t,n);if(e>=0)return t[1|e]}function oa(t,n){return function t1(t,n,e){let r=0,i=t.length>>e;for(;i!==r;){const o=r+(i-r>>1),s=t[o<<e];if(n===s)return o<<e;s>n?i=o:r=o+1}return~(i<<e)}(t,n,1)}const fd=Su(na("Optional"),8),hd=Su(na("SkipSelf"),4);function yd(t){return 128==(128&t.flags)}var mo=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}(mo||{});const pF=/^>|^->|<!--|-->|--!>|<!-$/g,gF=/(<|>)/g,mF="\u200b$1\u200b";const gg=new Map;let vF=0;const vg="__ngContext__";function vn(t,n){Wn(n)?(t[vg]=n[Nu],function bF(t){gg.set(t[Nu],t)}(n)):t[vg]=n}let yg;function bg(t,n){return yg(t,n)}function qu(t){const n=t[Ct];return An(n)?n[Ct]:n}function C1(t){return E1(t[Ru])}function x1(t){return E1(t[Or])}function E1(t){for(;null!==t&&!An(t);)t=t[Or];return t}function ua(t,n,e,r,i){if(null!=r){let o,s=!1;An(r)?o=r:Wn(r)&&(s=!0,r=r[Mt]);const a=ft(r);0===t&&null!==e?null==i?T1(n,e,a):os(n,e,a,i||null,!0):1===t&&null!==e?os(n,e,a,i||null,!0):2===t?function Dd(t,n,e){const r=xd(t,n);r&&function BF(t,n,e,r){t.removeChild(n,e,r)}(t,r,n,e)}(n,a,s):3===t&&n.destroyNode(a),null!=o&&function HF(t,n,e,r,i){const o=e[ni];o!==ft(e)&&ua(n,t,r,o,i);for(let a=cn;a<e.length;a++){const u=e[a];Yu(u[J],u,t,n,r,o)}}(n,t,o,e,i)}}function wg(t,n){return t.createComment(function p1(t){return t.replace(pF,n=>n.replace(gF,mF))}(n))}function _d(t,n,e){return t.createElement(n,e)}function I1(t,n){const e=t[qs],r=e.indexOf(n);E_(n),e.splice(r,1)}function Cd(t,n){if(t.length<=cn)return;const e=cn+n,r=t[e];if(r){const i=r[Ou];null!==i&&i!==t&&I1(i,r),n>0&&(t[e-1][Or]=r[Or]);const o=ld(t,cn+n);!function AF(t,n){Yu(t,n,n[Ce],2,null,null),n[Mt]=null,n[mn]=null}(r[J],r);const s=o[ti];null!==s&&s.detachView(o[J]),r[Ct]=null,r[Or]=null,r[Ie]&=-129}return r}function _g(t,n){if(!(256&n[Ie])){const e=n[Ce];n[ku]&&c_(n[ku]),n[Pu]&&c_(n[Pu]),e.destroyNode&&Yu(t,n,e,3,null,null),function NF(t){let n=t[Ru];if(!n)return Cg(t[J],t);for(;n;){let e=null;if(Wn(n))e=n[Ru];else{const r=n[cn];r&&(e=r)}if(!e){for(;n&&!n[Or]&&n!==t;)Wn(n)&&Cg(n[J],n),n=n[Ct];null===n&&(n=t),Wn(n)&&Cg(n[J],n),e=n&&n[Or]}n=e}}(n)}}function Cg(t,n){if(!(256&n[Ie])){n[Ie]&=-129,n[Ie]|=256,function LF(t,n){let e;if(null!=t&&null!=(e=t.destroyHooks))for(let r=0;r<e.length;r+=2){const i=n[e[r]];if(!(i instanceof Vu)){const o=e[r+1];if(Array.isArray(o))for(let s=0;s<o.length;s+=2){const a=i[o[s]],u=o[s+1];ri(4,a,u);try{u.call(a)}finally{ri(5,a,u)}}else{ri(4,i,o);try{o.call(i)}finally{ri(5,i,o)}}}}}(t,n),function FF(t,n){const e=t.cleanup,r=n[Ws];if(null!==e)for(let o=0;o<e.length-1;o+=2)if("string"==typeof e[o]){const s=e[o+3];s>=0?r[s]():r[-s].unsubscribe(),o+=2}else e[o].call(r[e[o+1]]);null!==r&&(n[Ws]=null);const i=n[fo];if(null!==i){n[fo]=null;for(let o=0;o<i.length;o++)(0,i[o])()}}(t,n),1===n[J].type&&n[Ce].destroy();const e=n[Ou];if(null!==e&&An(n[Ct])){e!==n[Ct]&&I1(e,n);const r=n[ti];null!==r&&r.detachView(t)}!function wF(t){gg.delete(t[Nu])}(n)}}function xg(t,n,e){return function S1(t,n,e){let r=n;for(;null!==r&&40&r.type;)r=(n=r).parent;if(null===r)return e[Mt];{const{componentOffset:i}=r;if(i>-1){const{encapsulation:o}=t.data[r.directiveStart+i];if(o===Ar.None||o===Ar.Emulated)return null}return zn(r,e)}}(t,n.parent,e)}function os(t,n,e,r,i){t.insertBefore(n,e,r,i)}function T1(t,n,e){t.appendChild(n,e)}function M1(t,n,e,r,i){null!==r?os(t,n,e,r,i):T1(t,n,e)}function xd(t,n){return t.parentNode(n)}function A1(t,n,e){return O1(t,n,e)}let Eg,Id,Tg,Sd,O1=function R1(t,n,e){return 40&t.type?zn(t,e):null};function Ed(t,n,e,r){const i=xg(t,r,n),o=n[Ce],a=A1(r.parent||n[mn],r,n);if(null!=i)if(Array.isArray(e))for(let u=0;u<e.length;u++)M1(o,i,e[u],a,!1);else M1(o,i,e,a,!1);void 0!==Eg&&Eg(o,r,n,e,i)}function Ku(t,n){if(null!==n){const e=n.type;if(3&e)return zn(n,t);if(4&e)return Dg(-1,t[n.index]);if(8&e){const r=n.child;if(null!==r)return Ku(t,r);{const i=t[n.index];return An(i)?Dg(-1,i):ft(i)}}if(32&e)return bg(n,t)()||ft(t[n.index]);{const r=k1(t,n);return null!==r?Array.isArray(r)?r[0]:Ku(qu(t[kt]),r):Ku(t,n.next)}}return null}function k1(t,n){return null!==n?t[kt][mn].projection[n.projection]:null}function Dg(t,n){const e=cn+t+1;if(e<n.length){const r=n[e],i=r[J].firstChild;if(null!==i)return Ku(r,i)}return n[ni]}function Ig(t,n,e,r,i,o,s){for(;null!=e;){const a=r[e.index],u=e.type;if(s&&0===n&&(a&&vn(ft(a),r),e.flags|=2),32!=(32&e.flags))if(8&u)Ig(t,n,e.child,r,i,o,!1),ua(n,t,i,a,o);else if(32&u){const c=bg(e,r);let l;for(;l=c();)ua(n,t,i,l,o);ua(n,t,i,a,o)}else 16&u?F1(t,n,r,e,i,o):ua(n,t,i,a,o);e=s?e.projectionNext:e.next}}function Yu(t,n,e,r,i,o){Ig(e,r,t.firstChild,n,i,o,!1)}function F1(t,n,e,r,i,o){const s=e[kt],u=s[mn].projection[r.projection];if(Array.isArray(u))for(let c=0;c<u.length;c++)ua(n,t,i,u[c],o);else{let c=u;const l=s[Ct];yd(r)&&(c.flags|=128),Ig(t,n,c,l,i,o,!0)}}function L1(t,n,e){""===e?t.removeAttribute(n,"class"):t.setAttribute(n,"class",e)}function B1(t,n,e){const{mergedAttrs:r,classes:i,styles:o}=e;null!==r&&Lp(t,n,r),null!==i&&L1(t,n,i),null!==o&&function WF(t,n,e){t.setAttribute(n,"style",e)}(t,n,o)}function ca(t){return function Sg(){if(void 0===Id&&(Id=null,dt.trustedTypes))try{Id=dt.trustedTypes.createPolicy("angular",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return Id}()?.createHTML(t)||t}function la(){if(void 0!==Tg)return Tg;if(typeof document<"u")return document;throw new $(210,!1)}function V1(t){return function Mg(){if(void 0===Sd&&(Sd=null,dt.trustedTypes))try{Sd=dt.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return Sd}()?.createHTML(t)||t}class j1{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Rw})`}}function vo(t){return t instanceof j1?t.changingThisBreaksApplicationSecurity:t}function Xu(t,n){const e=function JF(t){return t instanceof j1&&t.getTypeName()||null}(t);if(null!=e&&e!==n){if("ResourceURL"===e&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${e} (see ${Rw})`)}return e===n}class eL{constructor(n){this.inertDocumentHelper=n}getInertBodyElement(n){n="<body><remove></remove>"+n;try{const e=(new window.DOMParser).parseFromString(ca(n),"text/html").body;return null===e?this.inertDocumentHelper.getInertBodyElement(n):(e.removeChild(e.firstChild),e)}catch{return null}}}class tL{constructor(n){this.defaultDoc=n,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(n){const e=this.inertDocument.createElement("template");return e.innerHTML=ca(n),e}}const rL=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function Ag(t){return(t=String(t)).match(rL)?t:"unsafe:"+t}function Pi(t){const n={};for(const e of t.split(","))n[e]=!0;return n}function Zu(...t){const n={};for(const e of t)for(const r in e)e.hasOwnProperty(r)&&(n[r]=!0);return n}const z1=Pi("area,br,col,hr,img,wbr"),G1=Pi("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),$1=Pi("rp,rt"),Rg=Zu(z1,Zu(G1,Pi("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Zu($1,Pi("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Zu($1,G1)),Og=Pi("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),q1=Zu(Og,Pi("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Pi("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),iL=Pi("script,style,template");class oL{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(n){let e=n.firstChild,r=!0;for(;e;)if(e.nodeType===Node.ELEMENT_NODE?r=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,r&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let i=this.checkClobberedElement(e,e.nextSibling);if(i){e=i;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")}startElement(n){const e=n.nodeName.toLowerCase();if(!Rg.hasOwnProperty(e))return this.sanitizedSomething=!0,!iL.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);const r=n.attributes;for(let i=0;i<r.length;i++){const o=r.item(i),s=o.name,a=s.toLowerCase();if(!q1.hasOwnProperty(a)){this.sanitizedSomething=!0;continue}let u=o.value;Og[a]&&(u=Ag(u)),this.buf.push(" ",s,'="',K1(u),'"')}return this.buf.push(">"),!0}endElement(n){const e=n.nodeName.toLowerCase();Rg.hasOwnProperty(e)&&!z1.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(n){this.buf.push(K1(n))}checkClobberedElement(n,e){if(e&&(n.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${n.outerHTML}`);return e}}const sL=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,aL=/([^\#-~ |!])/g;function K1(t){return t.replace(/&/g,"&amp;").replace(sL,function(n){return"&#"+(1024*(n.charCodeAt(0)-55296)+(n.charCodeAt(1)-56320)+65536)+";"}).replace(aL,function(n){return"&#"+n.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Td;function Ng(t){return"content"in t&&function cL(t){return t.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===t.nodeName}(t)?t.content:null}var da=function(t){return t[t.NONE=0]="NONE",t[t.HTML=1]="HTML",t[t.STYLE=2]="STYLE",t[t.SCRIPT=3]="SCRIPT",t[t.URL=4]="URL",t[t.RESOURCE_URL=5]="RESOURCE_URL",t}(da||{});function Y1(t){const n=Qu();return n?V1(n.sanitize(da.HTML,t)||""):Xu(t,"HTML")?V1(vo(t)):function uL(t,n){let e=null;try{Td=Td||function W1(t){const n=new tL(t);return function nL(){try{return!!(new window.DOMParser).parseFromString(ca(""),"text/html")}catch{return!1}}()?new eL(n):n}(t);let r=n?String(n):"";e=Td.getInertBodyElement(r);let i=5,o=r;do{if(0===i)throw new Error("Failed to sanitize html because the input is unstable");i--,r=o,o=e.innerHTML,e=Td.getInertBodyElement(r)}while(r!==o);return ca((new oL).sanitizeChildren(Ng(e)||e))}finally{if(e){const r=Ng(e)||e;for(;r.firstChild;)r.removeChild(r.firstChild)}}}(la(),_e(t))}function kg(t){const n=Qu();return n?n.sanitize(da.URL,t)||"":Xu(t,"URL")?vo(t):Ag(_e(t))}function Qu(){const t=j();return t&&t[zs].sanitizer}const Ju=new se("ENVIRONMENT_INITIALIZER"),Q1=new se("INJECTOR",-1),J1=new se("INJECTOR_DEF_TYPES");class Pg{get(n,e=Iu){if(e===Iu){const r=new Error(`NullInjectorError: No provider for ${Gt(n)}!`);throw r.name="NullInjectorError",r}return e}}function gL(...t){return{\u0275providers:tC(0,t),\u0275fromNgModule:!0}}function tC(t,...n){const e=[],r=new Set;let i;const o=s=>{e.push(s)};return ia(n,s=>{const a=s;Md(a,o,[],r)&&(i||=[],i.push(a))}),void 0!==i&&nC(i,o),e}function nC(t,n){for(let e=0;e<t.length;e++){const{ngModule:r,providers:i}=t[e];Fg(i,o=>{n(o,r)})}}function Md(t,n,e,r){if(!(t=ye(t)))return!1;let i=null,o=Wl(t);const s=!o&&Ve(t);if(o||s){if(s&&!s.standalone)return!1;i=t}else{const u=t.ngModule;if(o=Wl(u),!o)return!1;i=u}const a=r.has(i);if(s){if(a)return!1;if(r.add(i),s.dependencies){const u="function"==typeof s.dependencies?s.dependencies():s.dependencies;for(const c of u)Md(c,n,e,r)}}else{if(!o)return!1;{if(null!=o.imports&&!a){let c;r.add(i);try{ia(o.imports,l=>{Md(l,n,e,r)&&(c||=[],c.push(l))})}finally{}void 0!==c&&nC(c,n)}if(!a){const c=ns(i)||(()=>new i);n({provide:i,useFactory:c,deps:Ke},i),n({provide:J1,useValue:i,multi:!0},i),n({provide:Ju,useValue:()=>pe(i),multi:!0},i)}const u=o.providers;if(null!=u&&!a){const c=t;Fg(u,l=>{n(l,c)})}}}return i!==t&&void 0!==t.providers}function Fg(t,n){for(let e of t)Dp(e)&&(e=e.\u0275providers),Array.isArray(e)?Fg(e,n):n(e)}const mL=nt({provide:String,useValue:nt});function Lg(t){return null!==t&&"object"==typeof t&&mL in t}function ss(t){return"function"==typeof t}const Bg=new se("Set Injector scope."),Ad={},yL={};let Vg;function Rd(){return void 0===Vg&&(Vg=new Pg),Vg}class _r{}class fa extends _r{get destroyed(){return this._destroyed}constructor(n,e,r,i){super(),this.parent=e,this.source=r,this.scopes=i,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Hg(n,s=>this.processProvider(s)),this.records.set(Q1,ha(void 0,this)),i.has("environment")&&this.records.set(_r,ha(void 0,this));const o=this.records.get(Bg);null!=o&&"string"==typeof o.value&&this.scopes.add(o.value),this.injectorDefTypes=new Set(this.get(J1.multi,Ke,Ne.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const e of this._ngOnDestroyHooks)e.ngOnDestroy();const n=this._onDestroyHooks;this._onDestroyHooks=[];for(const e of n)e()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(n){return this.assertNotDestroyed(),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){this.assertNotDestroyed();const e=co(this),r=jn(void 0);try{return n()}finally{co(e),jn(r)}}get(n,e=Iu,r=Ne.Default){if(this.assertNotDestroyed(),n.hasOwnProperty(Uw))return n[Uw](this);r=$l(r);const o=co(this),s=jn(void 0);try{if(!(r&Ne.SkipSelf)){let u=this.records.get(n);if(void 0===u){const c=function xL(t){return"function"==typeof t||"object"==typeof t&&t instanceof se}(n)&&jl(n);u=c&&this.injectableDefInScope(c)?ha(Ug(n),Ad):null,this.records.set(n,u)}if(null!=u)return this.hydrate(n,u)}return(r&Ne.Self?Rd():this.parent).get(n,e=r&Ne.Optional&&e===Iu?null:e)}catch(a){if("NullInjectorError"===a.name){if((a[Gl]=a[Gl]||[]).unshift(Gt(n)),o)throw a;return function wk(t,n,e,r){const i=t[Gl];throw n[Lw]&&i.unshift(n[Lw]),t.message=function _k(t,n,e,r=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.slice(2):t;let i=Gt(n);if(Array.isArray(n))i=n.map(Gt).join(" -> ");else if("object"==typeof n){let o=[];for(let s in n)if(n.hasOwnProperty(s)){let a=n[s];o.push(s+":"+("string"==typeof a?JSON.stringify(a):Gt(a)))}i=`{${o.join(", ")}}`}return`${e}${r?"("+r+")":""}[${i}]: ${t.replace(gk,"\n  ")}`}("\n"+t.message,i,e,r),t.ngTokenPath=i,t[Gl]=null,t}(a,n,"R3InjectorError",this.source)}throw a}finally{jn(s),co(o)}}resolveInjectorInitializers(){const n=co(this),e=jn(void 0);try{const i=this.get(Ju.multi,Ke,Ne.Self);for(const o of i)o()}finally{co(n),jn(e)}}toString(){const n=[],e=this.records;for(const r of e.keys())n.push(Gt(r));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new $(205,!1)}processProvider(n){let e=ss(n=ye(n))?n:ye(n&&n.provide);const r=function wL(t){return Lg(t)?ha(void 0,t.useValue):ha(oC(t),Ad)}(n);if(ss(n)||!0!==n.multi)this.records.get(e);else{let i=this.records.get(e);i||(i=ha(void 0,Ad,!0),i.factory=()=>kp(i.multi),this.records.set(e,i)),e=n,i.multi.push(n)}this.records.set(e,r)}hydrate(n,e){return e.value===Ad&&(e.value=yL,e.value=e.factory()),"object"==typeof e.value&&e.value&&function CL(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}injectableDefInScope(n){if(!n.providedIn)return!1;const e=ye(n.providedIn);return"string"==typeof e?"any"===e||this.scopes.has(e):this.injectorDefTypes.has(e)}removeOnDestroy(n){const e=this._onDestroyHooks.indexOf(n);-1!==e&&this._onDestroyHooks.splice(e,1)}}function Ug(t){const n=jl(t),e=null!==n?n.factory:ns(t);if(null!==e)return e;if(t instanceof se)throw new $(204,!1);if(t instanceof Function)return function bL(t){const n=t.length;if(n>0)throw zu(n,"?"),new $(204,!1);const e=function dk(t){return t&&(t[zl]||t[Nw])||null}(t);return null!==e?()=>e.factory(t):()=>new t}(t);throw new $(204,!1)}function oC(t,n,e){let r;if(ss(t)){const i=ye(t);return ns(i)||Ug(i)}if(Lg(t))r=()=>ye(t.useValue);else if(function iC(t){return!(!t||!t.useFactory)}(t))r=()=>t.useFactory(...kp(t.deps||[]));else if(function rC(t){return!(!t||!t.useExisting)}(t))r=()=>pe(ye(t.useExisting));else{const i=ye(t&&(t.useClass||t.provide));if(!function _L(t){return!!t.deps}(t))return ns(i)||Ug(i);r=()=>new i(...kp(t.deps))}return r}function ha(t,n,e=!1){return{factory:t,value:n,multi:e?[]:void 0}}function Hg(t,n){for(const e of t)Array.isArray(e)?Hg(e,n):e&&Dp(e)?Hg(e.\u0275providers,n):n(e)}const Od=new se("AppId",{providedIn:"root",factory:()=>EL}),EL="ng",sC=new se("Platform Initializer"),yo=new se("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),aC=new se("CSP nonce",{providedIn:"root",factory:()=>la().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let uC=(t,n,e)=>null;function Yg(t,n,e=!1){return uC(t,n,e)}class kL{}class dC{}class FL{resolveComponentFactory(n){throw function PL(t){const n=Error(`No component factory found for ${Gt(t)}.`);return n.ngComponent=t,n}(n)}}let Bd=(()=>{class t{static#e=this.NULL=new FL}return t})();function LL(){return ma(dn(),j())}function ma(t,n){return new en(zn(t,n))}let en=(()=>{class t{constructor(e){this.nativeElement=e}static#e=this.__NG_ELEMENT_ID__=LL}return t})();function BL(t){return t instanceof en?t.nativeElement:t}class hC{}let si=(()=>{class t{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function VL(){const t=j(),e=ir(dn().index,t);return(Wn(e)?e:t)[Ce]}()}return t})(),UL=(()=>{class t{static#e=this.\u0275prov=fe({token:t,providedIn:"root",factory:()=>null})}return t})();class nc{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const HL=new nc("16.2.12"),Qg={};function vC(t,n=null,e=null,r){const i=yC(t,n,e,r);return i.resolveInjectorInitializers(),i}function yC(t,n=null,e=null,r,i=new Set){const o=[e||Ke,gL(t)];return r=r||("object"==typeof t?void 0:Gt(t)),new fa(o,n||Rd(),r||null,i)}let sr=(()=>{class t{static#e=this.THROW_IF_NOT_FOUND=Iu;static#t=this.NULL=new Pg;static create(e,r){if(Array.isArray(e))return vC({name:""},r,e,"");{const i=e.name??"";return vC({name:i},e.parent,e.providers,i)}}static#n=this.\u0275prov=fe({token:t,providedIn:"any",factory:()=>pe(Q1)});static#r=this.__NG_ELEMENT_ID__=-1}return t})();function em(t){return t.ngOriginalError}class Fi{constructor(){this._console=console}handleError(n){const e=this._findOriginalError(n);this._console.error("ERROR",n),e&&this._console.error("ORIGINAL ERROR",e)}_findOriginalError(n){let e=n&&em(n);for(;e&&em(e);)e=em(e);return e||null}}function nm(t){return n=>{setTimeout(t,void 0,n)}}const $e=class KL extends mr{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,e,r){let i=n,o=e||(()=>null),s=r;if(n&&"object"==typeof n){const u=n;i=u.next?.bind(u),o=u.error?.bind(u),s=u.complete?.bind(u)}this.__isAsync&&(o=nm(o),i&&(i=nm(i)),s&&(s=nm(s)));const a=super.subscribe({next:i,error:o,complete:s});return n instanceof Jn&&n.add(a),a}};function wC(...t){}class rt{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new $e(!1),this.onMicrotaskEmpty=new $e(!1),this.onStable=new $e(!1),this.onError=new $e(!1),typeof Zone>"u")throw new $(908,!1);Zone.assertZonePatched();const i=this;i._nesting=0,i._outer=i._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(i._inner=i._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(i._inner=i._inner.fork(Zone.longStackTraceZoneSpec)),i.shouldCoalesceEventChangeDetection=!r&&e,i.shouldCoalesceRunChangeDetection=r,i.lastRequestAnimationFrameId=-1,i.nativeRequestAnimationFrame=function YL(){const t="function"==typeof dt.requestAnimationFrame;let n=dt[t?"requestAnimationFrame":"setTimeout"],e=dt[t?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&n&&e){const r=n[Zone.__symbol__("OriginalDelegate")];r&&(n=r);const i=e[Zone.__symbol__("OriginalDelegate")];i&&(e=i)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function QL(t){const n=()=>{!function ZL(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(dt,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,im(t),t.isCheckStableRunning=!0,rm(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),im(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,r,i,o,s,a)=>{if(function e3(t){return!(!Array.isArray(t)||1!==t.length)&&!0===t[0].data?.__ignore_ng_zone__}(a))return e.invokeTask(i,o,s,a);try{return _C(t),e.invokeTask(i,o,s,a)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===o.type||t.shouldCoalesceRunChangeDetection)&&n(),CC(t)}},onInvoke:(e,r,i,o,s,a,u)=>{try{return _C(t),e.invoke(i,o,s,a,u)}finally{t.shouldCoalesceRunChangeDetection&&n(),CC(t)}},onHasTask:(e,r,i,o)=>{e.hasTask(i,o),r===i&&("microTask"==o.change?(t._hasPendingMicrotasks=o.microTask,im(t),rm(t)):"macroTask"==o.change&&(t.hasPendingMacrotasks=o.macroTask))},onHandleError:(e,r,i,o)=>(e.handleError(i,o),t.runOutsideAngular(()=>t.onError.emit(o)),!1)})}(i)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!rt.isInAngularZone())throw new $(909,!1)}static assertNotInAngularZone(){if(rt.isInAngularZone())throw new $(909,!1)}run(n,e,r){return this._inner.run(n,e,r)}runTask(n,e,r,i){const o=this._inner,s=o.scheduleEventTask("NgZoneEvent: "+i,n,XL,wC,wC);try{return o.runTask(s,e,r)}finally{o.cancelTask(s)}}runGuarded(n,e,r){return this._inner.runGuarded(n,e,r)}runOutsideAngular(n){return this._outer.run(n)}}const XL={};function rm(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function im(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function _C(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function CC(t){t._nesting--,rm(t)}class JL{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new $e,this.onMicrotaskEmpty=new $e,this.onStable=new $e,this.onError=new $e}run(n,e,r){return n.apply(e,r)}runGuarded(n,e,r){return n.apply(e,r)}runOutsideAngular(n){return n()}runTask(n,e,r,i){return n.apply(e,r)}}const xC=new se("",{providedIn:"root",factory:EC});function EC(){const t=re(rt);let n=!0;return function tk(...t){const n=Du(t),e=function KN(t,n){return"number"==typeof _p(t)?t.pop():n}(t,1/0),r=t;return r.length?1===r.length?er(r[0]):Us(e)(Jt(r,n)):Qr}(new Lt(i=>{n=t.isStable&&!t.hasPendingMacrotasks&&!t.hasPendingMicrotasks,t.runOutsideAngular(()=>{i.next(n),i.complete()})}),new Lt(i=>{let o;t.runOutsideAngular(()=>{o=t.onStable.subscribe(()=>{rt.assertNotInAngularZone(),queueMicrotask(()=>{!n&&!t.hasPendingMacrotasks&&!t.hasPendingMicrotasks&&(n=!0,i.next(!0))})})});const s=t.onUnstable.subscribe(()=>{rt.assertInAngularZone(),n&&(n=!1,t.runOutsideAngular(()=>{i.next(!1)}))});return()=>{o.unsubscribe(),s.unsubscribe()}}).pipe(Aw()))}function Li(t){return t instanceof Function?t():t}let om=(()=>{class t{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static#e=this.\u0275prov=fe({token:t,providedIn:"root",factory:()=>new t})}return t})();function rc(t){for(;t;){t[Ie]|=64;const n=qu(t);if(Up(t)&&!n)return t;t=n}return null}const MC=new se("",{providedIn:"root",factory:()=>!1});let Ud=null;function NC(t,n){return t[n]??FC()}function kC(t,n){const e=FC();e.producerNode?.length&&(t[n]=Ud,e.lView=t,Ud=PC())}const d3={...r_,consumerIsAlwaysLive:!0,consumerMarkedDirty:t=>{rc(t.lView)},lView:null};function PC(){return Object.create(d3)}function FC(){return Ud??=PC(),Ud}const Ee={};function Y(t){LC(Ue(),j(),On()+t,!1)}function LC(t,n,e,r){if(!r)if(3==(3&n[Ie])){const o=t.preOrderCheckHooks;null!==o&&rd(n,o,e)}else{const o=t.preOrderHooks;null!==o&&id(n,o,0,e)}rs(e)}function F(t,n=Ne.Default){const e=j();return null===e?pe(t,n):K_(dn(),e,ye(t),n)}function Hd(t,n,e,r,i,o,s,a,u,c,l){const d=n.blueprint.slice();return d[Mt]=i,d[Ie]=140|r,(null!==c||t&&2048&t[Ie])&&(d[Ie]|=2048),x_(d),d[Ct]=d[Gs]=t,d[Nt]=e,d[zs]=s||t&&t[zs],d[Ce]=a||t&&t[Ce],d[lo]=u||t&&t[lo]||null,d[mn]=o,d[Nu]=function yF(){return vF++}(),d[Ai]=l,d[Jw]=c,d[kt]=2==n.type?t[kt]:d,d}function ba(t,n,e,r,i){let o=t.data[n];if(null===o)o=function sm(t,n,e,r,i){const o=M_(),s=Kp(),u=t.data[n]=function b3(t,n,e,r,i,o){let s=n?n.injectorIndex:-1,a=0;return Xs()&&(a|=128),{type:e,index:r,insertBeforeIndex:null,injectorIndex:s,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:i,attrs:o,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,s?o:o&&o.parent,e,n,r,i);return null===t.firstChild&&(t.firstChild=u),null!==o&&(s?null==o.child&&null!==u.parent&&(o.child=u):null===o.next&&(o.next=u,u.prev=o)),u}(t,n,e,r,i),function yP(){return ve.lFrame.inI18n}()&&(o.flags|=32);else if(64&o.type){o.type=e,o.value=r,o.attrs=i;const s=function Bu(){const t=ve.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}();o.injectorIndex=null===s?-1:s.injectorIndex}return ii(o,!0),o}function ic(t,n,e,r){if(0===e)return-1;const i=n.length;for(let o=0;o<e;o++)n.push(r),t.blueprint.push(r),t.data.push(null);return i}function VC(t,n,e,r,i){const o=NC(n,ku),s=On(),a=2&r;try{rs(-1),a&&n.length>ke&&LC(t,n,ke,!1),ri(a?2:0,i);const c=a?o:null,l=jp(c);try{null!==c&&(c.dirty=!1),e(r,i)}finally{Wp(c,l)}}finally{a&&null===n[ku]&&kC(n,ku),rs(s),ri(a?3:1,i)}}function am(t,n,e){if(Vp(n)){const r=br(null);try{const o=n.directiveEnd;for(let s=n.directiveStart;s<o;s++){const a=t.data[s];a.contentQueries&&a.contentQueries(1,e[s],s)}}finally{br(r)}}}function um(t,n,e){T_()&&(function I3(t,n,e,r){const i=e.directiveStart,o=e.directiveEnd;ts(e)&&function N3(t,n,e){const r=zn(n,t),i=UC(e);let s=16;e.signals?s=4096:e.onPush&&(s=64);const a=jd(t,Hd(t,i,null,s,r,n,null,t[zs].rendererFactory.createRenderer(r,e),null,null,null));t[n.index]=a}(n,e,t.data[i+e.componentOffset]),t.firstCreatePass||sd(e,n),vn(r,n);const s=e.initialInputs;for(let a=i;a<o;a++){const u=t.data[a],c=is(n,t,a,e);vn(c,n),null!==s&&k3(0,a-i,c,u,0,s),Nr(u)&&(ir(e.index,n)[Nt]=is(n,t,a,e))}}(t,n,e,zn(e,n)),64==(64&e.flags)&&GC(t,n,e))}function cm(t,n,e=zn){const r=n.localNames;if(null!==r){let i=n.index+1;for(let o=0;o<r.length;o+=2){const s=r[o+1],a=-1===s?e(n,t):t[s];t[i++]=a}}}function UC(t){const n=t.tView;return null===n||n.incompleteFirstPass?t.tView=lm(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):n}function lm(t,n,e,r,i,o,s,a,u,c,l){const d=ke+r,f=d+i,h=function h3(t,n){const e=[];for(let r=0;r<n;r++)e.push(r<t?null:Ee);return e}(d,f),p="function"==typeof c?c():c;return h[J]={type:t,blueprint:h,template:e,queries:null,viewQuery:a,declTNode:n,data:h.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:f,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof o?o():o,pipeRegistry:"function"==typeof s?s():s,firstChild:null,schemas:u,consts:p,incompleteFirstPass:!1,ssrId:l}}let HC=t=>null;function jC(t,n,e,r){for(let i in t)if(t.hasOwnProperty(i)){e=null===e?{}:e;const o=t[i];null===r?WC(e,n,i,o):r.hasOwnProperty(i)&&WC(e,n,r[i],o)}return e}function WC(t,n,e,r){t.hasOwnProperty(e)?t[e].push(n,r):t[e]=[n,r]}function ar(t,n,e,r,i,o,s,a){const u=zn(n,e);let l,c=n.inputs;!a&&null!=c&&(l=c[r])?(gm(t,e,l,r,i),ts(n)&&function C3(t,n){const e=ir(n,t);16&e[Ie]||(e[Ie]|=64)}(e,n.index)):3&n.type&&(r=function _3(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(r),i=null!=s?s(i,n.value||"",r):i,o.setProperty(u,r,i))}function dm(t,n,e,r){if(T_()){const i=null===r?null:{"":-1},o=function T3(t,n){const e=t.directiveRegistry;let r=null,i=null;if(e)for(let o=0;o<e.length;o++){const s=e[o];if(qw(n,s.selectors,!1))if(r||(r=[]),Nr(s))if(null!==s.findHostDirectiveDefs){const a=[];i=i||new Map,s.findHostDirectiveDefs(s,a,i),r.unshift(...a,s),fm(t,n,a.length)}else r.unshift(s),fm(t,n,0);else i=i||new Map,s.findHostDirectiveDefs?.(s,r,i),r.push(s)}return null===r?null:[r,i]}(t,e);let s,a;null===o?s=a=null:[s,a]=o,null!==s&&zC(t,n,e,s,i,a),i&&function M3(t,n,e){if(n){const r=t.localNames=[];for(let i=0;i<n.length;i+=2){const o=e[n[i+1]];if(null==o)throw new $(-301,!1);r.push(n[i],o)}}}(e,r,i)}e.mergedAttrs=Mu(e.mergedAttrs,e.attrs)}function zC(t,n,e,r,i,o){for(let c=0;c<r.length;c++)ag(sd(e,n),t,r[c].type);!function R3(t,n,e){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+e,t.providerIndexes=n}(e,t.data.length,r.length);for(let c=0;c<r.length;c++){const l=r[c];l.providersResolver&&l.providersResolver(l)}let s=!1,a=!1,u=ic(t,n,r.length,null);for(let c=0;c<r.length;c++){const l=r[c];e.mergedAttrs=Mu(e.mergedAttrs,l.hostAttrs),O3(t,e,n,u,l),A3(u,l,i),null!==l.contentQueries&&(e.flags|=4),(null!==l.hostBindings||null!==l.hostAttrs||0!==l.hostVars)&&(e.flags|=64);const d=l.type.prototype;!s&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((t.preOrderHooks??=[]).push(e.index),s=!0),!a&&(d.ngOnChanges||d.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(e.index),a=!0),u++}!function w3(t,n,e){const i=n.directiveEnd,o=t.data,s=n.attrs,a=[];let u=null,c=null;for(let l=n.directiveStart;l<i;l++){const d=o[l],f=e?e.get(d):null,p=f?f.outputs:null;u=jC(d.inputs,l,u,f?f.inputs:null),c=jC(d.outputs,l,c,p);const g=null===u||null===s||$w(n)?null:P3(u,l,s);a.push(g)}null!==u&&(u.hasOwnProperty("class")&&(n.flags|=8),u.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=a,n.inputs=u,n.outputs=c}(t,e,o)}function GC(t,n,e){const r=e.directiveStart,i=e.directiveEnd,o=e.index,s=function wP(){return ve.lFrame.currentDirectiveIndex}();try{rs(o);for(let a=r;a<i;a++){const u=t.data[a],c=n[a];Xp(a),(null!==u.hostBindings||0!==u.hostVars||null!==u.hostAttrs)&&S3(u,c)}}finally{rs(-1),Xp(s)}}function S3(t,n){null!==t.hostBindings&&t.hostBindings(1,n)}function fm(t,n,e){n.componentOffset=e,(t.components??=[]).push(n.index)}function A3(t,n,e){if(e){if(n.exportAs)for(let r=0;r<n.exportAs.length;r++)e[n.exportAs[r]]=t;Nr(n)&&(e[""]=t)}}function O3(t,n,e,r,i){t.data[r]=i;const o=i.factory||(i.factory=ns(i.type)),s=new Vu(o,Nr(i),F);t.blueprint[r]=s,e[r]=s,function E3(t,n,e,r,i){const o=i.hostBindings;if(o){let s=t.hostBindingOpCodes;null===s&&(s=t.hostBindingOpCodes=[]);const a=~n.index;(function D3(t){let n=t.length;for(;n>0;){const e=t[--n];if("number"==typeof e&&e<0)return e}return 0})(s)!=a&&s.push(a),s.push(e,r,o)}}(t,n,r,ic(t,e,i.hostVars,Ee),i)}function ai(t,n,e,r,i,o){const s=zn(t,n);!function hm(t,n,e,r,i,o,s){if(null==o)t.removeAttribute(n,i,e);else{const a=null==s?_e(o):s(o,r||"",i);t.setAttribute(n,i,a,e)}}(n[Ce],s,o,t.value,e,r,i)}function k3(t,n,e,r,i,o){const s=o[n];if(null!==s)for(let a=0;a<s.length;)$C(r,e,s[a++],s[a++],s[a++])}function $C(t,n,e,r,i){const o=br(null);try{const s=t.inputTransforms;null!==s&&s.hasOwnProperty(r)&&(i=s[r].call(n,i)),null!==t.setInput?t.setInput(n,i,e,r):n[r]=i}finally{br(o)}}function P3(t,n,e){let r=null,i=0;for(;i<e.length;){const o=e[i];if(0!==o)if(5!==o){if("number"==typeof o)break;if(t.hasOwnProperty(o)){null===r&&(r=[]);const s=t[o];for(let a=0;a<s.length;a+=2)if(s[a]===n){r.push(o,s[a+1],e[i+1]);break}}i+=2}else i+=2;else i+=4}return r}function qC(t,n,e,r){return[t,!0,!1,n,null,0,r,e,null,null,null]}function KC(t,n){const e=t.contentQueries;if(null!==e)for(let r=0;r<e.length;r+=2){const o=e[r+1];if(-1!==o){const s=t.data[o];Qp(e[r]),s.contentQueries(2,n[o],o)}}}function jd(t,n){return t[Ru]?t[Qw][Or]=n:t[Ru]=n,t[Qw]=n,n}function pm(t,n,e){Qp(0);const r=br(null);try{n(t,e)}finally{br(r)}}function YC(t){return t[Ws]||(t[Ws]=[])}function XC(t){return t.cleanup||(t.cleanup=[])}function QC(t,n){const e=t[lo],r=e?e.get(Fi,null):null;r&&r.handleError(n)}function gm(t,n,e,r,i){for(let o=0;o<e.length;){const s=e[o++],a=e[o++];$C(t.data[s],n[s],r,a,i)}}function F3(t,n){const e=ir(n,t),r=e[J];!function L3(t,n){for(let e=n.length;e<t.blueprint.length;e++)n.push(t.blueprint[e])}(r,e);const i=e[Mt];null!==i&&null===e[Ai]&&(e[Ai]=Yg(i,e[lo])),mm(r,e,e[Nt])}function mm(t,n,e){Jp(n);try{const r=t.viewQuery;null!==r&&pm(1,r,e);const i=t.template;null!==i&&VC(t,n,i,1,e),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&KC(t,n),t.staticViewQueries&&pm(2,t.viewQuery,e);const o=t.components;null!==o&&function B3(t,n){for(let e=0;e<n.length;e++)F3(t,n[e])}(n,o)}catch(r){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),r}finally{n[Ie]&=-5,eg()}}let JC=(()=>{class t{constructor(){this.all=new Set,this.queue=new Map}create(e,r,i){const o=typeof Zone>"u"?null:Zone.current,s=function Xk(t,n,e){const r=Object.create(Zk);e&&(r.consumerAllowSignalWrites=!0),r.fn=t,r.schedule=n;const i=s=>{r.cleanupFn=s};return r.ref={notify:()=>a_(r),run:()=>{if(r.dirty=!1,r.hasRun&&!u_(r))return;r.hasRun=!0;const s=jp(r);try{r.cleanupFn(),r.cleanupFn=m_,r.fn(i)}finally{Wp(r,s)}},cleanup:()=>r.cleanupFn()},r.ref}(e,c=>{this.all.has(c)&&this.queue.set(c,o)},i);let a;this.all.add(s),s.notify();const u=()=>{s.cleanup(),a?.(),this.all.delete(s),this.queue.delete(s)};return a=r?.onDestroy(u),{destroy:u}}flush(){if(0!==this.queue.size)for(const[e,r]of this.queue)this.queue.delete(e),r?r.run(()=>e.run()):e.run()}get isQueueEmpty(){return 0===this.queue.size}static#e=this.\u0275prov=fe({token:t,providedIn:"root",factory:()=>new t})}return t})();function Wd(t,n,e){let r=e?t.styles:null,i=e?t.classes:null,o=0;if(null!==n)for(let s=0;s<n.length;s++){const a=n[s];"number"==typeof a?o=a:1==o?i=xp(i,a):2==o&&(r=xp(r,a+": "+n[++s]+";"))}e?t.styles=r:t.stylesWithoutHost=r,e?t.classes=i:t.classesWithoutHost=i}function oc(t,n,e,r,i=!1){for(;null!==e;){const o=n[e.index];null!==o&&r.push(ft(o)),An(o)&&ex(o,r);const s=e.type;if(8&s)oc(t,n,e.child,r);else if(32&s){const a=bg(e,n);let u;for(;u=a();)r.push(u)}else if(16&s){const a=k1(n,e);if(Array.isArray(a))r.push(...a);else{const u=qu(n[kt]);oc(u[J],u,a,r,!0)}}e=i?e.projectionNext:e.next}return r}function ex(t,n){for(let e=cn;e<t.length;e++){const r=t[e],i=r[J].firstChild;null!==i&&oc(r[J],r,i,n)}t[ni]!==t[Mt]&&n.push(t[ni])}function zd(t,n,e,r=!0){const i=n[zs],o=i.rendererFactory,s=i.afterRenderEventManager;o.begin?.(),s?.begin();try{tx(t,n,t.template,e)}catch(u){throw r&&QC(n,u),u}finally{o.end?.(),i.effectManager?.flush(),s?.end()}}function tx(t,n,e,r){const i=n[Ie];if(256!=(256&i)){n[zs].effectManager?.flush(),Jp(n);try{x_(n),function R_(t){return ve.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==e&&VC(t,n,e,2,r);const s=3==(3&i);if(s){const c=t.preOrderCheckHooks;null!==c&&rd(n,c,null)}else{const c=t.preOrderHooks;null!==c&&id(n,c,0,null),ng(n,0)}if(function H3(t){for(let n=C1(t);null!==n;n=x1(n)){if(!n[e_])continue;const e=n[qs];for(let r=0;r<e.length;r++){aP(e[r])}}}(n),nx(n,2),null!==t.contentQueries&&KC(t,n),s){const c=t.contentCheckHooks;null!==c&&rd(n,c)}else{const c=t.contentHooks;null!==c&&id(n,c,1),ng(n,1)}!function f3(t,n){const e=t.hostBindingOpCodes;if(null===e)return;const r=NC(n,Pu);try{for(let i=0;i<e.length;i++){const o=e[i];if(o<0)rs(~o);else{const s=o,a=e[++i],u=e[++i];bP(a,s),r.dirty=!1;const c=jp(r);try{u(2,n[s])}finally{Wp(r,c)}}}}finally{null===n[Pu]&&kC(n,Pu),rs(-1)}}(t,n);const a=t.components;null!==a&&ix(n,a,0);const u=t.viewQuery;if(null!==u&&pm(2,u,r),s){const c=t.viewCheckHooks;null!==c&&rd(n,c)}else{const c=t.viewHooks;null!==c&&id(n,c,2),ng(n,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),n[Ie]&=-73,E_(n)}finally{eg()}}}function nx(t,n){for(let e=C1(t);null!==e;e=x1(e))for(let r=cn;r<e.length;r++)rx(e[r],n)}function j3(t,n,e){rx(ir(n,t),e)}function rx(t,n){if(!function oP(t){return 128==(128&t[Ie])}(t))return;const e=t[J],r=t[Ie];if(80&r&&0===n||1024&r||2===n)tx(e,t,e.template,t[Nt]);else if(t[Au]>0){nx(t,1);const i=e.components;null!==i&&ix(t,i,1)}}function ix(t,n,e){for(let r=0;r<n.length;r++)j3(t,n[r],e)}class sc{get rootNodes(){const n=this._lView,e=n[J];return oc(e,n,e.firstChild,[])}constructor(n,e){this._lView=n,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Nt]}set context(n){this._lView[Nt]=n}get destroyed(){return 256==(256&this._lView[Ie])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[Ct];if(An(n)){const e=n[8],r=e?e.indexOf(this):-1;r>-1&&(Cd(n,r),ld(e,r))}this._attachedToViewContainer=!1}_g(this._lView[J],this._lView)}onDestroy(n){!function I_(t,n){if(256==(256&t[Ie]))throw new $(911,!1);null===t[fo]&&(t[fo]=[]),t[fo].push(n)}(this._lView,n)}markForCheck(){rc(this._cdRefInjectingView||this._lView)}detach(){this._lView[Ie]&=-129}reattach(){this._lView[Ie]|=128}detectChanges(){zd(this._lView[J],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new $(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function OF(t,n){Yu(t,n,n[Ce],2,null,null)}(this._lView[J],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new $(902,!1);this._appRef=n}}class W3 extends sc{constructor(n){super(n),this._view=n}detectChanges(){const n=this._view;zd(n[J],n,n[Nt],!1)}checkNoChanges(){}get context(){return null}}class ox extends Bd{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const e=Ve(n);return new ac(e,this.ngModule)}}function sx(t){const n=[];for(let e in t)t.hasOwnProperty(e)&&n.push({propName:t[e],templateName:e});return n}class G3{constructor(n,e){this.injector=n,this.parentInjector=e}get(n,e,r){r=$l(r);const i=this.injector.get(n,Qg,r);return i!==Qg||e===Qg?i:this.parentInjector.get(n,e,r)}}class ac extends dC{get inputs(){const n=this.componentDef,e=n.inputTransforms,r=sx(n.inputs);if(null!==e)for(const i of r)e.hasOwnProperty(i.propName)&&(i.transform=e[i.propName]);return r}get outputs(){return sx(this.componentDef.outputs)}constructor(n,e){super(),this.componentDef=n,this.ngModule=e,this.componentType=n.type,this.selector=function Rk(t){return t.map(Ak).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!e}create(n,e,r,i){let o=(i=i||this.ngModule)instanceof _r?i:i?.injector;o&&null!==this.componentDef.getStandaloneInjector&&(o=this.componentDef.getStandaloneInjector(o)||o);const s=o?new G3(n,o):n,a=s.get(hC,null);if(null===a)throw new $(407,!1);const d={rendererFactory:a,sanitizer:s.get(UL,null),effectManager:s.get(JC,null),afterRenderEventManager:s.get(om,null)},f=a.createRenderer(null,this.componentDef),h=this.componentDef.selectors[0][0]||"div",p=r?function p3(t,n,e,r){const o=r.get(MC,!1)||e===Ar.ShadowDom,s=t.selectRootElement(n,o);return function g3(t){HC(t)}(s),s}(f,r,this.componentDef.encapsulation,s):_d(f,h,function z3(t){const n=t.toLowerCase();return"svg"===n?"svg":"math"===n?"math":null}(h)),v=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let y=null;null!==p&&(y=Yg(p,s,!0));const w=lm(0,null,null,1,0,null,null,null,null,null,null),b=Hd(null,w,null,v,null,null,d,f,s,null,y);let _,C;Jp(b);try{const T=this.componentDef;let S,D=null;T.findHostDirectiveDefs?(S=[],D=new Map,T.findHostDirectiveDefs(T,S,D),S.push(T)):S=[T];const I=function q3(t,n){const e=t[J],r=ke;return t[r]=n,ba(e,r,2,"#host",null)}(b,p),O=function K3(t,n,e,r,i,o,s){const a=i[J];!function Y3(t,n,e,r){for(const i of t)n.mergedAttrs=Mu(n.mergedAttrs,i.hostAttrs);null!==n.mergedAttrs&&(Wd(n,n.mergedAttrs,!0),null!==e&&B1(r,e,n))}(r,t,n,s);let u=null;null!==n&&(u=Yg(n,i[lo]));const c=o.rendererFactory.createRenderer(n,e);let l=16;e.signals?l=4096:e.onPush&&(l=64);const d=Hd(i,UC(e),null,l,i[t.index],t,o,c,null,null,u);return a.firstCreatePass&&fm(a,t,r.length-1),jd(i,d),i[t.index]=d}(I,p,T,S,b,d,f);C=C_(w,ke),p&&function Z3(t,n,e,r){if(r)Lp(t,e,["ng-version",HL.full]);else{const{attrs:i,classes:o}=function Ok(t){const n=[],e=[];let r=1,i=2;for(;r<t.length;){let o=t[r];if("string"==typeof o)2===i?""!==o&&n.push(o,t[++r]):8===i&&e.push(o);else{if(!Rr(i))break;i=o}r++}return{attrs:n,classes:e}}(n.selectors[0]);i&&Lp(t,e,i),o&&o.length>0&&L1(t,e,o.join(" "))}}(f,T,p,r),void 0!==e&&function Q3(t,n,e){const r=t.projection=[];for(let i=0;i<n.length;i++){const o=e[i];r.push(null!=o?Array.from(o):null)}}(C,this.ngContentSelectors,e),_=function X3(t,n,e,r,i,o){const s=dn(),a=i[J],u=zn(s,i);zC(a,i,s,e,null,r);for(let l=0;l<e.length;l++)vn(is(i,a,s.directiveStart+l,s),i);GC(a,i,s),u&&vn(u,i);const c=is(i,a,s.directiveStart+s.componentOffset,s);if(t[Nt]=i[Nt]=c,null!==o)for(const l of o)l(c,n);return am(a,s,t),c}(O,T,S,D,b,[J3]),mm(w,b,null)}finally{eg()}return new $3(this.componentType,_,ma(C,b),b,C)}}class $3 extends kL{constructor(n,e,r,i,o){super(),this.location=r,this._rootLView=i,this._tNode=o,this.previousInputValues=null,this.instance=e,this.hostView=this.changeDetectorRef=new W3(i),this.componentType=n}setInput(n,e){const r=this._tNode.inputs;let i;if(null!==r&&(i=r[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),e))return;const o=this._rootLView;gm(o[J],o,i,n,e),this.previousInputValues.set(n,e),rc(ir(this._tNode.index,o))}}get injector(){return new Nn(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}function J3(){const t=dn();nd(j()[J],t)}function Ye(t){let n=function ax(t){return Object.getPrototypeOf(t.prototype).constructor}(t.type),e=!0;const r=[t];for(;n;){let i;if(Nr(t))i=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new $(903,!1);i=n.\u0275dir}if(i){if(e){r.push(i);const s=t;s.inputs=Gd(t.inputs),s.inputTransforms=Gd(t.inputTransforms),s.declaredInputs=Gd(t.declaredInputs),s.outputs=Gd(t.outputs);const a=i.hostBindings;a&&rB(t,a);const u=i.viewQuery,c=i.contentQueries;if(u&&tB(t,u),c&&nB(t,c),Ul(t.inputs,i.inputs),Ul(t.declaredInputs,i.declaredInputs),Ul(t.outputs,i.outputs),null!==i.inputTransforms&&(null===s.inputTransforms&&(s.inputTransforms={}),Ul(s.inputTransforms,i.inputTransforms)),Nr(i)&&i.data.animation){const l=t.data;l.animation=(l.animation||[]).concat(i.data.animation)}}const o=i.features;if(o)for(let s=0;s<o.length;s++){const a=o[s];a&&a.ngInherit&&a(t),a===Ye&&(e=!1)}}n=Object.getPrototypeOf(n)}!function eB(t){let n=0,e=null;for(let r=t.length-1;r>=0;r--){const i=t[r];i.hostVars=n+=i.hostVars,i.hostAttrs=Mu(i.hostAttrs,e=Mu(e,i.hostAttrs))}}(r)}function Gd(t){return t===ei?{}:t===Ke?[]:t}function tB(t,n){const e=t.viewQuery;t.viewQuery=e?(r,i)=>{n(r,i),e(r,i)}:n}function nB(t,n){const e=t.contentQueries;t.contentQueries=e?(r,i,o)=>{n(r,i,o),e(r,i,o)}:n}function rB(t,n){const e=t.hostBindings;t.hostBindings=e?(r,i)=>{n(r,i),e(r,i)}:n}function $d(t){return!!vm(t)&&(Array.isArray(t)||!(t instanceof Map)&&Symbol.iterator in t)}function vm(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function yn(t,n,e){return!Object.is(t[n],e)&&(t[n]=e,!0)}function bt(t,n,e,r){const i=j();return yn(i,Zs(),n)&&(Ue(),ai(Et(),i,t,n,e,r)),bt}function _a(t,n,e,r){return yn(t,Zs(),e)?n+_e(e)+r:Ee}function de(t,n,e,r,i,o,s,a){const u=j(),c=Ue(),l=t+ke,d=c.firstCreatePass?function TB(t,n,e,r,i,o,s,a,u){const c=n.consts,l=ba(n,t,4,s||null,po(c,a));dm(n,e,l,po(c,u)),nd(n,l);const d=l.tView=lm(2,l,r,i,o,n.directiveRegistry,n.pipeRegistry,null,n.schemas,c,null);return null!==n.queries&&(n.queries.template(n,l),d.queries=n.queries.embeddedTView(l)),l}(l,c,u,n,e,r,i,o,s):c.data[l];ii(d,!1);const f=Ex(c,u,d,t);td()&&Ed(c,u,f,d),vn(f,u),jd(u,u[l]=qC(f,u,f,d)),Zl(d)&&um(c,u,d),null!=s&&cm(u,d,a)}let Ex=function Dx(t,n,e,r){return go(!0),n[Ce].createComment("")};function K(t,n,e){const r=j();return yn(r,Zs(),n)&&ar(Ue(),Et(),r,t,n,r[Ce],e,!1),K}function xm(t,n,e,r,i){const s=i?"class":"style";gm(t,e,n.inputs[s],s,r)}function Z(t,n,e,r){const i=j(),o=Ue(),s=ke+t,a=i[Ce],u=o.firstCreatePass?function NB(t,n,e,r,i,o){const s=n.consts,u=ba(n,t,2,r,po(s,i));return dm(n,e,u,po(s,o)),null!==u.attrs&&Wd(u,u.attrs,!1),null!==u.mergedAttrs&&Wd(u,u.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,u),u}(s,o,i,n,e,r):o.data[s],c=Ix(o,i,u,a,n,t);i[s]=c;const l=Zl(u);return ii(u,!0),B1(a,c,u),32!=(32&u.flags)&&td()&&Ed(o,i,c,u),0===function cP(){return ve.lFrame.elementDepthCount}()&&vn(c,i),function lP(){ve.lFrame.elementDepthCount++}(),l&&(um(o,i,u),am(o,u,i)),null!==r&&cm(i,u),Z}function Q(){let t=dn();Kp()?Yp():(t=t.parent,ii(t,!1));const n=t;(function fP(t){return ve.skipHydrationRootTNode===t})(n)&&function mP(){ve.skipHydrationRootTNode=null}(),function dP(){ve.lFrame.elementDepthCount--}();const e=Ue();return e.firstCreatePass&&(nd(e,t),Vp(t)&&e.queries.elementEnd(t)),null!=n.classesWithoutHost&&function AP(t){return 0!=(8&t.flags)}(n)&&xm(e,n,j(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function RP(t){return 0!=(16&t.flags)}(n)&&xm(e,n,j(),n.stylesWithoutHost,!1),Q}function ht(t,n,e,r){return Z(t,n,e,r),Q(),ht}let Ix=(t,n,e,r,i,o)=>(go(!0),_d(r,i,function V_(){return ve.lFrame.currentNamespace}()));function bo(t,n,e){const r=j(),i=Ue(),o=t+ke,s=i.firstCreatePass?function FB(t,n,e,r,i){const o=n.consts,s=po(o,r),a=ba(n,t,8,"ng-container",s);return null!==s&&Wd(a,s,!0),dm(n,e,a,po(o,i)),null!==n.queries&&n.queries.elementStart(n,a),a}(o,i,r,n,e):i.data[o];ii(s,!0);const a=Sx(i,r,s,t);return r[o]=a,td()&&Ed(i,r,a,s),vn(a,r),Zl(s)&&(um(i,r,s),am(i,s,r)),null!=e&&cm(r,s),bo}function wo(){let t=dn();const n=Ue();return Kp()?Yp():(t=t.parent,ii(t,!1)),n.firstCreatePass&&(nd(n,t),Vp(t)&&n.queries.elementEnd(t)),wo}function Vi(t,n,e){return bo(t,n,e),wo(),Vi}let Sx=(t,n,e,r)=>(go(!0),wg(n[Ce],""));function fc(){return j()}function hc(t){return!!t&&"function"==typeof t.then}function Tx(t){return!!t&&"function"==typeof t.subscribe}function Fe(t,n,e,r){const i=j(),o=Ue(),s=dn();return function Ax(t,n,e,r,i,o,s){const a=Zl(r),c=t.firstCreatePass&&XC(t),l=n[Nt],d=YC(n);let f=!0;if(3&r.type||s){const g=zn(r,n),m=s?s(g):g,v=d.length,y=s?b=>s(ft(b[r.index])):r.index;let w=null;if(!s&&a&&(w=function VB(t,n,e,r){const i=t.cleanup;if(null!=i)for(let o=0;o<i.length-1;o+=2){const s=i[o];if(s===e&&i[o+1]===r){const a=n[Ws],u=i[o+2];return a.length>u?a[u]:null}"string"==typeof s&&(o+=2)}return null}(t,n,i,r.index)),null!==w)(w.__ngLastListenerFn__||w).__ngNextListenerFn__=o,w.__ngLastListenerFn__=o,f=!1;else{o=Ox(r,n,l,o,!1);const b=e.listen(m,i,o);d.push(o,b),c&&c.push(i,y,v,v+1)}}else o=Ox(r,n,l,o,!1);const h=r.outputs;let p;if(f&&null!==h&&(p=h[i])){const g=p.length;if(g)for(let m=0;m<g;m+=2){const _=n[p[m]][p[m+1]].subscribe(o),C=d.length;d.push(o,_),c&&c.push(i,r.index,C,-(C+1))}}}(o,i,i[Ce],s,t,n,r),Fe}function Rx(t,n,e,r){try{return ri(6,n,e),!1!==e(r)}catch(i){return QC(t,i),!1}finally{ri(7,n,e)}}function Ox(t,n,e,r,i){return function o(s){if(s===Function)return r;rc(t.componentOffset>-1?ir(t.index,n):n);let u=Rx(n,e,r,s),c=o.__ngNextListenerFn__;for(;c;)u=Rx(n,e,c,s)&&u,c=c.__ngNextListenerFn__;return i&&!1===u&&s.preventDefault(),u}}function qe(t=1){return function CP(t){return(ve.lFrame.contextLView=function xP(t,n){for(;t>0;)n=n[Gs],t--;return n}(t,ve.lFrame.contextLView))[Nt]}(t)}function UB(t,n){let e=null;const r=function Ik(t){const n=t.attrs;if(null!=n){const e=n.indexOf(5);if(!(1&e))return n[e+1]}return null}(t);for(let i=0;i<n.length;i++){const o=n[i];if("*"!==o){if(null===r?qw(t,o,!0):Mk(r,o))return i}else e=i}return e}function Ma(t){const n=j()[kt][mn];if(!n.projection){const r=n.projection=zu(t?t.length:1,null),i=r.slice();let o=n.child;for(;null!==o;){const s=t?UB(o,t):0;null!==s&&(i[s]?i[s].projectionNext=o:r[s]=o,i[s]=o),o=o.next}}}function _o(t,n=0,e){const r=j(),i=Ue(),o=ba(i,ke+t,16,null,e||null);null===o.projection&&(o.projection=n),Yp(),(!r[Ai]||Xs())&&32!=(32&o.flags)&&function UF(t,n,e){F1(n[Ce],0,n,e,xg(t,e,n),A1(e.parent||n[mn],e,n))}(i,r,o)}function Zd(t,n,e,r,i){const o=j(),s=_a(o,n,e,r);return s!==Ee&&ar(Ue(),Et(),o,t,s,o[Ce],i,!1),Zd}function Qd(t,n){return t<<17|n<<2}function Co(t){return t>>17&32767}function Em(t){return 2|t}function us(t){return(131068&t)>>2}function Dm(t,n){return-131069&t|n<<2}function Im(t){return 1|t}function jx(t,n,e,r,i){const o=t[e+1],s=null===n;let a=r?Co(o):us(o),u=!1;for(;0!==a&&(!1===u||s);){const l=t[a+1];$B(t[a],n)&&(u=!0,t[a+1]=r?Im(l):Em(l)),a=r?Co(l):us(l)}u&&(t[e+1]=r?Em(o):Im(o))}function $B(t,n){return null===t||null==n||(Array.isArray(t)?t[1]:t)===n||!(!Array.isArray(t)||"string"!=typeof n)&&oa(t,n)>=0}const Kt={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function Wx(t){return t.substring(Kt.key,Kt.keyEnd)}function zx(t,n){const e=Kt.textEnd;return e===n?-1:(n=Kt.keyEnd=function XB(t,n,e){for(;n<e&&t.charCodeAt(n)>32;)n++;return n}(t,Kt.key=n,e),Aa(t,n,e))}function Aa(t,n,e){for(;n<e&&t.charCodeAt(n)<=32;)n++;return n}function xo(t,n){return function kr(t,n,e,r){const i=j(),o=Ue(),s=ki(2);o.firstUpdatePass&&Zx(o,t,s,r),n!==Ee&&yn(i,s,n)&&Jx(o,o.data[On()],i,i[Ce],t,i[s+1]=function a4(t,n){return null==t||""===t||("string"==typeof n?t+=n:"object"==typeof t&&(t=Gt(vo(t)))),t}(n,e),r,s)}(t,n,null,!0),xo}function Eo(t){Pr(o4,li,t,!0)}function li(t,n){for(let e=function KB(t){return function $x(t){Kt.key=0,Kt.keyEnd=0,Kt.value=0,Kt.valueEnd=0,Kt.textEnd=t.length}(t),zx(t,Aa(t,0,Kt.textEnd))}(n);e>=0;e=zx(n,e))or(t,Wx(n),!0)}function Pr(t,n,e,r){const i=Ue(),o=ki(2);i.firstUpdatePass&&Zx(i,null,o,r);const s=j();if(e!==Ee&&yn(s,o,e)){const a=i.data[On()];if(tE(a,r)&&!Xx(i,o)){let u=r?a.classesWithoutHost:a.stylesWithoutHost;null!==u&&(e=xp(u,e||"")),xm(i,a,s,e,r)}else!function s4(t,n,e,r,i,o,s,a){i===Ee&&(i=Ke);let u=0,c=0,l=0<i.length?i[0]:null,d=0<o.length?o[0]:null;for(;null!==l||null!==d;){const f=u<i.length?i[u+1]:void 0,h=c<o.length?o[c+1]:void 0;let g,p=null;l===d?(u+=2,c+=2,f!==h&&(p=d,g=h)):null===d||null!==l&&l<d?(u+=2,p=l):(c+=2,p=d,g=h),null!==p&&Jx(t,n,e,r,p,g,s,a),l=u<i.length?i[u]:null,d=c<o.length?o[c]:null}}(i,a,s,s[Ce],s[o+1],s[o+1]=function i4(t,n,e){if(null==e||""===e)return Ke;const r=[],i=vo(e);if(Array.isArray(i))for(let o=0;o<i.length;o++)t(r,i[o],!0);else if("object"==typeof i)for(const o in i)i.hasOwnProperty(o)&&t(r,o,i[o]);else"string"==typeof i&&n(r,i);return r}(t,n,e),r,o)}}function Xx(t,n){return n>=t.expandoStartIndex}function Zx(t,n,e,r){const i=t.data;if(null===i[e+1]){const o=i[On()],s=Xx(t,e);tE(o,r)&&null===n&&!s&&(n=!1),n=function e4(t,n,e,r){const i=function Zp(t){const n=ve.lFrame.currentDirectiveIndex;return-1===n?null:t[n]}(t);let o=r?n.residualClasses:n.residualStyles;if(null===i)0===(r?n.classBindings:n.styleBindings)&&(e=pc(e=Sm(null,t,n,e,r),n.attrs,r),o=null);else{const s=n.directiveStylingLast;if(-1===s||t[s]!==i)if(e=Sm(i,t,n,e,r),null===o){let u=function t4(t,n,e){const r=e?n.classBindings:n.styleBindings;if(0!==us(r))return t[Co(r)]}(t,n,r);void 0!==u&&Array.isArray(u)&&(u=Sm(null,t,n,u[1],r),u=pc(u,n.attrs,r),function n4(t,n,e,r){t[Co(e?n.classBindings:n.styleBindings)]=r}(t,n,r,u))}else o=function r4(t,n,e){let r;const i=n.directiveEnd;for(let o=1+n.directiveStylingLast;o<i;o++)r=pc(r,t[o].hostAttrs,e);return pc(r,n.attrs,e)}(t,n,r)}return void 0!==o&&(r?n.residualClasses=o:n.residualStyles=o),e}(i,o,n,r),function zB(t,n,e,r,i,o){let s=o?n.classBindings:n.styleBindings,a=Co(s),u=us(s);t[r]=e;let l,c=!1;if(Array.isArray(e)?(l=e[1],(null===l||oa(e,l)>0)&&(c=!0)):l=e,i)if(0!==u){const f=Co(t[a+1]);t[r+1]=Qd(f,a),0!==f&&(t[f+1]=Dm(t[f+1],r)),t[a+1]=function jB(t,n){return 131071&t|n<<17}(t[a+1],r)}else t[r+1]=Qd(a,0),0!==a&&(t[a+1]=Dm(t[a+1],r)),a=r;else t[r+1]=Qd(u,0),0===a?a=r:t[u+1]=Dm(t[u+1],r),u=r;c&&(t[r+1]=Em(t[r+1])),jx(t,l,r,!0),jx(t,l,r,!1),function GB(t,n,e,r,i){const o=i?t.residualClasses:t.residualStyles;null!=o&&"string"==typeof n&&oa(o,n)>=0&&(e[r+1]=Im(e[r+1]))}(n,l,t,r,o),s=Qd(a,u),o?n.classBindings=s:n.styleBindings=s}(i,o,n,e,s,r)}}function Sm(t,n,e,r,i){let o=null;const s=e.directiveEnd;let a=e.directiveStylingLast;for(-1===a?a=e.directiveStart:a++;a<s&&(o=n[a],r=pc(r,o.hostAttrs,i),o!==t);)a++;return null!==t&&(e.directiveStylingLast=a),r}function pc(t,n,e){const r=e?1:2;let i=-1;if(null!==n)for(let o=0;o<n.length;o++){const s=n[o];"number"==typeof s?i=s:i===r&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),or(t,s,!!e||n[++o]))}return void 0===t?null:t}function o4(t,n,e){const r=String(n);""!==r&&!r.includes(" ")&&or(t,r,e)}function Jx(t,n,e,r,i,o,s,a){if(!(3&n.type))return;const u=t.data,c=u[a+1],l=function WB(t){return 1==(1&t)}(c)?eE(u,n,e,i,us(c),s):void 0;Jd(l)||(Jd(o)||function HB(t){return 2==(2&t)}(c)&&(o=eE(u,null,e,i,a,s)),function jF(t,n,e,r,i){if(n)i?t.addClass(e,r):t.removeClass(e,r);else{let o=-1===r.indexOf("-")?void 0:mo.DashCase;null==i?t.removeStyle(e,r,o):("string"==typeof i&&i.endsWith("!important")&&(i=i.slice(0,-10),o|=mo.Important),t.setStyle(e,r,i,o))}}(r,s,ed(On(),e),i,o))}function eE(t,n,e,r,i,o){const s=null===n;let a;for(;i>0;){const u=t[i],c=Array.isArray(u),l=c?u[1]:u,d=null===l;let f=e[i+1];f===Ee&&(f=d?Ke:void 0);let h=d?lg(f,r):l===r?f:void 0;if(c&&!Jd(h)&&(h=lg(u,r)),Jd(h)&&(a=h,s))return a;const p=t[i+1];i=s?Co(p):us(p)}if(null!==n){let u=o?n.residualClasses:n.residualStyles;null!=u&&(a=lg(u,r))}return a}function Jd(t){return void 0!==t}function tE(t,n){return 0!=(t.flags&(n?8:16))}function He(t,n=""){const e=j(),r=Ue(),i=t+ke,o=r.firstCreatePass?ba(r,i,1,n,null):r.data[i],s=nE(r,e,o,n,t);e[i]=s,td()&&Ed(r,e,s,o),ii(o,!1)}let nE=(t,n,e,r,i)=>(go(!0),function wd(t,n){return t.createText(n)}(n[Ce],r));function ef(t){return Do("",t,""),ef}function Do(t,n,e){const r=j(),i=_a(r,t,n,e);return i!==Ee&&function Bi(t,n,e){const r=ed(n,t);!function D1(t,n,e){t.setValue(n,e)}(t[Ce],r,e)}(r,On(),i),Do}function Tm(t,n,e){Pr(or,li,_a(j(),t,n,e),!0)}const cs=void 0;var T4=["en",[["a","p"],["AM","PM"],cs],[["AM","PM"],cs,cs],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],cs,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],cs,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",cs,"{1} 'at' {0}",cs],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function S4(t){const e=Math.floor(Math.abs(t)),r=t.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===r?1:5}];let Ra={};function kn(t){const n=function M4(t){return t.toLowerCase().replace(/_/g,"-")}(t);let e=xE(n);if(e)return e;const r=n.split("-")[0];if(e=xE(r),e)return e;if("en"===r)return T4;throw new $(701,!1)}function xE(t){return t in Ra||(Ra[t]=dt.ng&&dt.ng.common&&dt.ng.common.locales&&dt.ng.common.locales[t]),Ra[t]}var pt=function(t){return t[t.LocaleId=0]="LocaleId",t[t.DayPeriodsFormat=1]="DayPeriodsFormat",t[t.DayPeriodsStandalone=2]="DayPeriodsStandalone",t[t.DaysFormat=3]="DaysFormat",t[t.DaysStandalone=4]="DaysStandalone",t[t.MonthsFormat=5]="MonthsFormat",t[t.MonthsStandalone=6]="MonthsStandalone",t[t.Eras=7]="Eras",t[t.FirstDayOfWeek=8]="FirstDayOfWeek",t[t.WeekendRange=9]="WeekendRange",t[t.DateFormat=10]="DateFormat",t[t.TimeFormat=11]="TimeFormat",t[t.DateTimeFormat=12]="DateTimeFormat",t[t.NumberSymbols=13]="NumberSymbols",t[t.NumberFormats=14]="NumberFormats",t[t.CurrencyCode=15]="CurrencyCode",t[t.CurrencySymbol=16]="CurrencySymbol",t[t.CurrencyName=17]="CurrencyName",t[t.Currencies=18]="Currencies",t[t.Directionality=19]="Directionality",t[t.PluralCase=20]="PluralCase",t[t.ExtraData=21]="ExtraData",t}(pt||{});const Oa="en-US";let EE=Oa;function Rm(t,n,e,r,i){if(t=ye(t),Array.isArray(t))for(let o=0;o<t.length;o++)Rm(t[o],n,e,r,i);else{const o=Ue(),s=j(),a=dn();let u=ss(t)?t:ye(t.provide);const c=oC(t),l=1048575&a.providerIndexes,d=a.directiveStart,f=a.providerIndexes>>20;if(ss(t)||!t.multi){const h=new Vu(c,i,F),p=Nm(u,n,i?l:l+f,d);-1===p?(ag(sd(a,s),o,u),Om(o,t,n.length),n.push(u),a.directiveStart++,a.directiveEnd++,i&&(a.providerIndexes+=1048576),e.push(h),s.push(h)):(e[p]=h,s[p]=h)}else{const h=Nm(u,n,l+f,d),p=Nm(u,n,l,l+f),m=p>=0&&e[p];if(i&&!m||!i&&!(h>=0&&e[h])){ag(sd(a,s),o,u);const v=function SV(t,n,e,r,i){const o=new Vu(t,e,F);return o.multi=[],o.index=n,o.componentProviders=0,YE(o,i,r&&!e),o}(i?IV:DV,e.length,i,r,c);!i&&m&&(e[p].providerFactory=v),Om(o,t,n.length,0),n.push(u),a.directiveStart++,a.directiveEnd++,i&&(a.providerIndexes+=1048576),e.push(v),s.push(v)}else Om(o,t,h>-1?h:p,YE(e[i?p:h],c,!i&&r));!i&&r&&m&&e[p].componentProviders++}}}function Om(t,n,e,r){const i=ss(n),o=function vL(t){return!!t.useClass}(n);if(i||o){const u=(o?ye(n.useClass):n).prototype.ngOnDestroy;if(u){const c=t.destroyHooks||(t.destroyHooks=[]);if(!i&&n.multi){const l=c.indexOf(e);-1===l?c.push(e,[r,u]):c[l+1].push(r,u)}else c.push(e,u)}}}function YE(t,n,e){return e&&t.componentProviders++,t.multi.push(n)-1}function Nm(t,n,e,r){for(let i=e;i<r;i++)if(n[i]===t)return i;return-1}function DV(t,n,e,r){return km(this.multi,[])}function IV(t,n,e,r){const i=this.multi;let o;if(this.providerFactory){const s=this.providerFactory.componentProviders,a=is(e,e[J],this.providerFactory.index,r);o=a.slice(0,s),km(i,o);for(let u=s;u<a.length;u++)o.push(a[u])}else o=[],km(i,o);return o}function km(t,n){for(let e=0;e<t.length;e++)n.push((0,t[e])());return n}function gt(t,n=[]){return e=>{e.providersResolver=(r,i)=>function EV(t,n,e){const r=Ue();if(r.firstCreatePass){const i=Nr(t);Rm(e,r.data,r.blueprint,i,!0),Rm(n,r.data,r.blueprint,i,!1)}}(r,i?i(t):t,n)}}class ls{}class XE{}class Pm extends ls{constructor(n,e,r){super(),this._parent=e,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new ox(this);const i=nr(n);this._bootstrapComponents=Li(i.bootstrap),this._r3Injector=yC(n,e,[{provide:ls,useValue:this},{provide:Bd,useValue:this.componentFactoryResolver},...r],Gt(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(n)}get injector(){return this._r3Injector}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class Fm extends XE{constructor(n){super(),this.moduleType=n}create(n){return new Pm(this.moduleType,n,[])}}class ZE extends ls{constructor(n){super(),this.componentFactoryResolver=new ox(this),this.instance=null;const e=new fa([...n.providers,{provide:ls,useValue:this},{provide:Bd,useValue:this.componentFactoryResolver}],n.parent||Rd(),n.debugName,new Set(["environment"]));this.injector=e,n.runEnvironmentInitializers&&e.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}}function Lm(t,n,e=null){return new ZE({providers:t,parent:n,debugName:e,runEnvironmentInitializers:!0}).injector}let AV=(()=>{class t{constructor(e){this._injector=e,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e)){const r=tC(0,e.type),i=r.length>0?Lm([r],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e,i)}return this.cachedInjectors.get(e)}ngOnDestroy(){try{for(const e of this.cachedInjectors.values())null!==e&&e.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=fe({token:t,providedIn:"environment",factory:()=>new t(pe(_r))})}return t})();function Na(t){t.getStandaloneInjector=n=>n.get(AV).getOrCreateStandaloneInjector(t)}function oD(t,n,e,r,i,o){const s=n+e;return yn(t,s,i)?function ui(t,n,e){return t[n]=e}(t,s+1,o?r.call(o,i):r(i)):function wc(t,n){const e=t[n];return e===Ee?void 0:e}(t,s+1)}function dD(t,n,e){const r=t+ke,i=j(),o=function Ys(t,n){return t[n]}(i,r);return function _c(t,n){return t[J].data[n].pure}(i,r)?oD(i,Rn(),n,o.transform,e,o):o.transform(e)}function JV(){return this._results[Symbol.iterator]()}class Vm{static#e=Symbol.iterator;get changes(){return this._changes||(this._changes=new $e)}constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=Vm.prototype;e[Symbol.iterator]||(e[Symbol.iterator]=JV)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,e){return this._results.reduce(n,e)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,e){const r=this;r.dirty=!1;const i=function wr(t){return t.flat(Number.POSITIVE_INFINITY)}(n);(this._changesDetected=!function GP(t,n,e){if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++){let i=t[r],o=n[r];if(e&&(i=e(i),o=e(o)),o!==i)return!1}return!0}(r._results,i,e))&&(r._results=i,r.length=i.length,r.last=i[this.length-1],r.first=i[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function tU(t,n,e,r=!0){const i=n[J];if(function kF(t,n,e,r){const i=cn+r,o=e.length;r>0&&(e[i-1][Or]=n),r<o-cn?(n[Or]=e[i],e1(e,cn+r,n)):(e.push(n),n[Or]=null),n[Ct]=e;const s=n[Ou];null!==s&&e!==s&&function PF(t,n){const e=t[qs];n[kt]!==n[Ct][Ct][kt]&&(t[e_]=!0),null===e?t[qs]=[n]:e.push(n)}(s,n);const a=n[ti];null!==a&&a.insertView(t),n[Ie]|=128}(i,n,t,e),r){const o=Dg(e,t),s=n[Ce],a=xd(s,t[ni]);null!==a&&function RF(t,n,e,r,i,o){r[Mt]=i,r[mn]=n,Yu(t,r,e,1,i,o)}(i,t[mn],s,n,a,o)}}let di=(()=>{class t{static#e=this.__NG_ELEMENT_ID__=iU}return t})();const nU=di,rU=class extends nU{constructor(n,e,r){super(),this._declarationLView=n,this._declarationTContainer=e,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,e){return this.createEmbeddedViewImpl(n,e)}createEmbeddedViewImpl(n,e,r){const i=function eU(t,n,e,r){const i=n.tView,a=Hd(t,i,e,4096&t[Ie]?4096:16,null,n,null,null,null,r?.injector??null,r?.hydrationInfo??null);a[Ou]=t[n.index];const c=t[ti];return null!==c&&(a[ti]=c.createEmbeddedView(i)),mm(i,a,e),a}(this._declarationLView,this._declarationTContainer,n,{injector:e,hydrationInfo:r});return new sc(i)}};function iU(){return af(dn(),j())}function af(t,n){return 4&t.type?new rU(n,t,ma(t,n)):null}let Fr=(()=>{class t{static#e=this.__NG_ELEMENT_ID__=lU}return t})();function lU(){return yD(dn(),j())}const dU=Fr,mD=class extends dU{constructor(n,e,r){super(),this._lContainer=n,this._hostTNode=e,this._hostLView=r}get element(){return ma(this._hostTNode,this._hostLView)}get injector(){return new Nn(this._hostTNode,this._hostLView)}get parentInjector(){const n=ad(this._hostTNode,this._hostLView);if(ig(n)){const e=Hu(n,this._hostLView),r=Uu(n);return new Nn(e[J].data[r+8],e)}return new Nn(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const e=vD(this._lContainer);return null!==e&&e[n]||null}get length(){return this._lContainer.length-cn}createEmbeddedView(n,e,r){let i,o;"number"==typeof r?i=r:null!=r&&(i=r.index,o=r.injector);const a=n.createEmbeddedViewImpl(e||{},o,null);return this.insertImpl(a,i,false),a}createComponent(n,e,r,i,o){const s=n&&!function Wu(t){return"function"==typeof t}(n);let a;if(s)a=e;else{const g=e||{};a=g.index,r=g.injector,i=g.projectableNodes,o=g.environmentInjector||g.ngModuleRef}const u=s?n:new ac(Ve(n)),c=r||this.parentInjector;if(!o&&null==u.ngModule){const m=(s?c:this.parentInjector).get(_r,null);m&&(o=m)}Ve(u.componentType??{});const h=u.create(c,i,null,o);return this.insertImpl(h.hostView,a,false),h}insert(n,e){return this.insertImpl(n,e,!1)}insertImpl(n,e,r){const i=n._lView;if(function sP(t){return An(t[Ct])}(i)){const u=this.indexOf(n);if(-1!==u)this.detach(u);else{const c=i[Ct],l=new mD(c,c[mn],c[Ct]);l.detach(l.indexOf(n))}}const s=this._adjustIndex(e),a=this._lContainer;return tU(a,i,s,!r),n.attachToViewContainerRef(),e1(Um(a),s,n),n}move(n,e){return this.insert(n,e)}indexOf(n){const e=vD(this._lContainer);return null!==e?e.indexOf(n):-1}remove(n){const e=this._adjustIndex(n,-1),r=Cd(this._lContainer,e);r&&(ld(Um(this._lContainer),e),_g(r[J],r))}detach(n){const e=this._adjustIndex(n,-1),r=Cd(this._lContainer,e);return r&&null!=ld(Um(this._lContainer),e)?new sc(r):null}_adjustIndex(n,e=0){return n??this.length+e}};function vD(t){return t[8]}function Um(t){return t[8]||(t[8]=[])}function yD(t,n){let e;const r=n[t.index];return An(r)?e=r:(e=qC(r,n,null,t),n[t.index]=e,jd(n,e)),bD(e,n,t,r),new mD(e,t,n)}let bD=function wD(t,n,e,r){if(t[ni])return;let i;i=8&e.type?ft(r):function fU(t,n){const e=t[Ce],r=e.createComment(""),i=zn(n,t);return os(e,xd(e,i),r,function VF(t,n){return t.nextSibling(n)}(e,i),!1),r}(n,e),t[ni]=i};class Hm{constructor(n){this.queryList=n,this.matches=null}clone(){return new Hm(this.queryList)}setDirty(){this.queryList.setDirty()}}class jm{constructor(n=[]){this.queries=n}createEmbeddedView(n){const e=n.queries;if(null!==e){const r=null!==n.contentQueries?n.contentQueries[0]:e.length,i=[];for(let o=0;o<r;o++){const s=e.getByIndex(o);i.push(this.queries[s.indexInDeclarationView].clone())}return new jm(i)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let e=0;e<this.queries.length;e++)null!==DD(n,e).matches&&this.queries[e].setDirty()}}class _D{constructor(n,e,r=null){this.predicate=n,this.flags=e,this.read=r}}class Wm{constructor(n=[]){this.queries=n}elementStart(n,e){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(n,e)}elementEnd(n){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(n)}embeddedTView(n){let e=null;for(let r=0;r<this.length;r++){const i=null!==e?e.length:0,o=this.getByIndex(r).embeddedTView(n,i);o&&(o.indexInDeclarationView=r,null!==e?e.push(o):e=[o])}return null!==e?new Wm(e):null}template(n,e){for(let r=0;r<this.queries.length;r++)this.queries[r].template(n,e)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class zm{constructor(n,e=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(n,e){this.isApplyingToNode(e)&&this.matchTNode(n,e)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,e){this.elementStart(n,e)}embeddedTView(n,e){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,e),new zm(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let r=n.parent;for(;null!==r&&8&r.type&&r.index!==e;)r=r.parent;return e===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(n,e){const r=this.metadata.predicate;if(Array.isArray(r))for(let i=0;i<r.length;i++){const o=r[i];this.matchTNodeWithReadOption(n,e,gU(e,o)),this.matchTNodeWithReadOption(n,e,ud(e,n,o,!1,!1))}else r===di?4&e.type&&this.matchTNodeWithReadOption(n,e,-1):this.matchTNodeWithReadOption(n,e,ud(e,n,r,!1,!1))}matchTNodeWithReadOption(n,e,r){if(null!==r){const i=this.metadata.read;if(null!==i)if(i===en||i===Fr||i===di&&4&e.type)this.addMatch(e.index,-2);else{const o=ud(e,n,i,!1,!1);null!==o&&this.addMatch(e.index,o)}else this.addMatch(e.index,r)}}addMatch(n,e){null===this.matches?this.matches=[n,e]:this.matches.push(n,e)}}function gU(t,n){const e=t.localNames;if(null!==e)for(let r=0;r<e.length;r+=2)if(e[r]===n)return e[r+1];return null}function vU(t,n,e,r){return-1===e?function mU(t,n){return 11&t.type?ma(t,n):4&t.type?af(t,n):null}(n,t):-2===e?function yU(t,n,e){return e===en?ma(n,t):e===di?af(n,t):e===Fr?yD(n,t):void 0}(t,n,r):is(t,t[J],e,n)}function CD(t,n,e,r){const i=n[ti].queries[r];if(null===i.matches){const o=t.data,s=e.matches,a=[];for(let u=0;u<s.length;u+=2){const c=s[u];a.push(c<0?null:vU(n,o[c],s[u+1],e.metadata.read))}i.matches=a}return i.matches}function Gm(t,n,e,r){const i=t.queries.getByIndex(e),o=i.matches;if(null!==o){const s=CD(t,n,i,e);for(let a=0;a<o.length;a+=2){const u=o[a];if(u>0)r.push(s[a/2]);else{const c=o[a+1],l=n[-u];for(let d=cn;d<l.length;d++){const f=l[d];f[Ou]===f[Ct]&&Gm(f[J],f,c,r)}if(null!==l[qs]){const d=l[qs];for(let f=0;f<d.length;f++){const h=d[f];Gm(h[J],h,c,r)}}}}}return r}function xr(t){const n=j(),e=Ue(),r=N_();Qp(r+1);const i=DD(e,r);if(t.dirty&&function iP(t){return 4==(4&t[Ie])}(n)===(2==(2&i.metadata.flags))){if(null===i.matches)t.reset([]);else{const o=i.crossesNgTemplate?Gm(e,n,r,[]):CD(e,n,i,r);t.reset(o,BL),t.notifyOnChanges()}return!0}return!1}function ka(t,n,e){const r=Ue();r.firstCreatePass&&(ED(r,new _D(t,n,e),-1),2==(2&n)&&(r.staticViewQueries=!0)),xD(r,j(),n)}function ds(t,n,e,r){const i=Ue();if(i.firstCreatePass){const o=dn();ED(i,new _D(n,e,r),o.index),function wU(t,n){const e=t.contentQueries||(t.contentQueries=[]);n!==(e.length?e[e.length-1]:-1)&&e.push(t.queries.length-1,n)}(i,t),2==(2&e)&&(i.staticContentQueries=!0)}xD(i,j(),e)}function Er(){return function bU(t,n){return t[ti].queries[n].queryList}(j(),N_())}function xD(t,n,e){const r=new Vm(4==(4&e));(function y3(t,n,e,r){const i=YC(n);i.push(e),t.firstCreatePass&&XC(t).push(r,i.length-1)})(t,n,r,r.destroy),null===n[ti]&&(n[ti]=new jm),n[ti].queries.push(new Hm(r))}function ED(t,n,e){null===t.queries&&(t.queries=new Wm),t.queries.track(new zm(n,e))}function DD(t,n){return t.queries.getByIndex(n)}const Zm=new se("Application Initializer");let Qm=(()=>{class t{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((e,r)=>{this.resolve=e,this.reject=r}),this.appInits=re(Zm,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const e=[];for(const i of this.appInits){const o=i();if(hc(o))e.push(o);else if(Tx(o)){const s=new Promise((a,u)=>{o.subscribe({complete:a,error:u})});e.push(s)}}const r=()=>{this.done=!0,this.resolve()};Promise.all(e).then(()=>{r()}).catch(i=>{this.reject(i)}),0===e.length&&r(),this.initialized=!0}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),jD=(()=>{class t{log(e){console.log(e)}warn(e){console.warn(e)}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac,providedIn:"platform"})}return t})();const Lr=new se("LocaleId",{providedIn:"root",factory:()=>re(Lr,Ne.Optional|Ne.SkipSelf)||function jU(){return typeof $localize<"u"&&$localize.locale||Oa}()});let WD=(()=>{class t{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new vr(!1)}add(){this.hasPendingTasks.next(!0);const e=this.taskId++;return this.pendingTasks.add(e),e}remove(e){this.pendingTasks.delete(e),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();class GU{constructor(n,e){this.ngModuleFactory=n,this.componentFactories=e}}let zD=(()=>{class t{compileModuleSync(e){return new Fm(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const r=this.compileModuleSync(e),o=Li(nr(e).declarations).reduce((s,a)=>{const u=Ve(a);return u&&s.push(new ac(u)),s},[]);return new GU(r,o)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const KD=new se(""),df=new se("");let rv,tv=(()=>{class t{constructor(e,r,i){this._ngZone=e,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,rv||(function hH(t){rv=t}(i),i.addToWindow(r)),this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{rt.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(e)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,r,i){let o=-1;r&&r>0&&(o=setTimeout(()=>{this._callbacks=this._callbacks.filter(s=>s.timeoutId!==o),e(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:e,timeoutId:o,updateCb:i})}whenStable(e,r,i){if(i&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,r,i),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(e){this.registry.registerApplication(e,this)}unregisterApplication(e){this.registry.unregisterApplication(e)}findProviders(e,r,i){return[]}static#e=this.\u0275fac=function(r){return new(r||t)(pe(rt),pe(nv),pe(df))};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac})}return t})(),nv=(()=>{class t{constructor(){this._applications=new Map}registerApplication(e,r){this._applications.set(e,r)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,r=!0){return rv?.findTestabilityInTree(this,e,r)??null}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac,providedIn:"platform"})}return t})(),Io=null;const YD=new se("AllowMultipleToken"),iv=new se("PlatformDestroyListeners"),ov=new se("appBootstrapListener");class ZD{constructor(n,e){this.name=n,this.token=e}}function JD(t,n,e=[]){const r=`Platform: ${n}`,i=new se(r);return(o=[])=>{let s=sv();if(!s||s.injector.get(YD,!1)){const a=[...e,...o,{provide:i,useValue:!0}];t?t(a):function mH(t){if(Io&&!Io.get(YD,!1))throw new $(400,!1);(function XD(){!function Gk(t){f_=t}(()=>{throw new $(600,!1)})})(),Io=t;const n=t.get(tI);(function QD(t){t.get(sC,null)?.forEach(e=>e())})(t)}(function eI(t=[],n){return sr.create({name:n,providers:[{provide:Bg,useValue:"platform"},{provide:iv,useValue:new Set([()=>Io=null])},...t]})}(a,r))}return function yH(t){const n=sv();if(!n)throw new $(401,!1);return n}()}}function sv(){return Io?.get(tI)??null}let tI=(()=>{class t{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,r){const i=function bH(t="zone.js",n){return"noop"===t?new JL:"zone.js"===t?new rt(n):t}(r?.ngZone,function nI(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}({eventCoalescing:r?.ngZoneEventCoalescing,runCoalescing:r?.ngZoneRunCoalescing}));return i.run(()=>{const o=function MV(t,n,e){return new Pm(t,n,e)}(e.moduleType,this.injector,function aI(t){return[{provide:rt,useFactory:t},{provide:Ju,multi:!0,useFactory:()=>{const n=re(_H,{optional:!0});return()=>n.initialize()}},{provide:sI,useFactory:wH},{provide:xC,useFactory:EC}]}(()=>i)),s=o.injector.get(Fi,null);return i.runOutsideAngular(()=>{const a=i.onError.subscribe({next:u=>{s.handleError(u)}});o.onDestroy(()=>{ff(this._modules,o),a.unsubscribe()})}),function rI(t,n,e){try{const r=e();return hc(r)?r.catch(i=>{throw n.runOutsideAngular(()=>t.handleError(i)),i}):r}catch(r){throw n.runOutsideAngular(()=>t.handleError(r)),r}}(s,i,()=>{const a=o.injector.get(Qm);return a.runInitializers(),a.donePromise.then(()=>(function DE(t){yr(t,"Expected localeId to be defined"),"string"==typeof t&&(EE=t.toLowerCase().replace(/_/g,"-"))}(o.injector.get(Lr,Oa)||Oa),this._moduleDoBootstrap(o),o))})})}bootstrapModule(e,r=[]){const i=iI({},r);return function pH(t,n,e){const r=new Fm(e);return Promise.resolve(r)}(0,0,e).then(o=>this.bootstrapModuleFactory(o,i))}_moduleDoBootstrap(e){const r=e.injector.get(La);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(i=>r.bootstrap(i));else{if(!e.instance.ngDoBootstrap)throw new $(-403,!1);e.instance.ngDoBootstrap(r)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new $(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const e=this._injector.get(iv,null);e&&(e.forEach(r=>r()),e.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#e=this.\u0275fac=function(r){return new(r||t)(pe(sr))};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac,providedIn:"platform"})}return t})();function iI(t,n){return Array.isArray(n)?n.reduce(iI,t):{...t,...n}}let La=(()=>{class t{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=re(sI),this.zoneIsStable=re(xC),this.componentTypes=[],this.components=[],this.isStable=re(WD).hasPendingTasks.pipe(Jr(e=>e?we(!1):this.zoneIsStable),function nk(t,n=ao){return t=t??rk,zt((e,r)=>{let i,o=!0;e.subscribe(Bt(r,s=>{const a=n(s);(o||!t(i,a))&&(o=!1,i=a,r.next(s))}))})}(),Aw()),this._injector=re(_r)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(e,r){const i=e instanceof dC;if(!this._injector.get(Qm).done)throw!i&&function js(t){const n=Ve(t)||un(t)||Mn(t);return null!==n&&n.standalone}(e),new $(405,!1);let s;s=i?e:this._injector.get(Bd).resolveComponentFactory(e),this.componentTypes.push(s.componentType);const a=function gH(t){return t.isBoundToModule}(s)?void 0:this._injector.get(ls),c=s.create(sr.NULL,[],r||s.selector,a),l=c.location.nativeElement,d=c.injector.get(KD,null);return d?.registerApplication(l),c.onDestroy(()=>{this.detachView(c.hostView),ff(this.components,c),d?.unregisterApplication(l)}),this._loadComponent(c),c}tick(){if(this._runningTick)throw new $(101,!1);try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this.internalErrorHandler(e)}finally{this._runningTick=!1}}attachView(e){const r=e;this._views.push(r),r.attachToAppRef(this)}detachView(e){const r=e;ff(this._views,r),r.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e);const r=this._injector.get(ov,[]);r.push(...this._bootstrapListeners),r.forEach(i=>i(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>ff(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new $(406,!1);const e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function ff(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}const sI=new se("",{providedIn:"root",factory:()=>re(Fi).handleError.bind(void 0)});function wH(){const t=re(rt),n=re(Fi);return e=>t.runOutsideAngular(()=>n.handleError(e))}let _H=(()=>{class t{constructor(){this.zone=re(rt),this.applicationRef=re(La)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();let fs=(()=>{class t{static#e=this.__NG_ELEMENT_ID__=xH}return t})();function xH(t){return function EH(t,n,e){if(ts(t)&&!e){const r=ir(t.index,n);return new sc(r,r)}return 47&t.type?new sc(n[kt],n):null}(dn(),j(),16==(16&t))}class dI{constructor(){}supports(n){return $d(n)}create(n){return new AH(n)}}const MH=(t,n)=>n;class AH{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||MH}forEachItem(n){let e;for(e=this._itHead;null!==e;e=e._next)n(e)}forEachOperation(n){let e=this._itHead,r=this._removalsHead,i=0,o=null;for(;e||r;){const s=!r||e&&e.currentIndex<hI(r,i,o)?e:r,a=hI(s,i,o),u=s.currentIndex;if(s===r)i--,r=r._nextRemoved;else if(e=e._next,null==s.previousIndex)i++;else{o||(o=[]);const c=a-i,l=u-i;if(c!=l){for(let f=0;f<c;f++){const h=f<o.length?o[f]:o[f]=0,p=h+f;l<=p&&p<c&&(o[f]=h+1)}o[s.previousIndex]=l-c}}a!==u&&n(s,a,u)}}forEachPreviousItem(n){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)n(e)}forEachMovedItem(n){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)n(e)}forEachIdentityChange(n){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)n(e)}diff(n){if(null==n&&(n=[]),!$d(n))throw new $(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let i,o,s,e=this._itHead,r=!1;if(Array.isArray(n)){this.length=n.length;for(let a=0;a<this.length;a++)o=n[a],s=this._trackByFn(a,o),null!==e&&Object.is(e.trackById,s)?(r&&(e=this._verifyReinsertion(e,o,s,a)),Object.is(e.item,o)||this._addIdentityChange(e,o)):(e=this._mismatch(e,o,s,a),r=!0),e=e._next}else i=0,function lB(t,n){if(Array.isArray(t))for(let e=0;e<t.length;e++)n(t[e]);else{const e=t[Symbol.iterator]();let r;for(;!(r=e.next()).done;)n(r.value)}}(n,a=>{s=this._trackByFn(i,a),null!==e&&Object.is(e.trackById,s)?(r&&(e=this._verifyReinsertion(e,a,s,i)),Object.is(e.item,a)||this._addIdentityChange(e,a)):(e=this._mismatch(e,a,s,i),r=!0),e=e._next,i++}),this.length=i;return this._truncate(e),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,e,r,i){let o;return null===n?o=this._itTail:(o=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._reinsertAfter(n,o,i)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(r,i))?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._moveAfter(n,o,i)):n=this._addAfter(new RH(e,r),o,i),n}_verifyReinsertion(n,e,r,i){let o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==o?n=this._reinsertAfter(o,n._prev,i):n.currentIndex!=i&&(n.currentIndex=i,this._addToMoves(n,i)),n}_truncate(n){for(;null!==n;){const e=n._next;this._addToRemovals(this._unlink(n)),n=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,e,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const i=n._prevRemoved,o=n._nextRemoved;return null===i?this._removalsHead=o:i._nextRemoved=o,null===o?this._removalsTail=i:o._prevRemoved=i,this._insertAfter(n,e,r),this._addToMoves(n,r),n}_moveAfter(n,e,r){return this._unlink(n),this._insertAfter(n,e,r),this._addToMoves(n,r),n}_addAfter(n,e,r){return this._insertAfter(n,e,r),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,e,r){const i=null===e?this._itHead:e._next;return n._next=i,n._prev=e,null===i?this._itTail=n:i._prev=n,null===e?this._itHead=n:e._next=n,null===this._linkedRecords&&(this._linkedRecords=new fI),this._linkedRecords.put(n),n.currentIndex=r,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const e=n._prev,r=n._next;return null===e?this._itHead=r:e._next=r,null===r?this._itTail=e:r._prev=e,n}_addToMoves(n,e){return n.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new fI),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,e){return n.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class RH{constructor(n,e){this.item=n,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class OH{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,e){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===e||e<=r.currentIndex)&&Object.is(r.trackById,n))return r;return null}remove(n){const e=n._prevDup,r=n._nextDup;return null===e?this._head=r:e._nextDup=r,null===r?this._tail=e:r._prevDup=e,null===this._head}}class fI{constructor(){this.map=new Map}put(n){const e=n.trackById;let r=this.map.get(e);r||(r=new OH,this.map.set(e,r)),r.add(n)}get(n,e){const i=this.map.get(n);return i?i.get(n,e):null}remove(n){const e=n.trackById;return this.map.get(e).remove(n)&&this.map.delete(e),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function hI(t,n,e){const r=t.previousIndex;if(null===r)return r;let i=0;return e&&r<e.length&&(i=e[r]),r+n+i}class pI{constructor(){}supports(n){return n instanceof Map||vm(n)}create(){return new NH}}class NH{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(n){let e;for(e=this._mapHead;null!==e;e=e._next)n(e)}forEachPreviousItem(n){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)n(e)}forEachChangedItem(n){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)n(e)}diff(n){if(n){if(!(n instanceof Map||vm(n)))throw new $(900,!1)}else n=new Map;return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(n,(r,i)=>{if(e&&e.key===i)this._maybeAddToChanges(e,r),this._appendAfter=e,e=e._next;else{const o=this._getOrCreateRecordForKey(i,r);e=this._insertBeforeOrAppend(e,o)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let r=e;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,e){if(n){const r=n._prev;return e._next=n,e._prev=r,n._prev=e,r&&(r._next=e),n===this._mapHead&&(this._mapHead=e),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(n,e){if(this._records.has(n)){const i=this._records.get(n);this._maybeAddToChanges(i,e);const o=i._prev,s=i._next;return o&&(o._next=s),s&&(s._prev=o),i._next=null,i._prev=null,i}const r=new kH(n);return this._records.set(n,r),r.currentValue=e,this._addToAdditions(r),r}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;null!==n;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;null!=n;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,e){Object.is(e,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=e,this._addToChanges(n))}_addToAdditions(n){null===this._additionsHead?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){null===this._changesHead?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,e){n instanceof Map?n.forEach(e):Object.keys(n).forEach(r=>e(n[r],r))}}class kH{constructor(n){this.key=n,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function gI(){return new gf([new dI])}let gf=(()=>{class t{static#e=this.\u0275prov=fe({token:t,providedIn:"root",factory:gI});constructor(e){this.factories=e}static create(e,r){if(null!=r){const i=r.factories.slice();e=e.concat(i)}return new t(e)}static extend(e){return{provide:t,useFactory:r=>t.create(e,r||gI()),deps:[[t,new hd,new fd]]}}find(e){const r=this.factories.find(i=>i.supports(e));if(null!=r)return r;throw new $(901,!1)}}return t})();function mI(){return new Ec([new pI])}let Ec=(()=>{class t{static#e=this.\u0275prov=fe({token:t,providedIn:"root",factory:mI});constructor(e){this.factories=e}static create(e,r){if(r){const i=r.factories.slice();e=e.concat(i)}return new t(e)}static extend(e){return{provide:t,useFactory:r=>t.create(e,r||mI()),deps:[[t,new hd,new fd]]}}find(e){const r=this.factories.find(i=>i.supports(e));if(r)return r;throw new $(901,!1)}}return t})();const LH=JD(null,"core",[]);let BH=(()=>{class t{constructor(e){}static#e=this.\u0275fac=function(r){return new(r||t)(pe(La))};static#t=this.\u0275mod=_t({type:t});static#n=this.\u0275inj=yt({})}return t})();let fv=null;function So(){return fv}class QH{}const Fn=new se("DocumentToken");let hv=(()=>{class t{historyGo(e){throw new Error("Not implemented")}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=fe({token:t,factory:function(){return re(ej)},providedIn:"platform"})}return t})();const JH=new se("Location Initialized");let ej=(()=>{class t extends hv{constructor(){super(),this._doc=re(Fn),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return So().getBaseHref(this._doc)}onPopState(e){const r=So().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",e,!1),()=>r.removeEventListener("popstate",e)}onHashChange(e){const r=So().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",e,!1),()=>r.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,r,i){this._history.pushState(e,r,i)}replaceState(e,r,i){this._history.replaceState(e,r,i)}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=fe({token:t,factory:function(){return new t},providedIn:"platform"})}return t})();function pv(t,n){if(0==t.length)return n;if(0==n.length)return t;let e=0;return t.endsWith("/")&&e++,n.startsWith("/")&&e++,2==e?t+n.substring(1):1==e?t+n:t+"/"+n}function DI(t){const n=t.match(/#|\?|$/),e=n&&n.index||t.length;return t.slice(0,e-("/"===t[e-1]?1:0))+t.slice(e)}function Ui(t){return t&&"?"!==t[0]?"?"+t:t}let ps=(()=>{class t{historyGo(e){throw new Error("Not implemented")}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=fe({token:t,factory:function(){return re(SI)},providedIn:"root"})}return t})();const II=new se("appBaseHref");let SI=(()=>{class t extends ps{constructor(e,r){super(),this._platformLocation=e,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??re(Fn).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return pv(this._baseHref,e)}path(e=!1){const r=this._platformLocation.pathname+Ui(this._platformLocation.search),i=this._platformLocation.hash;return i&&e?`${r}${i}`:r}pushState(e,r,i,o){const s=this.prepareExternalUrl(i+Ui(o));this._platformLocation.pushState(e,r,s)}replaceState(e,r,i,o){const s=this.prepareExternalUrl(i+Ui(o));this._platformLocation.replaceState(e,r,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static#e=this.\u0275fac=function(r){return new(r||t)(pe(hv),pe(II,8))};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),tj=(()=>{class t extends ps{constructor(e,r){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(e){const r=pv(this._baseHref,e);return r.length>0?"#"+r:r}pushState(e,r,i,o){let s=this.prepareExternalUrl(i+Ui(o));0==s.length&&(s=this._platformLocation.pathname),this._platformLocation.pushState(e,r,s)}replaceState(e,r,i,o){let s=this.prepareExternalUrl(i+Ui(o));0==s.length&&(s=this._platformLocation.pathname),this._platformLocation.replaceState(e,r,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static#e=this.\u0275fac=function(r){return new(r||t)(pe(hv),pe(II,8))};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac})}return t})(),gv=(()=>{class t{constructor(e){this._subject=new $e,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=e;const r=this._locationStrategy.getBaseHref();this._basePath=function ij(t){if(new RegExp("^(https?:)?//").test(t)){const[,e]=t.split(/\/\/[^\/]+/);return e}return t}(DI(TI(r))),this._locationStrategy.onPopState(i=>{this._subject.emit({url:this.path(!0),pop:!0,state:i.state,type:i.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,r=""){return this.path()==this.normalize(e+Ui(r))}normalize(e){return t.stripTrailingSlash(function rj(t,n){if(!t||!n.startsWith(t))return n;const e=n.substring(t.length);return""===e||["/",";","?","#"].includes(e[0])?e:n}(this._basePath,TI(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,r="",i=null){this._locationStrategy.pushState(i,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Ui(r)),i)}replaceState(e,r="",i=null){this._locationStrategy.replaceState(i,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Ui(r)),i)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",r){this._urlChangeListeners.forEach(i=>i(e,r))}subscribe(e,r,i){return this._subject.subscribe({next:e,error:r,complete:i})}static#e=this.normalizeQueryParams=Ui;static#t=this.joinWithSlash=pv;static#n=this.stripTrailingSlash=DI;static#r=this.\u0275fac=function(r){return new(r||t)(pe(ps))};static#i=this.\u0275prov=fe({token:t,factory:function(){return function nj(){return new gv(pe(ps))}()},providedIn:"root"})}return t})();function TI(t){return t.replace(/\/index.html$/,"")}var Ln=function(t){return t[t.Format=0]="Format",t[t.Standalone=1]="Standalone",t}(Ln||{}),ct=function(t){return t[t.Narrow=0]="Narrow",t[t.Abbreviated=1]="Abbreviated",t[t.Wide=2]="Wide",t[t.Short=3]="Short",t}(ct||{}),ur=function(t){return t[t.Short=0]="Short",t[t.Medium=1]="Medium",t[t.Long=2]="Long",t[t.Full=3]="Full",t}(ur||{}),Pt=function(t){return t[t.Decimal=0]="Decimal",t[t.Group=1]="Group",t[t.List=2]="List",t[t.PercentSign=3]="PercentSign",t[t.PlusSign=4]="PlusSign",t[t.MinusSign=5]="MinusSign",t[t.Exponential=6]="Exponential",t[t.SuperscriptingExponent=7]="SuperscriptingExponent",t[t.PerMille=8]="PerMille",t[t.Infinity=9]="Infinity",t[t.NaN=10]="NaN",t[t.TimeSeparator=11]="TimeSeparator",t[t.CurrencyDecimal=12]="CurrencyDecimal",t[t.CurrencyGroup=13]="CurrencyGroup",t}(Pt||{});function yf(t,n){return Ir(kn(t)[pt.DateFormat],n)}function bf(t,n){return Ir(kn(t)[pt.TimeFormat],n)}function wf(t,n){return Ir(kn(t)[pt.DateTimeFormat],n)}function Dr(t,n){const e=kn(t),r=e[pt.NumberSymbols][n];if(typeof r>"u"){if(n===Pt.CurrencyDecimal)return e[pt.NumberSymbols][Pt.Decimal];if(n===Pt.CurrencyGroup)return e[pt.NumberSymbols][Pt.Group]}return r}function AI(t){if(!t[pt.ExtraData])throw new Error(`Missing extra locale data for the locale "${t[pt.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function Ir(t,n){for(let e=n;e>-1;e--)if(typeof t[e]<"u")return t[e];throw new Error("Locale data API: locale data undefined")}function vv(t){const[n,e]=t.split(":");return{hours:+n,minutes:+e}}const yj=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,Dc={},bj=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var Hi=function(t){return t[t.Short=0]="Short",t[t.ShortGMT=1]="ShortGMT",t[t.Long=2]="Long",t[t.Extended=3]="Extended",t}(Hi||{}),Xe=function(t){return t[t.FullYear=0]="FullYear",t[t.Month=1]="Month",t[t.Date=2]="Date",t[t.Hours=3]="Hours",t[t.Minutes=4]="Minutes",t[t.Seconds=5]="Seconds",t[t.FractionalSeconds=6]="FractionalSeconds",t[t.Day=7]="Day",t}(Xe||{}),Ze=function(t){return t[t.DayPeriods=0]="DayPeriods",t[t.Days=1]="Days",t[t.Months=2]="Months",t[t.Eras=3]="Eras",t}(Ze||{});function RI(t,n,e,r){let i=function Tj(t){if(kI(t))return t;if("number"==typeof t&&!isNaN(t))return new Date(t);if("string"==typeof t){if(t=t.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(t)){const[i,o=1,s=1]=t.split("-").map(a=>+a);return _f(i,o-1,s)}const e=parseFloat(t);if(!isNaN(t-e))return new Date(e);let r;if(r=t.match(yj))return function Mj(t){const n=new Date(0);let e=0,r=0;const i=t[8]?n.setUTCFullYear:n.setFullYear,o=t[8]?n.setUTCHours:n.setHours;t[9]&&(e=Number(t[9]+t[10]),r=Number(t[9]+t[11])),i.call(n,Number(t[1]),Number(t[2])-1,Number(t[3]));const s=Number(t[4]||0)-e,a=Number(t[5]||0)-r,u=Number(t[6]||0),c=Math.floor(1e3*parseFloat("0."+(t[7]||0)));return o.call(n,s,a,u,c),n}(r)}const n=new Date(t);if(!kI(n))throw new Error(`Unable to convert "${t}" into a date`);return n}(t);n=ji(e,n)||n;let a,s=[];for(;n;){if(a=bj.exec(n),!a){s.push(n);break}{s=s.concat(a.slice(1));const l=s.pop();if(!l)break;n=l}}let u=i.getTimezoneOffset();r&&(u=NI(r,u),i=function Sj(t,n,e){const r=e?-1:1,i=t.getTimezoneOffset();return function Ij(t,n){return(t=new Date(t.getTime())).setMinutes(t.getMinutes()+n),t}(t,r*(NI(n,i)-i))}(i,r,!0));let c="";return s.forEach(l=>{const d=function Dj(t){if(bv[t])return bv[t];let n;switch(t){case"G":case"GG":case"GGG":n=mt(Ze.Eras,ct.Abbreviated);break;case"GGGG":n=mt(Ze.Eras,ct.Wide);break;case"GGGGG":n=mt(Ze.Eras,ct.Narrow);break;case"y":n=Vt(Xe.FullYear,1,0,!1,!0);break;case"yy":n=Vt(Xe.FullYear,2,0,!0,!0);break;case"yyy":n=Vt(Xe.FullYear,3,0,!1,!0);break;case"yyyy":n=Vt(Xe.FullYear,4,0,!1,!0);break;case"Y":n=Df(1);break;case"YY":n=Df(2,!0);break;case"YYY":n=Df(3);break;case"YYYY":n=Df(4);break;case"M":case"L":n=Vt(Xe.Month,1,1);break;case"MM":case"LL":n=Vt(Xe.Month,2,1);break;case"MMM":n=mt(Ze.Months,ct.Abbreviated);break;case"MMMM":n=mt(Ze.Months,ct.Wide);break;case"MMMMM":n=mt(Ze.Months,ct.Narrow);break;case"LLL":n=mt(Ze.Months,ct.Abbreviated,Ln.Standalone);break;case"LLLL":n=mt(Ze.Months,ct.Wide,Ln.Standalone);break;case"LLLLL":n=mt(Ze.Months,ct.Narrow,Ln.Standalone);break;case"w":n=yv(1);break;case"ww":n=yv(2);break;case"W":n=yv(1,!0);break;case"d":n=Vt(Xe.Date,1);break;case"dd":n=Vt(Xe.Date,2);break;case"c":case"cc":n=Vt(Xe.Day,1);break;case"ccc":n=mt(Ze.Days,ct.Abbreviated,Ln.Standalone);break;case"cccc":n=mt(Ze.Days,ct.Wide,Ln.Standalone);break;case"ccccc":n=mt(Ze.Days,ct.Narrow,Ln.Standalone);break;case"cccccc":n=mt(Ze.Days,ct.Short,Ln.Standalone);break;case"E":case"EE":case"EEE":n=mt(Ze.Days,ct.Abbreviated);break;case"EEEE":n=mt(Ze.Days,ct.Wide);break;case"EEEEE":n=mt(Ze.Days,ct.Narrow);break;case"EEEEEE":n=mt(Ze.Days,ct.Short);break;case"a":case"aa":case"aaa":n=mt(Ze.DayPeriods,ct.Abbreviated);break;case"aaaa":n=mt(Ze.DayPeriods,ct.Wide);break;case"aaaaa":n=mt(Ze.DayPeriods,ct.Narrow);break;case"b":case"bb":case"bbb":n=mt(Ze.DayPeriods,ct.Abbreviated,Ln.Standalone,!0);break;case"bbbb":n=mt(Ze.DayPeriods,ct.Wide,Ln.Standalone,!0);break;case"bbbbb":n=mt(Ze.DayPeriods,ct.Narrow,Ln.Standalone,!0);break;case"B":case"BB":case"BBB":n=mt(Ze.DayPeriods,ct.Abbreviated,Ln.Format,!0);break;case"BBBB":n=mt(Ze.DayPeriods,ct.Wide,Ln.Format,!0);break;case"BBBBB":n=mt(Ze.DayPeriods,ct.Narrow,Ln.Format,!0);break;case"h":n=Vt(Xe.Hours,1,-12);break;case"hh":n=Vt(Xe.Hours,2,-12);break;case"H":n=Vt(Xe.Hours,1);break;case"HH":n=Vt(Xe.Hours,2);break;case"m":n=Vt(Xe.Minutes,1);break;case"mm":n=Vt(Xe.Minutes,2);break;case"s":n=Vt(Xe.Seconds,1);break;case"ss":n=Vt(Xe.Seconds,2);break;case"S":n=Vt(Xe.FractionalSeconds,1);break;case"SS":n=Vt(Xe.FractionalSeconds,2);break;case"SSS":n=Vt(Xe.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":n=xf(Hi.Short);break;case"ZZZZZ":n=xf(Hi.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":n=xf(Hi.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":n=xf(Hi.Long);break;default:return null}return bv[t]=n,n}(l);c+=d?d(i,e,u):"''"===l?"'":l.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),c}function _f(t,n,e){const r=new Date(0);return r.setFullYear(t,n,e),r.setHours(0,0,0),r}function ji(t,n){const e=function sj(t){return kn(t)[pt.LocaleId]}(t);if(Dc[e]=Dc[e]||{},Dc[e][n])return Dc[e][n];let r="";switch(n){case"shortDate":r=yf(t,ur.Short);break;case"mediumDate":r=yf(t,ur.Medium);break;case"longDate":r=yf(t,ur.Long);break;case"fullDate":r=yf(t,ur.Full);break;case"shortTime":r=bf(t,ur.Short);break;case"mediumTime":r=bf(t,ur.Medium);break;case"longTime":r=bf(t,ur.Long);break;case"fullTime":r=bf(t,ur.Full);break;case"short":const i=ji(t,"shortTime"),o=ji(t,"shortDate");r=Cf(wf(t,ur.Short),[i,o]);break;case"medium":const s=ji(t,"mediumTime"),a=ji(t,"mediumDate");r=Cf(wf(t,ur.Medium),[s,a]);break;case"long":const u=ji(t,"longTime"),c=ji(t,"longDate");r=Cf(wf(t,ur.Long),[u,c]);break;case"full":const l=ji(t,"fullTime"),d=ji(t,"fullDate");r=Cf(wf(t,ur.Full),[l,d])}return r&&(Dc[e][n]=r),r}function Cf(t,n){return n&&(t=t.replace(/\{([^}]+)}/g,function(e,r){return null!=n&&r in n?n[r]:e})),t}function Br(t,n,e="-",r,i){let o="";(t<0||i&&t<=0)&&(i?t=1-t:(t=-t,o=e));let s=String(t);for(;s.length<n;)s="0"+s;return r&&(s=s.slice(s.length-n)),o+s}function Vt(t,n,e=0,r=!1,i=!1){return function(o,s){let a=function _j(t,n){switch(t){case Xe.FullYear:return n.getFullYear();case Xe.Month:return n.getMonth();case Xe.Date:return n.getDate();case Xe.Hours:return n.getHours();case Xe.Minutes:return n.getMinutes();case Xe.Seconds:return n.getSeconds();case Xe.FractionalSeconds:return n.getMilliseconds();case Xe.Day:return n.getDay();default:throw new Error(`Unknown DateType value "${t}".`)}}(t,o);if((e>0||a>-e)&&(a+=e),t===Xe.Hours)0===a&&-12===e&&(a=12);else if(t===Xe.FractionalSeconds)return function wj(t,n){return Br(t,3).substring(0,n)}(a,n);const u=Dr(s,Pt.MinusSign);return Br(a,n,u,r,i)}}function mt(t,n,e=Ln.Format,r=!1){return function(i,o){return function Cj(t,n,e,r,i,o){switch(e){case Ze.Months:return function cj(t,n,e){const r=kn(t),o=Ir([r[pt.MonthsFormat],r[pt.MonthsStandalone]],n);return Ir(o,e)}(n,i,r)[t.getMonth()];case Ze.Days:return function uj(t,n,e){const r=kn(t),o=Ir([r[pt.DaysFormat],r[pt.DaysStandalone]],n);return Ir(o,e)}(n,i,r)[t.getDay()];case Ze.DayPeriods:const s=t.getHours(),a=t.getMinutes();if(o){const c=function hj(t){const n=kn(t);return AI(n),(n[pt.ExtraData][2]||[]).map(r=>"string"==typeof r?vv(r):[vv(r[0]),vv(r[1])])}(n),l=function pj(t,n,e){const r=kn(t);AI(r);const o=Ir([r[pt.ExtraData][0],r[pt.ExtraData][1]],n)||[];return Ir(o,e)||[]}(n,i,r),d=c.findIndex(f=>{if(Array.isArray(f)){const[h,p]=f,g=s>=h.hours&&a>=h.minutes,m=s<p.hours||s===p.hours&&a<p.minutes;if(h.hours<p.hours){if(g&&m)return!0}else if(g||m)return!0}else if(f.hours===s&&f.minutes===a)return!0;return!1});if(-1!==d)return l[d]}return function aj(t,n,e){const r=kn(t),o=Ir([r[pt.DayPeriodsFormat],r[pt.DayPeriodsStandalone]],n);return Ir(o,e)}(n,i,r)[s<12?0:1];case Ze.Eras:return function lj(t,n){return Ir(kn(t)[pt.Eras],n)}(n,r)[t.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${e}`)}}(i,o,t,n,e,r)}}function xf(t){return function(n,e,r){const i=-1*r,o=Dr(e,Pt.MinusSign),s=i>0?Math.floor(i/60):Math.ceil(i/60);switch(t){case Hi.Short:return(i>=0?"+":"")+Br(s,2,o)+Br(Math.abs(i%60),2,o);case Hi.ShortGMT:return"GMT"+(i>=0?"+":"")+Br(s,1,o);case Hi.Long:return"GMT"+(i>=0?"+":"")+Br(s,2,o)+":"+Br(Math.abs(i%60),2,o);case Hi.Extended:return 0===r?"Z":(i>=0?"+":"")+Br(s,2,o)+":"+Br(Math.abs(i%60),2,o);default:throw new Error(`Unknown zone width "${t}"`)}}}const xj=0,Ef=4;function OI(t){return _f(t.getFullYear(),t.getMonth(),t.getDate()+(Ef-t.getDay()))}function yv(t,n=!1){return function(e,r){let i;if(n){const o=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,s=e.getDate();i=1+Math.floor((s+o)/7)}else{const o=OI(e),s=function Ej(t){const n=_f(t,xj,1).getDay();return _f(t,0,1+(n<=Ef?Ef:Ef+7)-n)}(o.getFullYear()),a=o.getTime()-s.getTime();i=1+Math.round(a/6048e5)}return Br(i,t,Dr(r,Pt.MinusSign))}}function Df(t,n=!1){return function(e,r){return Br(OI(e).getFullYear(),t,Dr(r,Pt.MinusSign),n)}}const bv={};function NI(t,n){t=t.replace(/:/g,"");const e=Date.parse("Jan 01, 1970 00:00:00 "+t)/6e4;return isNaN(e)?n:e}function kI(t){return t instanceof Date&&!isNaN(t.valueOf())}const Dv=/\s+/,BI=[];let To=(()=>{class t{constructor(e,r,i,o){this._iterableDiffers=e,this._keyValueDiffers=r,this._ngEl=i,this._renderer=o,this.initialClasses=BI,this.stateMap=new Map}set klass(e){this.initialClasses=null!=e?e.trim().split(Dv):BI}set ngClass(e){this.rawClass="string"==typeof e?e.trim().split(Dv):e}ngDoCheck(){for(const r of this.initialClasses)this._updateState(r,!0);const e=this.rawClass;if(Array.isArray(e)||e instanceof Set)for(const r of e)this._updateState(r,!0);else if(null!=e)for(const r of Object.keys(e))this._updateState(r,!!e[r]);this._applyStateDiff()}_updateState(e,r){const i=this.stateMap.get(e);void 0!==i?(i.enabled!==r&&(i.changed=!0,i.enabled=r),i.touched=!0):this.stateMap.set(e,{enabled:r,changed:!0,touched:!0})}_applyStateDiff(){for(const e of this.stateMap){const r=e[0],i=e[1];i.changed?(this._toggleClass(r,i.enabled),i.changed=!1):i.touched||(i.enabled&&this._toggleClass(r,!1),this.stateMap.delete(r)),i.touched=!1}}_toggleClass(e,r){(e=e.trim()).length>0&&e.split(Dv).forEach(i=>{r?this._renderer.addClass(this._ngEl.nativeElement,i):this._renderer.removeClass(this._ngEl.nativeElement,i)})}static#e=this.\u0275fac=function(r){return new(r||t)(F(gf),F(Ec),F(en),F(si))};static#t=this.\u0275dir=ge({type:t,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0})}return t})();class Wj{constructor(n,e,r,i){this.$implicit=n,this.ngForOf=e,this.index=r,this.count=i}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let UI=(()=>{class t{set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}constructor(e,r,i){this._viewContainer=e,this._template=r,this._differs=i,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const r=this._viewContainer;e.forEachOperation((i,o,s)=>{if(null==i.previousIndex)r.createEmbeddedView(this._template,new Wj(i.item,this._ngForOf,-1,-1),null===s?void 0:s);else if(null==s)r.remove(null===o?void 0:o);else if(null!==o){const a=r.get(o);r.move(a,s),HI(a,i)}});for(let i=0,o=r.length;i<o;i++){const a=r.get(i).context;a.index=i,a.count=o,a.ngForOf=this._ngForOf}e.forEachIdentityChange(i=>{HI(r.get(i.currentIndex),i)})}static ngTemplateContextGuard(e,r){return!0}static#e=this.\u0275fac=function(r){return new(r||t)(F(Fr),F(di),F(gf))};static#t=this.\u0275dir=ge({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}return t})();function HI(t,n){t.context.$implicit=n.item}let Wi=(()=>{class t{constructor(e,r){this._viewContainer=e,this._context=new zj,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){jI("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){jI("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,r){return!0}static#e=this.\u0275fac=function(r){return new(r||t)(F(Fr),F(di))};static#t=this.\u0275dir=ge({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}return t})();class zj{constructor(){this.$implicit=null,this.ngIf=null}}function jI(t,n){if(n&&!n.createEmbeddedView)throw new Error(`${t} must be a TemplateRef, but received '${Gt(n)}'.`)}let Sc=(()=>{class t{constructor(e,r,i){this._ngEl=e,this._differs=r,this._renderer=i,this._ngStyle=null,this._differ=null}set ngStyle(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}ngDoCheck(){if(this._differ){const e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}_setStyle(e,r){const[i,o]=e.split("."),s=-1===i.indexOf("-")?void 0:mo.DashCase;null!=r?this._renderer.setStyle(this._ngEl.nativeElement,i,o?`${r}${o}`:r,s):this._renderer.removeStyle(this._ngEl.nativeElement,i,s)}_applyChanges(e){e.forEachRemovedItem(r=>this._setStyle(r.key,null)),e.forEachAddedItem(r=>this._setStyle(r.key,r.currentValue)),e.forEachChangedItem(r=>this._setStyle(r.key,r.currentValue))}static#e=this.\u0275fac=function(r){return new(r||t)(F(en),F(Ec),F(si))};static#t=this.\u0275dir=ge({type:t,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0})}return t})(),Tc=(()=>{class t{constructor(e){this._viewContainerRef=e,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(e){if(e.ngTemplateOutlet||e.ngTemplateOutletInjector){const r=this._viewContainerRef;if(this._viewRef&&r.remove(r.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:i,ngTemplateOutletContext:o,ngTemplateOutletInjector:s}=this;this._viewRef=r.createEmbeddedView(i,o,s?{injector:s}:void 0)}else this._viewRef=null}else this._viewRef&&e.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}static#e=this.\u0275fac=function(r){return new(r||t)(F(Fr))};static#t=this.\u0275dir=ge({type:t,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[rr]})}return t})(),Kn=(()=>{class t{static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275mod=_t({type:t});static#n=this.\u0275inj=yt({})}return t})();const GI="browser";function Av(t){return t===GI}function $I(t){return"server"===t}let bW=(()=>{class t{static#e=this.\u0275prov=fe({token:t,providedIn:"root",factory:()=>new wW(pe(Fn),window)})}return t})();class wW{constructor(n,e){this.document=n,this.window=e,this.offset=()=>[0,0]}setOffset(n){this.offset=Array.isArray(n)?()=>n:n}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(n){this.supportsScrolling()&&this.window.scrollTo(n[0],n[1])}scrollToAnchor(n){if(!this.supportsScrolling())return;const e=function _W(t,n){const e=t.getElementById(n)||t.getElementsByName(n)[0];if(e)return e;if("function"==typeof t.createTreeWalker&&t.body&&"function"==typeof t.body.attachShadow){const r=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT);let i=r.currentNode;for(;i;){const o=i.shadowRoot;if(o){const s=o.getElementById(n)||o.querySelector(`[name="${n}"]`);if(s)return s}i=r.nextNode()}}return null}(this.document,n);e&&(this.scrollToElement(e),e.focus())}setHistoryScrollRestoration(n){this.supportsScrolling()&&(this.window.history.scrollRestoration=n)}scrollToElement(n){const e=n.getBoundingClientRect(),r=e.left+this.window.pageXOffset,i=e.top+this.window.pageYOffset,o=this.offset();this.window.scrollTo(r-o[0],i-o[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class GW extends QH{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class Nv extends GW{static makeCurrent(){!function ZH(t){fv||(fv=t)}(new Nv)}onAndCancel(n,e,r){return n.addEventListener(e,r),()=>{n.removeEventListener(e,r)}}dispatchEvent(n,e){n.dispatchEvent(e)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,e){return(e=e||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,e){return"window"===e?window:"document"===e?n:"body"===e?n.body:null}getBaseHref(n){const e=function $W(){return Ac=Ac||document.querySelector("base"),Ac?Ac.getAttribute("href"):null}();return null==e?null:function qW(t){Mf=Mf||document.createElement("a"),Mf.setAttribute("href",t);const n=Mf.pathname;return"/"===n.charAt(0)?n:`/${n}`}(e)}resetBaseElement(){Ac=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return function Hj(t,n){n=encodeURIComponent(n);for(const e of t.split(";")){const r=e.indexOf("="),[i,o]=-1==r?[e,""]:[e.slice(0,r),e.slice(r+1)];if(i.trim()===n)return decodeURIComponent(o)}return null}(document.cookie,n)}}let Mf,Ac=null,YW=(()=>{class t{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac})}return t})();const kv=new se("EventManagerPlugins");let ZI=(()=>{class t{constructor(e,r){this._zone=r,this._eventNameToPlugin=new Map,e.forEach(i=>{i.manager=this}),this._plugins=e.slice().reverse()}addEventListener(e,r,i){return this._findPluginFor(r).addEventListener(e,r,i)}getZone(){return this._zone}_findPluginFor(e){let r=this._eventNameToPlugin.get(e);if(r)return r;if(r=this._plugins.find(o=>o.supports(e)),!r)throw new $(5101,!1);return this._eventNameToPlugin.set(e,r),r}static#e=this.\u0275fac=function(r){return new(r||t)(pe(kv),pe(rt))};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac})}return t})();class QI{constructor(n){this._doc=n}}const Pv="ng-app-id";let JI=(()=>{class t{constructor(e,r,i,o={}){this.doc=e,this.appId=r,this.nonce=i,this.platformId=o,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=$I(o),this.resetHostNodes()}addStyles(e){for(const r of e)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(e){for(const r of e)this.changeUsageCount(r,-1)<=0&&this.onStyleRemoved(r)}ngOnDestroy(){const e=this.styleNodesInDOM;e&&(e.forEach(r=>r.remove()),e.clear());for(const r of this.getAllStyles())this.onStyleRemoved(r);this.resetHostNodes()}addHost(e){this.hostNodes.add(e);for(const r of this.getAllStyles())this.addStyleToHost(e,r)}removeHost(e){this.hostNodes.delete(e)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(e){for(const r of this.hostNodes)this.addStyleToHost(r,e)}onStyleRemoved(e){const r=this.styleRef;r.get(e)?.elements?.forEach(i=>i.remove()),r.delete(e)}collectServerRenderedStyles(){const e=this.doc.head?.querySelectorAll(`style[${Pv}="${this.appId}"]`);if(e?.length){const r=new Map;return e.forEach(i=>{null!=i.textContent&&r.set(i.textContent,i)}),r}return null}changeUsageCount(e,r){const i=this.styleRef;if(i.has(e)){const o=i.get(e);return o.usage+=r,o.usage}return i.set(e,{usage:r,elements:[]}),r}getStyleElement(e,r){const i=this.styleNodesInDOM,o=i?.get(r);if(o?.parentNode===e)return i.delete(r),o.removeAttribute(Pv),o;{const s=this.doc.createElement("style");return this.nonce&&s.setAttribute("nonce",this.nonce),s.textContent=r,this.platformIsServer&&s.setAttribute(Pv,this.appId),s}}addStyleToHost(e,r){const i=this.getStyleElement(e,r);e.appendChild(i);const o=this.styleRef,s=o.get(r)?.elements;s?s.push(i):o.set(r,{elements:[i],usage:1})}resetHostNodes(){const e=this.hostNodes;e.clear(),e.add(this.doc.head)}static#e=this.\u0275fac=function(r){return new(r||t)(pe(Fn),pe(Od),pe(aC,8),pe(yo))};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac})}return t})();const Fv={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Lv=/%COMP%/g,JW=new se("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function tS(t,n){return n.map(e=>e.replace(Lv,t))}let nS=(()=>{class t{constructor(e,r,i,o,s,a,u,c=null){this.eventManager=e,this.sharedStylesHost=r,this.appId=i,this.removeStylesOnCompDestroy=o,this.doc=s,this.platformId=a,this.ngZone=u,this.nonce=c,this.rendererByCompId=new Map,this.platformIsServer=$I(a),this.defaultRenderer=new Bv(e,s,u,this.platformIsServer)}createRenderer(e,r){if(!e||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===Ar.ShadowDom&&(r={...r,encapsulation:Ar.Emulated});const i=this.getOrCreateRenderer(e,r);return i instanceof iS?i.applyToHost(e):i instanceof Vv&&i.applyStyles(),i}getOrCreateRenderer(e,r){const i=this.rendererByCompId;let o=i.get(r.id);if(!o){const s=this.doc,a=this.ngZone,u=this.eventManager,c=this.sharedStylesHost,l=this.removeStylesOnCompDestroy,d=this.platformIsServer;switch(r.encapsulation){case Ar.Emulated:o=new iS(u,c,r,this.appId,l,s,a,d);break;case Ar.ShadowDom:return new r6(u,c,e,r,s,a,this.nonce,d);default:o=new Vv(u,c,r,l,s,a,d)}i.set(r.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(r){return new(r||t)(pe(ZI),pe(JI),pe(Od),pe(JW),pe(Fn),pe(yo),pe(rt),pe(aC))};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac})}return t})();class Bv{constructor(n,e,r,i){this.eventManager=n,this.doc=e,this.ngZone=r,this.platformIsServer=i,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(n,e){return e?this.doc.createElementNS(Fv[e]||e,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,e){(rS(n)?n.content:n).appendChild(e)}insertBefore(n,e,r){n&&(rS(n)?n.content:n).insertBefore(e,r)}removeChild(n,e){n&&n.removeChild(e)}selectRootElement(n,e){let r="string"==typeof n?this.doc.querySelector(n):n;if(!r)throw new $(-5104,!1);return e||(r.textContent=""),r}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,e,r,i){if(i){e=i+":"+e;const o=Fv[i];o?n.setAttributeNS(o,e,r):n.setAttribute(e,r)}else n.setAttribute(e,r)}removeAttribute(n,e,r){if(r){const i=Fv[r];i?n.removeAttributeNS(i,e):n.removeAttribute(`${r}:${e}`)}else n.removeAttribute(e)}addClass(n,e){n.classList.add(e)}removeClass(n,e){n.classList.remove(e)}setStyle(n,e,r,i){i&(mo.DashCase|mo.Important)?n.style.setProperty(e,r,i&mo.Important?"important":""):n.style[e]=r}removeStyle(n,e,r){r&mo.DashCase?n.style.removeProperty(e):n.style[e]=""}setProperty(n,e,r){n[e]=r}setValue(n,e){n.nodeValue=e}listen(n,e,r){if("string"==typeof n&&!(n=So().getGlobalEventTarget(this.doc,n)))throw new Error(`Unsupported event target ${n} for event ${e}`);return this.eventManager.addEventListener(n,e,this.decoratePreventDefault(r))}decoratePreventDefault(n){return e=>{if("__ngUnwrap__"===e)return n;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>n(e)):n(e))&&e.preventDefault()}}}function rS(t){return"TEMPLATE"===t.tagName&&void 0!==t.content}class r6 extends Bv{constructor(n,e,r,i,o,s,a,u){super(n,o,s,u),this.sharedStylesHost=e,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const c=tS(i.id,i.styles);for(const l of c){const d=document.createElement("style");a&&d.setAttribute("nonce",a),d.textContent=l,this.shadowRoot.appendChild(d)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,e){return super.appendChild(this.nodeOrShadowRoot(n),e)}insertBefore(n,e,r){return super.insertBefore(this.nodeOrShadowRoot(n),e,r)}removeChild(n,e){return super.removeChild(this.nodeOrShadowRoot(n),e)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class Vv extends Bv{constructor(n,e,r,i,o,s,a,u){super(n,o,s,a),this.sharedStylesHost=e,this.removeStylesOnCompDestroy=i,this.styles=u?tS(u,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class iS extends Vv{constructor(n,e,r,i,o,s,a,u){const c=i+"-"+r.id;super(n,e,r,o,s,a,u,c),this.contentAttr=function e6(t){return"_ngcontent-%COMP%".replace(Lv,t)}(c),this.hostAttr=function t6(t){return"_nghost-%COMP%".replace(Lv,t)}(c)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,e){const r=super.createElement(n,e);return super.setAttribute(r,this.contentAttr,""),r}}let i6=(()=>{class t extends QI{constructor(e){super(e)}supports(e){return!0}addEventListener(e,r,i){return e.addEventListener(r,i,!1),()=>this.removeEventListener(e,r,i)}removeEventListener(e,r,i){return e.removeEventListener(r,i)}static#e=this.\u0275fac=function(r){return new(r||t)(pe(Fn))};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac})}return t})();const oS=["alt","control","meta","shift"],o6={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},s6={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let a6=(()=>{class t extends QI{constructor(e){super(e)}supports(e){return null!=t.parseEventName(e)}addEventListener(e,r,i){const o=t.parseEventName(r),s=t.eventCallback(o.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>So().onAndCancel(e,o.domEventName,s))}static parseEventName(e){const r=e.toLowerCase().split("."),i=r.shift();if(0===r.length||"keydown"!==i&&"keyup"!==i)return null;const o=t._normalizeKey(r.pop());let s="",a=r.indexOf("code");if(a>-1&&(r.splice(a,1),s="code."),oS.forEach(c=>{const l=r.indexOf(c);l>-1&&(r.splice(l,1),s+=c+".")}),s+=o,0!=r.length||0===o.length)return null;const u={};return u.domEventName=i,u.fullKey=s,u}static matchEventFullKeyCode(e,r){let i=o6[e.key]||e.key,o="";return r.indexOf("code.")>-1&&(i=e.code,o="code."),!(null==i||!i)&&(i=i.toLowerCase()," "===i?i="space":"."===i&&(i="dot"),oS.forEach(s=>{s!==i&&(0,s6[s])(e)&&(o+=s+".")}),o+=i,o===r)}static eventCallback(e,r,i){return o=>{t.matchEventFullKeyCode(o,e)&&i.runGuarded(()=>r(o))}}static _normalizeKey(e){return"esc"===e?"escape":e}static#e=this.\u0275fac=function(r){return new(r||t)(pe(Fn))};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac})}return t})();const aS=[{provide:yo,useValue:GI},{provide:sC,useValue:function u6(){Nv.makeCurrent()},multi:!0},{provide:Fn,useFactory:function l6(){return function qF(t){Tg=t}(document),document},deps:[]}],d6=JD(LH,"browser",aS),f6=new se(""),uS=[{provide:df,useClass:class KW{addToWindow(n){dt.getAngularTestability=(r,i=!0)=>{const o=n.findTestabilityInTree(r,i);if(null==o)throw new $(5103,!1);return o},dt.getAllAngularTestabilities=()=>n.getAllTestabilities(),dt.getAllAngularRootElements=()=>n.getAllRootElements(),dt.frameworkStabilizers||(dt.frameworkStabilizers=[]),dt.frameworkStabilizers.push(r=>{const i=dt.getAllAngularTestabilities();let o=i.length,s=!1;const a=function(u){s=s||u,o--,0==o&&r(s)};i.forEach(u=>{u.whenStable(a)})})}findTestabilityInTree(n,e,r){return null==e?null:n.getTestability(e)??(r?So().isShadowRoot(e)?this.findTestabilityInTree(n,e.host,!0):this.findTestabilityInTree(n,e.parentElement,!0):null)}},deps:[]},{provide:KD,useClass:tv,deps:[rt,nv,df]},{provide:tv,useClass:tv,deps:[rt,nv,df]}],cS=[{provide:Bg,useValue:"root"},{provide:Fi,useFactory:function c6(){return new Fi},deps:[]},{provide:kv,useClass:i6,multi:!0,deps:[Fn,rt,yo]},{provide:kv,useClass:a6,multi:!0,deps:[Fn]},nS,JI,ZI,{provide:hC,useExisting:nS},{provide:class CW{},useClass:YW,deps:[]},[]];let h6=(()=>{class t{constructor(e){}static withServerTransition(e){return{ngModule:t,providers:[{provide:Od,useValue:e.appId}]}}static#e=this.\u0275fac=function(r){return new(r||t)(pe(f6,12))};static#t=this.\u0275mod=_t({type:t});static#n=this.\u0275inj=yt({providers:[...cS,...uS],imports:[Kn,BH]})}return t})(),lS=(()=>{class t{constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}static#e=this.\u0275fac=function(r){return new(r||t)(pe(Fn))};static#t=this.\u0275prov=fe({token:t,factory:function(r){let i=null;return i=r?new r:function g6(){return new lS(pe(Fn))}(),i},providedIn:"root"})}return t})();typeof window<"u"&&window;const{isArray:_6}=Array,{getPrototypeOf:C6,prototype:x6,keys:E6}=Object;function pS(t){if(1===t.length){const n=t[0];if(_6(n))return{args:n,keys:null};if(function D6(t){return t&&"object"==typeof t&&C6(t)===x6}(n)){const e=E6(n);return{args:e.map(r=>n[r]),keys:e}}}return{args:t,keys:null}}const{isArray:I6}=Array;function gS(t){return at(n=>function S6(t,n){return I6(n)?t(...n):t(n)}(t,n))}function mS(t,n){return t.reduce((e,r,i)=>(e[r]=n[i],e),{})}function Hv(...t){const n=Du(t),e=Iw(t),{args:r,keys:i}=pS(t);if(0===r.length)return Jt([],n);const o=new Lt(function T6(t,n,e=ao){return r=>{vS(n,()=>{const{length:i}=t,o=new Array(i);let s=i,a=i;for(let u=0;u<i;u++)vS(n,()=>{const c=Jt(t[u],n);let l=!1;c.subscribe(Bt(r,d=>{o[u]=d,l||(l=!0,a--),a||r.next(e(o.slice()))},()=>{--s||r.complete()}))},r)},r)}}(r,n,i?s=>mS(i,s):ao));return e?o.pipe(gS(e)):o}function vS(t,n,e){t?Si(e,t,n):n()}const Af=up(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"});function jv(...t){return function M6(){return Us(1)}()(Jt(t,Du(t)))}function yS(t){return new Lt(n=>{er(t()).subscribe(n)})}function Rc(t,n){const e=st(t)?t:()=>t,r=i=>i.error(e());return new Lt(n?i=>n.schedule(r,0,i):r)}function Wv(){return zt((t,n)=>{let e=null;t._refCount++;const r=Bt(n,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount)return void(e=null);const i=t._connection,o=e;e=null,i&&(!o||i===o)&&i.unsubscribe(),n.unsubscribe()});t.subscribe(r),r.closed||(e=t.connect())})}class bS extends Lt{constructor(n,e){super(),this.source=n,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,dw(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new Jn;const e=this.getSubject();n.add(this.source.subscribe(Bt(e,void 0,()=>{this._teardown(),e.complete()},r=>{this._teardown(),e.error(r)},()=>this._teardown()))),n.closed&&(this._connection=null,n=Jn.EMPTY)}return n}refCount(){return Wv()(this)}}function Ua(t){return t<=0?()=>Qr:zt((n,e)=>{let r=0;n.subscribe(Bt(e,i=>{++r<=t&&(e.next(i),t<=r&&e.complete())}))})}function Ao(t,n){return zt((e,r)=>{let i=0;e.subscribe(Bt(r,o=>t.call(n,o,i++)&&r.next(o)))})}function Rf(t){return zt((n,e)=>{let r=!1;n.subscribe(Bt(e,i=>{r=!0,e.next(i)},()=>{r||e.next(t),e.complete()}))})}function wS(t=R6){return zt((n,e)=>{let r=!1;n.subscribe(Bt(e,i=>{r=!0,e.next(i)},()=>r?e.complete():e.error(t())))})}function R6(){return new Af}function gs(t,n){const e=arguments.length>=2;return r=>r.pipe(t?Ao((i,o)=>t(i,o,r)):ao,Ua(1),e?Rf(n):wS(()=>new Af))}function Oc(t,n){return st(n)?sn(t,n,1):sn(t,1)}function bn(t,n,e){const r=st(t)||n||e?{next:t,error:n,complete:e}:t;return r?zt((i,o)=>{var s;null===(s=r.subscribe)||void 0===s||s.call(r);let a=!0;i.subscribe(Bt(o,u=>{var c;null===(c=r.next)||void 0===c||c.call(r,u),o.next(u)},()=>{var u;a=!1,null===(u=r.complete)||void 0===u||u.call(r),o.complete()},u=>{var c;a=!1,null===(c=r.error)||void 0===c||c.call(r,u),o.error(u)},()=>{var u,c;a&&(null===(u=r.unsubscribe)||void 0===u||u.call(r)),null===(c=r.finalize)||void 0===c||c.call(r)}))}):ao}function ms(t){return zt((n,e)=>{let o,r=null,i=!1;r=n.subscribe(Bt(e,void 0,void 0,s=>{o=er(t(s,ms(t)(n))),r?(r.unsubscribe(),r=null,o.subscribe(e)):i=!0})),i&&(r.unsubscribe(),r=null,o.subscribe(e))})}function zv(t){return t<=0?()=>Qr:zt((n,e)=>{let r=[];n.subscribe(Bt(e,i=>{r.push(i),t<r.length&&r.shift()},()=>{for(const i of r)e.next(i);e.complete()},void 0,()=>{r=null}))})}function Gv(t){return zt((n,e)=>{try{n.subscribe(e)}finally{e.add(t)}})}const Se="primary",Nc=Symbol("RouteTitle");class L6{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const e=this.params[n];return Array.isArray(e)?e[0]:e}return null}getAll(n){if(this.has(n)){const e=this.params[n];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function Ha(t){return new L6(t)}function B6(t,n,e){const r=e.path.split("/");if(r.length>t.length||"full"===e.pathMatch&&(n.hasChildren()||r.length<t.length))return null;const i={};for(let o=0;o<r.length;o++){const s=r[o],a=t[o];if(s.startsWith(":"))i[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:t.slice(0,r.length),posParams:i}}function fi(t,n){const e=t?Object.keys(t):void 0,r=n?Object.keys(n):void 0;if(!e||!r||e.length!=r.length)return!1;let i;for(let o=0;o<e.length;o++)if(i=e[o],!_S(t[i],n[i]))return!1;return!0}function _S(t,n){if(Array.isArray(t)&&Array.isArray(n)){if(t.length!==n.length)return!1;const e=[...t].sort(),r=[...n].sort();return e.every((i,o)=>r[o]===i)}return t===n}function CS(t){return t.length>0?t[t.length-1]:null}function Ro(t){return function w6(t){return!!t&&(t instanceof Lt||st(t.lift)&&st(t.subscribe))}(t)?t:hc(t)?Jt(Promise.resolve(t)):we(t)}const U6={exact:function DS(t,n,e){if(!vs(t.segments,n.segments)||!Of(t.segments,n.segments,e)||t.numberOfChildren!==n.numberOfChildren)return!1;for(const r in n.children)if(!t.children[r]||!DS(t.children[r],n.children[r],e))return!1;return!0},subset:IS},xS={exact:function H6(t,n){return fi(t,n)},subset:function j6(t,n){return Object.keys(n).length<=Object.keys(t).length&&Object.keys(n).every(e=>_S(t[e],n[e]))},ignored:()=>!0};function ES(t,n,e){return U6[e.paths](t.root,n.root,e.matrixParams)&&xS[e.queryParams](t.queryParams,n.queryParams)&&!("exact"===e.fragment&&t.fragment!==n.fragment)}function IS(t,n,e){return SS(t,n,n.segments,e)}function SS(t,n,e,r){if(t.segments.length>e.length){const i=t.segments.slice(0,e.length);return!(!vs(i,e)||n.hasChildren()||!Of(i,e,r))}if(t.segments.length===e.length){if(!vs(t.segments,e)||!Of(t.segments,e,r))return!1;for(const i in n.children)if(!t.children[i]||!IS(t.children[i],n.children[i],r))return!1;return!0}{const i=e.slice(0,t.segments.length),o=e.slice(t.segments.length);return!!(vs(t.segments,i)&&Of(t.segments,i,r)&&t.children[Se])&&SS(t.children[Se],n,o,r)}}function Of(t,n,e){return n.every((r,i)=>xS[e](t[i].parameters,r.parameters))}class ja{constructor(n=new it([],{}),e={},r=null){this.root=n,this.queryParams=e,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ha(this.queryParams)),this._queryParamMap}toString(){return G6.serialize(this)}}class it{constructor(n,e){this.segments=n,this.children=e,this.parent=null,Object.values(e).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Nf(this)}}class kc{constructor(n,e){this.path=n,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=Ha(this.parameters)),this._parameterMap}toString(){return AS(this)}}function vs(t,n){return t.length===n.length&&t.every((e,r)=>e.path===n[r].path)}let Pc=(()=>{class t{static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=fe({token:t,factory:function(){return new $v},providedIn:"root"})}return t})();class $v{parse(n){const e=new n5(n);return new ja(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(n){const e=`/${Fc(n.root,!0)}`,r=function K6(t){const n=Object.keys(t).map(e=>{const r=t[e];return Array.isArray(r)?r.map(i=>`${kf(e)}=${kf(i)}`).join("&"):`${kf(e)}=${kf(r)}`}).filter(e=>!!e);return n.length?`?${n.join("&")}`:""}(n.queryParams);return`${e}${r}${"string"==typeof n.fragment?`#${function $6(t){return encodeURI(t)}(n.fragment)}`:""}`}}const G6=new $v;function Nf(t){return t.segments.map(n=>AS(n)).join("/")}function Fc(t,n){if(!t.hasChildren())return Nf(t);if(n){const e=t.children[Se]?Fc(t.children[Se],!1):"",r=[];return Object.entries(t.children).forEach(([i,o])=>{i!==Se&&r.push(`${i}:${Fc(o,!1)}`)}),r.length>0?`${e}(${r.join("//")})`:e}{const e=function z6(t,n){let e=[];return Object.entries(t.children).forEach(([r,i])=>{r===Se&&(e=e.concat(n(i,r)))}),Object.entries(t.children).forEach(([r,i])=>{r!==Se&&(e=e.concat(n(i,r)))}),e}(t,(r,i)=>i===Se?[Fc(t.children[Se],!1)]:[`${i}:${Fc(r,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children[Se]?`${Nf(t)}/${e[0]}`:`${Nf(t)}/(${e.join("//")})`}}function TS(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function kf(t){return TS(t).replace(/%3B/gi,";")}function qv(t){return TS(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Pf(t){return decodeURIComponent(t)}function MS(t){return Pf(t.replace(/\+/g,"%20"))}function AS(t){return`${qv(t.path)}${function q6(t){return Object.keys(t).map(n=>`;${qv(n)}=${qv(t[n])}`).join("")}(t.parameters)}`}const Y6=/^[^\/()?;#]+/;function Kv(t){const n=t.match(Y6);return n?n[0]:""}const X6=/^[^\/()?;=#]+/,Q6=/^[^=?&#]+/,e5=/^[^&#]+/;class n5{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new it([],{}):new it([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(n.length>0||Object.keys(e).length>0)&&(r[Se]=new it(n,e)),r}parseSegment(){const n=Kv(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new $(4009,!1);return this.capture(n),new kc(Pf(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const e=function Z6(t){const n=t.match(X6);return n?n[0]:""}(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){const i=Kv(this.remaining);i&&(r=i,this.capture(r))}n[Pf(e)]=Pf(r)}parseQueryParam(n){const e=function J6(t){const n=t.match(Q6);return n?n[0]:""}(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){const s=function t5(t){const n=t.match(e5);return n?n[0]:""}(this.remaining);s&&(r=s,this.capture(r))}const i=MS(e),o=MS(r);if(n.hasOwnProperty(i)){let s=n[i];Array.isArray(s)||(s=[s],n[i]=s),s.push(o)}else n[i]=o}parseParens(n){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=Kv(this.remaining),i=this.remaining[r.length];if("/"!==i&&")"!==i&&";"!==i)throw new $(4010,!1);let o;r.indexOf(":")>-1?(o=r.slice(0,r.indexOf(":")),this.capture(o),this.capture(":")):n&&(o=Se);const s=this.parseChildren();e[o]=1===Object.keys(s).length?s[Se]:new it([],s),this.consumeOptional("//")}return e}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new $(4011,!1)}}function RS(t){return t.segments.length>0?new it([],{[Se]:t}):t}function OS(t){const n={};for(const r of Object.keys(t.children)){const o=OS(t.children[r]);if(r===Se&&0===o.segments.length&&o.hasChildren())for(const[s,a]of Object.entries(o.children))n[s]=a;else(o.segments.length>0||o.hasChildren())&&(n[r]=o)}return function r5(t){if(1===t.numberOfChildren&&t.children[Se]){const n=t.children[Se];return new it(t.segments.concat(n.segments),n.children)}return t}(new it(t.segments,n))}function ys(t){return t instanceof ja}function NS(t){let n;const i=RS(function e(o){const s={};for(const u of o.children){const c=e(u);s[u.outlet]=c}const a=new it(o.url,s);return o===t&&(n=a),a}(t.root));return n??i}function kS(t,n,e,r){let i=t;for(;i.parent;)i=i.parent;if(0===n.length)return Yv(i,i,i,e,r);const o=function o5(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new FS(!0,0,t);let n=0,e=!1;const r=t.reduce((i,o,s)=>{if("object"==typeof o&&null!=o){if(o.outlets){const a={};return Object.entries(o.outlets).forEach(([u,c])=>{a[u]="string"==typeof c?c.split("/"):c}),[...i,{outlets:a}]}if(o.segmentPath)return[...i,o.segmentPath]}return"string"!=typeof o?[...i,o]:0===s?(o.split("/").forEach((a,u)=>{0==u&&"."===a||(0==u&&""===a?e=!0:".."===a?n++:""!=a&&i.push(a))}),i):[...i,o]},[]);return new FS(e,n,r)}(n);if(o.toRoot())return Yv(i,i,new it([],{}),e,r);const s=function s5(t,n,e){if(t.isAbsolute)return new Lf(n,!0,0);if(!e)return new Lf(n,!1,NaN);if(null===e.parent)return new Lf(e,!0,0);const r=Ff(t.commands[0])?0:1;return function a5(t,n,e){let r=t,i=n,o=e;for(;o>i;){if(o-=i,r=r.parent,!r)throw new $(4005,!1);i=r.segments.length}return new Lf(r,!1,i-o)}(e,e.segments.length-1+r,t.numberOfDoubleDots)}(o,i,t),a=s.processChildren?Bc(s.segmentGroup,s.index,o.commands):LS(s.segmentGroup,s.index,o.commands);return Yv(i,s.segmentGroup,a,e,r)}function Ff(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function Lc(t){return"object"==typeof t&&null!=t&&t.outlets}function Yv(t,n,e,r,i){let s,o={};r&&Object.entries(r).forEach(([u,c])=>{o[u]=Array.isArray(c)?c.map(l=>`${l}`):`${c}`}),s=t===n?e:PS(t,n,e);const a=RS(OS(s));return new ja(a,o,i)}function PS(t,n,e){const r={};return Object.entries(t.children).forEach(([i,o])=>{r[i]=o===n?e:PS(o,n,e)}),new it(t.segments,r)}class FS{constructor(n,e,r){if(this.isAbsolute=n,this.numberOfDoubleDots=e,this.commands=r,n&&r.length>0&&Ff(r[0]))throw new $(4003,!1);const i=r.find(Lc);if(i&&i!==CS(r))throw new $(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Lf{constructor(n,e,r){this.segmentGroup=n,this.processChildren=e,this.index=r}}function LS(t,n,e){if(t||(t=new it([],{})),0===t.segments.length&&t.hasChildren())return Bc(t,n,e);const r=function c5(t,n,e){let r=0,i=n;const o={match:!1,pathIndex:0,commandIndex:0};for(;i<t.segments.length;){if(r>=e.length)return o;const s=t.segments[i],a=e[r];if(Lc(a))break;const u=`${a}`,c=r<e.length-1?e[r+1]:null;if(i>0&&void 0===u)break;if(u&&c&&"object"==typeof c&&void 0===c.outlets){if(!VS(u,c,s))return o;r+=2}else{if(!VS(u,{},s))return o;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(t,n,e),i=e.slice(r.commandIndex);if(r.match&&r.pathIndex<t.segments.length){const o=new it(t.segments.slice(0,r.pathIndex),{});return o.children[Se]=new it(t.segments.slice(r.pathIndex),t.children),Bc(o,0,i)}return r.match&&0===i.length?new it(t.segments,{}):r.match&&!t.hasChildren()?Xv(t,n,e):r.match?Bc(t,0,i):Xv(t,n,e)}function Bc(t,n,e){if(0===e.length)return new it(t.segments,{});{const r=function u5(t){return Lc(t[0])?t[0].outlets:{[Se]:t}}(e),i={};if(Object.keys(r).some(o=>o!==Se)&&t.children[Se]&&1===t.numberOfChildren&&0===t.children[Se].segments.length){const o=Bc(t.children[Se],n,e);return new it(t.segments,o.children)}return Object.entries(r).forEach(([o,s])=>{"string"==typeof s&&(s=[s]),null!==s&&(i[o]=LS(t.children[o],n,s))}),Object.entries(t.children).forEach(([o,s])=>{void 0===r[o]&&(i[o]=s)}),new it(t.segments,i)}}function Xv(t,n,e){const r=t.segments.slice(0,n);let i=0;for(;i<e.length;){const o=e[i];if(Lc(o)){const u=l5(o.outlets);return new it(r,u)}if(0===i&&Ff(e[0])){r.push(new kc(t.segments[n].path,BS(e[0]))),i++;continue}const s=Lc(o)?o.outlets[Se]:`${o}`,a=i<e.length-1?e[i+1]:null;s&&a&&Ff(a)?(r.push(new kc(s,BS(a))),i+=2):(r.push(new kc(s,{})),i++)}return new it(r,{})}function l5(t){const n={};return Object.entries(t).forEach(([e,r])=>{"string"==typeof r&&(r=[r]),null!==r&&(n[e]=Xv(new it([],{}),0,r))}),n}function BS(t){const n={};return Object.entries(t).forEach(([e,r])=>n[e]=`${r}`),n}function VS(t,n,e){return t==e.path&&fi(n,e.parameters)}const Vc="imperative";class hi{constructor(n,e){this.id=n,this.url=e}}class Uc extends hi{constructor(n,e,r="imperative",i=null){super(n,e),this.type=0,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Oo extends hi{constructor(n,e,r){super(n,e),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Hc extends hi{constructor(n,e,r,i){super(n,e),this.reason=r,this.code=i,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Wa extends hi{constructor(n,e,r,i){super(n,e),this.reason=r,this.code=i,this.type=16}}class Bf extends hi{constructor(n,e,r,i){super(n,e),this.error=r,this.target=i,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class US extends hi{constructor(n,e,r,i){super(n,e),this.urlAfterRedirects=r,this.state=i,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class d5 extends hi{constructor(n,e,r,i){super(n,e),this.urlAfterRedirects=r,this.state=i,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class f5 extends hi{constructor(n,e,r,i,o){super(n,e),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=o,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class h5 extends hi{constructor(n,e,r,i){super(n,e),this.urlAfterRedirects=r,this.state=i,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class p5 extends hi{constructor(n,e,r,i){super(n,e),this.urlAfterRedirects=r,this.state=i,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class g5{constructor(n){this.route=n,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class m5{constructor(n){this.route=n,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class v5{constructor(n){this.snapshot=n,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class y5{constructor(n){this.snapshot=n,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class b5{constructor(n){this.snapshot=n,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class w5{constructor(n){this.snapshot=n,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class HS{constructor(n,e,r){this.routerEvent=n,this.position=e,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class Zv{}class Qv{constructor(n){this.url=n}}class _5{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new jc,this.attachRef=null}}let jc=(()=>{class t{constructor(){this.contexts=new Map}onChildOutletCreated(e,r){const i=this.getOrCreateContext(e);i.outlet=r,this.contexts.set(e,i)}onChildOutletDestroyed(e){const r=this.getContext(e);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let r=this.getContext(e);return r||(r=new _5,this.contexts.set(e,r)),r}getContext(e){return this.contexts.get(e)||null}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();class jS{constructor(n){this._root=n}get root(){return this._root.value}parent(n){const e=this.pathFromRoot(n);return e.length>1?e[e.length-2]:null}children(n){const e=Jv(n,this._root);return e?e.children.map(r=>r.value):[]}firstChild(n){const e=Jv(n,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(n){const e=ey(n,this._root);return e.length<2?[]:e[e.length-2].children.map(i=>i.value).filter(i=>i!==n)}pathFromRoot(n){return ey(n,this._root).map(e=>e.value)}}function Jv(t,n){if(t===n.value)return n;for(const e of n.children){const r=Jv(t,e);if(r)return r}return null}function ey(t,n){if(t===n.value)return[n];for(const e of n.children){const r=ey(t,e);if(r.length)return r.unshift(n),r}return[]}class zi{constructor(n,e){this.value=n,this.children=e}toString(){return`TreeNode(${this.value})`}}function za(t){const n={};return t&&t.children.forEach(e=>n[e.value.outlet]=e),n}class WS extends jS{constructor(n,e){super(n),this.snapshot=e,ty(this,n)}toString(){return this.snapshot.toString()}}function zS(t,n){const e=function C5(t,n){const s=new Vf([],{},{},"",{},Se,n,null,{});return new $S("",new zi(s,[]))}(0,n),r=new vr([new kc("",{})]),i=new vr({}),o=new vr({}),s=new vr({}),a=new vr(""),u=new No(r,i,s,a,o,Se,n,e.root);return u.snapshot=e.root,new WS(new zi(u,[]),e)}class No{constructor(n,e,r,i,o,s,a,u){this.urlSubject=n,this.paramsSubject=e,this.queryParamsSubject=r,this.fragmentSubject=i,this.dataSubject=o,this.outlet=s,this.component=a,this._futureSnapshot=u,this.title=this.dataSubject?.pipe(at(c=>c[Nc]))??we(void 0),this.url=n,this.params=e,this.queryParams=r,this.fragment=i,this.data=o}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(at(n=>Ha(n)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(at(n=>Ha(n)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function GS(t,n="emptyOnly"){const e=t.pathFromRoot;let r=0;if("always"!==n)for(r=e.length-1;r>=1;){const i=e[r],o=e[r-1];if(i.routeConfig&&""===i.routeConfig.path)r--;else{if(o.component)break;r--}}return function x5(t){return t.reduce((n,e)=>({params:{...n.params,...e.params},data:{...n.data,...e.data},resolve:{...e.data,...n.resolve,...e.routeConfig?.data,...e._resolvedData}}),{params:{},data:{},resolve:{}})}(e.slice(r))}class Vf{get title(){return this.data?.[Nc]}constructor(n,e,r,i,o,s,a,u,c){this.url=n,this.params=e,this.queryParams=r,this.fragment=i,this.data=o,this.outlet=s,this.component=a,this.routeConfig=u,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Ha(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ha(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class $S extends jS{constructor(n,e){super(e),this.url=n,ty(this,e)}toString(){return qS(this._root)}}function ty(t,n){n.value._routerState=t,n.children.forEach(e=>ty(t,e))}function qS(t){const n=t.children.length>0?` { ${t.children.map(qS).join(", ")} } `:"";return`${t.value}${n}`}function ny(t){if(t.snapshot){const n=t.snapshot,e=t._futureSnapshot;t.snapshot=e,fi(n.queryParams,e.queryParams)||t.queryParamsSubject.next(e.queryParams),n.fragment!==e.fragment&&t.fragmentSubject.next(e.fragment),fi(n.params,e.params)||t.paramsSubject.next(e.params),function V6(t,n){if(t.length!==n.length)return!1;for(let e=0;e<t.length;++e)if(!fi(t[e],n[e]))return!1;return!0}(n.url,e.url)||t.urlSubject.next(e.url),fi(n.data,e.data)||t.dataSubject.next(e.data)}else t.snapshot=t._futureSnapshot,t.dataSubject.next(t._futureSnapshot.data)}function ry(t,n){const e=fi(t.params,n.params)&&function W6(t,n){return vs(t,n)&&t.every((e,r)=>fi(e.parameters,n[r].parameters))}(t.url,n.url);return e&&!(!t.parent!=!n.parent)&&(!t.parent||ry(t.parent,n.parent))}let Uf=(()=>{class t{constructor(){this.activated=null,this._activatedRoute=null,this.name=Se,this.activateEvents=new $e,this.deactivateEvents=new $e,this.attachEvents=new $e,this.detachEvents=new $e,this.parentContexts=re(jc),this.location=re(Fr),this.changeDetector=re(fs),this.environmentInjector=re(_r),this.inputBinder=re(Hf,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(e){if(e.name){const{firstChange:r,previousValue:i}=e.name;if(r)return;this.isTrackedInParentContexts(i)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(i)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new $(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new $(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new $(4012,!1);this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,r){this.activated=e,this._activatedRoute=r,this.location.insert(e.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,r){if(this.isActivated)throw new $(4013,!1);this._activatedRoute=e;const i=this.location,s=e.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,u=new E5(e,a,i.injector);this.activated=i.createComponent(s,{index:i.length,injector:u,environmentInjector:r??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275dir=ge({type:t,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[rr]})}return t})();class E5{constructor(n,e,r){this.route=n,this.childContexts=e,this.parent=r}get(n,e){return n===No?this.route:n===jc?this.childContexts:this.parent.get(n,e)}}const Hf=new se("");let KS=(()=>{class t{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(e){this.unsubscribeFromRouteData(e),this.subscribeToRouteData(e)}unsubscribeFromRouteData(e){this.outletDataSubscriptions.get(e)?.unsubscribe(),this.outletDataSubscriptions.delete(e)}subscribeToRouteData(e){const{activatedRoute:r}=e,i=Hv([r.queryParams,r.params,r.data]).pipe(Jr(([o,s,a],u)=>(a={...o,...s,...a},0===u?we(a):Promise.resolve(a)))).subscribe(o=>{if(!e.isActivated||!e.activatedComponentRef||e.activatedRoute!==r||null===r.component)return void this.unsubscribeFromRouteData(e);const s=function XH(t){const n=Ve(t);if(!n)return null;const e=new ac(n);return{get selector(){return e.selector},get type(){return e.componentType},get inputs(){return e.inputs},get outputs(){return e.outputs},get ngContentSelectors(){return e.ngContentSelectors},get isStandalone(){return n.standalone},get isSignal(){return n.signals}}}(r.component);if(s)for(const{templateName:a}of s.inputs)e.activatedComponentRef.setInput(a,o[a]);else this.unsubscribeFromRouteData(e)});this.outletDataSubscriptions.set(e,i)}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac})}return t})();function Wc(t,n,e){if(e&&t.shouldReuseRoute(n.value,e.value.snapshot)){const r=e.value;r._futureSnapshot=n.value;const i=function I5(t,n,e){return n.children.map(r=>{for(const i of e.children)if(t.shouldReuseRoute(r.value,i.value.snapshot))return Wc(t,r,i);return Wc(t,r)})}(t,n,e);return new zi(r,i)}{if(t.shouldAttach(n.value)){const o=t.retrieve(n.value);if(null!==o){const s=o.route;return s.value._futureSnapshot=n.value,s.children=n.children.map(a=>Wc(t,a)),s}}const r=function S5(t){return new No(new vr(t.url),new vr(t.params),new vr(t.queryParams),new vr(t.fragment),new vr(t.data),t.outlet,t.component,t)}(n.value),i=n.children.map(o=>Wc(t,o));return new zi(r,i)}}const iy="ngNavigationCancelingError";function YS(t,n){const{redirectTo:e,navigationBehaviorOptions:r}=ys(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,i=XS(!1,0,n);return i.url=e,i.navigationBehaviorOptions=r,i}function XS(t,n,e){const r=new Error("NavigationCancelingError: "+(t||""));return r[iy]=!0,r.cancellationCode=n,e&&(r.url=e),r}function ZS(t){return t&&t[iy]}let QS=(()=>{class t{static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275cmp=an({type:t,selectors:[["ng-component"]],standalone:!0,features:[Na],decls:1,vars:0,template:function(r,i){1&r&&ht(0,"router-outlet")},dependencies:[Uf],encapsulation:2})}return t})();function oy(t){const n=t.children&&t.children.map(oy),e=n?{...t,children:n}:{...t};return!e.component&&!e.loadComponent&&(n||e.loadChildren)&&e.outlet&&e.outlet!==Se&&(e.component=QS),e}function Ur(t){return t.outlet||Se}function zc(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let n=t.parent;n;n=n.parent){const e=n.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}class P5{constructor(n,e,r,i,o){this.routeReuseStrategy=n,this.futureState=e,this.currState=r,this.forwardEvent=i,this.inputBindingEnabled=o}activate(n){const e=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,r,n),ny(this.futureState.root),this.activateChildRoutes(e,r,n)}deactivateChildRoutes(n,e,r){const i=za(e);n.children.forEach(o=>{const s=o.value.outlet;this.deactivateRoutes(o,i[s],r),delete i[s]}),Object.values(i).forEach(o=>{this.deactivateRouteAndItsChildren(o,r)})}deactivateRoutes(n,e,r){const i=n.value,o=e?e.value:null;if(i===o)if(i.component){const s=r.getContext(i.outlet);s&&this.deactivateChildRoutes(n,e,s.children)}else this.deactivateChildRoutes(n,e,r);else o&&this.deactivateRouteAndItsChildren(e,r)}deactivateRouteAndItsChildren(n,e){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,e):this.deactivateRouteAndOutlet(n,e)}detachAndStoreRouteSubtree(n,e){const r=e.getContext(n.value.outlet),i=r&&n.value.component?r.children:e,o=za(n);for(const s of Object.keys(o))this.deactivateRouteAndItsChildren(o[s],i);if(r&&r.outlet){const s=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:s,route:n,contexts:a})}}deactivateRouteAndOutlet(n,e){const r=e.getContext(n.value.outlet),i=r&&n.value.component?r.children:e,o=za(n);for(const s of Object.keys(o))this.deactivateRouteAndItsChildren(o[s],i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(n,e,r){const i=za(e);n.children.forEach(o=>{this.activateRoutes(o,i[o.value.outlet],r),this.forwardEvent(new w5(o.value.snapshot))}),n.children.length&&this.forwardEvent(new y5(n.value.snapshot))}activateRoutes(n,e,r){const i=n.value,o=e?e.value:null;if(ny(i),i===o)if(i.component){const s=r.getOrCreateContext(i.outlet);this.activateChildRoutes(n,e,s.children)}else this.activateChildRoutes(n,e,r);else if(i.component){const s=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){const a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),ny(a.route.value),this.activateChildRoutes(n,null,s.children)}else{const a=zc(i.snapshot);s.attachRef=null,s.route=i,s.injector=a,s.outlet&&s.outlet.activateWith(i,s.injector),this.activateChildRoutes(n,null,s.children)}}else this.activateChildRoutes(n,null,r)}}class JS{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class jf{constructor(n,e){this.component=n,this.route=e}}function F5(t,n,e){const r=t._root;return Gc(r,n?n._root:null,e,[r.value])}function Ga(t,n){const e=Symbol(),r=n.get(t,e);return r===e?"function"!=typeof t||function lk(t){return null!==jl(t)}(t)?n.get(t):t:r}function Gc(t,n,e,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const o=za(n);return t.children.forEach(s=>{(function B5(t,n,e,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const o=t.value,s=n?n.value:null,a=e?e.getContext(t.value.outlet):null;if(s&&o.routeConfig===s.routeConfig){const u=function V5(t,n,e){if("function"==typeof e)return e(t,n);switch(e){case"pathParamsChange":return!vs(t.url,n.url);case"pathParamsOrQueryParamsChange":return!vs(t.url,n.url)||!fi(t.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!ry(t,n)||!fi(t.queryParams,n.queryParams);default:return!ry(t,n)}}(s,o,o.routeConfig.runGuardsAndResolvers);u?i.canActivateChecks.push(new JS(r)):(o.data=s.data,o._resolvedData=s._resolvedData),Gc(t,n,o.component?a?a.children:null:e,r,i),u&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new jf(a.outlet.component,s))}else s&&$c(n,a,i),i.canActivateChecks.push(new JS(r)),Gc(t,null,o.component?a?a.children:null:e,r,i)})(s,o[s.value.outlet],e,r.concat([s.value]),i),delete o[s.value.outlet]}),Object.entries(o).forEach(([s,a])=>$c(a,e.getContext(s),i)),i}function $c(t,n,e){const r=za(t),i=t.value;Object.entries(r).forEach(([o,s])=>{$c(s,i.component?n?n.children.getContext(o):null:n,e)}),e.canDeactivateChecks.push(new jf(i.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,i))}function qc(t){return"function"==typeof t}function e2(t){return t instanceof Af||"EmptyError"===t?.name}const Wf=Symbol("INITIAL_VALUE");function $a(){return Jr(t=>Hv(t.map(n=>n.pipe(Ua(1),function A6(...t){const n=Du(t);return zt((e,r)=>{(n?jv(t,e,n):jv(t,e)).subscribe(r)})}(Wf)))).pipe(at(n=>{for(const e of n)if(!0!==e){if(e===Wf)return Wf;if(!1===e||e instanceof ja)return e}return!0}),Ao(n=>n!==Wf),Ua(1)))}function t2(t){return function fN(...t){return uw(t)}(bn(n=>{if(ys(n))throw YS(0,n)}),at(n=>!0===n))}class zf{constructor(n){this.segmentGroup=n||null}}class n2{constructor(n){this.urlTree=n}}function qa(t){return Rc(new zf(t))}function r2(t){return Rc(new n2(t))}class oz{constructor(n,e){this.urlSerializer=n,this.urlTree=e}noMatchError(n){return new $(4002,!1)}lineralizeSegments(n,e){let r=[],i=e.root;for(;;){if(r=r.concat(i.segments),0===i.numberOfChildren)return we(r);if(i.numberOfChildren>1||!i.children[Se])return Rc(new $(4e3,!1));i=i.children[Se]}}applyRedirectCommands(n,e,r){return this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),n,r)}applyRedirectCreateUrlTree(n,e,r,i){const o=this.createSegmentGroup(n,e.root,r,i);return new ja(o,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(n,e){const r={};return Object.entries(n).forEach(([i,o])=>{if("string"==typeof o&&o.startsWith(":")){const a=o.substring(1);r[i]=e[a]}else r[i]=o}),r}createSegmentGroup(n,e,r,i){const o=this.createSegments(n,e.segments,r,i);let s={};return Object.entries(e.children).forEach(([a,u])=>{s[a]=this.createSegmentGroup(n,u,r,i)}),new it(o,s)}createSegments(n,e,r,i){return e.map(o=>o.path.startsWith(":")?this.findPosParam(n,o,i):this.findOrReturn(o,r))}findPosParam(n,e,r){const i=r[e.path.substring(1)];if(!i)throw new $(4001,!1);return i}findOrReturn(n,e){let r=0;for(const i of e){if(i.path===n.path)return e.splice(r),i;r++}return n}}const sy={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function sz(t,n,e,r,i){const o=ay(t,n,e);return o.matched?(r=function M5(t,n){return t.providers&&!t._injector&&(t._injector=Lm(t.providers,n,`Route: ${t.path}`)),t._injector??n}(n,r),function nz(t,n,e,r){const i=n.canMatch;return i&&0!==i.length?we(i.map(s=>{const a=Ga(s,t);return Ro(function G5(t){return t&&qc(t.canMatch)}(a)?a.canMatch(n,e):t.runInContext(()=>a(n,e)))})).pipe($a(),t2()):we(!0)}(r,n,e).pipe(at(s=>!0===s?o:{...sy}))):we(o)}function ay(t,n,e){if(""===n.path)return"full"===n.pathMatch&&(t.hasChildren()||e.length>0)?{...sy}:{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};const i=(n.matcher||B6)(e,t,n);if(!i)return{...sy};const o={};Object.entries(i.posParams??{}).forEach(([a,u])=>{o[a]=u.path});const s=i.consumed.length>0?{...o,...i.consumed[i.consumed.length-1].parameters}:o;return{matched:!0,consumedSegments:i.consumed,remainingSegments:e.slice(i.consumed.length),parameters:s,positionalParamSegments:i.posParams??{}}}function o2(t,n,e,r){return e.length>0&&function cz(t,n,e){return e.some(r=>Gf(t,n,r)&&Ur(r)!==Se)}(t,e,r)?{segmentGroup:new it(n,uz(r,new it(e,t.children))),slicedSegments:[]}:0===e.length&&function lz(t,n,e){return e.some(r=>Gf(t,n,r))}(t,e,r)?{segmentGroup:new it(t.segments,az(t,0,e,r,t.children)),slicedSegments:e}:{segmentGroup:new it(t.segments,t.children),slicedSegments:e}}function az(t,n,e,r,i){const o={};for(const s of r)if(Gf(t,e,s)&&!i[Ur(s)]){const a=new it([],{});o[Ur(s)]=a}return{...i,...o}}function uz(t,n){const e={};e[Se]=n;for(const r of t)if(""===r.path&&Ur(r)!==Se){const i=new it([],{});e[Ur(r)]=i}return e}function Gf(t,n,e){return(!(t.hasChildren()||n.length>0)||"full"!==e.pathMatch)&&""===e.path}class pz{constructor(n,e,r,i,o,s,a){this.injector=n,this.configLoader=e,this.rootComponentType=r,this.config=i,this.urlTree=o,this.paramsInheritanceStrategy=s,this.urlSerializer=a,this.allowRedirects=!0,this.applyRedirects=new oz(this.urlSerializer,this.urlTree)}noMatchError(n){return new $(4002,!1)}recognize(){const n=o2(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,n,Se).pipe(ms(e=>{if(e instanceof n2)return this.allowRedirects=!1,this.urlTree=e.urlTree,this.match(e.urlTree);throw e instanceof zf?this.noMatchError(e):e}),at(e=>{const r=new Vf([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Se,this.rootComponentType,null,{}),i=new zi(r,e),o=new $S("",i),s=function i5(t,n,e=null,r=null){return kS(NS(t),n,e,r)}(r,[],this.urlTree.queryParams,this.urlTree.fragment);return s.queryParams=this.urlTree.queryParams,o.url=this.urlSerializer.serialize(s),this.inheritParamsAndData(o._root),{state:o,tree:s}}))}match(n){return this.processSegmentGroup(this.injector,this.config,n.root,Se).pipe(ms(r=>{throw r instanceof zf?this.noMatchError(r):r}))}inheritParamsAndData(n){const e=n.value,r=GS(e,this.paramsInheritanceStrategy);e.params=Object.freeze(r.params),e.data=Object.freeze(r.data),n.children.forEach(i=>this.inheritParamsAndData(i))}processSegmentGroup(n,e,r,i){return 0===r.segments.length&&r.hasChildren()?this.processChildren(n,e,r):this.processSegment(n,e,r,r.segments,i,!0)}processChildren(n,e,r){const i=[];for(const o of Object.keys(r.children))"primary"===o?i.unshift(o):i.push(o);return Jt(i).pipe(Oc(o=>{const s=r.children[o],a=function N5(t,n){const e=t.filter(r=>Ur(r)===n);return e.push(...t.filter(r=>Ur(r)!==n)),e}(e,o);return this.processSegmentGroup(n,a,s,o)}),function N6(t,n){return zt(function O6(t,n,e,r,i){return(o,s)=>{let a=e,u=n,c=0;o.subscribe(Bt(s,l=>{const d=c++;u=a?t(u,l,d):(a=!0,l),r&&s.next(u)},i&&(()=>{a&&s.next(u),s.complete()})))}}(t,n,arguments.length>=2,!0))}((o,s)=>(o.push(...s),o)),Rf(null),function k6(t,n){const e=arguments.length>=2;return r=>r.pipe(t?Ao((i,o)=>t(i,o,r)):ao,zv(1),e?Rf(n):wS(()=>new Af))}(),sn(o=>{if(null===o)return qa(r);const s=s2(o);return function gz(t){t.sort((n,e)=>n.value.outlet===Se?-1:e.value.outlet===Se?1:n.value.outlet.localeCompare(e.value.outlet))}(s),we(s)}))}processSegment(n,e,r,i,o,s){return Jt(e).pipe(Oc(a=>this.processSegmentAgainstRoute(a._injector??n,e,a,r,i,o,s).pipe(ms(u=>{if(u instanceof zf)return we(null);throw u}))),gs(a=>!!a),ms(a=>{if(e2(a))return function fz(t,n,e){return 0===n.length&&!t.children[e]}(r,i,o)?we([]):qa(r);throw a}))}processSegmentAgainstRoute(n,e,r,i,o,s,a){return function dz(t,n,e,r){return!!(Ur(t)===r||r!==Se&&Gf(n,e,t))&&("**"===t.path||ay(n,t,e).matched)}(r,i,o,s)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(n,i,r,o,s,a):a&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(n,i,e,r,o,s):qa(i):qa(i)}expandSegmentAgainstRouteUsingRedirect(n,e,r,i,o,s){return"**"===i.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(n,r,i,s):this.expandRegularSegmentAgainstRouteUsingRedirect(n,e,r,i,o,s)}expandWildCardWithParamsAgainstRouteUsingRedirect(n,e,r,i){const o=this.applyRedirects.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?r2(o):this.applyRedirects.lineralizeSegments(r,o).pipe(sn(s=>{const a=new it(s,{});return this.processSegment(n,e,a,s,i,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(n,e,r,i,o,s){const{matched:a,consumedSegments:u,remainingSegments:c,positionalParamSegments:l}=ay(e,i,o);if(!a)return qa(e);const d=this.applyRedirects.applyRedirectCommands(u,i.redirectTo,l);return i.redirectTo.startsWith("/")?r2(d):this.applyRedirects.lineralizeSegments(i,d).pipe(sn(f=>this.processSegment(n,r,e,f.concat(c),s,!1)))}matchSegmentAgainstRoute(n,e,r,i,o,s){let a;if("**"===r.path){const u=i.length>0?CS(i).parameters:{};a=we({snapshot:new Vf(i,u,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,a2(r),Ur(r),r.component??r._loadedComponent??null,r,u2(r)),consumedSegments:[],remainingSegments:[]}),e.children={}}else a=sz(e,r,i,n).pipe(at(({matched:u,consumedSegments:c,remainingSegments:l,parameters:d})=>u?{snapshot:new Vf(c,d,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,a2(r),Ur(r),r.component??r._loadedComponent??null,r,u2(r)),consumedSegments:c,remainingSegments:l}:null));return a.pipe(Jr(u=>null===u?qa(e):this.getChildConfig(n=r._injector??n,r,i).pipe(Jr(({routes:c})=>{const l=r._loadedInjector??n,{snapshot:d,consumedSegments:f,remainingSegments:h}=u,{segmentGroup:p,slicedSegments:g}=o2(e,f,h,c);if(0===g.length&&p.hasChildren())return this.processChildren(l,c,p).pipe(at(v=>null===v?null:[new zi(d,v)]));if(0===c.length&&0===g.length)return we([new zi(d,[])]);const m=Ur(r)===o;return this.processSegment(l,c,p,g,m?Se:o,!0).pipe(at(v=>[new zi(d,v)]))}))))}getChildConfig(n,e,r){return e.children?we({routes:e.children,injector:n}):e.loadChildren?void 0!==e._loadedRoutes?we({routes:e._loadedRoutes,injector:e._loadedInjector}):function tz(t,n,e,r){const i=n.canLoad;return void 0===i||0===i.length?we(!0):we(i.map(s=>{const a=Ga(s,t);return Ro(function H5(t){return t&&qc(t.canLoad)}(a)?a.canLoad(n,e):t.runInContext(()=>a(n,e)))})).pipe($a(),t2())}(n,e,r).pipe(sn(i=>i?this.configLoader.loadChildren(n,e).pipe(bn(o=>{e._loadedRoutes=o.routes,e._loadedInjector=o.injector})):function iz(t){return Rc(XS(!1,3))}())):we({routes:[],injector:n})}}function mz(t){const n=t.value.routeConfig;return n&&""===n.path}function s2(t){const n=[],e=new Set;for(const r of t){if(!mz(r)){n.push(r);continue}const i=n.find(o=>r.value.routeConfig===o.value.routeConfig);void 0!==i?(i.children.push(...r.children),e.add(i)):n.push(r)}for(const r of e){const i=s2(r.children);n.push(new zi(r.value,i))}return n.filter(r=>!e.has(r))}function a2(t){return t.data||{}}function u2(t){return t.resolve||{}}function c2(t){return"string"==typeof t.title||null===t.title}function uy(t){return Jr(n=>{const e=t(n);return e?Jt(e).pipe(at(()=>n)):we(n)})}const Ka=new se("ROUTES");let cy=(()=>{class t{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=re(zD)}loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return we(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);const r=Ro(e.loadComponent()).pipe(at(l2),bn(o=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=o}),Gv(()=>{this.componentLoaders.delete(e)})),i=new bS(r,()=>new mr).pipe(Wv());return this.componentLoaders.set(e,i),i}loadChildren(e,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return we({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const o=function xz(t,n,e,r){return Ro(t.loadChildren()).pipe(at(l2),sn(i=>i instanceof XE||Array.isArray(i)?we(i):Jt(n.compileModuleAsync(i))),at(i=>{r&&r(t);let o,s,a=!1;return Array.isArray(i)?(s=i,!0):(o=i.create(e).injector,s=o.get(Ka,[],{optional:!0,self:!0}).flat()),{routes:s.map(oy),injector:o}}))}(r,this.compiler,e,this.onLoadEndListener).pipe(Gv(()=>{this.childrenLoaders.delete(r)})),s=new bS(o,()=>new mr).pipe(Wv());return this.childrenLoaders.set(r,s),s}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function l2(t){return function Ez(t){return t&&"object"==typeof t&&"default"in t}(t)?t.default:t}let $f=(()=>{class t{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new mr,this.transitionAbortSubject=new mr,this.configLoader=re(cy),this.environmentInjector=re(_r),this.urlSerializer=re(Pc),this.rootContexts=re(jc),this.inputBindingEnabled=null!==re(Hf,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>we(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=i=>this.events.next(new m5(i)),this.configLoader.onLoadStartListener=i=>this.events.next(new g5(i))}complete(){this.transitions?.complete()}handleNavigationRequest(e){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...e,id:r})}setupNavigations(e,r,i){return this.transitions=new vr({id:0,currentUrlTree:r,currentRawUrl:r,currentBrowserUrl:r,extractedUrl:e.urlHandlingStrategy.extract(r),urlAfterRedirects:e.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Vc,restoredState:null,currentSnapshot:i.snapshot,targetSnapshot:null,currentRouterState:i,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Ao(o=>0!==o.id),at(o=>({...o,extractedUrl:e.urlHandlingStrategy.extract(o.rawUrl)})),Jr(o=>{this.currentTransition=o;let s=!1,a=!1;return we(o).pipe(bn(u=>{this.currentNavigation={id:u.id,initialUrl:u.rawUrl,extractedUrl:u.extractedUrl,trigger:u.source,extras:u.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Jr(u=>{const c=u.currentBrowserUrl.toString(),l=!e.navigated||u.extractedUrl.toString()!==c||c!==u.currentUrlTree.toString();if(!l&&"reload"!==(u.extras.onSameUrlNavigation??e.onSameUrlNavigation)){const f="";return this.events.next(new Wa(u.id,this.urlSerializer.serialize(u.rawUrl),f,0)),u.resolve(null),Qr}if(e.urlHandlingStrategy.shouldProcessUrl(u.rawUrl))return we(u).pipe(Jr(f=>{const h=this.transitions?.getValue();return this.events.next(new Uc(f.id,this.urlSerializer.serialize(f.extractedUrl),f.source,f.restoredState)),h!==this.transitions?.getValue()?Qr:Promise.resolve(f)}),function vz(t,n,e,r,i,o){return sn(s=>function hz(t,n,e,r,i,o,s="emptyOnly"){return new pz(t,n,e,r,i,s,o).recognize()}(t,n,e,r,s.extractedUrl,i,o).pipe(at(({state:a,tree:u})=>({...s,targetSnapshot:a,urlAfterRedirects:u}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,e.config,this.urlSerializer,e.paramsInheritanceStrategy),bn(f=>{o.targetSnapshot=f.targetSnapshot,o.urlAfterRedirects=f.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:f.urlAfterRedirects};const h=new US(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot);this.events.next(h)}));if(l&&e.urlHandlingStrategy.shouldProcessUrl(u.currentRawUrl)){const{id:f,extractedUrl:h,source:p,restoredState:g,extras:m}=u,v=new Uc(f,this.urlSerializer.serialize(h),p,g);this.events.next(v);const y=zS(0,this.rootComponentType).snapshot;return this.currentTransition=o={...u,targetSnapshot:y,urlAfterRedirects:h,extras:{...m,skipLocationChange:!1,replaceUrl:!1}},we(o)}{const f="";return this.events.next(new Wa(u.id,this.urlSerializer.serialize(u.extractedUrl),f,1)),u.resolve(null),Qr}}),bn(u=>{const c=new d5(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(c)}),at(u=>(this.currentTransition=o={...u,guards:F5(u.targetSnapshot,u.currentSnapshot,this.rootContexts)},o)),function q5(t,n){return sn(e=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:o,canDeactivateChecks:s}}=e;return 0===s.length&&0===o.length?we({...e,guardsResult:!0}):function K5(t,n,e,r){return Jt(t).pipe(sn(i=>function ez(t,n,e,r,i){const o=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return o&&0!==o.length?we(o.map(a=>{const u=zc(n)??i,c=Ga(a,u);return Ro(function z5(t){return t&&qc(t.canDeactivate)}(c)?c.canDeactivate(t,n,e,r):u.runInContext(()=>c(t,n,e,r))).pipe(gs())})).pipe($a()):we(!0)}(i.component,i.route,e,n,r)),gs(i=>!0!==i,!0))}(s,r,i,t).pipe(sn(a=>a&&function U5(t){return"boolean"==typeof t}(a)?function Y5(t,n,e,r){return Jt(n).pipe(Oc(i=>jv(function Z5(t,n){return null!==t&&n&&n(new v5(t)),we(!0)}(i.route.parent,r),function X5(t,n){return null!==t&&n&&n(new b5(t)),we(!0)}(i.route,r),function J5(t,n,e){const r=n[n.length-1],o=n.slice(0,n.length-1).reverse().map(s=>function L5(t){const n=t.routeConfig?t.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:t,guards:n}:null}(s)).filter(s=>null!==s).map(s=>yS(()=>we(s.guards.map(u=>{const c=zc(s.node)??e,l=Ga(u,c);return Ro(function W5(t){return t&&qc(t.canActivateChild)}(l)?l.canActivateChild(r,t):c.runInContext(()=>l(r,t))).pipe(gs())})).pipe($a())));return we(o).pipe($a())}(t,i.path,e),function Q5(t,n,e){const r=n.routeConfig?n.routeConfig.canActivate:null;if(!r||0===r.length)return we(!0);const i=r.map(o=>yS(()=>{const s=zc(n)??e,a=Ga(o,s);return Ro(function j5(t){return t&&qc(t.canActivate)}(a)?a.canActivate(n,t):s.runInContext(()=>a(n,t))).pipe(gs())}));return we(i).pipe($a())}(t,i.route,e))),gs(i=>!0!==i,!0))}(r,o,t,n):we(a)),at(a=>({...e,guardsResult:a})))})}(this.environmentInjector,u=>this.events.next(u)),bn(u=>{if(o.guardsResult=u.guardsResult,ys(u.guardsResult))throw YS(0,u.guardsResult);const c=new f5(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot,!!u.guardsResult);this.events.next(c)}),Ao(u=>!!u.guardsResult||(this.cancelNavigationTransition(u,"",3),!1)),uy(u=>{if(u.guards.canActivateChecks.length)return we(u).pipe(bn(c=>{const l=new h5(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}),Jr(c=>{let l=!1;return we(c).pipe(function yz(t,n){return sn(e=>{const{targetSnapshot:r,guards:{canActivateChecks:i}}=e;if(!i.length)return we(e);let o=0;return Jt(i).pipe(Oc(s=>function bz(t,n,e,r){const i=t.routeConfig,o=t._resolve;return void 0!==i?.title&&!c2(i)&&(o[Nc]=i.title),function wz(t,n,e,r){const i=function _z(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}(t);if(0===i.length)return we({});const o={};return Jt(i).pipe(sn(s=>function Cz(t,n,e,r){const i=zc(n)??r,o=Ga(t,i);return Ro(o.resolve?o.resolve(n,e):i.runInContext(()=>o(n,e)))}(t[s],n,e,r).pipe(gs(),bn(a=>{o[s]=a}))),zv(1),function P6(t){return at(()=>t)}(o),ms(s=>e2(s)?Qr:Rc(s)))}(o,t,n,r).pipe(at(s=>(t._resolvedData=s,t.data=GS(t,e).resolve,i&&c2(i)&&(t.data[Nc]=i.title),null)))}(s.route,r,t,n)),bn(()=>o++),zv(1),sn(s=>o===i.length?we(e):Qr))})}(e.paramsInheritanceStrategy,this.environmentInjector),bn({next:()=>l=!0,complete:()=>{l||this.cancelNavigationTransition(c,"",2)}}))}),bn(c=>{const l=new p5(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}))}),uy(u=>{const c=l=>{const d=[];l.routeConfig?.loadComponent&&!l.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(l.routeConfig).pipe(bn(f=>{l.component=f}),at(()=>{})));for(const f of l.children)d.push(...c(f));return d};return Hv(c(u.targetSnapshot.root)).pipe(Rf(),Ua(1))}),uy(()=>this.afterPreactivation()),at(u=>{const c=function D5(t,n,e){const r=Wc(t,n._root,e?e._root:void 0);return new WS(r,n)}(e.routeReuseStrategy,u.targetSnapshot,u.currentRouterState);return this.currentTransition=o={...u,targetRouterState:c},o}),bn(()=>{this.events.next(new Zv)}),((t,n,e,r)=>at(i=>(new P5(n,i.targetRouterState,i.currentRouterState,e,r).activate(t),i)))(this.rootContexts,e.routeReuseStrategy,u=>this.events.next(u),this.inputBindingEnabled),Ua(1),bn({next:u=>{s=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Oo(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects))),e.titleStrategy?.updateTitle(u.targetRouterState.snapshot),u.resolve(!0)},complete:()=>{s=!0}}),function F6(t){return zt((n,e)=>{er(t).subscribe(Bt(e,()=>e.complete(),dp)),!e.closed&&n.subscribe(e)})}(this.transitionAbortSubject.pipe(bn(u=>{throw u}))),Gv(()=>{s||a||this.cancelNavigationTransition(o,"",1),this.currentNavigation?.id===o.id&&(this.currentNavigation=null)}),ms(u=>{if(a=!0,ZS(u))this.events.next(new Hc(o.id,this.urlSerializer.serialize(o.extractedUrl),u.message,u.cancellationCode)),function T5(t){return ZS(t)&&ys(t.url)}(u)?this.events.next(new Qv(u.url)):o.resolve(!1);else{this.events.next(new Bf(o.id,this.urlSerializer.serialize(o.extractedUrl),u,o.targetSnapshot??void 0));try{o.resolve(e.errorHandler(u))}catch(c){o.reject(c)}}return Qr}))}))}cancelNavigationTransition(e,r,i){const o=new Hc(e.id,this.urlSerializer.serialize(e.extractedUrl),r,i);this.events.next(o),e.resolve(!1)}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function d2(t){return t!==Vc}let f2=(()=>{class t{buildTitle(e){let r,i=e.root;for(;void 0!==i;)r=this.getResolvedTitleForRoute(i)??r,i=i.children.find(o=>o.outlet===Se);return r}getResolvedTitleForRoute(e){return e.data[Nc]}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=fe({token:t,factory:function(){return re(Dz)},providedIn:"root"})}return t})(),Dz=(()=>{class t extends f2{constructor(e){super(),this.title=e}updateTitle(e){const r=this.buildTitle(e);void 0!==r&&this.title.setTitle(r)}static#e=this.\u0275fac=function(r){return new(r||t)(pe(lS))};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Iz=(()=>{class t{static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=fe({token:t,factory:function(){return re(Tz)},providedIn:"root"})}return t})();class Sz{shouldDetach(n){return!1}store(n,e){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,e){return n.routeConfig===e.routeConfig}}let Tz=(()=>{class t extends Sz{static#e=this.\u0275fac=function(){let e;return function(i){return(e||(e=$t(t)))(i||t)}}();static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const qf=new se("",{providedIn:"root",factory:()=>({})});let Mz=(()=>{class t{static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=fe({token:t,factory:function(){return re(Az)},providedIn:"root"})}return t})(),Az=(()=>{class t{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,r){return e}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Kc=function(t){return t[t.COMPLETE=0]="COMPLETE",t[t.FAILED=1]="FAILED",t[t.REDIRECTING=2]="REDIRECTING",t}(Kc||{});function h2(t,n){t.events.pipe(Ao(e=>e instanceof Oo||e instanceof Hc||e instanceof Bf||e instanceof Wa),at(e=>e instanceof Oo||e instanceof Wa?Kc.COMPLETE:e instanceof Hc&&(0===e.code||1===e.code)?Kc.REDIRECTING:Kc.FAILED),Ao(e=>e!==Kc.REDIRECTING),Ua(1)).subscribe(()=>{n()})}function Rz(t){throw t}function Oz(t,n,e){return n.parse("/")}const Nz={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},kz={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Bn=(()=>{class t{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=re(jD),this.isNgZoneEnabled=!1,this._events=new mr,this.options=re(qf,{optional:!0})||{},this.pendingTasks=re(WD),this.errorHandler=this.options.errorHandler||Rz,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||Oz,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=re(Mz),this.routeReuseStrategy=re(Iz),this.titleStrategy=re(f2),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=re(Ka,{optional:!0})?.flat()??[],this.navigationTransitions=re($f),this.urlSerializer=re(Pc),this.location=re(gv),this.componentInputBindingEnabled=!!re(Hf,{optional:!0}),this.eventsSubscription=new Jn,this.isNgZoneEnabled=re(rt)instanceof rt&&rt.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new ja,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=zS(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(e=>{this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const e=this.navigationTransitions.events.subscribe(r=>{try{const{currentTransition:i}=this.navigationTransitions;if(null===i)return void(p2(r)&&this._events.next(r));if(r instanceof Uc)d2(i.source)&&(this.browserUrlTree=i.extractedUrl);else if(r instanceof Wa)this.rawUrlTree=i.rawUrl;else if(r instanceof US){if("eager"===this.urlUpdateStrategy){if(!i.extras.skipLocationChange){const o=this.urlHandlingStrategy.merge(i.urlAfterRedirects,i.rawUrl);this.setBrowserUrl(o,i)}this.browserUrlTree=i.urlAfterRedirects}}else if(r instanceof Zv)this.currentUrlTree=i.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(i.urlAfterRedirects,i.rawUrl),this.routerState=i.targetRouterState,"deferred"===this.urlUpdateStrategy&&(i.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,i),this.browserUrlTree=i.urlAfterRedirects);else if(r instanceof Hc)0!==r.code&&1!==r.code&&(this.navigated=!0),(3===r.code||2===r.code)&&this.restoreHistory(i);else if(r instanceof Qv){const o=this.urlHandlingStrategy.merge(r.url,i.currentRawUrl),s={skipLocationChange:i.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||d2(i.source)};this.scheduleNavigation(o,Vc,null,s,{resolve:i.resolve,reject:i.reject,promise:i.promise})}r instanceof Bf&&this.restoreHistory(i,!0),r instanceof Oo&&(this.navigated=!0),p2(r)&&this._events.next(r)}catch(i){this.navigationTransitions.transitionAbortSubject.next(i)}});this.eventsSubscription.add(e)}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const e=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),Vc,e)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const r="popstate"===e.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{this.navigateToSyncWithBrowser(e.url,r,e.state)},0)}))}navigateToSyncWithBrowser(e,r,i){const o={replaceUrl:!0},s=i?.navigationId?i:null;if(i){const u={...i};delete u.navigationId,delete u.\u0275routerPageId,0!==Object.keys(u).length&&(o.state=u)}const a=this.parseUrl(e);this.scheduleNavigation(a,r,s,o)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(e){this.config=e.map(oy),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(e,r={}){const{relativeTo:i,queryParams:o,fragment:s,queryParamsHandling:a,preserveFragment:u}=r,c=u?this.currentUrlTree.fragment:s;let d,l=null;switch(a){case"merge":l={...this.currentUrlTree.queryParams,...o};break;case"preserve":l=this.currentUrlTree.queryParams;break;default:l=o||null}null!==l&&(l=this.removeEmptyProps(l));try{d=NS(i?i.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof e[0]||!e[0].startsWith("/"))&&(e=[]),d=this.currentUrlTree.root}return kS(d,e,l,c??null)}navigateByUrl(e,r={skipLocationChange:!1}){const i=ys(e)?e:this.parseUrl(e),o=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(o,Vc,null,r)}navigate(e,r={skipLocationChange:!1}){return function Pz(t){for(let n=0;n<t.length;n++)if(null==t[n])throw new $(4008,!1)}(e),this.navigateByUrl(this.createUrlTree(e,r),r)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let r;try{r=this.urlSerializer.parse(e)}catch(i){r=this.malformedUriErrorHandler(i,this.urlSerializer,e)}return r}isActive(e,r){let i;if(i=!0===r?{...Nz}:!1===r?{...kz}:r,ys(e))return ES(this.currentUrlTree,e,i);const o=this.parseUrl(e);return ES(this.currentUrlTree,o,i)}removeEmptyProps(e){return Object.keys(e).reduce((r,i)=>{const o=e[i];return null!=o&&(r[i]=o),r},{})}scheduleNavigation(e,r,i,o,s){if(this.disposed)return Promise.resolve(!1);let a,u,c;s?(a=s.resolve,u=s.reject,c=s.promise):c=new Promise((d,f)=>{a=d,u=f});const l=this.pendingTasks.add();return h2(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(l))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:e,extras:o,resolve:a,reject:u,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(d=>Promise.reject(d))}setBrowserUrl(e,r){const i=this.urlSerializer.serialize(e);if(this.location.isCurrentPathEqualTo(i)||r.extras.replaceUrl){const s={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId)};this.location.replaceState(i,"",s)}else{const o={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId+1)};this.location.go(i,"",o)}}restoreHistory(e,r=!1){if("computed"===this.canceledNavigationResolution){const o=this.currentPageId-this.browserPageId;0!==o?this.location.historyGo(o):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===o&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,r){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:r}:{navigationId:e}}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function p2(t){return!(t instanceof Zv||t instanceof Qv)}class g2{}let Bz=(()=>{class t{constructor(e,r,i,o,s){this.router=e,this.injector=i,this.preloadingStrategy=o,this.loader=s}setUpPreloading(){this.subscription=this.router.events.pipe(Ao(e=>e instanceof Oo),Oc(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,r){const i=[];for(const o of r){o.providers&&!o._injector&&(o._injector=Lm(o.providers,e,`Route: ${o.path}`));const s=o._injector??e,a=o._loadedInjector??s;(o.loadChildren&&!o._loadedRoutes&&void 0===o.canLoad||o.loadComponent&&!o._loadedComponent)&&i.push(this.preloadConfig(s,o)),(o.children||o._loadedRoutes)&&i.push(this.processRoutes(a,o.children??o._loadedRoutes))}return Jt(i).pipe(Us())}preloadConfig(e,r){return this.preloadingStrategy.preload(r,()=>{let i;i=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(e,r):we(null);const o=i.pipe(sn(s=>null===s?we(void 0):(r._loadedRoutes=s.routes,r._loadedInjector=s.injector,this.processRoutes(s.injector??e,s.routes))));return r.loadComponent&&!r._loadedComponent?Jt([o,this.loader.loadComponent(r)]).pipe(Us()):o})}static#e=this.\u0275fac=function(r){return new(r||t)(pe(Bn),pe(zD),pe(_r),pe(g2),pe(cy))};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const dy=new se("");let m2=(()=>{class t{constructor(e,r,i,o,s={}){this.urlSerializer=e,this.transitions=r,this.viewportScroller=i,this.zone=o,this.options=s,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},s.scrollPositionRestoration=s.scrollPositionRestoration||"disabled",s.anchorScrolling=s.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof Uc?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof Oo?(this.lastId=e.id,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.urlAfterRedirects).fragment)):e instanceof Wa&&0===e.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof HS&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new HS(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#e=this.\u0275fac=function(r){!function BC(){throw new Error("invalid")}()};static#t=this.\u0275prov=fe({token:t,factory:t.\u0275fac})}return t})();function Gi(t,n){return{\u0275kind:t,\u0275providers:n}}function y2(){const t=re(sr);return n=>{const e=t.get(La);if(n!==e.components[0])return;const r=t.get(Bn),i=t.get(b2);1===t.get(fy)&&r.initialNavigation(),t.get(w2,null,Ne.Optional)?.setUpPreloading(),t.get(dy,null,Ne.Optional)?.init(),r.resetRootComponentType(e.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}const b2=new se("",{factory:()=>new mr}),fy=new se("",{providedIn:"root",factory:()=>1}),w2=new se("");function jz(t){return Gi(0,[{provide:w2,useExisting:Bz},{provide:g2,useExisting:t}])}const _2=new se("ROUTER_FORROOT_GUARD"),zz=[gv,{provide:Pc,useClass:$v},Bn,jc,{provide:No,useFactory:function v2(t){return t.routerState.root},deps:[Bn]},cy,[]];function Gz(){return new ZD("Router",Bn)}let Kf=(()=>{class t{constructor(e){}static forRoot(e,r){return{ngModule:t,providers:[zz,[],{provide:Ka,multi:!0,useValue:e},{provide:_2,useFactory:Yz,deps:[[Bn,new fd,new hd]]},{provide:qf,useValue:r||{}},r?.useHash?{provide:ps,useClass:tj}:{provide:ps,useClass:SI},{provide:dy,useFactory:()=>{const t=re(bW),n=re(rt),e=re(qf),r=re($f),i=re(Pc);return e.scrollOffset&&t.setOffset(e.scrollOffset),new m2(i,r,t,n,e)}},r?.preloadingStrategy?jz(r.preloadingStrategy).\u0275providers:[],{provide:ZD,multi:!0,useFactory:Gz},r?.initialNavigation?Xz(r):[],r?.bindToComponentInputs?Gi(8,[KS,{provide:Hf,useExisting:KS}]).\u0275providers:[],[{provide:C2,useFactory:y2},{provide:ov,multi:!0,useExisting:C2}]]}}static forChild(e){return{ngModule:t,providers:[{provide:Ka,multi:!0,useValue:e}]}}static#e=this.\u0275fac=function(r){return new(r||t)(pe(_2,8))};static#t=this.\u0275mod=_t({type:t});static#n=this.\u0275inj=yt({})}return t})();function Yz(t){return"guarded"}function Xz(t){return["disabled"===t.initialNavigation?Gi(3,[{provide:Zm,multi:!0,useFactory:()=>{const n=re(Bn);return()=>{n.setUpLocationChangeListener()}}},{provide:fy,useValue:2}]).\u0275providers:[],"enabledBlocking"===t.initialNavigation?Gi(2,[{provide:fy,useValue:0},{provide:Zm,multi:!0,deps:[sr],useFactory:n=>{const e=n.get(JH,Promise.resolve());return()=>e.then(()=>new Promise(r=>{const i=n.get(Bn),o=n.get(b2);h2(i,()=>{r(!0)}),n.get($f).afterPreactivation=()=>(r(!0),o.closed?we(void 0):o),i.initialNavigation()}))}}]).\u0275providers:[]]}const C2=new se(""),x2=["*"];let wn=(()=>class t{static STARTS_WITH="startsWith";static CONTAINS="contains";static NOT_CONTAINS="notContains";static ENDS_WITH="endsWith";static EQUALS="equals";static NOT_EQUALS="notEquals";static IN="in";static LESS_THAN="lt";static LESS_THAN_OR_EQUAL_TO="lte";static GREATER_THAN="gt";static GREATER_THAN_OR_EQUAL_TO="gte";static BETWEEN="between";static IS="is";static IS_NOT="isNot";static BEFORE="before";static AFTER="after";static DATE_IS="dateIs";static DATE_IS_NOT="dateIsNot";static DATE_BEFORE="dateBefore";static DATE_AFTER="dateAfter"})(),Jz=(()=>{class t{ripple=!1;inputStyle="outlined";overlayOptions={};filterMatchModeOptions={text:[wn.STARTS_WITH,wn.CONTAINS,wn.NOT_CONTAINS,wn.ENDS_WITH,wn.EQUALS,wn.NOT_EQUALS],numeric:[wn.EQUALS,wn.NOT_EQUALS,wn.LESS_THAN,wn.LESS_THAN_OR_EQUAL_TO,wn.GREATER_THAN,wn.GREATER_THAN_OR_EQUAL_TO],date:[wn.DATE_IS,wn.DATE_IS_NOT,wn.DATE_BEFORE,wn.DATE_AFTER]};translation={startsWith:"Starts with",contains:"Contains",notContains:"Not contains",endsWith:"Ends with",equals:"Equals",notEquals:"Not equals",noFilter:"No Filter",lt:"Less than",lte:"Less than or equal to",gt:"Greater than",gte:"Greater than or equal to",is:"Is",isNot:"Is not",before:"Before",after:"After",dateIs:"Date is",dateIsNot:"Date is not",dateBefore:"Date is before",dateAfter:"Date is after",clear:"Clear",apply:"Apply",matchAll:"Match All",matchAny:"Match Any",addRule:"Add Rule",removeRule:"Remove Rule",accept:"Yes",reject:"No",choose:"Choose",upload:"Upload",cancel:"Cancel",pending:"Pending",fileSizeTypes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],chooseYear:"Choose Year",chooseMonth:"Choose Month",chooseDate:"Choose Date",prevDecade:"Previous Decade",nextDecade:"Next Decade",prevYear:"Previous Year",nextYear:"Next Year",prevMonth:"Previous Month",nextMonth:"Next Month",prevHour:"Previous Hour",nextHour:"Next Hour",prevMinute:"Previous Minute",nextMinute:"Next Minute",prevSecond:"Previous Second",nextSecond:"Next Second",am:"am",pm:"pm",dateFormat:"mm/dd/yy",firstDayOfWeek:0,today:"Today",weekHeader:"Wk",weak:"Weak",medium:"Medium",strong:"Strong",passwordPrompt:"Enter a password",emptyMessage:"No results found",searchMessage:"{0} results are available",selectionMessage:"{0} items selected",emptySelectionMessage:"No selected item",emptySearchMessage:"No results found",emptyFilterMessage:"No results found",aria:{trueLabel:"True",falseLabel:"False",nullLabel:"Not Selected",star:"1 star",stars:"{star} stars",selectAll:"All items selected",unselectAll:"All items unselected",close:"Close",previous:"Previous",next:"Next",navigation:"Navigation",scrollTop:"Scroll Top",moveTop:"Move Top",moveUp:"Move Up",moveDown:"Move Down",moveBottom:"Move Bottom",moveToTarget:"Move to Target",moveToSource:"Move to Source",moveAllToTarget:"Move All to Target",moveAllToSource:"Move All to Source",pageLabel:"{page}",firstPageLabel:"First Page",lastPageLabel:"Last Page",nextPageLabel:"Next Page",prevPageLabel:"Previous Page",rowsPerPageLabel:"Rows per page",previousPageLabel:"Previous Page",jumpToPageDropdownLabel:"Jump to Page Dropdown",jumpToPageInputLabel:"Jump to Page Input",selectRow:"Row Selected",unselectRow:"Row Unselected",expandRow:"Row Expanded",collapseRow:"Row Collapsed",showFilterMenu:"Show Filter Menu",hideFilterMenu:"Hide Filter Menu",filterOperator:"Filter Operator",filterConstraint:"Filter Constraint",editRow:"Row Edit",saveEdit:"Save Edit",cancelEdit:"Cancel Edit",listView:"List View",gridView:"Grid View",slide:"Slide",slideNumber:"{slideNumber}",zoomImage:"Zoom Image",zoomIn:"Zoom In",zoomOut:"Zoom Out",rotateRight:"Rotate Right",rotateLeft:"Rotate Left"}};zIndex={modal:1100,overlay:1e3,menu:1e3,tooltip:1100};translationSource=new mr;translationObserver=this.translationSource.asObservable();getTranslation(e){return this.translation[e]}setTranslation(e){this.translation={...this.translation,...e},this.translationSource.next(this.translation)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=fe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),e8=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275cmp=an({type:t,selectors:[["p-header"]],ngContentSelectors:x2,decls:1,vars:0,template:function(r,i){1&r&&(Ma(),_o(0))},encapsulation:2})}return t})(),t8=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275cmp=an({type:t,selectors:[["p-footer"]],ngContentSelectors:x2,decls:1,vars:0,template:function(r,i){1&r&&(Ma(),_o(0))},encapsulation:2})}return t})(),hy=(()=>{class t{template;type;name;constructor(e){this.template=e}getType(){return this.name}static \u0275fac=function(r){return new(r||t)(F(di))};static \u0275dir=ge({type:t,selectors:[["","pTemplate",""]],inputs:{type:"type",name:["pTemplate","name"]}})}return t})(),Yc=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=_t({type:t});static \u0275inj=yt({imports:[Kn]})}return t})();function n8(t,n){1&t&&Vi(0)}function r8(t,n){if(1&t&&(Z(0,"div",8),_o(1,1),de(2,n8,1,0,"ng-container",6),Q()),2&t){const e=qe();Y(2),K("ngTemplateOutlet",e.headerTemplate)}}function i8(t,n){1&t&&Vi(0)}function o8(t,n){if(1&t&&(Z(0,"div",9),He(1),de(2,i8,1,0,"ng-container",6),Q()),2&t){const e=qe();Y(1),Do(" ",e.header," "),Y(1),K("ngTemplateOutlet",e.titleTemplate)}}function s8(t,n){1&t&&Vi(0)}function a8(t,n){if(1&t&&(Z(0,"div",10),He(1),de(2,s8,1,0,"ng-container",6),Q()),2&t){const e=qe();Y(1),Do(" ",e.subheader," "),Y(1),K("ngTemplateOutlet",e.subtitleTemplate)}}function u8(t,n){1&t&&Vi(0)}function c8(t,n){1&t&&Vi(0)}function l8(t,n){if(1&t&&(Z(0,"div",11),_o(1,2),de(2,c8,1,0,"ng-container",6),Q()),2&t){const e=qe();Y(2),K("ngTemplateOutlet",e.footerTemplate)}}const d8=["*",[["p-header"]],[["p-footer"]]],f8=["*","p-header","p-footer"];let h8=(()=>{class t{el;header;subheader;style;styleClass;headerFacet;footerFacet;templates;headerTemplate;titleTemplate;subtitleTemplate;contentTemplate;footerTemplate;constructor(e){this.el=e}ngAfterContentInit(){this.templates.forEach(e=>{switch(e.getType()){case"header":this.headerTemplate=e.template;break;case"title":this.titleTemplate=e.template;break;case"subtitle":this.subtitleTemplate=e.template;break;case"content":default:this.contentTemplate=e.template;break;case"footer":this.footerTemplate=e.template}})}getBlockableElement(){return this.el.nativeElement.children[0]}static \u0275fac=function(r){return new(r||t)(F(en))};static \u0275cmp=an({type:t,selectors:[["p-card"]],contentQueries:function(r,i,o){if(1&r&&(ds(o,e8,5),ds(o,t8,5),ds(o,hy,4)),2&r){let s;xr(s=Er())&&(i.headerFacet=s.first),xr(s=Er())&&(i.footerFacet=s.first),xr(s=Er())&&(i.templates=s)}},hostAttrs:[1,"p-element"],inputs:{header:"header",subheader:"subheader",style:"style",styleClass:"styleClass"},ngContentSelectors:f8,decls:9,vars:10,consts:[[3,"ngClass","ngStyle"],["class","p-card-header",4,"ngIf"],[1,"p-card-body"],["class","p-card-title",4,"ngIf"],["class","p-card-subtitle",4,"ngIf"],[1,"p-card-content"],[4,"ngTemplateOutlet"],["class","p-card-footer",4,"ngIf"],[1,"p-card-header"],[1,"p-card-title"],[1,"p-card-subtitle"],[1,"p-card-footer"]],template:function(r,i){1&r&&(Ma(d8),Z(0,"div",0),de(1,r8,3,1,"div",1),Z(2,"div",2),de(3,o8,3,2,"div",3),de(4,a8,3,2,"div",4),Z(5,"div",5),_o(6),de(7,u8,1,0,"ng-container",6),Q(),de(8,l8,3,1,"div",7),Q()()),2&r&&(Eo(i.styleClass),K("ngClass","p-card p-component")("ngStyle",i.style),bt("data-pc-name","card"),Y(1),K("ngIf",i.headerFacet||i.headerTemplate),Y(2),K("ngIf",i.header||i.titleTemplate),Y(1),K("ngIf",i.subheader||i.subtitleTemplate),Y(3),K("ngTemplateOutlet",i.contentTemplate),Y(1),K("ngIf",i.footerFacet||i.footerTemplate))},dependencies:[To,Wi,Tc,Sc],styles:["@layer primeng{.p-card-header img{width:100%}}\n"],encapsulation:2,changeDetection:0})}return t})(),E2=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=_t({type:t});static \u0275inj=yt({imports:[Kn,Yc]})}return t})(),p8=(()=>{class t{constructor(e){this._router=e,this._router.events.subscribe(r=>{r instanceof Uc&&this.checkCurrentStep(r.url)}),this.checkCurrentStep(e.url)}changeStep(e,r){this.currentStep=e,this._router.navigate([r])}checkCurrentStep(e){e.includes("video")?this.currentStep=1:e.includes("otp")?this.currentStep=2:e.includes("password")&&(this.currentStep=3)}static#e=this.\u0275fac=function(r){return new(r||t)(F(Bn))};static#t=this.\u0275cmp=an({type:t,selectors:[["app-kyc"]],decls:31,vars:9,consts:[[1,"main"],[1,"logos"],[1,"heading"],[1,"steps"],[1,"line"],[1,"steps-data"],[1,"step"],[1,"step-icon",3,"ngClass","click"],[1,"pi","pi-video"],[1,"step-label",3,"ngClass","click"],[1,"pi","pi-mobile"],[1,"pi","pi-lock"],[1,"step-one",3,"hidden"],["src","assets/imgs/video.svg","alt","",1,"logo"],[1,"step-two",3,"hidden"],["src","assets/imgs/otp.svg","alt","",1,"logo"],[1,"step-three",3,"hidden"],["src","assets/imgs/password.svg","alt","",1,"logo"],[1,"kyc-data"],[1,"kyc-data-card"]],template:function(r,i){1&r&&(Z(0,"div",0)(1,"div",1)(2,"div",2),He(3," Verification & Registration "),Q(),Z(4,"div",3),ht(5,"div",4),Z(6,"div",5)(7,"div",6)(8,"div",7),Fe("click",function(){return i.changeStep(1,"video")}),ht(9,"i",8),Q(),Z(10,"div",9),Fe("click",function(){return i.changeStep(1,"video")}),He(11,"Live Capture"),Q()(),Z(12,"div",6)(13,"div",7),Fe("click",function(){return i.changeStep(2,"otp")}),ht(14,"i",10),Q(),Z(15,"div",9),Fe("click",function(){return i.changeStep(2,"otp")}),He(16,"OTP Verification"),Q()(),Z(17,"div",6)(18,"div",7),Fe("click",function(){return i.changeStep(3,"password")}),ht(19,"i",11),Q(),Z(20,"div",9),Fe("click",function(){return i.changeStep(3,"password")}),He(21,"Set Passowrd"),Q()()()(),Z(22,"div",12),ht(23,"img",13),Q(),Z(24,"div",14),ht(25,"img",15),Q(),Z(26,"div",16),ht(27,"img",17),Q()(),Z(28,"div",18)(29,"p-card",19),ht(30,"router-outlet"),Q()()()),2&r&&(Y(8),K("ngClass",1===i.currentStep?"active-icon":""),Y(2),K("ngClass",1===i.currentStep?"active-label":""),Y(3),K("ngClass",2===i.currentStep?"active-icon":""),Y(2),K("ngClass",2===i.currentStep?"active-label":""),Y(3),K("ngClass",3===i.currentStep?"active-icon":""),Y(2),K("ngClass",3===i.currentStep?"active-label":""),Y(2),K("hidden",1!==i.currentStep),Y(2),K("hidden",2!==i.currentStep),Y(2),K("hidden",3!==i.currentStep))},dependencies:[To,Uf,h8],styles:[".main[_ngcontent-%COMP%]{height:100vh;display:flex;background-color:#5aab619e}.main[_ngcontent-%COMP%]   .logos[_ngcontent-%COMP%], .main[_ngcontent-%COMP%]   .kyc-data[_ngcontent-%COMP%]{width:50%}.main[_ngcontent-%COMP%]   .kyc-data[_ngcontent-%COMP%]{margin:auto}.main[_ngcontent-%COMP%]   .kyc-data[_ngcontent-%COMP%]   .kyc-data-card[_ngcontent-%COMP%]{width:90%;display:block}.main[_ngcontent-%COMP%]   .logos[_ngcontent-%COMP%]{display:flex;flex-direction:column}.main[_ngcontent-%COMP%]   .logos[_ngcontent-%COMP%]   .steps[_ngcontent-%COMP%]{width:55%;margin:3rem auto}.main[_ngcontent-%COMP%]   .logos[_ngcontent-%COMP%]   .steps[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]{border-bottom:2px dotted #6c63ff;position:relative;top:1.2rem;z-index:-1;width:80%;margin:auto}.main[_ngcontent-%COMP%]   .logos[_ngcontent-%COMP%]   .steps[_ngcontent-%COMP%]   .steps-data[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.main[_ngcontent-%COMP%]   .logos[_ngcontent-%COMP%]   .steps[_ngcontent-%COMP%]   .steps-data[_ngcontent-%COMP%]   .step[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.main[_ngcontent-%COMP%]   .logos[_ngcontent-%COMP%]   .steps[_ngcontent-%COMP%]   .steps-data[_ngcontent-%COMP%]   .step[_ngcontent-%COMP%]   .step-icon[_ngcontent-%COMP%]{padding:.5rem .6rem;border:2px solid #358856;border-radius:50%;background-color:#358856;color:#fff;cursor:pointer}.main[_ngcontent-%COMP%]   .logos[_ngcontent-%COMP%]   .steps[_ngcontent-%COMP%]   .steps-data[_ngcontent-%COMP%]   .step[_ngcontent-%COMP%]   .active-icon[_ngcontent-%COMP%]{border-color:#fff}.main[_ngcontent-%COMP%]   .logos[_ngcontent-%COMP%]   .steps[_ngcontent-%COMP%]   .steps-data[_ngcontent-%COMP%]   .step[_ngcontent-%COMP%]   .step-label[_ngcontent-%COMP%]{font-size:.9rem;font-family:cursive;cursor:pointer}.main[_ngcontent-%COMP%]   .logos[_ngcontent-%COMP%]   .steps[_ngcontent-%COMP%]   .steps-data[_ngcontent-%COMP%]   .step[_ngcontent-%COMP%]   .active-label[_ngcontent-%COMP%]{color:#fff}.main[_ngcontent-%COMP%]   .logos[_ngcontent-%COMP%]   .step-one[_ngcontent-%COMP%], .main[_ngcontent-%COMP%]   .logos[_ngcontent-%COMP%]   .step-two[_ngcontent-%COMP%], .main[_ngcontent-%COMP%]   .logos[_ngcontent-%COMP%]   .step-three[_ngcontent-%COMP%]{text-align:center}.main[_ngcontent-%COMP%]   .logos[_ngcontent-%COMP%]   .step-one[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%], .main[_ngcontent-%COMP%]   .logos[_ngcontent-%COMP%]   .step-two[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%], .main[_ngcontent-%COMP%]   .logos[_ngcontent-%COMP%]   .step-three[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{height:300px;width:300px}.main[_ngcontent-%COMP%]   .logos[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{font-size:1.5rem;font-family:cursive;margin:1rem;color:#0c3823;font-weight:700}[_nghost-%COMP%]     .p-card .p-card-body{height:85vh}"]})}return t})();function D2(t,n,e,r,i,o,s){try{var a=t[o](s),u=a.value}catch(c){return void e(c)}a.done?n(u):Promise.resolve(u).then(r,i)}function Ya(t){return function(){var n=this,e=arguments;return new Promise(function(r,i){var o=t.apply(n,e);function s(u){D2(o,r,i,s,a,"next",u)}function a(u){D2(o,r,i,s,a,"throw",u)}s(void 0)})}}var I2=function(t,n){return(I2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])})(t,n)};function Hr(t,n){function e(){this.constructor=t}I2(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}function ie(t,n,e,r){return new(e||(e=Promise))(function(i,o){function s(c){try{u(r.next(c))}catch(l){o(l)}}function a(c){try{u(r.throw(c))}catch(l){o(l)}}function u(c){c.done?i(c.value):new e(function(l){l(c.value)}).then(s,a)}u((r=r.apply(t,n||[])).next())})}function oe(t,n){var e,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(c){return function(l){if(e)throw new TypeError("Generator is already executing.");for(;s;)try{if(e=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return s.label++,{value:l[1],done:!1};case 5:s.label++,r=l[1],l=[0];continue;case 7:l=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){s=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){s.label=l[1];break}if(6===l[0]&&s.label<i[1]){s.label=i[1],i=l;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(l);break}i[2]&&s.ops.pop(),s.trys.pop();continue}l=n.call(t,s)}catch(d){l=[6,d],r=0}finally{e=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([u,c])}}}var g8=function(){function t(n){this.global=n,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return t.prototype.setPlatform=function(n,e){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=n,this.platform=e},t.prototype.registerFlag=function(n,e,r){if(this.flagRegistry[n]={evaluationFn:e,setHook:r},null!=this.urlFlags[n]){var i=this.urlFlags[n];console.warn("Setting feature override from URL "+n+": "+i+"."),this.set(n,i)}},t.prototype.get=function(n){return n in this.flags||(this.flags[n]=this.evaluateFlag(n)),this.flags[n]},t.prototype.getNumber=function(n){return this.get(n)},t.prototype.getBool=function(n){return this.get(n)},t.prototype.getFlags=function(){return this.flags},Object.defineProperty(t.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),t.prototype.set=function(n,e){if(null==this.flagRegistry[n])throw new Error("Cannot set flag "+n+" as it has not been registered.");this.flags[n]=e,null!=this.flagRegistry[n].setHook&&this.flagRegistry[n].setHook(e)},t.prototype.evaluateFlag=function(n){if(null==this.flagRegistry[n])throw new Error("Cannot evaluate flag '"+n+"': no evaluation function found.");return this.flagRegistry[n].evaluationFn()},t.prototype.setFlags=function(n){this.flags=Object.assign({},n)},t.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},t.prototype.populateURLFlags=function(){var n=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var r,i=(r={},this.global.location.search.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(o){for(var s=[],a=1;a<arguments.length;a++)s[a-1]=arguments[a];return function m8(t,n,e){t[decodeURIComponent(n)]=decodeURIComponent(e||"")}(r,s[0],s[1]),s.join("=")}),r);"tfjsflags"in i&&i.tfjsflags.split(",").forEach(function(o){var s=o.split(":"),a=s[0];n.urlFlags[a]=function(c,l){if("true"===(l=l.toLowerCase())||"false"===l)return"true"===l;if(""+ +l===l)return+l;throw new Error("Could not parse value flag value "+l+" for flag "+c+".")}(a,s[1])})}},t}();function P(){return S2}var S2=null,Xa=new Map,Xc=new Map;function T2(t,n){var e=py(t,n);return Xa.get(e)}function M2(t){for(var n=Xa.entries(),e=[];;){var r=n.next(),o=r.value;if(r.done)break;var a=o[1];o[0].split("_")[0]===t&&e.push(a)}return e}function A2(t){var n=t.kernelName,e=t.backendName,r=py(n,e);if(Xa.has(r))throw new Error("The kernel '"+n+"' for backend '"+e+"' is already registered");Xa.set(r,t)}function y8(t){var n=t.kernelName;Xc.has(n)&&console.warn("Overriding the gradient for '"+n+"'"),Xc.set(n,t)}function py(t,n){return n+"_"+t}function R2(t){for(var n=t.length,e=0,r=0;n>0;)r=Math.random()*n|0,e=t[--n],t[n]=t[r],t[r]=e}function Yf(t,n,e){return Math.max(t,Math.min(n,e))}function gy(t){return t%2==0?t:t+1}function O2(t){for(var n=0,e=0;e<t.length;e++)n+=t[e];return n}function E(t,n){if(!t)throw new Error("string"==typeof n?n:n())}function je(t,n,e){void 0===e&&(e=""),E(Ut(t,n),function(){return e+" Shapes "+t+" and "+n+" must match"})}function bs(t){E(null!=t,function(){return"The input to the tensor constructor must be a non-null value."})}function $i(t,n,e){if(void 0===n&&(n=[]),void 0===e&&(e=!1),null==n&&(n=[]),Array.isArray(t)||fn(t)&&!e)for(var r=0;r<t.length;++r)$i(t[r],n,e);else n.push(t);return n}function ae(t){if(0===t.length)return 1;for(var n=t[0],e=1;e<t.length;e++)n*=t[e];return n}function Ut(t,n){if(t===n)return!0;if(null==t||null==n||t.length!==n.length)return!1;for(var e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}function Dt(t){return t%1==0}function N2(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var n=Math.exp(2*t);return(n-1)/(n+1)}function Xf(t){var n=Math.ceil(Math.sqrt(t));return[n,Math.ceil(t/n)]}function ws(t,n){return n<=t.length?t:t+" ".repeat(n-t.length)}function my(t,n,e){return void 0===n&&(n=function(r){return 0}),new Promise(function(r,i){var o=0,s=function(){if(t())r();else{o++;var a=n(o);null!=e&&o>=e?i():setTimeout(s,a)}};s()})}function k2(t,n){for(var e=1,r=-1,i=0;i<t.length;++i)if(t[i]>=0)e*=t[i];else if(-1===t[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(t[i]<0)throw Error("Shapes can not be < 0. Found "+t[i]+" at dim "+i);if(-1===r){if(n>0&&n!==e)throw Error("Size("+n+") must match the product of shape "+t);return t}if(0===e)throw Error("Cannot infer the missing size in ["+t+"] when there are 0 elements");if(n%e!=0)throw Error("The implicit shape can't be a fractional number. Got "+n+" / "+e);var o=t.slice();return o[r]=n/e,o}function Ht(t,n){var e=n.length;return E((t=null==t?n.map(function(r,i){return i}):[].concat(t)).every(function(r){return r>=-e&&r<e}),function(){return"All values in axis param must be in range [-"+e+", "+e+") but got axis "+t}),E(t.every(function(r){return Dt(r)}),function(){return"All values in axis param must be integers but got axis "+t}),t.map(function(r){return r<0?e+r:r})}function ko(t,n){for(var e=[],r=[],i=null!=n&&Array.isArray(n)&&0===n.length,o=null==n||i?null:Ht(n,t).sort(),s=0,a=0;a<t.length;++a){if(null!=o){if(o[s]===a&&1!==t[a])throw new Error("Can't squeeze axis "+a+" since its dim '"+t[a]+"' is not 1");(null==o[s]||o[s]>a)&&1===t[a]&&(e.push(t[a]),r.push(a)),o[s]<=a&&s++}1!==t[a]&&(e.push(t[a]),r.push(a))}return{newShape:e,keptDims:r}}function Za(t,n){var e=null;if(null==t||"float32"===t)e=new Float32Array(n);else if("int32"===t)e=new Int32Array(n);else{if("bool"!==t)throw new Error("Unknown data type "+t);e=new Uint8Array(n)}return e}function Zc(t,n){var e=null;if(null==t||"float32"===t)e=new Float32Array(n);else if("int32"===t)e=new Int32Array(n);else if("bool"===t)e=new Uint8Array(n);else{if("string"!==t)throw new Error("Unknown data type "+t);e=new Array(n)}return e}function P2(t,n){for(var e=0;e<t.length;e++){var r=t[e];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+n+" being uploaded contains "+r+".")}}function F2(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function L2(t,n){return!("complex64"===n||"float32"===n&&"complex64"!==t||"int32"===n&&"float32"!==t&&"complex64"!==t||"bool"===n&&"bool"===t)}function fn(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function vy(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)}function B2(t){if(null==t)return 0;var n=0;return t.forEach(function(e){return n+=e.length}),n}function Po(t){return"string"==typeof t||t instanceof String}function V2(t){return"boolean"==typeof t}function U2(t){return"number"==typeof t}function Qa(t){return Array.isArray(t)?Qa(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":U2(t)?"float32":Po(t)?"string":V2(t)?"bool":"float32"}function Fo(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Zf(t,n){for(var e=n;e<t;++e)if(t%e==0)return e;return t}function jr(t){var n=t.length;if(n<2)return[];var e=new Array(n-1);e[n-2]=t[n-1];for(var r=n-3;r>=0;--r)e[r]=e[r+1]*t[r+1];return e}function yy(t,n,e){if("string"===n)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=$i(t)),e&&P2(t,n),s=n,(o=t)instanceof Float32Array&&"float32"===s||o instanceof Int32Array&&"int32"===s||o instanceof Uint8Array&&"bool"===s)return t;var o,s;if(null==n||"float32"===n||"complex64"===n)return new Float32Array(t);if("int32"===n)return new Int32Array(t);if("bool"===n){for(var r=new Uint8Array(t.length),i=0;i<r.length;++i)0!==Math.round(t[i])&&(r[i]=1);return r}throw new Error("Unknown data type "+n)}function by(t,n){if(0===t.length)return n[0];var e=t.reduce(function(r,i){return r*i});if(0===e)return[];if(e!==n.length)throw new Error("["+t+"] does not match the input size.");return function r(i,o,s){var a=new Array;if(1===o.length)for(var u=o[0],c=0;c<u;c++)a[c]=s[i+c];else{u=o[0];var l=o.slice(1),d=l.reduce(function(f,h){return f*h});for(c=0;c<u;c++)a[c]=r(i+c*d,l,s)}return a}(0,t,n)}function wy(t,n){for(var e=Ja(t,n),r=0;r<e.length;r++)e[r]=1;return e}function Ja(t,n){if(null==n||"float32"===n||"complex64"===n)return new Float32Array(t);if("int32"===n)return new Int32Array(t);if("bool"===n)return new Uint8Array(t);throw new Error("Unknown data type "+n)}function Wr(){return P().platform.now()}function _y(t){t.forEach(function(n){E(Number.isInteger(n)&&n>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."})})}function H2(t,n){return void 0===n&&(n="utf-8"),n=n||"utf-8",P().platform.encode(t,n)}function Qc(t,n){return void 0===n&&(n="utf-8"),n=n||"utf-8",P().platform.decode(t,n)}function Cy(t,n,e){if(0===n)return 0;if(1===n)return t[0];for(var r=t[t.length-1],i=0;i<t.length-1;++i)r+=e[i]*t[i];return r}function j2(t,n,e){if(0===n)return[];if(1===n)return[t];for(var r=new Array(n),i=0;i<r.length-1;++i)r[i]=Math.floor(t/e[i]),t-=r[i]*e[i];return r[r.length-1]=t,r}Object.freeze({shuffle:R2,clamp:Yf,nearestLargerEven:gy,sum:O2,randUniform:function(t,n){var e=Math.random();return n*e+(1-e)*t},distSquared:function(t,n){for(var e=0,r=0;r<t.length;r++){var i=Number(t[r])-Number(n[r]);e+=i*i}return e},assert:E,assertShapesMatch:je,assertNonNull:bs,flatten:$i,sizeFromShape:ae,isScalarShape:function(t){return 0===t.length},arraysEqual:Ut,isInt:Dt,tanh:N2,sizeToSquarishShape:Xf,createShuffledIndices:function(t){for(var n=new Uint32Array(t),e=0;e<t;++e)n[e]=e;return R2(n),n},rightPad:ws,repeatedTry:my,inferFromImplicitShape:k2,parseAxisParam:Ht,squeezeShape:ko,getTypedArrayFromDType:Za,getArrayFromDType:Zc,checkConversionForErrors:P2,isValidDtype:F2,hasEncodingLoss:L2,isTypedArray:fn,bytesPerElement:vy,bytesFromStringArray:B2,isString:Po,isBoolean:V2,isNumber:U2,inferDtype:Qa,isFunction:Fo,nearestDivisor:Zf,computeStrides:jr,toTypedArray:yy,toNestedArray:by,makeOnesTypedArray:wy,makeZerosTypedArray:Ja,now:Wr,assertNonNegativeIntegerDimensions:_y,fetch:function(t,n){return P().platform.fetch(t,n)},encodeString:H2,decodeString:Qc,locToIndex:Cy,indexToLoc:j2});var b8=function(){function t(n,e){this.backendTimer=n,this.logger=e,null==e&&(this.logger=new w8)}return t.prototype.profileKernel=function(n,e,r){var i,o=this,s=this.backendTimer.time(function(){i=r()});return i.forEach(function(a){a.data().then(function(u){(function(c,l,d){if("float32"!==l)return!1;for(var f=0;f<c.length;f++){var h=c[f];if(isNaN(h)||!isFinite(h))return console.warn("Found "+h+" in the result of '"+d+"'"),!0}})(u,a.dtype,n),s.then(function(c){var l="";null!=c.getExtraProfileInfo&&(l=c.getExtraProfileInfo()),o.logger.logKernelProfile(n,a,u,c.kernelMs,e,l)})})}),i},t}(),w8=function(){function t(){}return t.prototype.logKernelProfile=function(n,e,r,i,o,s){var a="number"==typeof i?ws(i+"ms",9):i.error,u=ws(n,25),c=e.rank,l=e.size,d=ws(e.shape.toString(),14),f="";for(var h in o){var p=o[h].shape||e.shape,g=p.length;f+=h+": "+g+"D "+(g>0?p:"")+" "}console.log("%c"+u+"\t%c"+a+"\t%c"+c+"D "+d+"\t%c"+l+"\t%c"+f+"\t%c"+s,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},t}();function el(t,n,e){return ws(Array.isArray(t)?parseFloat(t[0].toFixed(7))+" + "+parseFloat(t[1].toFixed(7))+"j":Po(t)?"'"+t+"'":"bool"===e?z2(t):parseFloat(t.toFixed(7)).toString(),n)}function z2(t){return 0===t?"false":"true"}function tl(t){for(var n=[],e=0;e<t.length;e+=2)n.push([t[e],t[e+1]]);return n}var nl=function(){function t(n,e,r){var i=this;if(this.dtype=e,this.shape=n.slice(),this.size=ae(n),null!=r){var o=r.length;E(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+i.size+"'."})}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Zc(e,this.size),this.strides=jr(n)}return t.prototype.set=function(n){for(var e=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];0===r.length&&(r=[0]),E(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+e.rank+")"});var o=this.locToIndex(r);this.values[o]=n},t.prototype.get=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];0===n.length&&(n=[0]);for(var r=0,i=0,o=n;i<o.length;i++){var s=o[i];if(s<0||s>=this.shape[r])throw new Error("Requested out of range element at "+n+".   Buffer shape="+this.shape);r++}for(var u=n[n.length-1],c=0;c<n.length-1;++c)u+=this.strides[c]*n[c];return this.values[u]},t.prototype.locToIndex=function(n){if(0===this.rank)return 0;if(1===this.rank)return n[0];for(var e=n[n.length-1],r=0;r<n.length-1;++r)e+=this.strides[r]*n[r];return e},t.prototype.indexToLoc=function(n){if(0===this.rank)return[];if(1===this.rank)return[n];for(var e=new Array(this.shape.length),r=0;r<e.length-1;++r)e[r]=Math.floor(n/this.strides[r]),n-=e[r]*this.strides[r];return e[e.length-1]=n,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return pi().makeTensor(this.values,this.shape,this.dtype)},t}(),pi=null,k=null,G2=null,lt=function(){function t(n,e,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=n.slice(),this.dtype=e||"float32",this.size=ae(n),this.strides=jr(n),this.dataId=r,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}return t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),E(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(n,e){return this.throwIfDisposed(),this.reshape([n,e])},t.prototype.as3D=function(n,e,r){return this.throwIfDisposed(),this.reshape([n,e,r])},t.prototype.as4D=function(n,e,r,i){return this.throwIfDisposed(),this.reshape([n,e,r,i])},t.prototype.as5D=function(n,e,r,i,o){return this.throwIfDisposed(),this.reshape([n,e,r,i,o])},t.prototype.asType=function(n){return this.throwIfDisposed(),k.cast(this,n)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.buffer=function(){return ie(this,void 0,void 0,function(){var n;return oe(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return n=e.sent(),[2,k.buffer(this.shape,this.dtype,n)]}})})},t.prototype.bufferSync=function(){return k.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.array=function(){return ie(this,void 0,void 0,function(){var n;return oe(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return n=e.sent(),[2,by(this.shape,n)]}})})},t.prototype.arraySync=function(){return by(this.shape,this.dataSync())},t.prototype.data=function(){return ie(this,void 0,void 0,function(){var n,e;return oe(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),n=pi().read(this.dataId),"string"!==this.dtype?[3,2]:[4,n];case 1:e=r.sent();try{return[2,e.map(function(i){return Qc(i)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,n]}})})},t.prototype.dataSync=function(){this.throwIfDisposed();var n=pi().readSync(this.dataId);if("string"===this.dtype)try{return n.map(function(e){return Qc(e)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return n},t.prototype.bytes=function(){return ie(this,void 0,void 0,function(){var n;return oe(this,function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,pi().read(this.dataId)];case 1:return n=e.sent(),"string"===this.dtype?[2,n]:[2,new Uint8Array(n.buffer)]}})})},t.prototype.dispose=function(){this.isDisposed||(pi().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(n){return void 0===n&&(n=!1),k.print(this,n)},t.prototype.reshape=function(n){return this.throwIfDisposed(),k.reshape(this,n)},t.prototype.reshapeAs=function(n){return this.throwIfDisposed(),this.reshape(n.shape)},t.prototype.expandDims=function(n){return void 0===n&&(n=0),k.expandDims(this,n)},t.prototype.cumsum=function(n,e,r){return void 0===n&&(n=0),void 0===e&&(e=!1),void 0===r&&(r=!1),k.cumsum(this,n,e,r)},t.prototype.squeeze=function(n){return this.throwIfDisposed(),k.squeeze(this,n)},t.prototype.clone=function(){return this.throwIfDisposed(),k.clone(this)},t.prototype.oneHot=function(n,e,r){return this.throwIfDisposed(),k.oneHot(this,n,e,r)},t.prototype.toString=function(n){return void 0===n&&(n=!1),function _8(t,n,e,r){var i=jr(n),o=function(c,l,d,f){var h=ae(l),p=f[f.length-1],g=new Array(p).fill(0),m=l.length,v="complex64"===d?tl(c):c;if(m>1)for(var y=0;y<h/p;y++)for(var w=y*p,b=0;b<p;b++)g[b]=Math.max(g[b],el(v[w+b],0,d).length);return g}(t,n,e,i),s=n.length,a=function c(l,d,f,h,p,g){void 0===g&&(g=!0);var m="complex64"===f?2:1,v=d[0],y=d.length;if(0===y)return"complex64"===f?[el(tl(l)[0],0,f)]:"bool"===f?[z2(l[0])]:[l[0].toString()];if(1===y){if(v>20){var b=Array.from(l.slice(0,3*m)),_=Array.from(l.slice((v-3)*m,v*m));return"complex64"===f&&(b=tl(b),_=tl(_)),["["+b.map(function(B,z){return el(B,p[z],f)}).join(", ")+", ..., "+_.map(function(B,z){return el(B,p[v-3+z],f)}).join(", ")+"]"]}return["["+("complex64"===f?tl(l):Array.from(l)).map(function(B,z){return el(B,p[z],f)}).join(", ")+"]"]}var C=d.slice(1),T=h.slice(1),S=h[0]*m,D=[];if(v>20){for(var I=0;I<3;I++){var O=(R=I*S)+S;D.push.apply(D,c(l.slice(R,O),C,f,T,p,!1))}for(D.push("..."),I=v-3;I<v;I++)O=(R=I*S)+S,D.push.apply(D,c(l.slice(R,O),C,f,T,p,I===v-1))}else for(I=0;I<v;I++){var R;O=(R=I*S)+S,D.push.apply(D,c(l.slice(R,O),C,f,T,p,I===v-1))}var V=2===y?",":"";for(D[0]="["+D[0]+V,I=1;I<D.length-1;I++)D[I]=" "+D[I]+V;var L=",\n";for(I=2;I<y;I++)L+="\n";return D[D.length-1]=" "+D[D.length-1]+"]"+(g?"":L),D}(t,n,e,i,o),u=["Tensor"];return r&&(u.push("  dtype: "+e),u.push("  rank: "+s),u.push("  shape: ["+n+"]"),u.push("  values:")),u.push(a.map(function(c){return"    "+c}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,n)},t.prototype.tile=function(n){return this.throwIfDisposed(),k.tile(this,n)},t.prototype.gather=function(n,e){return void 0===e&&(e=0),this.throwIfDisposed(),k.gather(this,n,e)},t.prototype.matMul=function(n,e,r){return void 0===e&&(e=!1),void 0===r&&(r=!1),this.throwIfDisposed(),k.matMul(this,n,e,r)},t.prototype.dot=function(n){return this.throwIfDisposed(),k.dot(this,n)},t.prototype.norm=function(n,e,r){return void 0===n&&(n="euclidean"),void 0===e&&(e=null),void 0===r&&(r=!1),this.throwIfDisposed(),k.norm(this,n,e,r)},t.prototype.slice=function(n,e){return this.throwIfDisposed(),k.slice(this,n,e)},t.prototype.reverse=function(n){return this.throwIfDisposed(),k.reverse(this,n)},t.prototype.concat=function(n,e){return void 0===e&&(e=0),this.throwIfDisposed(),n instanceof t&&(n=[n]),k.concat([this].concat(n),e)},t.prototype.split=function(n,e){return void 0===e&&(e=0),this.throwIfDisposed(),k.split(this,n,e)},t.prototype.stack=function(n,e){return void 0===e&&(e=0),k.stack([this,n],e)},t.prototype.unstack=function(n){return void 0===n&&(n=0),k.unstack(this,n)},t.prototype.pad=function(n,e){return void 0===e&&(e=0),k.pad(this,n,e)},t.prototype.batchNormalization=function(n,e,r,i,o){return void 0===r&&(r=.001),G2("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(n,e,o,i,r)},t.prototype.batchNorm=function(n,e,r,i,o){return void 0===o&&(o=.001),this.throwIfDisposed(),k.batchNorm(this,n,e,r,i,o)},t.prototype.all=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),k.all(this,n,e)},t.prototype.any=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),k.any(this,n,e)},t.prototype.logSumExp=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),k.logSumExp(this,n,e)},t.prototype.sum=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),k.sum(this,n,e)},t.prototype.prod=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),k.prod(this,n,e)},t.prototype.mean=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),k.mean(this,n,e)},t.prototype.min=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),k.min(this,n,e)},t.prototype.max=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),k.max(this,n,e)},t.prototype.argMin=function(n){return void 0===n&&(n=null),this.throwIfDisposed(),k.argMin(this,n)},t.prototype.argMax=function(n){return void 0===n&&(n=null),this.throwIfDisposed(),k.argMax(this,n)},t.prototype.cast=function(n){return this.throwIfDisposed(),k.cast(this,n)},t.prototype.add=function(n){return this.throwIfDisposed(),k.add(this,n)},t.prototype.addStrict=function(n){return this.throwIfDisposed(),k.addStrict(this,n)},t.prototype.atan2=function(n){return this.throwIfDisposed(),k.atan2(this,n)},t.prototype.sub=function(n){return this.throwIfDisposed(),k.sub(this,n)},t.prototype.subStrict=function(n){return this.throwIfDisposed(),k.subStrict(this,n)},t.prototype.pow=function(n){return this.throwIfDisposed(),k.pow(this,n)},t.prototype.powStrict=function(n){return this.throwIfDisposed(),k.powStrict(this,n)},t.prototype.mul=function(n){return this.throwIfDisposed(),k.mul(this,n)},t.prototype.mulStrict=function(n){return this.throwIfDisposed(),k.mulStrict(this,n)},t.prototype.div=function(n){return this.throwIfDisposed(),k.div(this,n)},t.prototype.divNoNan=function(n){return this.throwIfDisposed(),k.divNoNan(this,n)},t.prototype.floorDiv=function(n){return this.throwIfDisposed(),k.floorDiv(this,n)},t.prototype.divStrict=function(n){return this.throwIfDisposed(),k.divStrict(this,n)},t.prototype.minimum=function(n){return this.throwIfDisposed(),k.minimum(this,n)},t.prototype.minimumStrict=function(n){return this.throwIfDisposed(),k.minimumStrict(this,n)},t.prototype.maximum=function(n){return this.throwIfDisposed(),k.maximum(this,n)},t.prototype.maximumStrict=function(n){return this.throwIfDisposed(),k.maximumStrict(this,n)},t.prototype.mod=function(n){return this.throwIfDisposed(),k.mod(this,n)},t.prototype.modStrict=function(n){return this.throwIfDisposed(),k.modStrict(this,n)},t.prototype.squaredDifferenceStrict=function(n){return this.throwIfDisposed(),k.squaredDifferenceStrict(this,n)},t.prototype.transpose=function(n){return this.throwIfDisposed(),k.transpose(this,n)},t.prototype.notEqual=function(n){return this.throwIfDisposed(),k.notEqual(this,n)},t.prototype.notEqualStrict=function(n){return this.throwIfDisposed(),k.notEqualStrict(this,n)},t.prototype.less=function(n){return this.throwIfDisposed(),k.less(this,n)},t.prototype.lessStrict=function(n){return this.throwIfDisposed(),k.lessStrict(this,n)},t.prototype.equal=function(n){return this.throwIfDisposed(),k.equal(this,n)},t.prototype.equalStrict=function(n){return this.throwIfDisposed(),k.equalStrict(this,n)},t.prototype.lessEqual=function(n){return this.throwIfDisposed(),k.lessEqual(this,n)},t.prototype.lessEqualStrict=function(n){return this.throwIfDisposed(),k.lessEqualStrict(this,n)},t.prototype.greater=function(n){return this.throwIfDisposed(),k.greater(this,n)},t.prototype.greaterStrict=function(n){return this.throwIfDisposed(),k.greaterStrict(this,n)},t.prototype.greaterEqual=function(n){return this.throwIfDisposed(),k.greaterEqual(this,n)},t.prototype.greaterEqualStrict=function(n){return this.throwIfDisposed(),k.greaterEqualStrict(this,n)},t.prototype.logicalAnd=function(n){return this.throwIfDisposed(),k.logicalAnd(this,n)},t.prototype.logicalOr=function(n){return this.throwIfDisposed(),k.logicalOr(this,n)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),k.logicalNot(this)},t.prototype.logicalXor=function(n){return this.throwIfDisposed(),k.logicalXor(this,n)},t.prototype.where=function(n,e){return this.throwIfDisposed(),k.where(n,this,e)},t.prototype.neg=function(){return this.throwIfDisposed(),k.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),k.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),k.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),k.sign(this)},t.prototype.isNaN=function(){return this.throwIfDisposed(),k.isNaN(this)},t.prototype.isInf=function(){return this.throwIfDisposed(),k.isInf(this)},t.prototype.isFinite=function(){return this.throwIfDisposed(),k.isFinite(this)},t.prototype.exp=function(){return this.throwIfDisposed(),k.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),k.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),k.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),k.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),k.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),k.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),k.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),k.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),k.abs(this)},t.prototype.clipByValue=function(n,e){return this.throwIfDisposed(),k.clipByValue(this,n,e)},t.prototype.relu=function(){return this.throwIfDisposed(),k.relu(this)},t.prototype.relu6=function(){return this.throwIfDisposed(),k.relu6(this)},t.prototype.elu=function(){return this.throwIfDisposed(),k.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),k.selu(this)},t.prototype.leakyRelu=function(n){return void 0===n&&(n=.2),this.throwIfDisposed(),k.leakyRelu(this,n)},t.prototype.prelu=function(n){return this.throwIfDisposed(),k.prelu(this,n)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),k.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),k.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),k.softplus(this)},t.prototype.zerosLike=function(){return this.throwIfDisposed(),k.zerosLike(this)},t.prototype.onesLike=function(){return this.throwIfDisposed(),k.onesLike(this)},t.prototype.sin=function(){return this.throwIfDisposed(),k.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),k.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),k.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),k.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),k.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),k.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),k.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),k.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),k.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),k.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),k.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),k.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),k.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),k.round(this)},t.prototype.step=function(n){return void 0===n&&(n=0),this.throwIfDisposed(),k.step(this,n)},t.prototype.softmax=function(n){return void 0===n&&(n=-1),this.throwIfDisposed(),k.softmax(this,n)},t.prototype.logSoftmax=function(n){return void 0===n&&(n=-1),this.throwIfDisposed(),k.logSoftmax(this,n)},t.prototype.resizeBilinear=function(n,e){return void 0===e&&(e=!1),this.throwIfDisposed(),k.image.resizeBilinear(this,n,e)},t.prototype.resizeNearestNeighbor=function(n,e){return void 0===e&&(e=!1),this.throwIfDisposed(),k.image.resizeNearestNeighbor(this,n,e)},t.prototype.conv1d=function(n,e,r,i,o,s){return void 0===i&&(i="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),k.conv1d(this,n,e,r,i,o,s)},t.prototype.conv2d=function(n,e,r,i,o,s){return void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),k.conv2d(this,n,e,r,i,o,s)},t.prototype.conv2dTranspose=function(n,e,r,i,o){return this.throwIfDisposed(),k.conv2dTranspose(this,n,e,r,i,o)},t.prototype.depthwiseConv2D=function(n,e,r,i,o,s){return void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),k.depthwiseConv2d(this,n,e,r,i,o,s)},t.prototype.separableConv2d=function(n,e,r,i,o,s){return void 0===o&&(o=[1,1]),void 0===s&&(s="NHWC"),this.throwIfDisposed(),k.separableConv2d(this,n,e,r,i,o,s)},t.prototype.avgPool=function(n,e,r,i){return this.throwIfDisposed(),k.avgPool(this,n,e,r,i)},t.prototype.maxPool=function(n,e,r,i){return this.throwIfDisposed(),k.maxPool(this,n,e,r,i)},t.prototype.localResponseNormalization=function(n,e,r,i){return void 0===n&&(n=5),void 0===e&&(e=1),void 0===r&&(r=1),void 0===i&&(i=.5),k.localResponseNormalization(this,n,e,r,i)},t.prototype.pool=function(n,e,r,i,o){return this.throwIfDisposed(),k.pool(this,n,e,r,i,o)},t.prototype.variable=function(n,e,r){return void 0===n&&(n=!0),this.throwIfDisposed(),pi().makeVariable(this,n,e,r)},t.prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),k.unsortedSegmentSum(this,n,e)},t.prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),k.batchToSpaceND(this,n,e)},t.prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),k.spaceToBatchND(this,n,e)},t.prototype.topk=function(n,e){return void 0===n&&(n=1),void 0===e&&(e=!0),this.throwIfDisposed(),k.topk(this,n,e)},t.prototype.stridedSlice=function(n,e,r,i,o,s,a,u){return void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===u&&(u=0),this.throwIfDisposed(),k.stridedSlice(this,n,e,r,i,o,s,a,u)},t.prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),k.depthToSpace(this,n,e)},t.prototype.fft=function(){return this.throwIfDisposed(),k.spectral.fft(this)},t.prototype.ifft=function(){return this.throwIfDisposed(),k.spectral.ifft(this)},t.prototype.rfft=function(){return this.throwIfDisposed(),k.spectral.rfft(this)},t.prototype.irfft=function(){return this.throwIfDisposed(),k.spectral.irfft(this)},t}();Object.defineProperty(lt,Symbol.hasInstance,{value:function(t){return!!t&&null!=t.dataId&&null!=t.shape&&null!=t.dtype}});var $2,Ey,Dy,Iy,Sy,t,eu=function(t){function n(e,r,i,o){var s=t.call(this,e.shape,e.dtype,e.dataId,o)||this;return s.trainable=r,s.name=i,s}return Hr(n,t),n.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!Ut(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");pi().disposeTensor(this),this.dataId=e.dataId,pi().incRef(this,null)},n.prototype.dispose=function(){pi().disposeVariable(this),this.isDisposedInternal=!0},n}(lt);Object.defineProperty(eu,Symbol.hasInstance,{value:function(t){return t instanceof lt&&null!=t.assign&&t.assign instanceof Function}}),(t=$2||($2={})).R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6",function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(Ey||(Ey={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(Dy||(Dy={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(Iy||(Iy={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(Sy||(Sy={}));var C8={float32:Iy,int32:Ey,bool:Dy,complex64:Sy};function tn(t,n){if("string"===t||"string"===n){if("string"===t&&"string"===n)return"string";throw new Error("Can not upcast "+t+" with "+n)}return C8[t][n]}function Ty(t){return tn(t,"int32")}function xt(t,n){if(t.dtype===n.dtype)return[t,n];var e=tn(t.dtype,n.dtype);return[t.cast(e),n.cast(e)]}function q2(t,n){E(t.dtype===n.dtype,function(){return"The dtypes of the first("+t.dtype+") and second("+n.dtype+") input must match"})}function My(t){var n=[];return function e(r,i,o){if(null!=r){if(r instanceof lt)return void i.push(r);if(s=r,Array.isArray(s)||"object"==typeof s){var s,a=r;for(var u in a){var c=a[u];o.has(c)||(o.add(c),e(c,i,o))}}}}(t,n,new Set),n}Object.freeze({makeTypesMatch:xt,assertTypesMatch:q2,isTensorInList:function(t,n){return n.some(function(e){return e.id===t.id})},getTensorsInContainer:My});var Ay,K2=function(){function t(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.dispose=function(){for(var n in this.registeredVariables)this.registeredVariables[n].dispose()},t}(),x8=function(){function t(n){this.ENV=n,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new K2}return t.prototype.ready=function(){return ie(this,void 0,void 0,function(){var n,e,r;return oe(this,function(i){switch(i.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];n=this.getSortedBackends(),e=0,i.label=1;case 1:return e<n.length?[4,this.initializeBackend(r=n[e]).success]:[3,5];case 2:return i.sent()?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(t.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var n=this.initializeBackendsAndReturnBest(),e=n.name;if(n.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),t.prototype.backendNames=function(){return Object.keys(this.registryFactory)},t.prototype.findBackend=function(n){return n in this.registry||n in this.registryFactory&&!this.initializeBackend(n).asyncInit?this.registry[n]:null},t.prototype.findBackendFactory=function(n){return n in this.registryFactory?this.registryFactory[n].factory:null},t.prototype.registerBackend=function(n,e,r){return void 0===r&&(r=1),n in this.registryFactory?(console.warn(n+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[n]={factory:e,priority:r},!0)},t.prototype.setBackend=function(n){return ie(this,void 0,void 0,function(){var e,r,i;return oe(this,function(o){switch(o.label){case 0:if(null==this.registryFactory[n])throw new Error("Backend name '"+n+"' not found in registry");return this.backendName=n,null!=this.registry[n]?[3,4]:(this.backendInstance=null,e=this.initializeBackend(n),r=e.success,e.asyncInit?[4,r]:[3,2]);case 1:return i=o.sent(),[3,3];case 2:i=r,o.label=3;case 3:if(!i)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[n],this.setupRegisteredKernels(),this.profiler=new b8(this.backendInstance),[2,!0]}})})},t.prototype.setupRegisteredKernels=function(){var n=this;M2(this.backendName).forEach(function(e){null!=e.setupFunc&&e.setupFunc(n.backendInstance)})},t.prototype.disposeRegisteredKernels=function(n){var e=this;M2(n).forEach(function(r){null!=r.disposeFunc&&r.disposeFunc(e.registry[n])})},t.prototype.initializeBackend=function(n){var e=this,r=this.registryFactory[n];if(null==r)throw new Error("Cannot initialize backend "+n+", no registration found.");try{var i=r.factory();if(Promise.resolve(i)===i){var o=++this.pendingBackendInitId,s=i.then(function(a){return!(o<e.pendingBackendInitId||(e.registry[n]=a,e.pendingBackendInit=null,0))}).catch(function(a){return!(o<e.pendingBackendInitId||(e.pendingBackendInit=null,console.warn("Initialization of backend "+n+" failed"),console.warn(a.stack||a.message),1))});return this.pendingBackendInit=s,{success:s,asyncInit:!0}}return this.registry[n]=i,{success:!0,asyncInit:!1}}catch(a){return console.warn("Initialization of backend "+n+" failed"),console.warn(a.stack||a.message),{success:!1,asyncInit:!1}}},t.prototype.removeBackend=function(n){if(!(n in this.registryFactory))throw new Error(n+" backend not found in registry");this.backendName===n&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,n in this.registry&&(this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n]),delete this.registryFactory[n],this.backendName===n&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},t.prototype.getSortedBackends=function(){var n=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(e,r){return n.registryFactory[r].priority-n.registryFactory[e].priority})},t.prototype.initializeBackendsAndReturnBest=function(){for(var n=this.getSortedBackends(),e=0;e<n.length;e++){var r=n[e],i=this.initializeBackend(r),s=i.asyncInit;if(s||i.success)return{name:r,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")},t.prototype.moveData=function(n,e){var r=this.state.tensorInfo.get(e),i=r.backend,o=this.readSync(e);i.disposeData(e),r.backend=n,n.move(e,o,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},t.prototype.tidy=function(n,e){var r,i=this,o=null;if(null==e){if("function"!=typeof n)throw new Error("Please provide a function to tidy()");e=n}else{if("string"!=typeof n&&!(n instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=n}return this.scopedRun(function(){return i.startScope(o)},function(){return i.endScope(r)},function(){return(r=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},t.prototype.scopedRun=function(n,e,r){n();try{var i=r();return e(),i}catch(o){throw e(),o}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.clone=function(n){var e=this.makeTensorFromDataId(n.dataId,n.shape,n.dtype);return this.addTapeNode(this.state.activeScope.name,{x:n},[e],function(i){return{x:function(){return i.toFloat()}}},[]),e},t.prototype.runKernel=function(n,e,r,i,o){return this.runKernelFunc(null,e,null,n,r,i,o)},t.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},t.prototype.checkKernelForMemLeak=function(n,e,r){var i=this.backend.numDataIds(),o=0;r.forEach(function(u){o+="complex64"===u.dtype?3:1});var a=i-e-o-this.state.numDataMovesStack[this.state.numDataMovesStack.length-1];if(a>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+a+" data ids) after running '"+n+"'")},t.prototype.runKernelFunc=function(n,e,r,i,o,s,a){var u,c=this;void 0===s&&(s=[]),void 0===a&&(a=[]);var l=[],d=this.isTapeOn();null==i&&(i=null!=this.state.activeScope?this.state.activeScope.name:"");var f,h=function(y){d&&(l=y.map(function(w){return c.keep(c.clone(w))}))},p=this.state.numBytes,g=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,v=T2(i,this.backendName);return f=null!=v?function(){var y=c.backend.numDataIds();m=v.kernelFunc({inputs:e,attrs:o,backend:c.backend});var w=Array.isArray(m)?m:[m];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(i,y,w);var b=w.map(function(C){return c.makeTensorFromDataId(C.dataId,C.shape,C.dtype)}),_=b.filter(function(C,T){return a[T]});return h((s||[]).slice().concat(_)),b}:function(){var y=c.backend.numDataIds();m=c.tidy(function(){return n(c.backend,h)});var w=Array.isArray(m)?m:[m];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(i,y,w),w},this.scopedRun(function(){return c.state.kernelDepth++},function(){return c.state.kernelDepth--},function(){u=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(i,e,function(){return f()}):f()}),d&&this.addTapeNode(i,e,u,r,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:i,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-g,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map(function(y){return e[y].shape}),outputShapes:u.map(function(y){return y.shape})}),Array.isArray(m)?u:u[0]},t.prototype.makeTensor=function(n,e,r,i){if(null==n)throw new Error("Values passed to engine.makeTensor() are null");i=i||this.backend;var o=n;"string"===(r=r||"float32")&&Po(n[0])&&(o=n.map(function(l){return H2(l)}));var s=i.write(o,e,r),a=new lt(e,r,s,this.nextTensorId());if(this.incRef(a,i),"string"===r){var u=this.state.tensorInfo.get(s),c=B2(o);this.state.numBytes+=c-u.bytes,u.bytes=c}return a},t.prototype.makeTensorFromDataId=function(n,e,r,i){var o=new lt(e,r=r||"float32",n,this.nextTensorId());return this.incRef(o,i),o},t.prototype.makeVariable=function(n,e,r,i){void 0===e&&(e=!0),r=r||this.nextVariableId().toString(),null!=i&&i!==n.dtype&&(n=n.asType(i));var o=new eu(n,e,r,this.nextTensorId());if(null!=this.state.registeredVariables[o.name])throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},t.prototype.incRef=function(n,e){var r=this.state.tensorInfo.has(n.dataId)?this.state.tensorInfo.get(n.dataId).refCount:0;if(this.state.numTensors++,"string"===n.dtype&&this.state.numStringTensors++,0===r){this.state.numDataBuffers++;var i=0;"complex64"!==n.dtype&&"string"!==n.dtype&&(i=n.size*vy(n.dtype)),this.state.tensorInfo.set(n.dataId,{backend:e||this.backend,dtype:n.dtype,shape:n.shape,bytes:i,refCount:0}),this.state.numBytes+=i}this.state.tensorInfo.get(n.dataId).refCount++,n instanceof eu||this.track(n)},t.prototype.disposeTensor=function(n){if(this.state.tensorInfo.has(n.dataId)){this.state.numTensors--,"string"===n.dtype&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(n.dataId);e.refCount<=1?("complex64"!==n.dtype&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(n.dataId),this.state.tensorInfo.delete(n.dataId)):this.state.tensorInfo.get(n.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var n in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[n])},t.prototype.disposeVariable=function(n){this.disposeTensor(n),null!=this.state.registeredVariables[n.name]&&delete this.state.registeredVariables[n.name]},t.prototype.memory=function(){var n=this.backend.memory();return n.numTensors=this.state.numTensors,n.numDataBuffers=this.state.numDataBuffers,n.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(n.unreliable=!0,null==n.reasons&&(n.reasons=[]),n.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),n},t.prototype.profile=function(n){return ie(this,void 0,void 0,function(){var e,r;return oe(this,function(i){return this.state.profiling=!0,e=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=n(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(o){return o.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},t.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},t.prototype.addTapeNode=function(n,e,r,i,o){var s=this,a={id:this.state.nextTapeNodeId++,kernelName:n,inputs:e,outputs:r,saved:o},u=function v8(t){return Xc.get(t)}(n);null!=u&&(i=u.gradFunc),null!=i&&(a.gradient=function(c){return c=c.map(function(l,d){if(null==l){var f=r[d],h=Ja(f.size,f.dtype);return s.makeTensor(h,f.shape,f.dtype)}return l}),i(c.length>1?c:c[0],o)}),this.state.activeTape.push(a)},t.prototype.keep=function(n){return n.kept=!0,n},t.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},t.prototype.endTape=function(){this.state.gradientDepth--},t.prototype.startScope=function(n){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};n&&(e.name=n),this.state.scopeStack.push(e),this.state.activeScope=e},t.prototype.endScope=function(n){for(var e=this,r=My(n),i=new Set(r.map(function(u){return u.id})),o=0;o<this.state.activeScope.track.length;o++){var s=this.state.activeScope.track[o];s.kept||i.has(s.id)||s.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==a.id||e.track(u)})},t.prototype.gradients=function(n,e,r,i){var o=this;if(void 0===i&&(i=!1),E(e.length>0,function(){return"gradients() received an empty list of xs."}),null!=r&&"float32"!==r.dtype)throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var s=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",n)});E(s instanceof lt,function(){return"The result y returned by f() must be a tensor."});var a=function(u,c,l){for(var d={},f={},h=0;h<c.length;h++)d[c[h].id]=!0;for(h=0;h<u.length;h++){var p=(C=u[h]).inputs;for(var g in p){for(var m=p[g],v=!1,y=0;y<c.length;y++)if(d[m.id]){C.outputs.forEach(function(I){return d[I.id]=!0}),v=!0,f[C.id]=!0;break}if(v)break}}var w={};w[l.id]=!0;var b={};for(h=u.length-1;h>=0;h--)for(p=(C=u[h]).inputs,y=0;y<C.outputs.length;y++)if(w[C.outputs[y].id]){for(var g in p)w[p[g].id]=!0,b[C.id]=!0;break}var _=[];for(h=0;h<u.length;h++){var C;if(f[(C=u[h]).id]&&b[C.id]){var T={};for(var g in C.inputs){var S=C.inputs[g];d[S.id]&&(T[g]=S)}var D=Object.assign({},C);D.inputs=T,D.outputs=C.outputs,_.push(D)}}return _}(this.state.activeTape,e,s);if(!i&&0===a.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,c,l={};l[s.id]=r??(c=wy(ae(u=s.shape),"float32"),M.makeTensor(c,u,"float32")),function(f,h,p){for(var g=function(v){var y=h[v],w=[];if(y.outputs.forEach(function(T){var S=f[T.id];w.push(null!=S?S:null)}),null==y.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+y.kernelName+".");var b=y.gradient(w),_=function(T){if(!(T in b))throw new Error("Cannot backprop through input "+T+". Available gradients found: "+Object.keys(b)+".");var S=o.tidy(function(){return b[T]()});if("float32"!==S.dtype)throw new Error("Error in gradient for op "+y.kernelName+". The gradient of input "+T+" must have 'float32' dtype, but has '"+S.dtype+"'");var D=y.inputs[T];if(!Ut(S.shape,D.shape))throw new Error("Error in gradient for op "+y.kernelName+". The gradient of input '"+T+"' has shape '"+S.shape+"', which does not match the shape of the input '"+D.shape+"'");if(null==f[D.id])f[D.id]=S;else{var I=f[D.id];f[D.id]=I.add(S),I.dispose()}};for(var C in y.inputs)_(C)},m=h.length-1;m>=0;m--)g(m)}(l,a);var d=e.map(function(f){return l[f.id]});return 0===o.state.gradientDepth&&(o.state.activeTape.forEach(function(f){for(var h=0,p=f.saved;h<p.length;h++)p[h].dispose()}),o.state.activeTape=null),{value:s,grads:d}})},t.prototype.customGrad=function(n){var e=this;return E(Fo(n),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];E(i.every(function(a){return a instanceof lt}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var s={};return i.forEach(function(a,u){s[u]=a}),e.runKernelFunc(function(a,u){return E((r=n.apply(void 0,i.concat([u]))).value instanceof lt,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),E(Fo(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},s,function(a,u){var c=r.gradFunc(a,u),l=Array.isArray(c)?c:[c];E(l.length===i.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),E(l.every(function(f){return f instanceof lt}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return l.forEach(function(f,h){d[h]=function(){return f}}),d})}},t.prototype.readSync=function(n){return this.state.tensorInfo.get(n).backend.readSync(n)},t.prototype.read=function(n){return this.state.tensorInfo.get(n).backend.read(n)},t.prototype.time=function(n){return ie(this,void 0,void 0,function(){var e,r;return oe(this,function(i){switch(i.label){case 0:return e=Wr(),[4,this.backend.time(n)];case 1:return(r=i.sent()).wallMs=Wr()-e,[2,r]}})})},t.prototype.track=function(n){return null!=this.state.activeScope&&(n.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(n)),n},Object.defineProperty(t.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),t.prototype.reset=function(){for(var n in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new K2,this.registry)this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},t.nextTensorId=0,t.nextVariableId=0,t}(),M=function(){var t=function(){if(null==Ay){var e=void 0;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else{if(typeof self>"u")throw new Error("Could not find a global object");e=self}Ay=e}return Ay}();if(null==t._tfengine){var n=new g8(t);t._tfengine=new x8(n)}return S2=t._tfengine.ENV,pi=function(){return t._tfengine},t._tfengine}();function Y2(){return typeof window<"u"&&null!=window.document||typeof WorkerGlobalScope<"u"}var qi=P();qi.registerFlag("DEBUG",function(){return!1},function(t){t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),qi.registerFlag("IS_BROWSER",function(){return Y2()}),qi.registerFlag("IS_NODE",function(){return typeof process<"u"&&void 0!==process.versions&&void 0!==process.versions.node}),qi.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),qi.registerFlag("PROD",function(){return!1}),qi.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return qi.getBool("DEBUG")}),qi.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),qi.registerFlag("IS_TEST",function(){return!1});var rl,cr,lr,_s={},Ry={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function X2(t,n){_s[t]=n}function gi(t){t in _s||(_s[t]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(i){if(typeof OffscreenCanvas<"u"&&2===i)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return r.addEventListener("webglcontextlost",function(i){i.preventDefault(),delete _s[e]},!1),1===e?r.getContext("webgl",Ry)||r.getContext("experimental-webgl",Ry):r.getContext("webgl2",Ry)}(t));var n=_s[t];return n.isContextLost()?(delete _s[t],gi(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),_s[t])}function Qf(t,n){return[n,t]}function il(t){var n=ae(t);return Xf(Math.ceil(n/4))}function ol(t,n){return[Math.max(1,Math.ceil(n/2)),Math.max(1,Math.ceil(t/2))]}function Oy(t,n){var e,r,i,o,s,a,u,c,l,d=t;return 2===P().getNumber("WEBGL_VERSION")?(e=d.R32F,r=d.R16F,i=d.RGBA16F,o=d.RGBA32F,s=d.RED,a=4,u=1,c=d.HALF_FLOAT,l=d.FLOAT):(e=t.RGBA,r=t.RGBA,i=t.RGBA,o=d.RGBA,s=t.RGBA,a=4,u=4,c=null!=n?n.HALF_FLOAT_OES:null,l=t.FLOAT),{internalFormatFloat:e,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:t.RGBA,downloadUnpackNumChannels:a,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function ne(t,n,e){var r=e();return n&&function(i){var o=i.getError();if(o!==i.NO_ERROR)throw new Error("WebGL Error: "+Q2(i,o))}(t),r}function Z2(t){return!!(P().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||5.96e-8<Math.abs(t)&&Math.abs(t)<65504)}function Q2(t,n){switch(n){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+n}}function sl(t,n,e){return Ki(t,n,function(){return t.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function J2(t,n,e){var r=Ki(t,n,function(){return t.createShader(t.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(ne(t,n,function(){return t.shaderSource(r,e)}),ne(t,n,function(){return t.compileShader(r)}),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function eT(t,n,e){var r=Ki(t,n,function(){return t.createShader(t.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(ne(t,n,function(){return t.shaderSource(r,e)}),ne(t,n,function(){return t.compileShader(r)}),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw function(i,o){var s=I8.exec(o);if(null==s)return console.log("Couldn't parse line number in error: "+o),void console.log(i);for(var a=+s[1],u=i.split("\n"),c=u.length.toString().length+2,l=u.map(function(m,v){return ws((v+1).toString(),c)+m}),d=0,f=0;f<l.length;f++)d=Math.max(l[f].length,d);var h=l.slice(0,a-1),p=l.slice(a-1,a),g=l.slice(a);console.log(h.join("\n")),console.log(o.split("\n")[0]),console.log("%c "+ws(p[0],d),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(g.join("\n"))}(e,t.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(rl||(rl={})),function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(cr||(cr={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(lr||(lr={}));var Jf,eh,I8=/ERROR: [0-9]+:([0-9]+):/g;function tT(t,n){return Ki(t,n,function(){return t.createProgram()},"Unable to create WebGLProgram.")}function nT(t,n,e){if(ne(t,n,function(){return t.linkProgram(e)}),!1===t.getProgramParameter(e,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function th(t,n,e){if(ne(t,n,function(){return t.validateProgram(e)}),!1===t.getProgramParameter(e,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function rT(t,n,e){var r=Ki(t,n,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return ne(t,n,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),ne(t,n,function(){return t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)}),r}function iT(t,n,e){var r=Ki(t,n,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return ne(t,n,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r)}),ne(t,n,function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)}),r}function oT(t,n){return Ki(t,n,function(){return t.createTexture()},"Unable to create WebGLTexture.")}function sT(t,n){var e=P().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||n<=0){var r="["+t+"x"+n+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(t>e||n>e)throw r="["+t+"x"+n+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+e+"x"+e+"].")}function aT(t,n){return Ki(t,n,function(){return t.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Ny(t,n,e,r,i,o,s,a){var u=t.getAttribLocation(e,r);return-1!==u&&(ne(t,n,function(){return t.bindBuffer(t.ARRAY_BUFFER,i)}),ne(t,n,function(){return t.vertexAttribPointer(u,o,t.FLOAT,!1,s,a)}),ne(t,n,function(){return t.enableVertexAttribArray(u)}),!0)}function uT(t,n,e,r){hT(t,r),ne(t,n,function(){return t.activeTexture(t.TEXTURE0+r)}),ne(t,n,function(){return t.bindTexture(t.TEXTURE_2D,e)})}function cT(t,n,e,r){return Ki(t,n,function(){return t.getUniformLocation(e,r)},'uniform "'+r+'" not present in program.')}function lT(t,n,e){return t.getUniformLocation(n,e)}function dT(t,n,e,r,i,o){ne(t,n,function(){return uT(t,n,r,o)}),ne(t,n,function(){return t.uniform1i(i,o)})}function nh(t,n,e,r){ne(t,n,function(){return t.bindFramebuffer(t.FRAMEBUFFER,r)}),ne(t,n,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)})}function ky(t,n,e){ne(t,n,function(){return t.bindFramebuffer(t.FRAMEBUFFER,e)}),ne(t,n,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)})}function al(t){var n=t.checkFramebufferStatus(t.FRAMEBUFFER);if(n!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+fT(t,n))}function fT(t,n){switch(n){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+n}}function Ki(t,n,e,r){var i=ne(t,n,function(){return e()});if(null==i)throw new Error(r);return i}function hT(t,n){var e=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=n+t.TEXTURE0;if(r<t.TEXTURE0||r>e)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+e+"].")}function ul(t,n){return void 0===n&&(n=2),ae(t.slice(0,t.length-n))}function cl(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function rh(t){var n=[1,1,1];return 0===t.length||1===t.length&&1===t[0]||(n=[ul(t)].concat(cl(t))),n}function pT(t,n){var e;void 0===n&&(n=!1);var r=P().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n&&(r*=2,1===(t=t.map(function(c,l){return l>=t.length-2?gy(t[l]):t[l]})).length&&(t=[2,t[0]])),2!==t.length){var i=ko(t);t=i.newShape}var o=ae(t);if(t.length<=1&&o<=r)return[1,o];if(2===t.length&&t[0]<=r&&t[1]<=r)return t;if(3===t.length&&t[0]*t[1]<=r&&t[2]<=r)return[t[0]*t[1],t[2]];if(3===t.length&&t[0]<=r&&t[1]*t[2]<=r)return[t[0],t[1]*t[2]];if(4===t.length&&t[0]*t[1]*t[2]<=r&&t[3]<=r)return[t[0]*t[1]*t[2],t[3]];if(4===t.length&&t[0]<=r&&t[1]*t[2]*t[3]<=r)return[t[0],t[1]*t[2]*t[3]];if(n){var s=ul(t),a=2,u=2;return t.length&&(a=(e=cl(t))[0],u=e[1]),Xf(o=s*(a/2)*(u/2)).map(function(c){return 2*c})}return Xf(o)}function ih(t){return t%2==0}function ll(t,n){if(Ut(t=t.slice(-2),n=n.slice(-2))||!t.length||!n.length||0===t[0]||0===t[1]||0===n[0]||0===n[1])return!0;if(t.length!==n.length){var e=t.slice(-1)[0],r=n.slice(-1)[0];if(e===r||ih(e)&&ih(r)&&(1===t[0]||1===n[0]))return!0}return t[1]===n[1]&&ih(t[0])&&ih(n[0])}function gT(t){if(null==Jf){var n=gi(t);Jf=n.getParameter(n.MAX_TEXTURE_SIZE)}return Jf}function mT(t){if(null==eh){var n=gi(t);eh=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,eh)}function vT(t){if(0===t)return 0;var n=gi(t);return dr(n,"EXT_disjoint_timer_query_webgl2")&&2===t?2:dr(n,"EXT_disjoint_timer_query")?1:0}function dr(t,n){return null!=t.getExtension(n)}function Py(t){try{if(null!=gi(t))return!0}catch{return!1}return!1}function yT(t){if(0===t)return!1;var n=gi(t);if(1===t){if(!dr(n,"OES_texture_float"))return!1}else if(!dr(n,"EXT_color_buffer_float"))return!1;return Fy(n)}function bT(t){if(0===t)return!1;var n=gi(t);if(1!==t){if(dr(n,"EXT_color_buffer_float"))return Fy(n);if(dr(n,"EXT_color_buffer_half_float")){var e=n.getExtension("EXT_color_buffer_half_float");return function(r,i){var o=Oy(r,i),s=r.createTexture();r.bindTexture(r.TEXTURE_2D,s),r.texImage2D(r.TEXTURE_2D,0,o.internalFormatHalfFloat,1,1,0,o.textureFormatFloat,o.textureTypeHalfFloat,null);var a=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,a),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(s),r.deleteFramebuffer(a),u}(n,e)}return!1}return!!dr(n,"OES_texture_float")&&!!dr(n,"WEBGL_color_buffer_float")&&Fy(n)}function Fy(t){var n=Oy(t),e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatFloat,1,1,0,n.textureFormatFloat,n.textureTypeFloat,null);var r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0);var i=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(e),t.deleteFramebuffer(r),i}function wT(t){return 2===t&&null!=gi(t).fenceSync}var S8=Object.freeze({callAndCheck:ne,canBeRepresented:Z2,getWebGLErrorMessage:Q2,getExtensionOrThrow:sl,createVertexShader:J2,createFragmentShader:eT,createProgram:tT,linkProgram:nT,validateProgram:th,createStaticVertexBuffer:rT,createStaticIndexBuffer:iT,getNumChannels:function(){return 2===P().getNumber("WEBGL_VERSION")?1:4},createTexture:oT,validateTextureSize:sT,createFramebuffer:aT,bindVertexBufferToProgramAttribute:Ny,bindTextureUnit:uT,unbindTextureUnit:function(t,n,e){hT(t,e),ne(t,n,function(){return t.activeTexture(t.TEXTURE0+e)}),ne(t,n,function(){return t.bindTexture(t.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:cT,getProgramUniformLocation:lT,bindTextureToProgramUniformSampler:dT,bindCanvasToFramebuffer:function(t,n){ne(t,n,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),ne(t,n,function(){return t.viewport(0,0,t.canvas.width,t.canvas.height)}),ne(t,n,function(){return t.scissor(0,0,t.canvas.width,t.canvas.height)})},bindColorTextureToFramebuffer:nh,unbindColorTextureFromFramebuffer:ky,validateFramebuffer:al,getFramebufferErrorMessage:fT,getBatchDim:ul,getRowsCols:cl,getShapeAs3D:rh,getTextureShapeFromLogicalShape:pT,isReshapeFree:ll,getWebGLMaxTextureSize:gT,resetMaxTextureSize:function(){Jf=null},resetMaxTexturesInShader:function(){eh=null},getMaxTexturesInShader:mT,getWebGLDisjointQueryTimerVersion:vT,hasExtension:dr,isWebGLVersionEnabled:Py,isCapableOfRenderingToFloatTexture:yT,isDownloadFloatTextureEnabled:bT,isWebGLFenceEnabled:wT}),be=P();function _T(t){P().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function te(t,n){return M.tidy(t,n)}function Yn(t){My(t).forEach(function(n){return n.dispose()})}function oh(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];P().getBool("IS_TEST")||console.warn.apply(console,t)}function mi(t,n){var e=t;if(fn(t))return"string"===n?[]:[t.length];if(!Array.isArray(t))return[];for(var r=[];Array.isArray(e)||fn(e)&&"string"!==n;)r.push(e.length),e=e[0];return Array.isArray(t)&&P().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function i(o,s,a){if(a=a||[],Array.isArray(o)||fn(o)){E(s.length>0,function(){return"Element arr["+a.join("][")+"] should be a primitive, but is an array of "+o.length+" elements"}),E(o.length===s[0],function(){return"Element arr["+a.join("][")+"] should have "+s[0]+" elements, but has "+o.length+" elements"});for(var u=s.slice(1),c=0;c<o.length;++c)i(o[c],u,a.concat(c))}else E(0===s.length,function(){return"Element arr["+a.join("][")+"] is a primitive, but should be an array/TypedArray of "+s[0]+" elements"})}(t,r,[]),r}function CT(t,n,e,r){if(null!=t&&("numeric"!==t&&t!==n||"numeric"===t&&"string"===n))throw new Error("Argument '"+e+"' passed to '"+r+"' must be "+t+" tensor, but got "+n+" tensor")}function x(t,n,e,r){if(void 0===r&&(r="numeric"),t instanceof lt)return CT(r,t.dtype,n,e),t;var i=Qa(t);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),CT(r,i,n,e),null==t||!fn(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("Argument '"+n+"' passed to '"+e+"' must be a Tensor or TensorLike, but got '"+(null==t?"null":t.constructor.name)+"'");var s=mi(t,i);fn(t)||Array.isArray(t)||(t=[t]);var a="string"!==i?yy(t,i,P().getBool("DEBUG")):$i(t,[],!0);return M.makeTensor(a,s,i)}function dl(t,n,e,r){if(void 0===r&&(r="numeric"),!Array.isArray(t))throw new Error("Argument "+n+" passed to "+e+" must be a `Tensor[]` or `TensorLike[]`");return t.map(function(i,o){return x(i,n+"["+o+"]",e)},r)}function Ly(t,n){for(var e=0;e<t.length;++e)if(t[t.length-e-1]!==n-1-e)return!1;return!0}function xT(t,n,e){for(var r=t.length+n.length,i=[],o=0,s=0,a=0;a<r;a++)-1===e.indexOf(a)?i.push(t[o++]):i.push(n[s++]);return i}function hn(t,n){for(var e=[],r=t.length,i=0;i<r;i++)-1===n.indexOf(i)&&e.push(t[i]);return[e,n.map(function(o){return t[o]})]}function Vn(t,n){return xT(t,n.map(function(e){return 1}),n)}function Xn(t,n,e){E(Ly(n,e),function(){return t+" supports only inner-most axes for now. Got axes "+n+" and rank-"+e+" input."})}function zr(t,n){if(Ly(t,n))return null;for(var e=[],r=0;r<n;++r)-1===t.indexOf(r)&&e.push(r);return t.forEach(function(i){return e.push(i)}),e}function sh(t){return t.map(function(n,e){return[e,n]}).sort(function(n,e){return n[1]-e[1]}).map(function(n){return n[0]})}function Gr(t,n){for(var e=[],r=n-t;r<n;++r)e.push(r);return e}function ET(t,n){var e=t[0].length;t.forEach(function(i,o){E(i.length===e,function(){return"Error in concat"+e+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+e+")"})}),E(n>=0&&n<e,function(){return"Error in concat"+e+"D: axis must be between 0 and "+(e-1)+"."});var r=t[0];t.forEach(function(i,o){for(var s=0;s<e;s++)E(s===n||i[s]===r[s],function(){return"Error in concat"+e+"D: Shape of tensors["+o+"] ("+i+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function Cs(t,n){for(var e=t[0].slice(),r=1;r<t.length;r++)e[n]+=t[r][n];return e}function A(t){var n=Object.keys(t);if(1!==n.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+n.length+" keys.");var e=n[0],r=t[e];e.endsWith("_")&&(e=e.substring(0,e.length-1));var i=function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];M.startScope(e);try{var a=r.apply(void 0,o);return a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),M.endScope(a),a}catch(u){throw M.endScope(null),u}};return Object.defineProperty(i,"name",{value:e,configurable:!0}),i}be.registerFlag("HAS_WEBGL",function(){return be.getNumber("WEBGL_VERSION")>0}),be.registerFlag("WEBGL_VERSION",function(){return Py(2)?2:Py(1)?1:0}),be.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===be.get("WEBGL_VERSION")}),be.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),be.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),be.registerFlag("WEBGL_PACK",function(){return be.getBool("HAS_WEBGL")}),be.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_CLIP",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),be.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_REDUCE",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_LAZILY_UNPACK",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_CONV_IM2COL",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return gT(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return mT(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var t=be.getNumber("WEBGL_VERSION");return 0===t?0:vT(t)}),be.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(t=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))));var t}),be.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return yT(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!be.getBool("WEBGL_FORCE_F16_TEXTURES")&&be.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),be.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return bT(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return wT(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return be.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),G2=_T;var pn=A({complex_:function(t,n){var e=x(t,"real","complex"),r=x(n,"imag","complex");return je(e.shape,r.shape,"real and imag shapes, "+e.shape+" and "+r.shape+", must match in call to tf.complex()."),M.runKernelFunc(function(i){return i.complex(e,r)},{$real:e,$imag:r})}}),Sr=A({real_:function(t){var n=x(t,"input","real");return M.runKernelFunc(function(e){return e.real(n)},{$input:n})}}),vi=A({imag_:function(t){var n=x(t,"input","imag");return M.runKernelFunc(function(e){return e.imag(n)},{$input:n})}});function gn(t,n,e){return Lo(t,n,mi(t,e),e)}function Lo(t,n,e,r){if(null==r&&(r=Qa(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!fn(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=n){_y(n);var i=ae(n),o=ae(e);E(i===o,function(){return"Based on the provided shape, ["+n+"], the tensor should have "+i+" values but has "+o});for(var s=0;s<e.length;++s){var u=s!==e.length-1||e[s]!==ae(n.slice(s));E(e[s]===n[s]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+e+") does not match the provided shape ("+n+"). "})}}return fn(t)||Array.isArray(t)||(t=[t]),n=n||e,t="string"!==r?yy(t,r,P().getBool("DEBUG")):$i(t,[],!0),M.makeTensor(t,n,r)}function X(t,n){if((fn(t)&&"string"!==n||Array.isArray(t))&&"complex64"!==n)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===n&&fn(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Lo(t,[],[],n)}function jt(t,n){bs(t);var e=mi(t,n);if(1!==e.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Lo(t,null,e,n)}function Bo(t,n,e){if(bs(t),null!=n&&2!==n.length)throw new Error("tensor2d() requires shape to have two numbers");var r=mi(t,e);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==n)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Lo(t,n,r,e)}function By(t,n,e){if(bs(t),null!=n&&3!==n.length)throw new Error("tensor3d() requires shape to have three numbers");var r=mi(t,e);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==n)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Lo(t,n,r,e)}function Zn(t,n,e){if(bs(t),null!=n&&4!==n.length)throw new Error("tensor4d() requires shape to have four numbers");var r=mi(t,e);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==n)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Lo(t,n,r,e)}function tu(t,n){if(void 0===n&&(n="float32"),"complex64"===n){var e=tu(t,"float32"),r=wt(t,"float32");return pn(e,r)}var i=wy(ae(t),n);return M.makeTensor(i,t,n)}function wt(t,n){if(void 0===n&&(n="float32"),"complex64"===n){var e=wt(t,"float32"),r=wt(t,"float32");return pn(e,r)}var i=Ja(ae(t),n);return M.makeTensor(i,t,n)}function yi(t,n,e){return M.runKernelFunc(function(r){return r.fill(t,n,e)},{})}function ah(t,n,e,r){if(void 0===e&&(e=1),void 0===r&&(r="float32"),0===e)throw new Error("Cannot have a step of zero");if(t===n||t<n&&e<0||n<t&&e>1)return wt([0],r);var i=Ja(Math.abs(Math.ceil((n-t)/e)),r);n<t&&1===e&&(e=-1),i[0]=t;for(var o=1;o<i.length;o++)i[o]=i[o-1]+e;return jt(i,r)}var DT=A({onesLike_:function(t){var n=x(t,"x","onesLike");if("complex64"===n.dtype){var e=DT(Sr(n)),r=We(vi(n));return pn(e,r)}return M.runKernelFunc(function(i){return i.onesLike(n)},{$x:n},function(i,o){return{$x:function(){return We(i)}}})}}),We=A({zerosLike_:function(t){var n=x(t,"x","zerosLike");return M.runKernelFunc(function(e){return e.zerosLike(n)},{$x:n},function(e,r){return{$x:function(){return We(e)}}})}}),Yt=A({concat_:function(t,n){void 0===n&&(n=0),E(t.length>=1,function(){return"Pass at least one tensor to concat"});var e=dl(t,"tensors","concat");"complex64"===e[0].dtype&&e.forEach(function(a){if("complex64"!==a.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+a.dtype+". ")}),n=Ht(n,e[0].shape)[0];var r=Cs(e.map(function(a){return a.shape}),n);if(0===ae(r))return gn([],r);if(1===(e=e.filter(function(a){return a.size>0})).length)return e[0];var i=e.map(function(a){return a.shape});return ET(i,n),M.runKernelFunc(function(a){return a.concat(e,n)},e,function(a){var u=i.map(function(c){return c[n]});return Vy(a,u,n).map(function(c){return function(){return c}})},"Concat",{axis:n})}}),N8=A({concat1d_:function(t){return Yt(t,0)}}),k8=A({concat2d_:function(t,n){return Yt(t,n)}}),P8=A({concat3d_:function(t,n){return Yt(t,n)}}),F8=A({concat4d_:function(t,n){return Yt(t,n)}}),Vy=A({split_:function(t,n,e){void 0===e&&(e=0);var r,i=x(t,"x","split");return e=Ht(e,i.shape)[0],"number"==typeof n?(E(i.shape[e]%n==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(n).fill(i.shape[e]/n)):(E(i.shape[e]===n.reduce(function(o,s){return o+s}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=n),M.runKernelFunc(function(o){return o.split(i,r,e)},{$x:i},function(o){return{$x:function(){return Yt(o,e)}}})}});function xs(t,n){return t(n={exports:{}},n.exports),n.exports}typeof globalThis<"u"||typeof window<"u"||typeof global<"u"&&global;var L8=xs(function(t){!function(n,e,r){function i(a){var u,c=this,l=(u=4022871197,function(d){d=d.toString();for(var f=0;f<d.length;f++){var h=.02519603282416938*(u+=d.charCodeAt(f));h-=u=h>>>0,u=(h*=u)>>>0,u+=4294967296*(h-=u)}return 2.3283064365386963e-10*(u>>>0)});c.next=function(){var d=2091639*c.s0+2.3283064365386963e-10*c.c;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=0|d)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(a),c.s0<0&&(c.s0+=1),c.s1-=l(a),c.s1<0&&(c.s1+=1),c.s2-=l(a),c.s2<0&&(c.s2+=1),l=null}function o(a,u){return u.c=a.c,u.s0=a.s0,u.s1=a.s1,u.s2=a.s2,u}function s(a,u){var c=new i(a),l=u&&u.state,d=c.next;return d.int32=function(){return 4294967296*c.next()|0},d.double=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.quick=d,l&&("object"==typeof l&&o(l,c),d.state=function(){return o(c,{})}),d}e&&e.exports?e.exports=s:this.alea=s}(0,t)}),B8=xs(function(t){!function(n,e,r){function i(a){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var d=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^d^d>>>8},a===(0|a)?u.x=a:c+=a;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),u.next()}function o(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u}function s(a,u){var c=new i(a),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&("object"==typeof l&&o(l,c),d.state=function(){return o(c,{})}),d}e&&e.exports?e.exports=s:this.xor128=s}(0,t)}),V8=xs(function(t){!function(n,e,r){function i(a){var u=this,c="";u.next=function(){var d=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^d^d<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,a===(0|a)?u.x=a:c+=a;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function o(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u.v=a.v,u.d=a.d,u}function s(a,u){var c=new i(a),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&("object"==typeof l&&o(l,c),d.state=function(){return o(c,{})}),d}e&&e.exports?e.exports=s:this.xorwow=s}(0,t)}),U8=xs(function(t){!function(n,e,r){function i(a){var u=this;u.next=function(){var c,l,d=u.x,f=u.i;return c=d[f],l=(c^=c>>>7)^c<<24,l^=(c=d[f+1&7])^c>>>10,l^=(c=d[f+3&7])^c>>>3,l^=(c=d[f+4&7])^c<<7,c=d[f+7&7],l^=(c^=c<<13)^c<<9,d[f]=l,u.i=f+1&7,l},function(c,l){var d,f=[];if(l===(0|l))f[0]=l;else for(l=""+l,d=0;d<l.length;++d)f[7&d]=f[7&d]<<15^l.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&0===f[d];++d);for(8==d&&(f[7]=-1),c.x=f,c.i=0,d=256;d>0;--d)c.next()}(u,a)}function o(a,u){return u.x=a.x.slice(),u.i=a.i,u}function s(a,u){null==a&&(a=+new Date);var c=new i(a),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&(l.x&&o(l,c),d.state=function(){return o(c,{})}),d}e&&e.exports?e.exports=s:this.xorshift7=s}(0,t)}),H8=xs(function(t){!function(n,e,r){function i(a){var u=this;u.next=function(){var c,l,d=u.w,f=u.X,h=u.i;return u.w=d=d+1640531527|0,l=f[h+34&127],c=f[h=h+1&127],l^=l<<13,c^=c<<17,l=f[h]=(l^=l>>>15)^(c^=c>>>12),u.i=h,l+(d^d>>>16)|0},function(c,l){var d,f,h,p,g,m=[],v=128;for(l===(0|l)?(f=l,l=null):(l+="\0",f=0,v=Math.max(v,l.length)),h=0,p=-32;p<v;++p)l&&(f^=l.charCodeAt((p+32)%l.length)),0===p&&(g=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,p>=0&&(h=0==(d=m[127&p]^=f+(g=g+1640531527|0))?h+1:0);for(h>=128&&(m[127&(l&&l.length||0)]=-1),h=127,p=512;p>0;--p)f=m[h+34&127],d=m[h=h+1&127],f^=f<<13,d^=d<<17,m[h]=(f^=f>>>15)^(d^=d>>>12);c.w=g,c.X=m,c.i=h}(u,a)}function o(a,u){return u.i=a.i,u.w=a.w,u.X=a.X.slice(),u}function s(a,u){null==a&&(a=+new Date);var c=new i(a),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&(l.X&&o(l,c),d.state=function(){return o(c,{})}),d}e&&e.exports?e.exports=s:this.xor4096=s}(0,t)}),j8=xs(function(t){!function(n,e,r){function i(a){var u=this,c="";u.next=function(){var d=u.b,f=u.c,h=u.d,p=u.a;return d=d<<25^d>>>7^f,f=f-h|0,h=h<<24^h>>>8^p,p=p-d|0,u.b=d=d<<20^d>>>12^f,u.c=f=f-h|0,u.d=h<<16^f>>>16^p,u.a=p-d|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,a===Math.floor(a)?(u.a=a/4294967296|0,u.b=0|a):c+=a;for(var l=0;l<c.length+20;l++)u.b^=0|c.charCodeAt(l),u.next()}function o(a,u){return u.a=a.a,u.b=a.b,u.c=a.c,u.d=a.d,u}function s(a,u){var c=new i(a),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&("object"==typeof l&&o(l,c),d.state=function(){return o(c,{})}),d}e&&e.exports?e.exports=s:this.tychei=s}(0,t)}),Es=xs(function(t){!function(n,e){var r,i=this,o=256,a="random",u=e.pow(o,6),c=e.pow(2,52),l=2*c,d=o-1;function f(v,y,w){var b=[],_=g(function S(D,I){var O,R=[],V=typeof D;if(I&&"object"==V)for(O in D)try{R.push(S(D[O],I-1))}catch{}return R.length?R:"string"==V?D:D+"\0"}((y=1==y?{entropy:!0}:y||{}).entropy?[v,m(n)]:v??function(){try{var S;return r&&(S=r.randomBytes)?S=S(o):(S=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(S)),m(S)}catch{var D=i.navigator,I=D&&D.plugins;return[+new Date,i,I,i.screen,m(n)]}}(),3),b),C=new h(b),T=function(){for(var S=C.g(6),D=u,I=0;S<c;)S=(S+I)*o,D*=o,I=C.g(1);for(;S>=l;)S/=2,D/=2,I>>>=1;return(S+I)/D};return T.int32=function(){return 0|C.g(4)},T.quick=function(){return C.g(4)/4294967296},T.double=T,g(m(C.S),n),(y.pass||w||function(S,D,I,O){return O&&(O.S&&p(O,C),S.state=function(){return p(C,{})}),I?(e[a]=S,D):S})(T,_,"global"in y?y.global:this==e,y.state)}function h(v){var y,w=v.length,b=this,_=0,C=b.i=b.j=0,T=b.S=[];for(w||(v=[w++]);_<o;)T[_]=_++;for(_=0;_<o;_++)T[_]=T[C=d&C+v[_%w]+(y=T[_])],T[C]=y;(b.g=function(S){for(var D,I=0,O=b.i,R=b.j,V=b.S;S--;)D=V[O=d&O+1],I=I*o+V[d&(V[O]=V[R=d&R+D])+(V[R]=D)];return b.i=O,b.j=R,I})(o)}function p(v,y){return y.i=v.i,y.j=v.j,y.S=v.S.slice(),y}function g(v,y){for(var w,b=v+"",_=0;_<b.length;)y[d&_]=d&(w^=19*y[d&_])+b.charCodeAt(_++);return m(y)}function m(v){return String.fromCharCode.apply(0,v)}if(e["seed"+a]=f,g(e.random(),n),t.exports){t.exports=f;try{r=xu(369)}catch{}}}([],Math)});Es.alea=L8,Es.xor128=B8,Es.xorwow=V8,Es.xorshift7=U8,Es.xor4096=H8,Es.tychei=j8;var uh=Es.alea,Uy=function(){function t(n,e,r,i,o){this.mean=n,this.stdDev=e,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var s=o||Math.random();this.random=uh(s.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var n=this.nextVal;return this.nextVal=NaN,n}for(var e,r,i=!1;!i;){var o=void 0,s=void 0,a=void 0;do{a=(o=2*this.random()-1)*o+(s=2*this.random()-1)*s}while(a>=1||0===a);var u=Math.sqrt(-2*Math.log(a)/a);e=this.mean+this.stdDev*o*u,r=this.mean+this.stdDev*s*u,this.truncated&&!this.isValidTruncated(e)||(i=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(e)},t.prototype.convertValue=function(n){return null==this.dtype||"float32"===this.dtype?n:Math.round(n)},t.prototype.isValidTruncated=function(n){return n<=this.upper&&n>=this.lower},t}(),W8=function(){function t(n,e,r,i){this.alpha=n,this.beta=1/e,this.dtype=r;var o=i||Math.random();this.randu=uh(o.toString()),this.randn=new Uy(0,1,r,!1,this.randu()),this.d=n<1?n+2/3:n-1/3,this.c=1/Math.sqrt(9*this.d)}return t.prototype.nextValue=function(){for(var n,e,r,i,o,s;;){do{i=this.randn.nextValue(),s=1+this.c*i}while(s<=0);if(e=1-.331*(n=i*i)*n,r=.5*n+this.d*(1-(s*=s*s)+Math.log(s)),(o=this.randu())<e||Math.log(o)<r)break}return s*=1/this.beta*this.d,this.alpha<1&&(s*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(s)},t.prototype.convertValue=function(n){return"float32"===this.dtype?n:Math.round(n)},t}(),z8=function(){function t(n,e,r,i){var o=this;if(void 0===n&&(n=0),void 0===e&&(e=1),this.canReturnFloat=function(){return null==o.dtype||"float32"===o.dtype},this.min=n,this.range=e-n,this.dtype=r,null==i&&(i=Math.random()),"number"==typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+n+" - "+e+" <= 1 and dtype is not float");this.random=uh(i)}return t.prototype.convertValue=function(n){return this.canReturnFloat()?n:Math.round(n)},t.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},t}();function De(t,n,e){return void 0===n&&(n="float32"),n=n||"float32",_y(t),new nl(t,n,e)}var IT=A({batchToSpaceND_:function(t,n,e){var r=x(t,"x","batchToSpaceND"),i=n.reduce(function(o,s){return o*s});return E(r.rank>=1+n.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+n.length}),E(e.length===n.length,function(){return"crops.length is "+e.length+" but should be equal to blockShape.length  "+n.length}),E(r.shape[0]%i==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+n.join(" * ")+" === "+i}),M.runKernelFunc(function(o){return o.batchToSpaceND(r,n,e)},{$x:r},function(o){return{$x:function(){return o.spaceToBatchND(n,e)}}})}}),$8=A({broadcastTo_:function(t,n){var e=x(t,"broadcastTo","x"),r=e.shape;if(n.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+n+"].");if(n.length<e.rank)throw new Error("broadcastTo(): shape.length="+n.length+" < input.rank="+e.rank+".");if(n.length>e.rank){for(var i=e.shape.slice();i.length<n.length;)i.unshift(1);e=e.reshape(i)}for(var o=Array.from(n),s=n.length-1;s>=0;s--)if(e.shape[s]===n[s])o[s]=1;else if(1!==e.shape[s])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+n+"].");var a=o.map(function(u,c){return u>1?c:-1}).filter(function(u){return u>=0});return 0===a.length?e.clone():M.runKernelFunc(function(u){return u.tile(e,o)},{input:e},function(u){return{input:function(){return u.sum(a,!0)}}})}}),q8=A({cast_:function(t,n){var e=x(t,"x","cast");if(!F2(n))throw new Error("Failed to cast to unknown dtype "+n);if("string"===n&&"string"!==e.dtype||"string"!==n&&"string"===e.dtype)throw new Error("Only strings can be casted to strings");return M.runKernelFunc(function(i){return i.cast(e,n)},{x:e},function(i){return{x:function(){return i.clone()}}},"Cast",{dtype:n})}}),K8=A({clone_:function(t){var n=x(t,"x","clone",null);return M.runKernelFunc(function(){return M.makeTensorFromDataId(n.dataId,n.shape,n.dtype)},{$x:n},function(e){return{$x:function(){return e.toFloat()}}})}}),Y8=A({cumsum_:function(t,n,e,r){void 0===n&&(n=0),void 0===e&&(e=!1),void 0===r&&(r=!1);var i=x(t,"x","cumsum"),o=zr([n|=0],i.rank),s=i;null!=o&&(s=i.transpose(o));var a=Gr(1,i.rank)[0],u=M.runKernelFunc(function(c){return c.cumsum(s,a,e,r)},{permutedX:s},function(c){return{permutedX:function(){return c.cumsum(n,e,!r)}}});return null!=o&&(u=u.transpose(o)),u}}),X8=A({depthToSpace_:function(t,n,e){void 0===e&&(e="NHWC");var r=x(t,"x","depthToSpace"),i="NHWC"===e?r.shape[1]:r.shape[2],o="NHWC"===e?r.shape[2]:r.shape[3],s="NHWC"===e?r.shape[3]:r.shape[1];return E(i*n>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+n+"  for depthToSpace with input shape\n      "+r.shape}),E(o*n>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+n+" for depthToSpace with input shape\n          "+r.shape}),E(s%(n*n)==0,function(){return"Dimension size must be evenly divisible by "+n*n+" but is "+s+" for depthToSpace with input shape "+r.shape}),M.runKernelFunc(function(a){return a.depthToSpace(r,n,e)},{$x:r})}}),Tr=A({expandDims_:function(t,n){void 0===n&&(n=0);var e=x(t,"x","expandDims",null);E(n<=e.rank,function(){return"Axis must be <= rank of the tensor"});var r=e.shape.slice();return n<0&&(E(-(e.rank+1)<=n,function(){return"Axis must be in the interval ["+-(e.rank+1)+", "+e.rank+"]"}),n=e.rank+n+1),r.splice(n,0,1),$r(e,r)}}),ST=A({eye_:function(t,n,e,r){void 0===r&&(r="float32"),null==n&&(n=t);for(var i=De([t,n],r),o=t<=n?t:n,s=0;s<o;++s)i.set(1,s,s);var a=i.toTensor().as2D(t,n);if(null==e)return a;if(1===e.length)return nu(Tr(a,0),[e[0],1,1]);if(2===e.length)return nu(Tr(Tr(a,0),0),[e[0],e[1],1,1]);if(3===e.length)return nu(Tr(Tr(Tr(a,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+e.length+"D.")}}),Z8=A({multinomial_:function(t,n,e,r){void 0===r&&(r=!1);var i=x(t,"logits","multinomial"),o=i.size,s=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(s>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+s);e=e||Math.random();var a=1===s?i.as2D(1,-1):i,u=M.runKernelFunc(function(c){return c.multinomial(a,r,n,e)},{logits2D:a});return 1===s?u.as1D():u}}),Hy=A({oneHot_:function(t,n,e,r){if(void 0===e&&(e=1),void 0===r&&(r=0),n<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+n);var i=x(t,"indices","oneHot","int32"),o=i.shape.concat([n]);return i=i.flatten(),M.runKernelFunc(function(s){return s.oneHot(i,n,e,r)},{$indices:i},function(s){return{$indices:function(){return wt(i.shape,"float32")}}}).reshape(o)}}),Ds=A({pad_:function(t,n,e){void 0===e&&(e=0);var r=x(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");return M.runKernelFunc(function(o){return o.pad(r,n,e)},{x:r},function(o){var s=n.map(function(a){return a[0]});return{x:function(){return o.slice(s,r.shape)}}},"PadV2",{paddings:n,constantValue:e})}}),Q8=A({pad1d_:function(t,n,e){return void 0===e&&(e=0),E(2===n.length,function(){return"Invalid number of paddings. Must be length of 2."}),Ds(t,[n],e)}}),J8=A({pad2d_:function(t,n,e){return void 0===e&&(e=0),E(2===n.length&&2===n[0].length&&2===n[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ds(t,n,e)}}),eG=A({pad3d_:function(t,n,e){return void 0===e&&(e=0),E(3===n.length&&2===n[0].length&&2===n[1].length&&2===n[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ds(t,n,e)}}),tG=A({pad4d_:function(t,n,e){return void 0===e&&(e=0),E(4===n.length&&2===n[0].length&&2===n[1].length&&2===n[2].length&&2===n[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ds(t,n,e)}}),nG=A({rand_:function(t,n,e){var r=ae(t),i=null;if(null==e||"float32"===e)i=new Float32Array(r);else if("int32"===e)i=new Int32Array(r);else{if("bool"!==e)throw new Error("Unknown data type "+e);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=n();return M.makeTensor(i,t,e)}}),rG=A({randomNormal_:function(t,n,e,r,i){if(void 0===n&&(n=0),void 0===e&&(e=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var o=new Uy(n,e,r,!1,i),s=De(t,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),iG=A({randomGamma_:function(t,n,e,r,i){if(void 0===e&&(e=1),void 0===r&&(r="float32"),null==e&&(e=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var o=new W8(n,e,r,i),s=De(t,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),TT=A({randomUniform_:function(t,n,e,r,i){void 0===n&&(n=0),void 0===e&&(e=1),void 0===r&&(r="float32");for(var o=De(t,r),s=new z8(n,e,null,i),a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}}),$r=A({reshape_:function(t,n){var e=x(t,"x","reshape",null);return n=k2(n,e.size),E(e.size===ae(n),function(){return"new shape and old shape must have the same number of elements."}),M.runKernelFunc(function(i){return i.reshape(e,n)},{x:e},function(i){return{x:function(){return i.reshape(e.shape)}}},"Reshape",{shape:n})}}),MT=A({spaceToBatchND_:function(t,n,e){var r=x(t,"x","spaceToBatchND");return E(r.rank>=1+n.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+n.length}),E(e.length===n.length,function(){return"paddings.shape[0] "+e.length+" must be equal to [blockShape] "+n.length}),E(r.shape.reduce(function(i,o,s){return s>0&&s<=n.length?i&&(o+e[s-1][0]+e[s-1][1])%n[s-1]==0:i},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+e.toString()+" must be divisible by blockShapes "+n.toString()}),M.runKernelFunc(function(i){return i.spaceToBatchND(r,n,e)},{$x:r},function(i){return{$x:function(){return i.batchToSpaceND(n,e)}}})}}),AT=A({squeeze_:function(t,n){var e=x(t,"x","squeeze");return $r(e,ko(e.shape,n).newShape)}}),fr=A({stack_:function(t,n){void 0===n&&(n=0);var e=dl(t,"tensors","stack");if(E(e.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===e.length)return e[0].expandDims(n);var i=e[0].shape,o=e[0].dtype;E(n<=e[0].rank,function(){return"Axis must be <= rank of the tensor"}),e.forEach(function(a){je(i,a.shape,"All tensors passed to stack must have matching shapes")}),e.forEach(function(a){E(o===a.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=e.map(function(a){return a.expandDims(n)});return Yt(s,n)}}),nu=A({tile_:function(t,n){var e=x(t,"x","tile",null);return E(e.rank===n.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of reps "+n+"."}),M.runKernelFunc(function(o,s){var a=o.tile(e,n);return s([e]),a},{x:e},function(o,s){var a=s[0];return{x:function(){var u=We(a);if(1===a.rank)for(var c=0;c<n[0];++c)u=u.add(o.slice([c*a.shape[0]],[a.shape[0]]));else if(2===a.rank)for(c=0;c<n[0];++c)for(var l=0;l<n[1];++l)u=u.add(o.slice([c*a.shape[0],l*a.shape[1]],[a.shape[0],a.shape[1]]));else if(3===a.rank)for(c=0;c<n[0];++c)for(l=0;l<n[1];++l)for(var d=0;d<n[2];++d)u=u.add(o.slice([c*a.shape[0],l*a.shape[1],d*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else{if(4!==a.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+a.rank+" tensors yet.");for(c=0;c<n[0];++c)for(l=0;l<n[1];++l)for(d=0;d<n[2];++d)for(var f=0;f<n[3];++f)u=u.add(o.slice([c*a.shape[0],l*a.shape[1],d*a.shape[2],f*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]))}return u}}},"Tile",{reps:n},[e])}}),oG=A({truncatedNormal_:function(t,n,e,r,i){if(void 0===n&&(n=0),void 0===e&&(e=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var o=new Uy(n,e,r,!0,i),s=De(t,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),Xt=A({unstack_:function(t,n){void 0===n&&(n=0),n=n||0;var e=x(t,"x","unstack");return E(n>=-e.shape.length&&n<e.shape.length,function(){return"Axis = "+n+" is not in [-"+e.shape.length+", "+e.shape.length+")"}),n<0&&(n+=e.shape.length),M.runKernelFunc(function(i){return i.unstack(e,n)},{x:e},function(i){return{x:function(){return fr(i,n)}}},"Unpack",{axis:n})}});function ch(t,n,e,r){void 0===r&&(r=!0);var i=[];if(r)(i=i.concat(n.slice(0))).push(t[0]/e),i=i.concat(t.slice(1));else{i=i.concat(t[0]);for(var o=n.length,s=0;s<o;++s)i=i.concat([t[s+1]/n[s],n[s]]);i=i.concat(t.slice(o+1))}return i}function lh(t,n,e){void 0===e&&(e=!0);var r=[];if(e){r.push(n);for(var i=n+1;i<t;++i)i<=2*n?(r.push(i),r.push(i-(n+1))):r.push(i)}else{var o=[],s=[];for(i=1;i<t;++i)i>=2*n+1||i%2==1?s.push(i):o.push(i);r.push.apply(r,o),r.push(0),r.push.apply(r,s)}return r}function dh(t,n,e,r){void 0===r&&(r=!0);var i=[];i.push(r?t[0]/e:t[0]*e);for(var o=1;o<t.length;++o)i.push(o<=n.length?r?n[o-1]*t[o]:t[o]/n[o-1]:t[o]);return i}function RT(t,n){for(var e=[0],r=0;r<n;++r)e.push(t[r][0]);return e}function OT(t,n,e){for(var r=t.slice(0,1),i=0;i<e;++i)r.push(t[i+1]-n[i][0]-n[i][1]);return r}function jy(t,n){if(t.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+t.rank+".");if(n.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if("int32"!==n.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+n.dtype+".");if(n.shape[n.rank-1]>t.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+n.shape[n.rank-1]+" vs. "+t.rank);if(0===t.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+t.shape+".");for(var e=n.shape,r=e[e.length-1],i=1,o=0;o<e.length-1;++o)i*=e[o];var s=t.shape,a=e.slice();a.pop();var u=1;for(o=r;o<t.rank;++o)u*=s[o],a.push(s[o]);var c=jr(t.shape).map(function(l){return l/u}).concat([1]).slice(0,r);return[a,i,u,c]}function fh(t){return t<=30?t:Zf(t,Math.floor(Math.sqrt(t)))}function NT(t,n,e){var r=n.rank>1?n.shape[n.rank-1]:1,i=n.rank>1?n.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+e.shape+", indices.shape: "+n.shape+", shape: "+t+", sliceDim: "+r+", and batchDim: "+i+".";if(e.rank<i)throw new Error(o+" update.rank < "+i+". ");if(t.length<r+(e.rank-i))throw new Error(o+" Output shape length < "+(r+(e.rank-i)));if(e.rank!==i+t.length-r)throw new Error(o+" update.rank != "+(i+t.length-r));for(var s=0;s<i;++s)if(e.shape[s]!==n.shape[s])throw new Error(o+" updates.shape["+s+"] ("+e.shape[s]+") != indices.shape["+s+"] ("+n.shape[s]+").");for(s=0;s<e.rank-i;++s)if(e.shape[s+i]!==t[s+r])throw new Error(o+" updates.shape["+(s+i)+"] ("+e.shape[s+i]+") != shape["+(s+i)+"] ("+t[s+i]+")")}function kT(t,n,e){if(n.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if(t.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==n.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+n.dtype);if(e.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+e);if(0===e.length){if(0===n.size)throw new Error("Indices specified for empty output. indices shape: "+n.shape);if(0===t.size)throw new Error("Updates specified for empty output. updates shape: "+t.shape)}NT(e,n,t)}function fl(t,n,e){for(var r=n.shape.length,i=r>1?n.shape[r-1]:1,o=e.length,s=1,a=i;a<o;++a)s*=e[a];var u=i<1?1:i;return{sliceRank:i,numUpdates:ae(n.shape)/u,sliceSize:s,strides:jr(e.slice(0,i)).concat([1]),outputSize:ae(e)}}function PT(t,n,e){E(t.rank===n.length,function(){return"Error in slice"+t.rank+"D: Length of begin "+n+" must match the rank of the array ("+t.rank+")."}),E(t.rank===e.length,function(){return"Error in slice"+t.rank+"D: Length of size "+e+" must match the rank of the array ("+t.rank+")."});for(var r=function(o){E(n[o]+e[o]<=t.shape[o],function(){return"Error in slice"+t.rank+"D: begin["+o+"] + size["+o+"] ("+(n[o]+e[o])+") would overflow input.shape["+o+"] ("+t.shape[o]+")"})},i=0;i<t.rank;++i)r(i)}function zy(t){for(var n=[],e=0;t>0;)1&t&&n.push(e),t/=2,e++;return n}function hh(t,n,e){for(var r=[],i=0;i<t.length;i++)r[i]=Math.ceil((n[i]-t[i])/e[i]);return r}function FT(t,n,e,r,i){var o=n[i];(t&1<<i||null==o)&&(o=(e[i]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),Yf(0,o,a-1)}function LT(t,n,e,r,i){var o=n[i],s=e[i]||1;(t&1<<i||null==o)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),s>0?Yf(0,o,a):Yf(-1,o,a-1)}function Gy(t,n,e){for(var r=e.length,i=0;i<e.length;i++)if(e[i]>1){r=i;break}for(i=r+1;i<e.length;i++)if(n[i]>0||e[i]!==t[i])return!1;return!0}function $y(t,n){for(var e=t.length>0?t[t.length-1]:1,r=0;r<t.length-1;r++)e+=t[r]*n[r];return e}function ph(t){return M.customGrad(t)}Object.freeze({prepareAndValidate:jy}),Object.freeze({validateUpdateShape:NT,validateInput:kT,calculateShapes:fl}),Object.freeze({assertParamsValid:PT,maskToAxes:zy,computeOutShape:hh,startForAxis:FT,stopForAxis:LT,isSliceContinous:Gy,computeFlatOffset:$y});var Yi=A({softmax_:function(t,n){void 0===n&&(n=-1);var e=x(t,"logits","softmax","float32");if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and dim was "+n);return M.runKernelFunc(function(r,i){var o=r.softmax(e,n);return i([o]),o},{logits:e},function(r,i){var o=i[0],s=r.mul(o);return{logits:function(){return s.sub(s.sum([n],!0).mul(o))}}},"Softmax",{dim:n},[],[!0])}}),uG=A({logSoftmax_:function(t,n){void 0===n&&(n=-1);var e=x(t,"logits","logSoftmax");if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and axis was "+n);return ph(function(r,i){var o=r.max(n,!0),s=r.sub(o),a=s.toFloat().sub(s.exp().sum(n,!0).log());return i([a]),{value:a,gradFunc:function(u,c){var l=c[0].exp();return u.sub(u.sum(n,!0).mul(l))}}})(e)}}),BT=function(){function t(n,e){this.backend=n,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return t.prototype.get=function(n){return this.data.has(n)||this.dataMover.moveData(this.backend,n),this.data.get(n)},t.prototype.set=function(n,e){this.dataIdsCount++,this.data.set(n,e)},t.prototype.has=function(n){return this.data.has(n)},t.prototype.delete=function(n){return this.dataIdsCount--,this.data.delete(n)},t.prototype.numDataIds=function(){return this.dataIdsCount},t}(),VT=function(){function t(){}return t.prototype.time=function(n){return N("time")},t.prototype.read=function(n){return N("read")},t.prototype.readSync=function(n){return N("readSync")},t.prototype.numDataIds=function(){return N("numDataIds")},t.prototype.disposeData=function(n){return N("disposeData")},t.prototype.write=function(n,e,r){return N("write")},t.prototype.move=function(n,e,r,i){return N("move")},t.prototype.memory=function(){return N("memory")},t.prototype.floatPrecision=function(){return N("floatPrecision")},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.batchMatMul=function(n,e,r,i){return N("batchMatMul")},t.prototype.fusedBatchMatMul=function(n){return N("fusedBatchMatMul")},t.prototype.slice=function(n,e,r){return N("slice")},t.prototype.stridedSlice=function(n,e,r,i){return N("stridedSlice")},t.prototype.unstack=function(n,e){return N("unstack")},t.prototype.reverse=function(n,e){return N("reverse")},t.prototype.concat=function(n,e){return N("concat")},t.prototype.neg=function(n){return N("neg")},t.prototype.add=function(n,e){return N("add")},t.prototype.addN=function(n){return N("addN")},t.prototype.subtract=function(n,e){return N("subtract")},t.prototype.multiply=function(n,e){return N("multiply")},t.prototype.realDivide=function(n,e){return N("realDivide")},t.prototype.floorDiv=function(n,e){return N("floorDiv")},t.prototype.sum=function(n,e){return N("sum")},t.prototype.prod=function(n,e){return N("prod")},t.prototype.unsortedSegmentSum=function(n,e,r){return N("unsortedSegmentSum")},t.prototype.argMin=function(n,e){return N("argMin")},t.prototype.argMax=function(n,e){return N("argMax")},t.prototype.equal=function(n,e){return N("equal")},t.prototype.notEqual=function(n,e){return N("notEqual")},t.prototype.less=function(n,e){return N("less")},t.prototype.lessEqual=function(n,e){return N("lessEqual")},t.prototype.greater=function(n,e){return N("greater")},t.prototype.greaterEqual=function(n,e){return N("greaterEqual")},t.prototype.logicalNot=function(n){return N("logicalNot")},t.prototype.logicalAnd=function(n,e){return N("logicalAnd")},t.prototype.logicalOr=function(n,e){return N("logicalOr")},t.prototype.where=function(n){return N("where")},t.prototype.select=function(n,e,r){return N("select")},t.prototype.topk=function(n,e,r){return N("topk")},t.prototype.min=function(n,e){return N("min")},t.prototype.minimum=function(n,e){return N("minimum")},t.prototype.mod=function(n,e){return N("mod")},t.prototype.max=function(n,e){return N("max")},t.prototype.maximum=function(n,e){return N("maximum")},t.prototype.all=function(n,e){return N("all")},t.prototype.any=function(n,e){return N("any")},t.prototype.squaredDifference=function(n,e){return N("squaredDifference")},t.prototype.ceil=function(n){return N("ceil")},t.prototype.floor=function(n){return N("floor")},t.prototype.round=function(n){return N("round")},t.prototype.sign=function(n){return N("sign")},t.prototype.isNaN=function(n){return N("isNaN")},t.prototype.isInf=function(n){return N("isInf")},t.prototype.isFinite=function(n){return N("isFinite")},t.prototype.pow=function(n,e){return N("pow")},t.prototype.exp=function(n){return N("exp")},t.prototype.expm1=function(n){return N("expm1")},t.prototype.softmax=function(n,e){return N("softmax")},t.prototype.log=function(n){return N("log")},t.prototype.log1p=function(n){return N("log1p")},t.prototype.sqrt=function(n){return N("sqrt")},t.prototype.rsqrt=function(n){return N("rsqrt")},t.prototype.square=function(n){return N("square")},t.prototype.reciprocal=function(n){return N("reciprocal")},t.prototype.relu=function(n){return N("relu")},t.prototype.relu6=function(n){return N("relu6")},t.prototype.prelu=function(n,e){return N("prelu")},t.prototype.elu=function(n){return N("elu")},t.prototype.eluDer=function(n,e){return N("eluDer")},t.prototype.selu=function(n){return N("selu")},t.prototype.int=function(n){return N("int")},t.prototype.clip=function(n,e,r){return N("clip")},t.prototype.abs=function(n){return N("abs")},t.prototype.complexAbs=function(n){return N("complexAbs")},t.prototype.sigmoid=function(n){return N("sigmoid")},t.prototype.softplus=function(n){return N("softplus")},t.prototype.sin=function(n){return N("sin")},t.prototype.cos=function(n){return N("cos")},t.prototype.tan=function(n){return N("tan")},t.prototype.asin=function(n){return N("asin")},t.prototype.acos=function(n){return N("acos")},t.prototype.atan=function(n){return N("atan")},t.prototype.atan2=function(n,e){return N("atan2")},t.prototype.sinh=function(n){return N("sinh")},t.prototype.cosh=function(n){return N("cosh")},t.prototype.tanh=function(n){return N("tanh")},t.prototype.asinh=function(n){return N("asinh")},t.prototype.acosh=function(n){return N("acosh")},t.prototype.atanh=function(n){return N("atanh")},t.prototype.erf=function(n){return N("erf")},t.prototype.step=function(n,e){return N("step")},t.prototype.fusedConv2d=function(n){return N("fusedConv2d")},t.prototype.conv2d=function(n,e,r){return N("conv2d")},t.prototype.conv2dDerInput=function(n,e,r){return N("conv2dDerInput")},t.prototype.conv2dDerFilter=function(n,e,r){return N("conv2dDerFilter")},t.prototype.fusedDepthwiseConv2D=function(n){return N("fusedDepthwiseConv2D")},t.prototype.depthwiseConv2D=function(n,e,r){return N("depthwiseConv2D")},t.prototype.depthwiseConv2DDerInput=function(n,e,r){return N("depthwiseConv2DDerInput")},t.prototype.depthwiseConv2DDerFilter=function(n,e,r){return N("depthwiseConv2DDerFilter")},t.prototype.conv3d=function(n,e,r){return N("conv3d")},t.prototype.conv3dDerInput=function(n,e,r){return N("conv3dDerInput")},t.prototype.conv3dDerFilter=function(n,e,r){return N("conv3dDerFilter")},t.prototype.maxPool=function(n,e){return N("maxPool")},t.prototype.maxPoolBackprop=function(n,e,r,i){return N("maxPoolBackprop")},t.prototype.avgPool=function(n,e){return N("avgPool")},t.prototype.avgPoolBackprop=function(n,e,r){return N("avgPoolBackprop")},t.prototype.avgPool3d=function(n,e){return N("avgPool3d")},t.prototype.avgPool3dBackprop=function(n,e,r){return N("avgPool3dBackprop")},t.prototype.maxPool3d=function(n,e){return N("maxPool3d")},t.prototype.maxPool3dBackprop=function(n,e,r,i){return N("maxPool3dBackprop")},t.prototype.reshape=function(n,e){return N("reshape")},t.prototype.cast=function(n,e){return N("cast")},t.prototype.tile=function(n,e){return N("tile")},t.prototype.pad=function(n,e,r){return N("pad")},t.prototype.transpose=function(n,e){return N("transpose")},t.prototype.gather=function(n,e,r){return N("gather")},t.prototype.gatherND=function(n,e){return N("gatherND")},t.prototype.scatterND=function(n,e,r){return N("scatterND")},t.prototype.batchToSpaceND=function(n,e,r){return N("batchToSpaceND")},t.prototype.spaceToBatchND=function(n,e,r){return N("spaceToBatchND")},t.prototype.resizeBilinear=function(n,e,r,i){return N("resizeBilinear")},t.prototype.resizeBilinearBackprop=function(n,e,r){return N("resizeBilinearBackprop")},t.prototype.resizeNearestNeighbor=function(n,e,r,i){return N("resizeNearestNeighbor")},t.prototype.resizeNearestNeighborBackprop=function(n,e,r){return N("resizeNearestNeighborBackprop")},t.prototype.batchNormalization=function(n,e,r,i,o,s){return N("batchNormalization")},t.prototype.localResponseNormalization4D=function(n,e,r,i,o){return N("localResponseNormalization4D")},t.prototype.LRNGrad=function(n,e,r,i,o,s,a){return N("LRNGrad")},t.prototype.multinomial=function(n,e,r,i){return N("multinomial")},t.prototype.oneHot=function(n,e,r,i){return N("oneHot")},t.prototype.cumsum=function(n,e,r,i){return N("cumsum")},t.prototype.nonMaxSuppression=function(n,e,r,i,o){return N("nonMaxSuppression")},t.prototype.fft=function(n){return N("fft")},t.prototype.ifft=function(n){return N("ifft")},t.prototype.complex=function(n,e){return N("complex")},t.prototype.real=function(n){return N("real")},t.prototype.imag=function(n){return N("imag")},t.prototype.cropAndResize=function(n,e,r,i,o,s){return N("cropAndResize")},t.prototype.depthToSpace=function(n,e,r){return N("depthToSpace")},t.prototype.split=function(n,e,r){return N("split")},t.prototype.sparseToDense=function(n,e,r,i){return N("sparseToDense")},t.prototype.diag=function(n){return N("diag")},t.prototype.fill=function(n,e,r){return N("fill")},t.prototype.onesLike=function(n){return N("onesLike")},t.prototype.zerosLike=function(n){return N("zerosLike")},t.prototype.linspace=function(n,e,r){return N("linspace")},t.prototype.dispose=function(){return N("dispose")},t}();function N(t){throw new Error("'"+t+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Xi(t,n){for(var e=t.length,r=[],i=0;i<e;i++){var o=e-1-i;(n[n.length-1-i]||1)>1&&1===(t[o]||1)&&r.unshift(o)}return r}function Wt(t,n){for(var e=[],r=0;r<n.length;r++){var i=t[t.length-r-1],o=n.length-r-1;(null==i||1===i&&n[o]>1)&&e.unshift(o)}return e}function Re(t,n){for(var e=[],r=Math.max(t.length,n.length),i=0;i<r;i++){var o=t[t.length-i-1];null==o&&(o=1);var s=n[n.length-i-1];if(null==s&&(s=1),1===o)e.unshift(s);else if(1===s)e.unshift(o);else{if(o!==s)throw Error("Operands could not be broadcast together with shapes "+t+" and "+n+".");e.unshift(o)}}return e}function ru(t,n,e,r,i,o,s){void 0===s&&(s="channelsLast");var a,u=mh(n),c=u[0],l=u[1];if("channelsLast"===s)a=[c,l,t[3],t[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);a=[c,l,t[1],t[1]]}return Vo(t,a,e,r,i,o,!1,s)}function hl(t,n,e,r,i,o,s){void 0===s&&(s="NDHWC");var a,u,c=Ky(n),l=c[0],d=c[1],f=c[2];if("NDHWC"===s)u="channelsLast",a=[l,d,f,t[4],t[4]];else{if("NCDHW"!==s)throw new Error("Unknown dataFormat "+s);u="channelsFirst",a=[l,d,f,t[1],t[1]]}return pl(t,a,e,r,i,!1,u,o)}function Vo(t,n,e,r,i,o,s,a){void 0===s&&(s=!1),void 0===a&&(a="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],d=u[2],f=u[3];if("channelsLast"===a)c=t[0],l=t[1],d=t[2],f=t[3];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);c=t[0],f=t[1],l=t[2],d=t[3]}var h,p=n[0],g=n[1],m=n[3],v=mh(e),y=v[0],w=v[1],b=mh(r),_=b[0],C=b[1],T=iu(p,_),S=iu(g,C),D=function(L,B,z,H,U,G,q,ee){var le,he,Me;if("number"==typeof L){le={top:L,bottom:L,left:L,right:L,type:0===L?"VALID":"NUMBER"};var Ae=function(Be,ot,et,Ot,St){null==Ot&&(Ot=qy(Be,ot,et));var Ei=Be[1],Di=gl((Be[0]-ot+2*Ot)/et+1,St);E(Dt(Di),function(){return"The output # of rows ("+Di+") must be an integer. Change the stride and/or zero pad parameters"});var gr=gl((Ei-ot+2*Ot)/et+1,St);return E(Dt(gr),function(){return"The output # of columns ("+gr+") must be an integer. Change the stride and/or zero pad parameters"}),[Di,gr]}([B,z],G,H,L,ee);he=Ae[0],Me=Ae[1]}else if("same"===L){he=Math.ceil(B/H),Me=Math.ceil(z/U);var Pe=Math.max(0,(he-1)*H+G-B),ze=Math.max(0,(Me-1)*U+q-z),Le=Math.floor(Pe/2),Ge=Pe-Le,Ft=Math.floor(ze/2);le={top:Le,bottom:Ge,left:Ft,right:ze-Ft,type:"SAME"}}else{if("valid"!==L)throw Error("Unknown padding parameter: "+L);le={top:0,bottom:0,left:0,right:0,type:"VALID"},he=Math.ceil((B-G+1)/H),Me=Math.ceil((z-q+1)/U)}return{padInfo:le,outHeight:he,outWidth:Me}}(i,l,d,y,w,T,S,o),O=D.outHeight,R=D.outWidth,V=s?m*f:m;return"channelsFirst"===a?h=[c,V,O,R]:"channelsLast"===a&&(h=[c,O,R,V]),{batchSize:c,dataFormat:a,inHeight:l,inWidth:d,inChannels:f,outHeight:O,outWidth:R,outChannels:V,padInfo:D.padInfo,strideHeight:y,strideWidth:w,filterHeight:p,filterWidth:g,effectiveFilterHeight:T,effectiveFilterWidth:S,dilationHeight:_,dilationWidth:C,inShape:t,outShape:h,filterShape:n}}function pl(t,n,e,r,i,o,s,a){void 0===o&&(o=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],d=u[2],f=u[3],h=u[4];if("channelsLast"===s)c=t[0],l=t[1],d=t[2],f=t[3],h=t[4];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=t[0],h=t[1],l=t[2],d=t[3],f=t[4]}var p,g=n[0],m=n[1],v=n[2],y=n[4],w=Ky(e),b=w[0],_=w[1],C=w[2],T=Ky(r),S=T[0],D=T[1],I=T[2],O=iu(g,S),R=iu(m,D),V=iu(v,I),L=function(q,ee,le,he,Me,Ae,Pe,ze,Le,Ge,Ft){var Be,ot,et,Ot;if("number"==typeof q){Be={top:q,bottom:q,left:q,right:q,front:q,back:q,type:0===q?"VALID":"NUMBER"};var St=function(_u,so,Qb,Cu,Ii,Jb){null==Ii&&(Ii=qy(_u,so,Cu));var sQ=_u[1],aQ=_u[2],ew=gl((_u[0]-so+2*Ii)/Cu+1,Jb);E(Dt(ew),function(){return"The output # of depths ("+ew+") must be an integer. Change the stride and/or zero pad parameters"});var tw=gl((sQ-so+2*Ii)/Cu+1,Jb);E(Dt(tw),function(){return"The output # of rows ("+tw+") must be an integer. Change the stride and/or zero pad parameters"});var nw=gl((aQ-so+2*Ii)/Cu+1,Jb);return E(Dt(nw),function(){return"The output # of columns ("+nw+") must be an integer. Change the stride and/or zero pad parameters"}),[ew,tw,nw,1]}([ee,le,he,1],ze,0,Me,q,Ft);ot=St[0],et=St[1],Ot=St[2]}else if("same"===q){var Tt=((ot=Math.ceil(ee/Me))-1)*Me+ze-ee,Ei=((et=Math.ceil(le/Ae))-1)*Ae+Le-le,Di=((Ot=Math.ceil(he/Pe))-1)*Pe+Ge-he,gr=Math.floor(Tt/2),wu=Tt-gr,io=Math.floor(Ei/2),Zo=Ei-io,oo=Math.floor(Di/2);Be={top:io,bottom:Zo,left:oo,right:Di-oo,front:gr,back:wu,type:"SAME"}}else{if("valid"!==q)throw Error("Unknown padding parameter: "+q);Be={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},ot=Math.ceil((ee-ze+1)/Me),et=Math.ceil((le-Le+1)/Ae),Ot=Math.ceil((he-Ge+1)/Pe)}return{padInfo:Be,outDepth:ot,outHeight:et,outWidth:Ot}}(i,l,d,f,b,_,C,O,R,V,a),z=L.outDepth,H=L.outHeight,U=L.outWidth,G=o?y*h:y;return"channelsFirst"===s?p=[c,G,z,H,U]:"channelsLast"===s&&(p=[c,z,H,U,G]),{batchSize:c,dataFormat:s,inDepth:l,inHeight:d,inWidth:f,inChannels:h,outDepth:z,outHeight:H,outWidth:U,outChannels:G,padInfo:L.padInfo,strideDepth:b,strideHeight:_,strideWidth:C,filterDepth:g,filterHeight:m,filterWidth:v,effectiveFilterDepth:O,effectiveFilterHeight:R,effectiveFilterWidth:V,dilationDepth:S,dilationHeight:D,dilationWidth:I,inShape:t,outShape:p,filterShape:n}}function qy(t,n,e,r){void 0===r&&(r=1);var i=iu(n,r);return Math.floor((t[0]*(e-1)-e+i)/2)}function mh(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function Ky(t){return"number"==typeof t?[t,t,t]:t}function iu(t,n){return n<=1?t:t+(t-1)*(n-1)}function gl(t,n){if(!n)return t;switch(n){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+n)}}function Is(t){var n=mh(t);return 1===n[0]&&1===n[1]&&1===n[2]}function Un(t,n){return Is(t)||Is(n)}function vh(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error("Unknown dataFormat "+t)}function Yy(t,n,e){if("complex64"===n){if("complex64"===t.dtype)return t.clone();var r=wt(t.shape),i=t.toFloat(),o=e.complex(i,r);return r.dispose(),i.dispose(),o}if(!L2(t.dtype,n))return M.makeTensorFromDataId(t.dataId,t.shape,n);if("complex64"===t.dtype){var s=e.real(t);return o=s.cast(n),s.dispose(),o}if("int32"===n)return e.int(t);if("bool"===n){var a=X(0,t.dtype);return o=e.notEqual(t,a),a.dispose(),o}throw new Error("Error in Cast: failed to cast "+t.dtype+" to "+n)}function yh(t,n){return M.makeTensorFromDataId(t.dataId,n,t.dtype)}function Xy(t,n,e){var r=(n-t)/(e-1),i=Ja(e,"float32");i[0]=t;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return jt(i,"float32")}function Zy(t,n){if(t.length!==n.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+t.length+", imag: "+n.length+".");for(var e=new Float32Array(2*t.length),r=0;r<e.length;r+=2)e[r]=t[r/2],e[r+1]=n[r/2];return e}function UT(t,n){return{real:t[2*n],imag:t[2*n+1]}}function cG(t,n,e,r){t[2*r]=n,t[2*r+1]=e}function lG(t,n,e){var r=(e?2:-2)*Math.PI*(t/n);return{real:Math.cos(r),imag:Math.sin(r)}}function dG(t,n,e){var r=function(u,c,l){for(var d=0,f=u.length,h=0,p=!1;d<f;){var g=l(c,u[h=d+(f-d>>>1)]);g>0?d=h+1:(f=h,p=!g)}return p?d:-d-1}(t,n,e||fG);t.splice(r<0?-(r+1):r,0,n)}function fG(t,n){return t>n?1:t<n?-1:0}function Qy(t,n,e,r,i){return HT(t,n,e,r,i,0).selectedIndices}function Jy(t,n,e,r,i,o){var s=HT(t,n,e,r,i,o,!0);return s.numValidOutputs.dispose(),{selectedIndices:s.selectedIndices,selectedScores:s.selectedScores}}function HT(t,n,e,r,i,o,s,a){void 0===s&&(s=!1),void 0===a&&(a=!1);for(var u=Array.from(n).map(function(b,_){return{score:b,boxIndex:_,suppressBeginIndex:0}}).filter(function(b){return b.score>i}).sort(jT),c=o>0?-.5/o:0,l=[],d=[];l.length<e&&u.length>0;){var f=u.pop(),h=f.score,p=f.boxIndex,g=f.suppressBeginIndex;if(h<i)break;for(var m=!1,v=l.length-1;v>=g;--v){var y=hG(t,p,l[v]);if(y>=r){m=!0;break}if(f.score=f.score*pG(r,c,y),f.score<=i)break}f.suppressBeginIndex=l.length,m||(f.score===h?(l.push(p),d.push(f.score)):f.score>i&&dG(u,f,jT))}var w=l.length;return a&&(l.fill(0,w),d.fill(0,w)),{selectedIndices:jt(l,"int32"),selectedScores:jt(d,"float32"),numValidOutputs:X(w,"int32")}}function hG(t,n,e){var r=t.subarray(4*n,4*n+4),i=t.subarray(4*e,4*e+4),o=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(i[0],i[2]),l=Math.min(i[1],i[3]),d=Math.max(i[0],i[2]),f=Math.max(i[1],i[3]),h=(a-o)*(u-s),p=(d-c)*(f-l);if(h<=0||p<=0)return 0;var g=Math.max(o,c),m=Math.max(s,l),v=Math.min(a,d),y=Math.min(u,f),w=Math.max(v-g,0)*Math.max(y-m,0);return w/(h+p-w)}function pG(t,n,e){var r=Math.exp(n*e*e);return e<=t?r:0}function jT(t,n){return t.score-n.score||t.score===n.score&&n.boxIndex-t.boxIndex}function WT(t,n,e){var r=new Array(t.rank).fill(0),i=t.shape.slice();return n.map(function(o){i[e]=o;var s=t.slice(r,i);return r[e]+=o,s})}function zT(t,n){for(var e=new Array(t.rank),r=0;r<e.length;r++)e[r]=t.shape[r]*n[r];var i=De(e,t.dtype);for(r=0;r<i.values.length;++r){for(var o=i.indexToLoc(r),s=new Array(t.rank),a=0;a<s.length;a++)s[a]=o[a]%t.shape[a];var u=t.locToIndex(s);i.values[r]=t.values[u]}return i.toTensor()}function GT(t,n,e,r,i){for(var o=n[n.length-1],s=[t.length/o,o],a=s[0],u=s[1],c=Za(e,a*r),l=Za("int32",a*r),d=0;d<a;d++){for(var f=d*u,h=t.subarray(f,f+u),p=[],g=0;g<h.length;g++)p.push({value:h[g],index:g});p.sort(function(b,_){return _.value-b.value});var m=d*r,v=c.subarray(m,m+r),y=l.subarray(m,m+r);for(g=0;g<r;g++)v[g]=p[g].value,y[g]=p[g].index}var w=n.slice();return w[w.length-1]=r,[gn(c,w,e),gn(l,w,"int32")]}function e0(t,n){for(var e=[],r=0;r<n.length;r++)n[r]&&e.push(r);var i=De(t,"int32"),o=De([e.length,t.length],"int32");for(r=0;r<e.length;r++){var s=i.indexToLoc(e[r]);o.values.set(s,r*t.length)}return o.toTensor()}Object.freeze({castTensor:Yy,reshapeTensor:yh,linspaceImpl:Xy,upcastType:tn,axesAreInnerMostDims:Ly,combineLocations:xT,computeOutAndReduceShapes:hn,expandShapeToKeepDim:Vn,assertAxesAreInnerMostDims:Xn,getAxesPermutation:zr,getUndoAxesPermutation:sh,getInnerMostAxes:Gr,getBroadcastDims:Xi,getReductionAxes:Wt,assertAndGetBroadcastShape:Re,assertParamsConsistent:ET,computeOutShape:Cs,computePool2DInfo:ru,computePool3DInfo:hl,computeConv2DInfo:Vo,computeConv3DInfo:pl,computeDefaultPad:qy,tupleValuesAreOne:Is,eitherStridesOrDilationsAreOne:Un,convertConv2DDataFormat:vh,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:fh});var gG=function(t,n){this.outputShape=[],this.outputShape=t,this.variableNames=n.map(function(i,o){return"T"+o});var e=[];this.variableNames.forEach(function(i){e.push("float v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode="\n      void main() {\n        "+e.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},mG=function(t,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map(function(i,o){return"T"+o});var e=[];this.variableNames.forEach(function(i){e.push("vec4 v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode="\n      void main() {\n        "+e.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},vG=function(t,n,e){this.variableNames=["A"];var r=t.windowSize,i=t.batchSize,s=Math.ceil(t.inSize/r);e||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+(e?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));")+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+("max"===n?">":"<")+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function $T(t,n){return["x","y","z","w","u","v"].slice(0,n).map(function(e){return t+"."+e})}function Qn(t,n){return 1===n?[t]:$T(t,n)}function _n(){var t,n,e,r,i,o,s,a,u,c;return 2===P().getNumber("WEBGL_VERSION")?(t="#version 300 es",n="in",e="out",r="in",i="texture",o="outputColor",s="out vec4 outputColor;",a="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",n="attribute",e="varying",r="varying",i="texture2D",o="gl_FragColor",s="",a="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:n,varyingVs:e,varyingFs:r,texture2D:i,output:o,defineOutput:s,defineSpecialNaN:a,defineSpecialInf:u,defineRound:c}}function Ss(t,n,e){void 0===e&&(e="index");var r=jr(n);return r.map(function(i,o){return"int "+t[o]+" = "+e+" / "+i+"; "+(o===r.length-1?"int "+t[o+1]+" = "+e+" - "+t[o]+" * "+i:"index -= "+t[o]+" * "+i)+";"}).join("")}function t0(t){var n=jr(t).map(function(e){return e.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+n[0]+" + coords.y * "+n[1]+" + coords.z;\n  }\n"}var qT="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function yG(t,n,e,r){var i=[];t.forEach(function(h){var p=ae(h.shapeInfo.logicalShape);h.shapeInfo.isUniform?i.push("uniform float "+h.name+(p>1?"["+p+"]":"")+";"):(i.push("uniform sampler2D "+h.name+";"),i.push("uniform int offset"+h.name+";"))});var o,s,h,a=i.join("\n"),u=t.map(function(h){return function(p,g,m){void 0===m&&(m=!1);var v="";return v+=m?KT(p):ou(p),p.shapeInfo.logicalShape.length<=g.logicalShape.length&&(v+=m?function(b,_){var C,z,T=b.name,S=T.charAt(0).toUpperCase()+T.slice(1),D="get"+S+"AtOutCoords",I=b.shapeInfo.logicalShape.length,O=_.logicalShape.length,R=Xi(b.shapeInfo.logicalShape,_.logicalShape),V=vt(O),L=O-I,B=["x","y","z","w","u","v"];C=0===I?"":O<2&&R.length>=1?"coords = 0;":R.map(function(le){return"coords."+B[le+L]+" = 0;"}).join("\n"),z=O<2&&I>0?"coords":b.shapeInfo.logicalShape.map(function(le,he){return"coords."+B[he+L]}).join(", ");var H="return outputValue;",U=1===ae(b.shapeInfo.logicalShape),G=1===ae(_.logicalShape);if(1!==I||U||G){if(U&&!G)H=1===O?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(R.length){var q=I-2,ee=I-1;R.indexOf(q)>-1&&R.indexOf(ee)>-1?H="return vec4(outputValue.x);":R.indexOf(q)>-1?H="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":R.indexOf(ee)>-1&&(H="return vec4(outputValue.xx, outputValue.zz);")}}else H="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+D+"() {\n      "+V+" coords = getOutputCoords();\n      "+C+"\n      vec4 outputValue = get"+S+"("+z+");\n      "+H+"\n    }\n  "}(p,g):function(b,_){var C=b.name,T=C.charAt(0).toUpperCase()+C.slice(1),S="get"+T+"AtOutCoords",O=b.shapeInfo.logicalShape.length,R=_.logicalShape.length;if(!b.shapeInfo.isUniform&&O===R&&null==b.shapeInfo.flatOffset&&Ut(b.shapeInfo.texShape,_.texShape))return"\n      float "+S+"() {\n        return sampleTexture("+C+", resultUV);\n      }\n    ";var L=vt(R),B=Xi(b.shapeInfo.logicalShape,_.logicalShape),z=R-O,H=["x","y","z","w","u","v"];return"\n    float "+S+"() {\n      "+L+" coords = getOutputCoords();\n      "+(0===O?"":R<2&&B.length>=1?"coords = 0;":B.map(function(G){return"coords."+H[G+z]+" = 0;"}).join("\n"))+"\n      return get"+T+"("+(R<2&&O>0?"coords":b.shapeInfo.logicalShape.map(function(G,q){return"coords."+H[q+z]}).join(", "))+");\n    }\n  "}(p,g)),v}(h,n,r)}).join("\n"),c=n.texShape,l=_n(),d="\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+l.texture2D+"(textureSampler, uv).r;\n    }\n  ",f=(h=l).version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+h.varyingFs+" vec2 resultUV;\n    "+h.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+h.defineSpecialNaN+"\n    "+h.defineSpecialInf+"\n    "+h.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+bG+"\n    "+wG+"\n    "+_G+"\n  ";return n.isPacked?(o=function(h,p){switch(h.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return _=p,1===(C=[Math.ceil(_[0]/2),Math.ceil(_[1]/2)])[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+C[1]+".0);\n      }\n    ":1===C[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+C[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+C[0]+", "+C[1]+"));\n      return 2 * (resTexRC.x * "+C[1]+" + resTexRC.y);\n    }\n  ";case 2:return function(b,_){var C=[Math.ceil(_[0]/2),Math.ceil(_[1]/2)];if(Ut(b,_))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+C[0]+", "+C[1]+"));\n      }\n    ";var T=Math.ceil(b[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+C[0]+", "+C[1]+"));\n\n      int index = resTexRC.x * "+C[1]+" + resTexRC.y;\n      int r = 2 * (index / "+T+");\n      int c = imod(index, "+T+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(h,p);case 3:return g=h,m=p,v=[Math.ceil(m[0]/2),Math.ceil(m[1]/2)],w=(y=Math.ceil(g[2]/2))*Math.ceil(g[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+v[0]+", "+v[1]+"));\n      int index = resTexRC.x * "+v[1]+" + resTexRC.y;\n\n      int b = index / "+w+";\n      index -= b * "+w+";\n\n      int r = 2 * (index / "+y+");\n      int c = imod(index, "+y+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(b,_){for(var C=[Math.ceil(_[0]/2),Math.ceil(_[1]/2)],T=Math.ceil(b[b.length-1]/2),S=T*Math.ceil(b[b.length-2]/2),D=S,I="",O="b, r, c",R=2;R<b.length-1;R++)I="\n      int b"+R+" = index / "+(D*=b[b.length-R-1])+";\n      index -= b"+R+" * "+D+";\n    "+I,O="b"+R+", "+O;return"\n    ivec"+b.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+C[0]+", "+C[1]+"));\n      int index = resTexRC.x * "+C[1]+" + resTexRC.y;\n\n      "+I+"\n\n      int b = index / "+S+";\n      index -= b * "+S+";\n\n      int r = 2 * (index / "+T+");\n      int c = imod(index, "+T+") * 2;\n\n      return ivec"+b.length+"("+O+");\n    }\n  "}(h,p)}var _,C,g,m,v,y,w}(n.logicalShape,c),s=function(h){return"\n    void setOutput(vec4 val) {\n      "+h.output+" = val;\n    }\n  "}(l)):(o=function(h,p){switch(h.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return 1===(y=p)[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+y[1]+".0);\n      }\n    ":1===y[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+y[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+y[0]+", "+y[1]+"));\n      return resTexRC.x * "+y[1]+" + resTexRC.y;\n    }\n  ";case 2:return function(v,y){return Ut(v,y)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+y[0]+", "+y[1]+"));\n      }\n    ":1===v[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+y[0]+", "+y[1]+"));\n        int index = resTexRC.x * "+y[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===v[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+y[0]+", "+y[1]+"));\n        int index = resTexRC.x * "+y[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+y[0]+", "+y[1]+"));\n      int index = resTexRC.x * "+y[1]+" + resTexRC.y;\n      int r = index / "+v[1]+";\n      int c = index - r * "+v[1]+";\n      return ivec2(r, c);\n    }\n  "}(h,p);case 3:return g=p,m=Ss(["r","c","d"],h),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+g[0]+", "+g[1]+"));\n      int index = resTexRC.x * "+g[1]+" + resTexRC.y;\n      "+m+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(v,y){var w=Ss(["r","c","d","d2"],v);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+y[0]+", "+y[1]+"));\n      int index = resTexRC.x * "+y[1]+" + resTexRC.y;\n      "+w+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(h,p);case 5:return function(v,y){var w=Ss(["r","c","d","d2","d3"],v);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+y[0]+",\n                             "+y[1]+"));\n\n      int index = resTexRC.x * "+y[1]+" + resTexRC.y;\n\n      "+w+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(h,p);case 6:return function(v,y){var w=Ss(["r","c","d","d2","d3","d4"],v);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+y[0]+", "+y[1]+"));\n      int index = resTexRC.x * "+y[1]+" + resTexRC.y;\n\n      "+w+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(h,p);default:throw new Error(h.length+"-D output sampling is not yet supported")}var y,g,m}(n.logicalShape,c),s=function(h){return"\n    void setOutput(float val) {\n      "+h.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(l)),r&&(f+=CG),[f,d,s,a,o,u,e].join("\n")}function ou(t){var n=t.shapeInfo.logicalShape;switch(n.length){case 0:return function(e){var r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(e.shapeInfo.isUniform)return"float "+i+"() {return "+r+";}";var o=e.shapeInfo.texShape;if(1===o[0]&&1===o[1])return"\n      float "+i+"() {\n        return sampleTexture("+r+", halfCR);\n      }\n    ";var u=e.shapeInfo.texShape;return"\n    float "+i+"() {\n      vec2 uv = uvFromFlat("+u[0]+", "+u[1]+", "+Ts(r)+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(t);case 1:return function(e){var r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+i+"(int index) {\n        "+su(e)+"\n      }\n    ";var o=e.shapeInfo.texShape,s=o[0],a=o[1];if(1===a&&1===s)return"\n      float "+i+"(int index) {\n        return sampleTexture("+r+", halfCR);\n      }\n    ";var u=Ts(r);return 1===a?"\n      float "+i+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+u+") + 0.5) / "+s+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":1===s?"\n      float "+i+"(int index) {\n        vec2 uv = vec2((float(index + "+u+") + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+i+"(int index) {\n      vec2 uv = uvFromFlat("+s+", "+a+", index + "+u+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(t);case 2:return function(e){var r=e.shapeInfo.logicalShape,i=e.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=e.shapeInfo.texShape;if(null!=s&&Ut(r,s))return"\n    float "+o+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+s[1]+".0, "+s[0]+".0);\n      return sampleTexture("+i+", uv);\n    }\n  ";var c=ko(r),l=c.newShape,d=c.keptDims;if(l.length<r.length)return"\n      "+ou(au(e,l))+"\n      float "+o+"(int row, int col) {\n        return "+o+"("+uu(["row","col"],d)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+r[1]+", 1)));\n        "+su(e)+"\n      }\n    ";var p=s[0],g=s[1],m=Ts(i);return 1===g?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec3(row, col, "+m+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+p+".0);\n      return sampleTexture("+i+", uv);\n    }\n  ":1===p?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec3(row, col, "+m+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+g+".0, 0.5);\n      return sampleTexture("+i+", uv);\n    }\n  ":"\n  float "+o+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+r[1]+" + col + "+m+";\n    vec2 uv = uvFromFlat("+p+", "+g+", index);\n    return sampleTexture("+i+", uv);\n  }\n"}(t);case 3:return function(e){var r=e.shapeInfo.logicalShape,i=e.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[1]*r[2],a=r[2],u=ko(r),c=u.newShape,l=u.keptDims;if(c.length<r.length)return"\n        "+ou(au(e,c))+"\n        float "+o+"(int row, int col, int depth) {\n          return "+o+"("+uu(["row","col","depth"],l)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+s+", "+a+", 1)));\n        "+su(e)+"\n      }\n    ";var h=e.shapeInfo.texShape,p=h[0],g=h[1],m=e.shapeInfo.flatOffset;return g===s&&null==m?"\n        float "+o+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+g+".0, "+p+".0);\n          return sampleTexture("+i+", uv);\n        }\n      ":g===a&&null==m?"\n    float "+o+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+r[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+g+".0, "+p+".0);\n      return sampleTexture("+i+", uv);\n    }\n  ":"\n      float "+o+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+s+" + col * "+a+" + depth + "+Ts(i)+";\n        vec2 uv = uvFromFlat("+p+", "+g+", index);\n        return sampleTexture("+i+", uv);\n      }\n  "}(t);case 4:return function(e){var r=e.shapeInfo.logicalShape,i=e.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[3],a=r[2]*s,u=r[1]*a,c=ko(r),l=c.newShape,d=c.keptDims;if(l.length<r.length)return"\n      "+ou(au(e,l))+"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        return "+o+"("+uu(["row","col","depth","depth2"],d)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+u+", "+a+", "+s+", 1)));\n        "+su(e)+"\n      }\n    ";var h=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,g=p[0],m=p[1];return m===u&&null==h?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+s+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+g+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":m===s&&null==h?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+r[1]*r[2]+", "+r[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+g+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+u+" + col * "+a+" +\n          depth * "+s+" + depth2;\n      vec2 uv = uvFromFlat("+g+", "+m+", index + "+Ts(i)+");\n      return sampleTexture("+i+", uv);\n    }\n  "}(t);case 5:return function(e){var r=e.shapeInfo.logicalShape,i=e.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[4],a=r[3]*s,u=r[2]*a,c=r[1]*u,l=ko(r),d=l.newShape,f=l.keptDims;if(d.length<r.length)return"\n      "+ou(au(e,d))+"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+o+"("+uu(["row","col","depth","depth2","depth3"],f)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+c+", "+u+", "+a+", "+s+")) +\n          depth3;\n        "+su(e)+"\n      }\n    ";var p=e.shapeInfo.flatOffset,g=e.shapeInfo.texShape,m=g[0],v=g[1];return v===c&&null==p?"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+u+", "+a+", "+s+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+m+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":v===s&&null==p?"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]+",\n               "+r[2]*r[3]+", "+r[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+m+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+c+" + col * "+u+" + depth * "+a+" +\n          depth2 * "+s+" + depth3 + "+Ts(i)+";\n      vec2 uv = uvFromFlat("+m+", "+v+", index);\n      return sampleTexture("+i+", uv);\n    }\n  "}(t);case 6:return function(e){var r=e.shapeInfo.logicalShape,i=e.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=ko(r),a=s.newShape,u=s.keptDims;if(a.length<r.length)return"\n      "+ou(au(e,a))+"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+o+"("+uu(["row","col","depth","depth2","depth3","depth4"],u)+");\n      }\n    ";var l=r[5],d=r[4]*l,f=r[3]*d,h=r[2]*f,p=r[1]*h;if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+p+", "+h+", "+f+", "+d+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+l+", 1)));\n        "+su(e)+"\n      }\n    ";var g=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,v=m[0],y=m[1];return y===p&&null==g?"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+h+", "+f+", "+d+", "+l+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+y+".0, "+v+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":y===l&&null==g?"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]*r[4]+",\n               "+r[2]*r[3]*r[4]+",\n               "+r[3]*r[4]+",\n               "+r[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+y+".0, "+v+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+p+" + col * "+h+" + depth * "+f+" +\n          depth2 * "+d+" + depth3 * "+l+" + depth4 + "+Ts(i)+";\n      vec2 uv = uvFromFlat("+v+", "+y+", index);\n      return sampleTexture("+i+", uv);\n    }\n  "}(t);default:throw new Error(n.length+"-D input sampling is not yet supported")}}function KT(t){var n,i,o,s,a,u,c;switch(t.shapeInfo.logicalShape.length){case 0:return"\n    vec4 get"+(n=t.name).charAt(0).toUpperCase()+n.slice(1)+"() {\n      return "+_n().texture2D+"("+n+", halfCR);\n    }\n  ";case 1:return s="get"+(o=(i=t).name).charAt(0).toUpperCase()+o.slice(1),a=i.shapeInfo.texShape,u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=_n(),"\n    vec4 "+s+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+u[0]+", "+u[1]+", index);\n      return "+c.texture2D+"("+o+", uv);\n    }\n  ";case 2:return function(i){var o=i.shapeInfo.logicalShape,s=i.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),u=i.shapeInfo.texShape,c=u[0],l=u[1],d=_n();if(null!=u&&Ut(o,u))return"\n      vec4 "+a+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+l+".0, "+c+".0);\n\n        return "+d.texture2D+"("+s+", uv);\n      }\n    ";var f=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];return"\n    vec4 "+a+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(o[1]/2)+", "+f[0]+", "+f[1]+", row, col);\n      return "+d.texture2D+"("+s+", uv);\n    }\n  "}(t);case 3:return function(i){var o=i.shapeInfo.logicalShape,s=i.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),u=i.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(1===o[0])return"\n        "+KT(au(i,o.slice(1)))+"\n        vec4 "+a+"(int b, int row, int col) {\n          return "+a+"("+uu(["b","row","col"],[1,2])+");\n        }\n      ";var f=c[0],h=c[1],p=Math.ceil(o[2]/2);return"\n    vec4 "+a+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+f+", "+h+", "+p*Math.ceil(o[1]/2)+", "+p+", b, row, col);\n      return "+_n().texture2D+"("+s+", uv);\n    }\n  "}(t);default:return function(i){for(var o=i.shapeInfo.logicalShape,s=o.length,a=i.name,u="get"+a.charAt(0).toUpperCase()+a.slice(1),c=i.shapeInfo.texShape,l=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],d=l[0],f=l[1],h=Math.ceil(o[s-1]/2),p=h*Math.ceil(o[s-2]/2),g="int b, int row, int col",m="b * "+p+" + (row / 2) * "+h+" + (col / 2)",v=2;v<s-1;v++)g="int b"+v+", "+g,m="b"+v+" * "+(p*=o[s-v-1])+" + "+m;return"\n    vec4 "+u+"("+g+") {\n      int index = "+m+";\n      int texR = index / "+f+";\n      int texC = index - texR * "+f+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+f+", "+d+");\n      return "+_n().texture2D+"("+a+", uv);\n    }\n  "}(t)}}var bG="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",wG="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",_G="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",CG="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Ts(t){return"offset"+t}function su(t){var n=t.name,e=ae(t.shapeInfo.logicalShape);return e<2?"return "+n+";":"\n    for (int i = 0; i < "+e+"; i++) {\n      if (i == index) {\n        return "+n+"[i];\n      }\n    }\n  "}function vt(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function au(t,n){var e=JSON.parse(JSON.stringify(t));return e.shapeInfo.logicalShape=n,e}function uu(t,n){return n.map(function(e){return t[e]}).join(", ")}var xG=function(t,n,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,E(t.length>2,function(){return"Packed arg"+(e.charAt(0).toUpperCase()+e.slice(1))+" supports only inputs with rank above 2."});var o=Math.ceil(t[t.length-1]/n);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var s,a,u=this.outputShape,c=u.length,l=vt(c),d=Qn("coords",c);if(1===o){var f=vt(a=c+1);s="\n        "+f+" sourceLocR = "+f+"("+d.join()+", 0);\n        ++"+d[c-1]+";\n        "+f+" sourceLocG = "+f+"("+d.join()+", 0);\n        ++"+d[c-2]+";\n        "+f+" sourceLocA = "+f+"("+d.join()+", 0);\n        --"+d[c-1]+";\n        "+f+" sourceLocB = "+f+"("+d.join()+", 0);\n        --"+d[c-2]+";"}else a=c,s="\n        "+l+" sourceLocR = coords;\n        ++"+d[c-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+d[c-2]+";\n        "+l+" sourceLocA = coords;\n        --"+d[c-1]+";\n        "+l+" sourceLocB = coords;\n        --"+d[c-2]+";";var h=["x","y","z","w","u","v"].slice(0,a),p="."+h[a-1],g=h.map(function(S){return"int "+S}),m=Qn("sourceLocR",a-1).concat("inIdx.r"),v=Qn("sourceLocG",a-1).concat("inIdx.g"),y=Qn("sourceLocB",a-1).concat("inIdx.b"),w=Qn("sourceLocA",a-1).concat("inIdx.a"),b="max"===e?"greaterThan":"lessThan",_=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+w.join()+")));",C="vec4(\n            getAChannel("+m.join()+"),\n            hasNextCol ? getAChannel("+v.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+w.join()+") : 0.)",T=r?"":"\n      float getBestIndicesAChannel("+g.join()+") {\n        return getChannel(getBestIndicesA("+h.join()+"),\n                                          vec2("+h.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+g.join()+") {\n        return getChannel(getA("+h.join()+"),\n                               vec2("+h.slice(-2).join()+"));\n      }\n      "+T+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+d[c-1]+" < "+(u[c-1]-1)+";\n        bool hasNextRow = "+d[c-2]+" < "+(u[c-2]-1)+";\n        "+s+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+n+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+C+";\n\n        for (int i = 0; i < "+n+"; i++) {\n          inIdx = srcIdx;\n          "+_+"\n          vec4 candidate = "+C+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+b+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},EG=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var a=t.effectiveFilterHeight,u=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(a-1-t.padInfo.top)+", "+(u-1-t.padInfo.left)+");\n      const float avgMultiplier = float("+1/(t.filterHeight*t.filterWidth)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+a+";\n            wR += "+t.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+t.dilationWidth+") {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},DG=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var l=t.effectiveFilterDepth,d=t.effectiveFilterHeight,f=t.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(l-1-t.padInfo.front)+", "+(d-1-t.padInfo.top)+", "+(f-1-t.padInfo.left)+");\n      const float avgMultiplier = float("+1/(t.filterDepth*t.filterHeight*t.filterWidth)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+t.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+t.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+d+";\n              wR += "+t.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+f+";\n                wC += "+t.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},IG=function(t,n,e,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],Re(t,n),Re(t,e);var s="0.0";null!=r&&(Re(t,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var a="1.0";null!=i&&(Re(t,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+s+";\n        float scale = "+a+";\n        float inv = scale * inversesqrt(variance + float("+o+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},SG=function(t,n,e,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Re(t,n),Re(t,e);var s="vec4(0.0)";null!=r&&(Re(t,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var a="vec4(1.0)";null!=i&&(Re(t,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = "+s+";\n        vec4 scale = "+a+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+o+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},YT=function(t,n,e){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Re(n,e),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+t+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},n0="return a + b;",r0="return a - b;",XT="return a * b;",ZT="return (a < 0.) ? b * a : a;",Rt=function(t,n,e){this.variableNames=["A","B"],this.outputShape=Re(n,e),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+t+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},QT="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Zi=function(t,n,e,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Re(n,e);var i=this.outputShape.length,o="";if(r)if(0===i||1===ae(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(o="\n          "+vt(i)+" coords = getOutputCoords();\n        ",1===i)o+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var s=Qn("coords",i);o+="\n            bool nextRowOutOfBounds =\n              ("+s[i-2]+" + 1) >= "+this.outputShape[i-2]+";\n            bool nextColOutOfBounds =\n              ("+s[i-1]+" + 1) >= "+this.outputShape[i-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+o+"\n\n        setOutput(result);\n      }\n    "},AG=function(){function t(n){this.variableNames=["A"],this.outputShape=n,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n,e){var r=this;return function(i,o){null==r.minLoc&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,n),i.gl.uniform1f(r.maxLoc,e)}},t}(),RG=function(){function t(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n,e){var r=this;return function(i,o){null==r.minLoc&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,n),i.gl.uniform1f(r.maxLoc,e)}},t}(),OG=function(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},NG=function(t){this.outputShape=[],this.outputShape=Cs(t,1),this.variableNames=t.map(function(a,u){return"T"+u});var n=new Array(t.length-1);n[0]=t[0][1];for(var e=1;e<n.length;e++)n[e]=n[e-1]+t[e][1];var r=["if (yC < "+n[0]+") setOutput(getT0(yR, yC));"];for(e=1;e<n.length;e++)r.push("else if (yC < "+n[e]+") setOutput(getT"+e+"(yR, yC-"+n[e-1]+"));");r.push("else setOutput(getT"+n.length+"(yR, yC-"+n[n.length-1]+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},kG=function(t,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Cs(t,n);var e=this.outputShape,r=e.length,i=vt(r),o=Qn("coords",r),s=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map(function(m,v){return"T"+v});var a=new Array(t.length-1);a[0]=t[0][n];for(var u=1;u<a.length;u++)a[u]=a[u-1]+t[u][n];var c=s[n],l=s.slice(-2),d=s.join(),f="if ("+c+" < "+a[0]+") {\n        return getChannel(\n            getT0("+d+"), vec2("+l.join()+"));\n        }";for(u=1;u<a.length;u++){var h=a[u-1];f+="\n        if ("+c+" < "+a[u]+"  && "+c+" >= "+a[u-1]+") {\n          return getChannel(\n            getT"+u+"("+bh(s,c,h)+"),\n            vec2("+bh(l,c,h)+"));\n        }"}var g=a[a.length-1];f+="\n        return getChannel(\n          getT"+a.length+"("+bh(s,c,g)+"),\n          vec2("+bh(l,c,g)+"));",this.userCode="\n      float getValue("+s.map(function(m){return"int "+m})+") {\n        "+f+"\n      }\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+o+"), 0., 0., 0.);\n\n        "+o[r-1]+" = "+o[r-1]+" + 1;\n        if ("+o[r-1]+" < "+e[r-1]+") {\n          result.g = getValue("+o+");\n        }\n\n        "+o[r-2]+" = "+o[r-2]+" + 1;\n        if ("+o[r-2]+" < "+e[r-2]+") {\n          result.a = getValue("+o+");\n        }\n\n        "+o[r-1]+" = "+o[r-1]+" - 1;\n        if ("+o[r-2]+" < "+e[r-2]+" &&\n            "+o[r-1]+" < "+e[r-1]+") {\n          result.b = getValue("+o+");\n        }\n        setOutput(result);\n      }\n    "};function bh(t,n,e){var r=t.indexOf(n);return t.map(function(i,o){return o===r?i+" - "+e:i}).join()}var PG=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              if ("+("channelsLast"===t.dataFormat)+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},FG=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,e=t.filterWidth,o="channelsLast"===t.dataFormat;this.userCode="\n      const ivec2 pads = ivec2("+(n-1-t.padInfo.top)+", "+(e-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+(o?3:1)+"];\n\n        ivec2 dyCorner = ivec2(coords["+(o?1:2)+"], coords["+(o?2:3)+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+n+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+n+" - 1 - wR;\n\n          for (int wC = 0; wC < "+e+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+e+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n\n              if ("+o+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},LG=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yF = 0; yF < "+t.outDepth+"; yF++) {\n            int xF = wF + yF * "+t.strideDepth+" - "+t.padInfo.front+";\n\n            if (xF < 0 || xF >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n              int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n                int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},BG=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,e=t.filterHeight,r=t.filterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(n-1-t.padInfo.front)+", "+(e-1-t.padInfo.top)+", "+(r-1-t.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+n+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+t.strideDepth+".0;\n\n          if (dyF < 0.0 || dyF >= "+t.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+n+" - 1 - wF;\n\n          for (int wR = 0; wR < "+e+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+e+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},VG=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+t.outChannels/t.inChannels+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},UG=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,e=t.filterWidth,a=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+(n-1-t.padInfo.top)+", "+(e-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+n+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+n+" - 1 - wR;\n\n          for (int wC = 0; wC < "+e+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+e+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+a+"; dm++) {\n              int d2 = d1 * "+a+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},JT=function(t,n,e,r){void 0===n&&(n=!1),void 0===e&&(e=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var i=t.padInfo.top,o=t.padInfo.left,s=t.strideHeight,a=t.strideWidth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterHeight,d=t.filterWidth,f=4*Math.floor(t.inChannels/4),h=t.inChannels%4,p="channelsLast"===t.dataFormat,g=p?1:2,m=p?2:3,v=p?3:1,y="",w="";e&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+e+"\n        }":"\n          float activation(float x) {\n            "+e+"\n          }\n        ",w="result = activation(result);");var b=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+s+", "+a+");\n      const ivec2 pads = ivec2("+i+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+v+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+g+"], coords["+m+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+d+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+t.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+f+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+p+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===h)+") {\n\n              if ("+p+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+f+") *\n                    getW(wR, wC, "+f+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+f+", xR, xC) *\n                    getW(wR, wC, "+f+", d2);\n              }\n\n            } else if ("+(2===h)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+f+", d2),\n                getW(wR, wC, "+f+" + 1, d2)\n              );\n\n              if ("+p+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+f+"),\n                  getX(batch, xR, xC, "+f+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+f+", xR, xC),\n                  getX(batch, "+f+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===h)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+f+", d2),\n                getW(wR, wC, "+f+" + 1, d2),\n                getW(wR, wC, "+f+" + 2, d2)\n              );\n\n              if ("+p+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+f+"),\n                  getX(batch, xR, xC, "+f+" + 1),\n                  getX(batch, xR, xC, "+f+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+f+", xR, xC),\n                  getX(batch, "+f+" + 1, xR, xC),\n                  getX(batch, "+f+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+b+"\n        "+w+"\n        setOutput(result);\n      }\n    "},HG=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,e=t.padInfo.top,r=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,a=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterDepth,d=t.filterHeight,f=t.filterWidth,h=4*Math.floor(t.inChannels/4),p=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+i+", "+o+", "+s+");\n      const ivec3 pads = ivec3("+n+", "+e+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+a+";\n\n          if (xF < 0 || xF >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+d+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+f+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+h+") *\n                  getW(wF, wR, wC, "+h+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1),\n                  getX(batch, xF, xR, xC, "+h+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2),\n                  getW(wF, wR, wC, "+h+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},eM=function(t,n,e,r){void 0===n&&(n=!1),void 0===e&&(e=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var i=t.inHeight,o=t.inWidth,s=t.padInfo.top,a=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,d=t.dilationWidth,f=t.filterHeight,h=t.filterWidth,p=t.outChannels/t.inChannels,g="",m="";e&&(g=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+e+"\n        }":"\n          float activation(float x) {\n            "+e+"\n          }\n        ",m="result = activation(result);");var v=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+g+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+s+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+f+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+i+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+d+";\n\n            if (xC < 0 || xC >= "+o+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+v+"\n        "+m+"\n        setOutput(result);\n      }\n    "},tM=function(t,n,e,r){void 0===n&&(n=!1),void 0===e&&(e=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;for(var i=t.inHeight,o=t.inWidth,s=t.padInfo.top,a=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,d=t.dilationWidth,f=t.filterHeight,h=t.filterWidth,p=h,g="int xR; int xC; int xCOffset;",m=0;m<f;m++)for(var v=0;v<h;v++)g+="\n          vec4 xTexelR"+m+"C"+2*v+" = vec4(0.);\n          vec4 wR"+m+"C"+v+" = vec4(0.);\n          vec4 xR"+m+"C"+v+" = vec4(0.);";for(m=0;m<f;m++)for(var y=0;y<p;y++){if(g+="\n          xR = xRCorner + "+m*l+";\n          xC = xCCorner + "+(v=2*y)*d+";\n        ",1===c){if(v<h&&(g+=a%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+m+"C"+v+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+o+") {\n                    xTexelR"+m+"C"+v+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+m+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+o+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+o+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+m+"C"+v+" = vec4(previous.zw, xTexelR"+m+"C"+v+".xy);\n                } else {\n                  xR"+m+"C"+v+" = vec4(0, 0, xTexelR"+m+"C"+v+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+i+" && xC >= 0 && xC < "+o+") {\n                  xTexelR"+m+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+v+" = vec4(0.);\n                }\n\n                xR"+m+"C"+v+" = xTexelR"+m+"C"+v+";\n              ",v+1<h)){var w=a%2==0?gy(d):d;d%2==0&&a%2==1||d%2!=0&&a%2!=1?(g+="\n                  xCOffset = xC + "+a%2+" + "+w+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+o+") {\n                    xTexelR"+m+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",d>1&&(g+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+i+" &&\n                      xCOffset >= 0 && xCOffset < "+o+") {\n                      xTexelR"+m+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+m+"C"+v+" = vec4(0.);\n                    }\n                  "),g+="\n                  xR"+m+"C"+(v+1)+" = vec4(\n                    xTexelR"+m+"C"+v+".zw, xTexelR"+m+"C"+(v+2)+".xy);\n                "):g+="\n                  xCOffset = xC + "+w+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+o+") {\n                    xTexelR"+m+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+m+"C"+(v+1)+" = xTexelR"+m+"C"+(v+2)+";\n                "}}else v<h&&(g+="\n              if(xR >= 0 && xR < "+i+") {\n            ",a%2==1?(g+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+m+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+v+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+o+") {\n                  xTexelR"+m+"C"+(v+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+m+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+v+" = vec4(\n                  xTexelR"+m+"C"+v+".zw, xTexelR"+m+"C"+(v+2)+".zw);\n              ",v+1<h&&(g+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+o+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+m+"C"+(v+1)+" = vec4(xTexelR"+m+"C"+(v+2)+".xy, final.xy);\n                ")):(g+="\n                if(xC >= 0 && xC < "+o+") {\n                  xTexelR"+m+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+m+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+v+" = vec4(\n                  xTexelR"+m+"C"+v+".xy, xTexelR"+m+"C"+(v+2)+".xy);\n              ",v+1<h&&(g+="\n                  xR"+m+"C"+(v+1)+" = vec4(\n                    xTexelR"+m+"C"+v+".zw, xTexelR"+m+"C"+(v+2)+".zw);\n                ")),g+="}");v<h&&(g+="\n            vec4 wTexelR"+m+"C"+v+" = getW("+m+", "+v+", d1, q);\n            wR"+m+"C"+v+" = vec4(wTexelR"+m+"C"+v+".xz, wTexelR"+m+"C"+v+".xz);\n          ",v+1<h&&(g+="\n              vec4 wTexelR"+m+"C"+(v+1)+" = getW("+m+", "+(v+1)+", d1, q);\n              wR"+m+"C"+(v+1)+" =\n                vec4(wTexelR"+m+"C"+(v+1)+".xz, wTexelR"+m+"C"+(v+1)+".xz);"))}for(m=0;m<f;m++)for(v=0;v<h;v++)g+="dotProd += xR"+m+"C"+v+" * wR"+m+"C"+v+";";var b="",_="";e&&(b=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+e+"\n        }":"vec4 activation(vec4 x) {\n          "+e+"\n        }",_="result = activation(result);");var C=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+b+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+s+", "+a+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+g+"\n\n        vec4 result = dotProd;\n        "+C+"\n        "+_+"\n        setOutput(result);\n      }\n    "},jG=function(t,n,e,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=t[0],s=t[1],a=t[2],l=e[0],d=e[1];this.outputShape=[n[0],l,d,t[3]];var h=[s-1+".0",a-1+".0"],p=h[0],g=h[1],m=l>1?[""+(s-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],b=d>1?[""+(a-1)/(d-1),"(x2-x1) * width_ratio","x1*"+g+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+g];this.userCode="\n      const float height_ratio = float("+m[0]+");\n      const float width_ratio = float("+b[0]+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+o+") {\n          return;\n        }\n\n        float height_scale = "+m[1]+";\n        float width_scale = "+b[1]+";\n\n        float in_y = "+m[2]+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n        float in_x = "+b[2]+";\n        if( in_x < 0.0 || in_x > "+g+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+("bilinear"===r?1:0)+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},WG=function(t,n,e){this.variableNames=["x"],this.outputShape=t;var r=t.length,i=t[t.length-1],o=e?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(e?"return "+i+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+vt(r)+" coords = getOutputCoords();\n        int end = "+nM(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+i+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+o+" end) {\n            continue;\n          }\n          if (idx == end && "+n+") {\n            continue;\n          }\n          "+nM(r,"coords")+" = idx;\n          val += getX("+function(s,a){if(1===s)return""+a;if(2===s)return a+".x, "+a+".y";if(3===s)return a+".x, "+a+".y, "+a+".z";if(4===s)return a+".x, "+a+".y, "+a+".z, "+a+".w";throw Error("Cumulative sum for rank "+s+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function nM(t,n){if(1===t)return""+n;if(2===t)return n+".y";if(3===t)return n+".z";if(4===t)return n+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}var zG=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=rl.DENSE;var n=il(t),e=_n();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Ss(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+n[0]+", "+n[1]+"));\n        int index = 4 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+e.output+" = result;\n      }\n    "},GG=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=rl.DENSE;var n=il(t),e=_n();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Ss(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+n[0]+", "+n[1]+"));\n        int index = 4 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+e.output+" = result;\n      }\n    "},$G=function(){function t(n,e,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=n,this.blockSize=e,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+e+";\n      int offset_h = imod(h, "+e+");\n      int in_w = w / "+e+";\n      int offset_w = imod(w, "+e+");\n      int offset_d = (offset_h * "+e+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return t.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}(),qG=function(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},KG=function(t){this.variableNames=["A"],this.outTexUsage=cr.DOWNLOAD;var n=_n();this.outputShape=t,this.userCode="\n      "+qT+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+n.output+" = encode_float(x);\n      }\n    "},YG=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=cr.DOWNLOAD;var n=_n();this.outputShape=t,this.userCode="\n      "+qT+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+n.output+" = encode_float(x);\n      }\n    "},XG=function(t,n,e){void 0===e&&(e=!1),this.variableNames=["A"];var r=_n(),i=n[0],o=n[1];this.outputShape=t;var s="result";e&&(s="floor(result * 255. + 0.5)"),this.userCode="\n      "+t0(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+o+";\n        int c = imod(flatIndex, "+o+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+o+".0, "+i+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+s+", 0., 0., 0.);\n      }\n    "},ZG=function(t,n,e){void 0===e&&(e=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=_n(),i=n[0],o=n[1];this.outputShape=t;var s="",a="result";e&&(a="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;s+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+t[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+u+" < "+t[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+o+";\n              c = imod(flatIndex, "+o+");\n              uv = (vec2(c, r) + halfCR) / vec2("+o+".0, "+i+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+t0(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+s+"\n\n        "+r.output+" = "+a+";\n      }\n    "},rM=function(t,n,e){this.variableNames=["real","imag"];var r=n[1];this.outputShape=n;var i=e?"2.0 * "+Math.PI:"-2.0 * "+Math.PI;this.userCode="\n      const float exponentMultiplier = "+i+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+t+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+(e?r+".0":"1.0")+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},e$=function(){function t(n,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=n,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n){var e=this;return function(r,i){null==e.valueLoc&&(e.valueLoc=r.getUniformLocationNoThrow(i,"value")),r.gl.uniform1f(e.valueLoc,n)}},t}(),t$=function(t,n,e){this.variableNames=["A","indices"];var r=t.slice();r[e]=n,this.outputShape=r,this.rank=r.length;var i=vt(this.rank),o=function(s,a){var u=s.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(1===u)return"int(getIndices(resRC))";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],d=0;d<s.length;d++)l.push(d===a?"int(getIndices("+c[d]+"))":""+c[d]);return l.join()}(t,e);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "},n$=function(t,n,e){this.sliceDim=t,this.strides=n,this.variableNames=["x","indices"],this.outputShape=e;var r=vt(n.length),i=vt(e.length);this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+i+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+(this.sliceDim>1?"strides[j]":"strides")+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function iM(t,n){var e=_n();return J2(t,n,e.version+"\n    precision highp float;\n    "+e.attribute+" vec3 clipSpacePos;\n    "+e.attribute+" vec2 uv;\n    "+e.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function oM(t,n){return rT(t,n,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function sM(t,n){return iT(t,n,new Uint16Array([0,1,2,2,1,3]))}function ml(t,n,e,r,i,o,s){sT(e,r);var a=oT(t,n),u=t.TEXTURE_2D;return ne(t,n,function(){return t.bindTexture(u,a)}),ne(t,n,function(){return t.texParameteri(u,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)}),ne(t,n,function(){return t.texParameteri(u,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}),ne(t,n,function(){return t.texParameteri(u,t.TEXTURE_MIN_FILTER,t.NEAREST)}),ne(t,n,function(){return t.texParameteri(u,t.TEXTURE_MAG_FILTER,t.NEAREST)}),ne(t,n,function(){return t.texImage2D(u,0,i,e,r,0,o,s,null)}),ne(t,n,function(){return t.bindTexture(t.TEXTURE_2D,null)}),a}function aM(t,n,e,r,i){var o=Qf(e,r);return ml(t,n,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,t.FLOAT)}function uM(t,n,e,r,i){var o=Qf(e,r);return ml(t,n,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function cM(t,n,e,r,i){var o=Qf(e,r);return ml(t,n,o[0],o[1],t.RGBA,t.RGBA,t.UNSIGNED_BYTE)}function lM(t,n,e,r,i){var o=ol(e,r);return ml(t,n,o[0],o[1],i.internalFormatPackedFloat,t.RGBA,t.FLOAT)}function dM(t,n,e,r,i){var o=ol(e,r);return ml(t,n,o[0],o[1],i.internalFormatPackedHalfFloat,t.RGBA,i.textureTypeHalfFloat)}function fM(t,n,e,r){return ne(t,n,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),Ny(t,n,e,"clipSpacePos",r,3,20,0)&&Ny(t,n,e,"uv",r,2,20,12)}function hM(t,n,e,r,i,o,s){var a,u,c;ne(t,n,function(){return t.bindTexture(t.TEXTURE_2D,e)}),o instanceof Uint8Array?(a=new Uint8Array(r*i*4),u=t.UNSIGNED_BYTE,c=t.RGBA):(a=new Float32Array(r*i*4),u=t.FLOAT,c=s.internalFormatPackedFloat),a.set(o),ne(t,n,function(){return t.texImage2D(t.TEXTURE_2D,0,c,r,i,0,t.RGBA,u,a)}),ne(t,n,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function pM(t,n,e,r){ne(t,n,function(){return t.bindTexture(t.TEXTURE_2D,e)}),r.data instanceof Uint8Array?ne(t,n,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r.width,r.height,0,t.RGBA,t.UNSIGNED_BYTE,r.data)}):ne(t,n,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)}),ne(t,n,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function gM(t,n,e,r,i){var o=t.createBuffer();ne(t,n,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,o)});var s=16*e*r;return ne(t,n,function(){return t.bufferData(t.PIXEL_PACK_BUFFER,s,t.STREAM_READ)}),ne(t,n,function(){return t.readPixels(0,0,r,e,t.RGBA,t.FLOAT,0)}),ne(t,n,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}),o}function mM(t,n,e){var r=t,i=new Float32Array(e);return r.bindBuffer(r.PIXEL_PACK_BUFFER,n),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function vM(t,n,e,r,i){var o=Qf(e,r),s=o[0],a=o[1],u=new Uint8Array(e*r*4);return ne(t,n,function(){return t.readPixels(0,0,s,a,i.downloadTextureFormat,t.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function yM(t,n,e,r,i,o,s,a){var f,u=t,c=new Float32Array((f=ol(o,s))[0]*f[1]*4);return u.bindBuffer(u.PIXEL_PACK_BUFFER,n),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function bM(t,n,e,r){var i=new Float32Array(e*r*4);return ne(t,n,function(){return t.readPixels(0,0,r,e,t.RGBA,t.FLOAT,i)}),i}var r$=Object.freeze({createVertexShader:iM,createVertexBuffer:oM,createIndexBuffer:sM,createFloat32MatrixTexture:aM,createFloat16MatrixTexture:uM,createUnsignedBytesMatrixTexture:cM,createPackedMatrixTexture:lM,createFloat16PackedMatrixTexture:dM,bindVertexProgramAttributeStreams:fM,uploadDenseMatrixToTexture:hM,uploadPixelDataToTexture:pM,createBufferFromOutputTexture:gM,downloadFloat32MatrixFromBuffer:mM,downloadByteEncodedFloatMatrixFromOutputTexture:vM,downloadPackedMatrixFromBuffer:yM,downloadMatrixFromPackedOutputTexture:bM}),wM=function(){function t(n){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=P().getNumber("WEBGL_VERSION");null!=n?(this.gl=n,X2(e,n)):this.gl=gi(e);var r="WEBGL_color_buffer_float";if(1===P().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=sl(this.gl,this.debug,"OES_texture_float"),dr(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=sl(this.gl,this.debug,"OES_texture_half_float");else if(P().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),dr(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=sl(this.gl,this.debug,"EXT_color_buffer_half_float");else if(P().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(dr(this.gl,r="EXT_color_buffer_float"))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!dr(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=oM(this.gl,this.debug),this.indexBuffer=sM(this.gl,this.debug),this.framebuffer=aT(this.gl,this.debug),this.textureConfig=Oy(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(t.prototype,"debug",{get:function(){return P().getBool("DEBUG")},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var n=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;ne(e,this.debug,function(){return e.finish()}),ne(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),ne(e,this.debug,function(){return e.deleteFramebuffer(n.framebuffer)}),ne(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),ne(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),ne(e,this.debug,function(){return e.deleteBuffer(n.indexBuffer)}),this.disposed=!0}},t.prototype.createFloat32MatrixTexture=function(n,e){return this.throwIfDisposed(),aM(this.gl,this.debug,n,e,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(n,e){return this.throwIfDisposed(),uM(this.gl,this.debug,n,e,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(n,e){return this.throwIfDisposed(),cM(this.gl,this.debug,n,e)},t.prototype.uploadPixelDataToTexture=function(n,e){this.throwIfDisposed(),pM(this.gl,this.debug,n,e)},t.prototype.uploadDenseMatrixToTexture=function(n,e,r,i){this.throwIfDisposed(),hM(this.gl,this.debug,n,e,r,i,this.textureConfig)},t.prototype.createFloat16PackedMatrixTexture=function(n,e){return this.throwIfDisposed(),dM(this.gl,this.debug,n,e,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(n,e){return this.throwIfDisposed(),lM(this.gl,this.debug,n,e,this.textureConfig)},t.prototype.deleteMatrixTexture=function(n){var e=this;this.throwIfDisposed(),this.outputTexture===n&&(ky(this.gl,this.debug,this.framebuffer),this.outputTexture=null),ne(this.gl,this.debug,function(){return e.gl.deleteTexture(n)})},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(n,e,r){var i=this;return this.downloadMatrixDriver(n,function(){return vM(i.gl,i.debug,e,r,i.textureConfig)})},t.prototype.downloadPackedMatrixFromBuffer=function(n,e,r,i,o,s){return yM(this.gl,n,0,0,0,o,s)},t.prototype.downloadFloat32MatrixFromBuffer=function(n,e){return mM(this.gl,n,e)},t.prototype.createBufferFromTexture=function(n,e,r){this.bindTextureToFrameBuffer(n);var i=gM(this.gl,this.debug,e,r);return this.unbindTextureToFrameBuffer(),i},t.prototype.createAndWaitForFence=function(){var n=this.createFence(this.gl);return this.pollFence(n)},t.prototype.createFence=function(n){var e,r,i=this;if(P().getBool("WEBGL_FENCE_API_ENABLED")){var o=n,s=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);n.flush(),r=function(){var a=o.clientWaitSync(s,0,0);return a===o.ALREADY_SIGNALED||a===o.CONDITION_SATISFIED},e=s}else P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),r=function(){return i.isQueryAvailable(e,P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:e,isFencePassed:r}},t.prototype.downloadMatrixFromPackedTexture=function(n,e,r){var i=this;return this.downloadMatrixDriver(n,function(){return bM(i.gl,i.debug,e,r)})},t.prototype.createProgram=function(n){this.throwIfDisposed();var e=this.gl,r=eT(e,this.debug,n),i=iM(e,this.debug),o=tT(e,this.debug);return ne(e,this.debug,function(){return e.attachShader(o,i)}),ne(e,this.debug,function(){return e.attachShader(o,r)}),nT(e,this.debug,o),this.debug&&th(e,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=fM(e,this.debug,this.program,this.vertexBuffer)),o},t.prototype.deleteProgram=function(n){var e=this;this.throwIfDisposed(),n===this.program&&(this.program=null),null!=n&&ne(this.gl,this.debug,function(){return e.gl.deleteProgram(n)})},t.prototype.setProgram=function(n){var e=this;this.throwIfDisposed(),this.program=n,null!=this.program&&this.debug&&th(this.gl,this.debug,this.program),ne(this.gl,this.debug,function(){return e.gl.useProgram(n)})},t.prototype.getUniformLocation=function(n,e,r){return void 0===r&&(r=!0),this.throwIfDisposed(),r?cT(this.gl,this.debug,n,e):lT(this.gl,n,e)},t.prototype.getAttributeLocation=function(n,e){var r=this;return this.throwIfDisposed(),ne(this.gl,this.debug,function(){return r.gl.getAttribLocation(n,e)})},t.prototype.getUniformLocationNoThrow=function(n,e){return this.throwIfDisposed(),this.gl.getUniformLocation(n,e)},t.prototype.setInputMatrixTexture=function(n,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),dT(this.gl,this.debug,0,n,e,r)},t.prototype.setOutputMatrixTexture=function(n,e,r){this.setOutputMatrixTextureDriver(n,r,e)},t.prototype.setOutputPackedMatrixTexture=function(n,e,r){this.throwIfDisposed();var i=ol(e,r);this.setOutputMatrixTextureDriver(n,i[0],i[1])},t.prototype.setOutputMatrixWriteRegion=function(n,e,r,i){this.setOutputMatrixWriteRegionDriver(r,n,i,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(n,e,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&th(this.gl,this.debug,this.program),al(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var n=this.gl;this.debug&&this.debugValidate(),ne(n,this.debug,function(){return n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var n=this;this.throwIfDisposed(),ne(this.gl,this.debug,function(){return n.gl.finish()})},t.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=sl(this.gl,this.debug,2===P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(2===P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var n=this.gl,e=this.getQueryTimerExtensionWebGL2(),r=n.createQuery();return n.beginQuery(e.TIME_ELAPSED_EXT,r),r}var i=this.getQueryTimerExtensionWebGL1(),o=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,o),o},t.prototype.endQuery=function(){if(2!==P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)}else{var e=this.gl,r=this.getQueryTimerExtensionWebGL2();e.endQuery(r.TIME_ELAPSED_EXT)}},t.prototype.waitForQueryAndGetTime=function(n){return ie(this,void 0,void 0,function(){var e=this;return oe(this,function(r){switch(r.label){case 0:return[4,my(function(){return e.disposed||e.isQueryAvailable(n,P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(n,P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},t.prototype.getQueryTime=function(n,e){if(0===e)return null;if(2===e){var r=this.gl;return r.getQueryParameter(n,r.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(n,i.QUERY_RESULT_EXT)/1e6},t.prototype.isQueryAvailable=function(n,e){if(0===e)return!0;if(2===e){var r=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(n,r.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(n,i.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint},t.prototype.pollFence=function(n){var e=this;return new Promise(function(r){e.addItemToPoll(function(){return n.isFencePassed()},function(){return r()})})},t.prototype.pollItems=function(){for(var n=function(r){for(var i=0;i<r.length&&r[i]();++i);return i-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),e=0;e<=n;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(n+1)},t.prototype.addItemToPoll=function(n,e){var r=this;this.itemsToPoll.push({isDoneFn:n,resolveFn:e}),this.itemsToPoll.length>1||my(function(){return r.pollItems(),0===r.itemsToPoll.length})},t.prototype.bindTextureToFrameBuffer=function(n){this.throwIfDisposed(),nh(this.gl,this.debug,n,this.framebuffer),this.debug&&al(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(nh(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&al(this.gl)):ky(this.gl,this.debug,this.framebuffer)},t.prototype.downloadMatrixDriver=function(n,e){this.bindTextureToFrameBuffer(n);var r=e();return this.unbindTextureToFrameBuffer(),r},t.prototype.setOutputMatrixTextureDriver=function(n,e,r){this.throwIfDisposed();var i=this.gl;nh(i,this.debug,n,this.framebuffer),this.debug&&al(i),this.outputTexture=n,ne(i,this.debug,function(){return i.viewport(0,0,e,r)}),ne(i,this.debug,function(){return i.scissor(0,0,e,r)})},t.prototype.setOutputMatrixWriteRegionDriver=function(n,e,r,i){var o=this;this.throwIfDisposed(),ne(this.gl,this.debug,function(){return o.gl.scissor(n,e,r,i)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}();function _M(t,n){if(t.length!==n.length)throw Error("Binary was compiled with "+t.length+" inputs, but was executed with "+n.length+" inputs");t.forEach(function(e,r){var i=e.logicalShape,o=n[r],s=o.shape;if(!Ut(i,s))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+s+" must match");if(!e.isUniform||!o.isUniform){var a=e.texShape,u=o.isUniform?null:o.texData.texShape;if(!Ut(a,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+u+" must match")}})}var i$=function(t,n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var i=e.inChannels,o=e.strideWidth,s=e.strideHeight,a=e.padInfo,u=e.outWidth,c=e.dilationWidth,l=e.dilationHeight,d=e.dataFormat,f=a.left,h=a.top,p=i*e.filterWidth,g=_n(),m="channelsLast"===d,v=m?0:1,y=m?1:2,w="",b=0;b<=1;b++)for(var _=0;_<=1;_++)w+="\n          blockIndex = rc.y + "+_+";\n          pos = rc.x + "+b+";\n\n          if(blockIndex < "+t[1]+" && pos < "+t[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+s+" - "+h+";\n            d0 = offsetY + "+l+" * (pos / "+p+");\n\n            if(d0 < "+n[v]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+o+". - "+f+".);\n              d1 = offsetX + "+c+" * (int(mod(float(pos), "+p+".) / "+i+".));\n\n              if(d1 < "+n[y]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+i+".));\n\n                if ("+m+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*b+_)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*b+_)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+w+"\n\n        "+g.output+" = result;\n      }\n    "},o$=function(t,n,e,r,i){this.variableNames=["x"],this.outputShape=[];var s=n,a=t[3]-1;this.outputShape=t;var u="float("+e+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+s+"; j <= "+s+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+a+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+(.5===i?"inversesqrt("+u+")":1===i?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));")+";\n        setOutput(val);\n      }\n    "},s$=function(t,n,e,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=e,this.alpha=r,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+n+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+n+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+e+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+i+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+i+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},a$=function(t,n,e,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var s=n,a=t[3]-1;this.outputShape=t;var u="float("+e+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+s+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+s+"; j <= "+s+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+a+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+(.5===i?"inversesqrt("+u+")":1===i?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));")+";\n        setOutput(result);\n      }\n    "},u$=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var i=t.effectiveFilterHeight,o=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(i-1-t.padInfo.top)+", "+(o-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+i+";\n          wR += "+t.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+o+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+(i*o-1)+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+o+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},c$=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var a=t.effectiveFilterDepth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(a-1-t.padInfo.front)+", "+(u-1-t.padInfo.top)+", "+(c-1-t.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+a+";\n           wD += "+t.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+t.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+t.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+t.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+(a*u*c-1)+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+c+" +\n                  wR * "+c+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},o0=function(t,n,e,r,i,o,s){void 0===e&&(e=!1),void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===o&&(o=null),void 0===s&&(s=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;var u=Math.ceil((e?t[1]:t[2])/2),c=e?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",d=e?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",p="";o&&(h=s?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+o+"\n        }":"vec4 activation(vec4 x) {\n          "+o+"\n        }",p="result = activation(result);");var g=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+h+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+c+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+d[0]+" * "+f[0]+");\n          result += ("+d[1]+" * "+f[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+g+"\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "},l$=function(){function t(n,e,r){this.variableNames=["probs"],this.outputShape=[n,r],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(e-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(e-1)+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n){var e=this;return function(r,i){null==e.seedLoc&&(e.seedLoc=r.getUniformLocation(i,"seed")),r.gl.uniform1f(e.seedLoc,n)}},t}(),d$=function(t,n,e,r){this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+e+"),\n                      float(index == coords.y)));\n      }\n    "},f$=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;var a,c,l,n=t.length;if(0===n)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var e=Qn("rc",n),r=vt(n),i=function(a,u,c){if(1===a)return"rc > "+u[0];for(var l="",d=a-2;d<a;d++)l+=c[d]+" >= "+u[d],d<a-1&&(l+="||");return l}(n,t,e),o=function(a,u,c,l){if(1===a)return"";var d=l.slice(-2);return"\n    int r = "+d[0]+";\n    int c = "+d[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+u+";\n    bool rEdge = rp1 >= "+c+";\n  "}(n,t[t.length-1],t[t.length-2],e),s=(l=function(d,f){for(var h=[],p=0;p<=1;p++)for(var g=0;g<=1;g++){for(var m=(0===p?"r":"rp1")+", "+(0===g?"c":"cp1"),v=2;v<d;v++)m=f[f.length-1-v]+","+m;h.push(m)}return h}(c=(a=t).length,e),1===c?"getA(rc),\n            rc + 1 >= "+a[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+l[0]+"),\n          cEdge ? 0. : getA("+l[1]+"),\n          rEdge ? 0. : getA("+l[2]+"),\n          rEdge || cEdge ? 0. : getA("+l[3]+")");this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+i+") {\n            setOutput(vec4(0));\n          } else {\n            "+o+"\n\n            setOutput(vec4("+s+"));\n          }\n        }\n      "}},h$=function(t,n,e){this.variableNames=["x"],this.outputShape=n.map(function(u,c){return u[0]+t[c]+u[1]});var r=t.length,i=vt(r),o=n.map(function(u){return u[0]}).join(","),s=n.map(function(u,c){return u[0]+t[c]}).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+i+" start = "+i+"("+o+");\n      "+i+" end = "+i+"("+s+");\n\n      void main() {\n        "+i+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+e+"));\n        } else {\n          "+i+" coords = outC - start;\n          setOutput(getX("+a+"));\n        }\n      }\n    ":"\n        int start = "+o+";\n        int end = "+s+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+e+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},p$=function(t,n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map(function(m,v){return m[0]+t[v]+m[1]});for(var r=t.length,i=vt(r),o=n.map(function(m){return m[0]}).join(","),s=n.map(function(m,v){return m[0]+t[v]}).join(","),a=Qn("rc",r),u=Qn("source",r),c=a[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+u.slice(-2).join()+")",d=[i+" rc = outputLoc;",a[r-1]+" += 1;\n       if("+c+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+a[r-2]+" += 1;\n       if("+a[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+a[r-1]+" += 1;\n         if("+c+") {"],f=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",p=0,g=1===r?2:4;p<g;p++)h+="\n        "+d[p]+"\n        if ("+f+") {\n          result["+p+"] = float("+e+");\n        } else {\n          "+i+" source = rc - start;\n          result["+p+"] = getChannel(getX("+u.join()+"), "+l+");\n        }\n      ";this.userCode="\n      const "+i+" start = "+i+"("+o+");\n      const "+i+" end = "+i+"("+s+");\n\n      void main() {\n        "+i+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+(h+=1===r?"} ":"}}")+"\n        setOutput(result);\n      }\n    "},s0=function(t,n,e){if(this.variableNames=["x"],"avg"===n&&e)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,i=t.strideHeight,o=t.strideWidth,s=t.dilationHeight,a=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=t.padInfo.top,d=t.padInfo.left;this.outputShape=t.outShape;var f="avg"===n,h="0.0";if(f||(h="-1.0 / 1e-20"),e)this.userCode="\n        const ivec2 strides = ivec2("+i+", "+o+");\n        const ivec2 pads = ivec2("+l+", "+d+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+s+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+a+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+c+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var p=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(p="avgValue / count");var g=4*Math.floor(r/4),m=r%4,v="\n      if ("+f+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+i+", "+o+");\n      const ivec2 pads = ivec2("+l+", "+d+");\n      const float initializationValue = "+h+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+h+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+s+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+g+"; wC += 4) {\n            int xC = xCCorner + wC * "+a+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+a+", d),\n              getValue(batch, xR, xC + 2 * "+a+", d),\n              getValue(batch, xR, xC + 3 * "+a+", d)\n            );\n\n            "+v+"\n          }\n\n          int xC = xCCorner + "+g+";\n          if ("+(1===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(2===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+a+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(3===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+a+", d),\n              getValue(batch, xR, xC + 2 * "+a+", d),\n              initializationValue\n            );\n\n            "+v+"\n          }\n        }\n        setOutput("+p+");\n      }\n    "}},a0=function(t,n,e){if(this.variableNames=["x"],"avg"===n&&e)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,a=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,d=t.effectiveFilterHeight,f=t.effectiveFilterWidth,h=t.padInfo.front,p=t.padInfo.top,g=t.padInfo.left;this.outputShape=t.outShape;var m="avg"===n,v="0.0";if(m||(v="-1.0 / 1e-20"),e)this.userCode="\n        const ivec3 strides =\n            ivec3("+i+", "+o+", "+s+");\n        const ivec3 pads = ivec3("+h+", "+p+", "+g+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+l+";\n              wD += "+a+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+d+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+f+";\n                  wC += "+c+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+d+" * "+f+" +\n                      wR * "+f+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(y="avgValue / count");var w=4*Math.floor(r/4),b=r%4,_="\n      if ("+m+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+i+", "+o+", "+s+");\n      const ivec3 pads = ivec3("+h+", "+p+", "+g+");\n      const float initializationValue = "+v+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+v+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+a+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+d+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+w+"; wC += 4) {\n              int xC = xCCorner + wC * "+c+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+c+", ch)\n              );\n\n              "+_+"\n            }\n\n            int xC = xCCorner + "+w+";\n            if ("+(1===b)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+_+"\n            } else if ("+(2===b)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+_+"\n            } else if ("+(3===b)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                initializationValue\n              );\n\n              "+_+"\n            }\n          }\n          setOutput("+y+");\n        }\n      }\n    "}},g$=function(t,n){this.variableNames=["x"];var e=t.windowSize,r=t.batchSize,i=t.inSize,o=Math.ceil(i/e);this.outputShape=[r,o];var s="0.0",a="";"prod"===n?s="1.0":"min"===n?(s="1.0 / 1e-20",a="min"):"max"===n&&(s="-1.0 / 1e-20",a="max");var u=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===n?u="sumValue":"prod"===n?u="prodValue":"all"===n?u="allValue":"any"===n&&(u="anyValue");var c=4*Math.floor(e/4),l=e%4,d="\n      if ("+("sum"===n)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===n)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+a+"(values, minMaxValue);\n      }\n    ",f="vec4";"all"===n?(s="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",f="bvec4"):"any"===n&&(s="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",f="bvec4");var h="";i%e>0&&(h="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+s+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+h+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+e+";\n\n        vec4 minMaxValue = vec4("+s+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+d+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+d+"\n        } else if ("+(2===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+d+"\n        } else if ("+(3===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+d+"\n        }\n        setOutput("+u+");\n      }\n    "},m$=function(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var e="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),e+="\n        "+i+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+Ss(["r","c","d"],n)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+t0(t)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+t[1]+";\n        int cols = "+t[2]+";\n\n        "+e+"\n\n        setOutput(result);\n      }\n    "},v$=function(t,n,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var r=n.shape,i=r[1],o=r[2],s=t.shape,a=s[1],u=s[2],c=[e&&a>1?i-1:i,e&&u>1?o-1:o],l=[e&&a>1?a-1:a,e&&u>1?u-1:u],d=c[0]/l[0],f=c[1]/l[1],h=1/d,p=1/f,g=2*Math.ceil(h)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+f+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+g+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+a+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(i-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(o-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},y$=function(t,n,e,r){this.variableNames=["A"],this.outputShape=[];var o=t[1],s=t[2];this.outputShape=[t[0],n,e,t[3]];var u=[r&&n>1?o-1:o,r&&e>1?s-1:s],c=[r&&n>1?n-1:n,r&&e>1?e-1:e];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+s+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},b$=function(t,n,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=t[1],s=t[2],a=t[3];this.outputShape=[t[0],n,e,a];var u=[r&&n>1?o-1:o,r&&e>1?s-1:s],c=[r&&n>1?n-1:n,r&&e>1?e-1:e];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+",\n          "+u[1]/c[1]+");\n      const vec3 inputShapeRC = vec3("+o+".0, "+s+".0,\n                                     "+s+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(a-1)+";\n        bool hasNextRow = coords.z < "+(e-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},w$=function(t,n,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var r=n.shape,i=r[1],o=r[2],s=t.shape,a=s[1],u=s[2],c=[e&&a>1?i-1:i,e&&u>1?o-1:o],l=[e&&a>1?a-1:a,e&&u>1?u-1:u],d=c[0]/l[0],f=c[1]/l[1],h=1/d,p=1/f,g=2*Math.ceil(h)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+f+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+g+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+a+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+i+") - 1),\n                "+e+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+o+") - 1),\n                "+e+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},_$=function(t,n,e,r){this.variableNames=["A"],this.outputShape=[];var o=t[1],s=t[2];this.outputShape=[t[0],n,e,t[3]];var u=[r&&n>1?o-1:o,r&&e>1?s-1:s],c=[r&&n>1?n-1:n,r&&e>1?e-1:e];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+s+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+(r?"0.5":"0.0")+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},C$=function(t,n){this.variableNames=["x"];var e=t.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");if(this.outputShape=t,1!==e){var r=t.map(function(o,s){return-1!==n.indexOf(a=s)&&1!==t[a]?t[a]+" - coords["+a+"] - 1":"coords["+a+"]";var a}).join(","),i=vt(e);this.userCode="\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+t[0]+" - coord - 1));\n        }\n      "},x$=function(t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var e=t.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");this.outputShape=t;var u,r=Qn("rc",e),i=r[e-1]+" + 1 < "+this.outputShape[e-1],o=r[e-2]+" + 1 < "+this.outputShape[e-2],s=vt(e);function a(u){var c=t.map(function(l,d){return h=u,-1!==n.indexOf(f=d)&&1!==t[f]?t[f]+" - "+h[f]+" - 1":""+h[f];var f,h});return"getChannel(getX("+c.join(",")+"), vec2("+c.slice(-2).join(",")+"))"}this.userCode=1===e?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+t[0]+" - rc - 1),\n            "+t[0]+" - rc - 1);\n          if("+i+"){\n              result.g = getChannel(getX("+t[0]+" - (rc  + 1) - 1),\n                "+t[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+s+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+a(r.slice())+";\n          if("+i+"){\n            result.g = "+((u=r.slice())[e-1]="("+u[e-1]+" + 1)",a(u)+";\n          }\n          if(")+o+") {\n            result.b = "+function(u){return u[e-2]="("+u[e-2]+" + 1)",a(u)}(r.slice())+";\n            if("+i+") {\n              result.a = "+function(u){return u[e-1]="("+u[e-1]+" + 1)",u[e-2]="("+u[e-2]+" + 1)",a(u)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},CM=function(t,n,e,r,i,o,s){void 0===s&&(s=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var a=vt(i.length),u=vt(o.length),c="";1===e?c="i":2===e&&(c="i, j");var d="";1===r?d="i":2===r&&(d="i, coords[1]"),this.userCode="\n        "+a+" strides = "+a+"("+i+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+t+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+n+"; j++) {\n              int index = round(getIndices("+c+"));\n              flattenedIndex += index * "+(n>1?"strides[j]":"strides")+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates("+d+");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},E$=function(t,n){this.variableNames=["x","segmentIds"];var e=t.windowSize,r=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/e);this.outputShape=[r,s];var a=4*Math.floor(e/4),u=e%4,c="\n        sumValue += dot(values, segFilter);\n    ",l="";i%e>0&&(l="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      ");var d="";i%e>0&&(d="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+d+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+o+")) * float("+e+"));\n        int currentSeg = int(mod(float(outIdx), float("+o+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+a+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+a+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "},D$=function(t,n,e){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=n,e>4)throw Error("Where for rank "+e+" is not yet supported");if(1===e)i="resRC",r="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],a=[],u=0;u<n.length;u++)a.push(""+o[u]),u<t&&s.push(""+o[u]);r=s.join(),i=a.join()}var c=vt(e);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+i+"));\n        } else {\n          setOutput(getB("+i+"));\n        }\n      }\n    "},I$=function(){function t(n){this.variableNames=["source"],this.outputShape=n,this.rank=n.length;var e,r=vt(this.rank),i="uniform int start["+this.rank+"];",o=function(s){if(1===s)return"sourceLoc";if(s<=6)return u0.slice(0,s).map(function(a){return"sourceLoc."+a}).join(",");throw Error("Slicing for rank "+s+" is not yet supported")}(this.rank);e="\n        "+r+" sourceLoc;\n        "+r+" coords = getOutputCoords();\n        "+n.map(function(s,a){return"sourceLoc."+u0[a]+" = start["+a+"] + coords."+u0[a]+";"}).join("\n")+"\n      ",this.userCode="\n      "+i+"\n      void main() {\n        "+e+"\n        setOutput(getSource("+o+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n){var e=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(r,i){null==e.startLoc&&(e.startLoc=r.getUniformLocationNoThrow(i,"start"),null==e.startLoc)||r.gl.uniform1iv(e.startLoc,n)}},t}(),u0=["x","y","z","w","u","v"],S$=function(){function t(n){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.rank=n.length;var e=vt(this.rank),r=Qn("coords",this.rank),i=Qn("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2("+i.slice(-2).join()+")",s="getChannel(getSource("+i.join()+"), "+o+")",a="\n      result.x = "+s+";\n      if (++"+r[this.rank-1]+" < "+n[this.rank-1]+") {\n        ++"+i[this.rank-1]+";\n        result.y = "+s+";\n        --"+i[this.rank-1]+";\n      }\n    ",u=1===this.rank?"":"\n      --"+r[this.rank-1]+";\n      if (++"+r[this.rank-2]+" < "+n[this.rank-2]+") {\n        ++"+i[this.rank-2]+";\n        result.z = "+s+";\n        if (++"+r[this.rank-1]+" < "+n[this.rank-1]+") {\n          ++"+i[this.rank-1]+";\n          result.w = "+s+";\n        }\n      }\n    ",c=this.rank<=4?"sourceLoc = coords +\n            "+e+"("+n.map(function(l,d){return"start["+d+"]"}).join()+");":n.map(function(l,d){return i[d]+" = "+r[d]+" + start["+d+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+e+" coords = getOutputCoords();\n        "+e+" sourceLoc;\n        "+c+"\n        vec4 result = vec4(0.);\n        "+a+"\n        "+u+"\n        setOutput(result);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n){var e=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(r,i){null==e.startLoc&&(e.startLoc=r.getUniformLocationNoThrow(i,"start"),null==e.startLoc)||r.gl.uniform1iv(e.startLoc,n)}},t}(),T$=function(t,n,e){this.variableNames=["x"],this.outputShape=e;var r=e.length,i=vt(e.length),o=vt(e.length),s="";if(1===r)s="coords * strides + begin";else{var a=0;s=e.map(function(u,c){return a++,1===e.length?"coords * strides["+c+"] + begin["+c+"]":"coords["+(a-1)+"] * strides["+c+"] + begin["+c+"]"}).join(",")}this.userCode="\n      "+i+" begin = "+i+"("+t+");\n      "+i+" strides = "+i+"("+n+");\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+s+"));\n      }\n    "},M$=function(){function t(n){this.gpgpu=n,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(n,e,r){var i,o=xM(e,r),s=EM(n,o,r);if(s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]),this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[s].shift();return this.usedTextures[s].push(a),a}return this.numUsedTextures++,this.log(),o===lr.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(n[0],n[1]):o===lr.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(n[0],n[1]):o===lr.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(n[0],n[1]):o===lr.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(n[0],n[1]):o===lr.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(n[0],n[1])),this.usedTextures[s].push(i),i},t.prototype.releaseTexture=function(n,e,r,i){if(null!=this.freeTextures){var o=EM(e,xM(r,i),i);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(n),this.numFreeTextures++,this.numUsedTextures--;var s=this.usedTextures[o],a=s.indexOf(n);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");s.splice(a,1),this.log()}},t.prototype.log=function(){this.logEnabled&&console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+(this.numFreeTextures+this.numUsedTextures)+")")},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var n=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(r){n.gpgpu.deleteMatrixTexture(r)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(i){n.gpgpu.deleteMatrixTexture(i)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}();function xM(t,n){if(t===cr.UPLOAD)return lr.PACKED_2X2_FLOAT32;if(t===cr.RENDER||null==t)return e=n,P().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?lr.PACKED_2X2_FLOAT32:lr.UNPACKED_FLOAT32:e?lr.PACKED_2X2_FLOAT16:lr.UNPACKED_FLOAT16;var e;if(t===cr.DOWNLOAD||t===cr.PIXELS)return lr.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+t)}function EM(t,n,e){return t[0]+"_"+t[1]+"_"+n+"_"+e}var A$=function(t,n){this.variableNames=["A"];for(var e=new Array(t.length),r=0;r<e.length;r++)e[r]=t[r]*n[r];this.outputShape=e,this.rank=e.length;var i=vt(this.rank),o=function(s){var a=s.length;if(a>5)throw Error("Tile for rank "+a+" is not yet supported");if(1===a)return"imod(resRC, "+s[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],c=[],l=0;l<s.length;l++)c.push("imod("+u[l]+", "+s[l]+")");return c.join()}(t);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "},R$=function(t,n){this.variableNames=["A"];for(var e=new Array(t.length),r=0;r<e.length;r++)e[r]=t[n[r]];this.outputShape=e,this.rank=e.length;var i=vt(this.rank),o=function(s){var a=s.length;if(a>6)throw Error("Transpose for rank "+a+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],c=new Array(a),l=0;l<s.length;l++)c[s[l]]=u[l];return c.join()}(n);this.userCode="\n    void main() {\n      "+i+" resRC = getOutputCoords();\n      setOutput(getA("+o+"));\n    }\n    "},O$=function(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var e=new Array(t.length),r=0;r<e.length;r++)e[r]=t[n[r]];if(this.outputShape=e,this.rank=e.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=vt(this.rank),o=$T("rc",this.rank),s=new Array(this.rank);for(r=0;r<n.length;r++)s[n[r]]=o[r];var a="vec2("+s.slice(-2).join()+")",u="++"+o[this.rank-1]+" < "+e[this.rank-1],c="getChannel(getA("+s.join()+"), "+a+")";this.userCode="\n    void main() {\n      "+i+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+u+") {\n        result[1] = "+c+";\n      }\n      --"+o[this.rank-1]+";\n      if(++"+o[this.rank-2]+" < "+e[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+u+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "},c0=1.7580993408473768,l0=1.0507009873554805,Te=function(t,n){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      float unaryOperation(float x) {\n        "+n+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},qr="if (isnan(x)) return x;",DM="return abs(x);",IM=qr+"\n  return (x < 0.0) ? 0.0 : x;\n",SM=qr+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",TM="return (x >= 0.0) ? x : (exp(x) - 1.0);",k$="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+c0+";\n  float scale = "+l0+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",MM="return -x;",AM="return ceil(x);",RM="return floor(x);",OM="return exp(x);",NM="return exp(x) - 1.0;",P$=qr+"\n  return sin(x);\n",F$=qr+"\n  return cos(x);\n",L$=qr+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",B$=qr+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",V$=qr+"\n  return atan(x);\n",U$=qr+"return log(x + sqrt(x * x + 1.0));",H$=qr+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",j$=qr+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",wh="return x;",kM="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",PM="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",FM="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",vl=function(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+n+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},z$=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;var n=t.length,e=Qn("rc",n),r=vt(n),i=function(a,u){if(1===a)return"rc";for(var c="",l=0;l<a;l++)c+=u[l],l<a-1&&(c+=",");return c}(n,e),o=e.slice(-2),s=n<=1?"rc":"vec2("+o.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+i+");\n\n        setOutput(getChannel(packedInput, "+s+"));\n      }\n    "},_h={};function Ch(t,n){if(void 0===n&&(n=!1),"linear"===t)return"return x;";if("relu"===t)return n?kM:IM;if("elu"===t)return n?FM:TM;if("relu6"===t)return n?PM:SM;if("prelu"===t)return n?QT:ZT;throw new Error("Activation "+t+" has not been implemented for the WebGL backend.")}var LM=function(t){function n(e){var r,i=t.call(this)||this;if(i.pendingRead=new WeakMap,i.pendingDisposal=new WeakSet,i.dataRefCount=new WeakMap,i.numBytesInGPU=0,i.uploadWaitMs=0,i.downloadWaitMs=0,i.warnedAboutMemory=!1,i.pendingDeletes=0,i.disposed=!1,!P().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var o=gi(P().getNumber("WEBGL_VERSION"));i.binaryCache=((r=P().getNumber("WEBGL_VERSION"))in _h||(_h[r]={}),_h[r]),i.gpgpu=new wM(o),i.canvas=o.canvas,i.gpgpuCreatedLocally=!0}else i.gpgpu=e,i.binaryCache={},i.gpgpuCreatedLocally=!1,i.canvas=e.gl.canvas;return i.textureManager=new M$(i.gpgpu),i.numMBBeforeWarning=null==P().global.screen?1024:P().global.screen.height*P().global.screen.width*window.devicePixelRatio*600/1024/1024,i.texData=new BT(i,M),i}return Hr(n,t),n.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},n.prototype.write=function(e,r,i){if(P().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===i&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var o={};return this.texData.set(o,{shape:r,dtype:i,values:e,usage:cr.UPLOAD}),o},n.prototype.move=function(e,r,i,o){if(P().getBool("DEBUG")&&this.checkNumericalProblems(r),"complex64"===o)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:i,dtype:o,values:r,usage:cr.UPLOAD})},n.prototype.readSync=function(e){var r=this.texData.get(e),i=r.values,o=r.dtype,s=r.complexTensors,u=r.shape;if(null!=r.slice){var l;l=r.isPacked?new vl(u,wh):new Te(u,wh);var d=this.runWebGLProgram(l,[{dataId:e,shape:u,dtype:o}],o),f=this.readSync(d.dataId);return this.disposeData(d.dataId),f}if(null!=i)return this.convertAndCacheOnCPU(e);if("string"===o)return i;var h,p,g=null!=this.activeTimers;return g&&(h=Wr()),p="complex64"===o?Zy(s.real.dataSync(),s.imag.dataSync()):this.getValuesFromTexture(e),g&&(this.downloadWaitMs+=Wr()-h),this.convertAndCacheOnCPU(e,p)},n.prototype.read=function(e){return ie(this,void 0,void 0,function(){var r,i,o,s,u,c,l,d,f,h,p,g,m,v,y,_,C,T,S;return oe(this,function(D){switch(D.label){case 0:if(this.pendingRead.has(e))return r=this.pendingRead.get(e),[2,new Promise(function(I){return r.push(I)})];if(i=this.texData.get(e),o=i.values,s=i.shape,u=i.dtype,c=i.complexTensors,l=i.isPacked,null!=i.slice)return d=l?new vl(s,wh):new Te(s,wh),f=this.runWebGLProgram(d,[{dataId:e,shape:s,dtype:u}],u),h=this.read(f.dataId),this.disposeData(f.dataId),[2,h];if(null!=o)return[2,this.convertAndCacheOnCPU(e)];if(!P().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===P().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,"complex64"!==u&&P().get("WEBGL_BUFFER_SUPPORTED")&&(g=this.decode(e),m=this.texData.get(g.dataId),p=(S=this.gpgpu).createBufferFromTexture.apply(S,[m.texture].concat(il(s)))),this.pendingRead.set(e,[]),"complex64"===u?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:D.sent(),D.label=2;case 2:return"complex64"!==u?[3,4]:[4,Promise.all([c.real.data(),c.imag.data()])];case 3:return y=D.sent(),v=Zy(y[0],y[1]),[3,5];case 4:null==p?v=this.getValuesFromTexture(e):(_=ae(s),v=this.gpgpu.downloadFloat32MatrixFromBuffer(p,_)),D.label=5;case 5:return null!=g&&this.disposeData(g.dataId),C=this.convertAndCacheOnCPU(e,v),T=this.pendingRead.get(e),this.pendingRead.delete(e),T.forEach(function(I){return I(C)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,C]}})})},n.prototype.checkNumericalProblems=function(e){if(null!=e)for(var r=0;r<e.length;r++){var i=e[r];if(!Z2(i))throw P().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+i+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+i+" cannot be represented on this device.")}},n.prototype.getValuesFromTexture=function(e){var r,i=this.texData.get(e),o=i.shape,s=i.dtype,a=i.isPacked,u=ae(o);if(P().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(e),l=this.texData.get(c.dataId),d=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[l.texture].concat(il(o))).subarray(0,u);return this.disposeData(c.dataId),d}var f=P().getBool("WEBGL_PACK")&&!0===a,h=f?rh(o):o,p=f?new YG(h):new KG(h),g=this.runWebGLProgram(p,[{shape:h,dtype:s,dataId:e}],"float32"),m=this.texData.get(g.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture,m.texShape[0],m.texShape[1]).subarray(0,u);return this.disposeData(g.dataId),v},n.prototype.time=function(e){return ie(this,void 0,void 0,function(){var r,i,o,s,a,u,c;return oe(this,function(l){switch(l.label){case 0:return r=this.activeTimers,i=[],o=!1,null==this.programTimersStack?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,e(),s=$i(this.activeTimers.map(function(d){return d.query})).filter(function(d){return null!=d}),a=$i(this.activeTimers.map(function(d){return d.name})).filter(function(d){return null!=d}),this.activeTimers=r,o&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(s)]:[3,2];case 1:return c=l.sent(),u.kernelMs=O2(c),u.getExtraProfileInfo=function(){return c.map(function(d,f){return{name:a[f],ms:d}}).map(function(d){return d.name+": "+d.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},l.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},n.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},n.prototype.startTimer=function(){return P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Wr(),endMs:null}},n.prototype.endTimer=function(e){return P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Wr(),e)},n.prototype.getQueryTime=function(e){return ie(this,void 0,void 0,function(){var r;return oe(this,function(i){return P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(r=e).endMs-r.startMs]})})},n.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var r=this.texData.get(e).complexTensors;null!=r&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(e)}}},n.prototype.releaseGPUData=function(e){var r=this.texData.get(e),i=r.texture,o=r.dtype,s=r.texShape,a=r.usage,u=r.isPacked,c=r.slice,l=c&&c.origDataId||e,d=this.dataRefCount.get(l);d>1?this.dataRefCount.set(l,d-1):(this.dataRefCount.delete(l),null!=i&&(this.numBytesInGPU-=this.computeBytes(s,o),this.textureManager.releaseTexture(i,s,a,u)));var f=this.texData.get(e);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},n.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},n.prototype.getDataInfo=function(e){return this.texData.get(e)},n.prototype.getCPUBackend=function(){return P().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=M.findBackend("cpu")),this.cpuBackend):null},n.prototype.shouldExecuteOnCPU=function(e,r){var i=this;return void 0===r&&(r=128),null!=this.getCPUBackend()&&e.every(function(o){return null==i.texData.get(o.dataId).texture&&o.size<r})},n.prototype.getGPGPUContext=function(){return this.gpgpu},n.prototype.complex=function(e,r){var i=this.makeOutput(e.shape,"complex64");return this.texData.get(i.dataId).complexTensors={real:M.keep(e.clone()),imag:M.keep(r.clone())},i},n.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},n.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},n.prototype.slice=function(e,r,i){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,r,i);if(0===ae(i))return gn([],i,e.dtype);var o=this.texData.get(e.dataId).isPacked,s=Gy(e.shape,r,i);if(o||!s){var a=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new S$(i):new I$(i),u=a.getCustomSetupFunc(r);return this.compileAndRun(a,[e],null,u)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,r,i)},n.prototype.shallowSlice=function(e,r,i){var o=this.texData.get(e.dataId),s=this.makeOutput(i,e.dtype),a=this.texData.get(s.dataId);Object.assign(a,o),a.shape=i,a.dtype=e.dtype;var u=$y(r,e.strides);o.slice&&(u+=o.slice.flatOffset),a.slice={flatOffset:u,origDataId:o.slice&&o.slice.origDataId||e.dataId};var c=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,c+1),s},n.prototype.stridedSlice=function(e,r,i,o){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,r,i,o);var s=hh(r,i,o);if(s.some(function(u){return 0===u}))return gn([],s);var a=new T$(r,o,s);return this.compileAndRun(a,[e])},n.prototype.reverse=function(e,r){var i=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new x$(e.shape,r):new C$(e.shape,r);return this.compileAndRun(i,[e])},n.prototype.concat=function(e,r){if("complex64"===e[0].dtype){var i=e.map(function(h){return Sr(h)}),o=e.map(function(h){return vi(h)});return pn(this.concat(i,r),this.concat(o,r))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,r);if(1===e.length)return e[0];if(e.length>P().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var s=Math.floor(e.length/2),a=this.concat(e.slice(0,s),r),u=this.concat(e.slice(s),r);return this.concat([a,u],r)}if(P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var c=new kG(e.map(function(h){return h.shape}),r);return this.compileAndRun(c,e)}var l=Cs(e.map(function(h){return h.shape}),r),d=e.map(function(h){return h.as2D(-1,ae(h.shape.slice(r)))}),f=new NG(d.map(function(h){return h.shape}));return this.compileAndRun(f,d).reshape(l)},n.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,MM,e.dtype);var r=new Te(e.shape,MM);return this.compileAndRun(r,[e])},n.prototype.batchMatMul=function(e,r,i,o){var s=i?e.shape[2]:e.shape[1],a=o?r.shape[1]:r.shape[2],u=i?e.shape[1]:e.shape[2],c=e.shape[0];if((1===s||1===a)&&u>1e3){i&&(e=e.transpose([0,2,1])),o&&(r=r.transpose([0,2,1]));var l=1===a?e:e.as3D(c,u,1),d=1===a?2:1,f=1===a?r.as3D(c,1,u):r;return this.multiply(l,f).sum(d,!0)}var h=tn(e.dtype,r.dtype),p=new o0(e.shape,[c,s,a],i,o);return this.compileAndRun(p,[e,r],h)},n.prototype.fusedBatchMatMul=function(e){var r=e.a,i=e.b,o=e.transposeA,s=e.transposeB,a=e.bias,u=e.activation,c=e.preluActivationWeights,l=o?r.shape[2]:r.shape[1],d=s?i.shape[1]:i.shape[2],f=r.shape[0],h=tn(r.dtype,i.dtype),p=null!=a,g=null!=c,m=u?Ch(u,!0):null,v=new o0(r.shape,[f,l,d],o,s,p,m,g),y=[r,i];return a&&y.push(a),c&&y.push(c),this.compileAndRun(v,y,h)},n.prototype.multiply=function(e,r){if("complex64"===e.dtype){var i=this.texData.get(e.dataId),o=this.texData.get(r.dataId),s=new YT("return areal * breal - aimag * bimag;",e.shape,r.shape),a=new YT("return areal * bimag + aimag * breal;",e.shape,r.shape),u=[this.makeComplexComponentTensorInfo(e,i.complexTensors.real),this.makeComplexComponentTensorInfo(e,i.complexTensors.imag),this.makeComplexComponentTensorInfo(r,o.complexTensors.real),this.makeComplexComponentTensorInfo(r,o.complexTensors.imag)],c=this.compileAndRun(s,u),l=this.compileAndRun(a,u),d=this.complex(c,l);return c.dispose(),l.dispose(),d}if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.multiply(e,r);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,XT,e.dtype);var f=new Rt(XT,e.shape,r.shape);return this.compileAndRun(f,[e,r],e.dtype)},n.prototype.batchNormalization=function(e,r,i,o,s,a){var u=[e,r,i],c=null;null!=a&&(c=a.shape,u.push(a));var l=null;if(null!=s&&(l=s.shape,u.push(s)),P().getBool("WEBGL_PACK_NORMALIZATION")){var d=new SG(e.shape,r.shape,i.shape,c,l,o);return this.compileAndRun(d,u)}var f=new IG(e.shape,r.shape,i.shape,c,l,o);return this.compileAndRun(f,u)},n.prototype.localResponseNormalization4D=function(e,r,i,o,s){var a=P().getBool("WEBGL_PACK_NORMALIZATION")?new a$(e.shape,r,i,o,s):new o$(e.shape,r,i,o,s);return this.compileAndRun(a,[e])},n.prototype.LRNGrad=function(e,r,i,o,s,a,u){var c=new s$(r.shape,o,s,a,u);return this.compileAndRun(c,[r,i,e])},n.prototype.tile=function(e,r){if("string"===e.dtype){var i=this.readSync(e.dataId).map(function(s){return Qc(s)});return zT(De(e.shape,e.dtype,i),r)}var o=new A$(e.shape,r);return this.compileAndRun(o,[e])},n.prototype.pad=function(e,r,i){var o=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new p$(e.shape,r,i):new h$(e.shape,r,i);return this.compileAndRun(o,[e])},n.prototype.transpose=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,r);var i=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new O$(e.shape,r):new R$(e.shape,r);return this.compileAndRun(i,[e])},n.prototype.gather=function(e,r,i){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.gather(e,r,i);var o=new t$(e.shape,r.size,i);return this.compileAndRun(o,[e,r])},n.prototype.batchToSpaceND=function(e,r,i){E(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(d,f){return d*f}),s=ch(e.shape,r,o),a=lh(s.length,r.length),u=dh(e.shape,r,o),c=RT(i,r.length),l=OT(u,i,r.length);return e.reshape(s).transpose(a).reshape(u).slice(c,l)},n.prototype.spaceToBatchND=function(e,r,i){E(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(f,h){return f*h}),s=[[0,0]];s.push.apply(s,i);for(var a=1+r.length;a<e.shape.length;++a)s.push([0,0]);var u=e.pad(s),c=ch(u.shape,r,o,!1),l=lh(c.length,r.length,!1),d=dh(u.shape,r,o,!1);return u.reshape(c).transpose(l).reshape(d)},n.prototype.reduce=function(e,r,i){var o=e.shape[0],s=e.shape[1],a=fh(s),u=new g$({windowSize:a,inSize:s,batchSize:o},r),c=this.compileAndRun(u,[e],i);return 1===c.shape[1]?c:this.reduce(c,r,i)},n.prototype.argReduce=function(e,r,i){void 0===i&&(i=null);var o=e.shape[0],s=e.shape[1];null!=i&&(o=i.shape[0],s=i.shape[1]);var a=fh(s),u=new vG({windowSize:a,inSize:s,batchSize:o},r,null==i),c=[e];null!=i&&c.push(i);var l=this.compileAndRun(u,c,"int32");return 1===l.shape[1]?l:this.argReduce(e,r,l)},n.prototype.argReducePacked=function(e,r,i){void 0===i&&(i=null);var o=null!=i?i.shape:e.shape,s=fh(o[o.length-1]),a=new xG(o,s,r,null==i),c=this.compileAndRun(a,null==i?[e]:[e,i],"int32");return c.rank===e.rank?this.argReducePacked(e,r,c):c},n.prototype.sum=function(e,r){Xn("sum",r,e.rank);var i=hn(e.shape,r),o=i[0],s=ae(i[1]),a=e.as2D(-1,s),u=Ty(e.dtype);return this.reduce(a,"sum",u).reshape(o)},n.prototype.prod=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,r);var i=hn(e.shape,r),o=i[0],s=ae(i[1]),a=e.as2D(-1,s),u=Ty(e.dtype);return this.reduce(a,"prod",u).reshape(o)},n.prototype.unsortedSegmentSum=function(e,r,i){var o=0,s=zr([o],e.rank),a=e;null!=s&&(a=e.transpose(s),o=Gr(1,e.rank)[0]);var u=function(h,p,g){for(var m=[],v=h.length,y=0;y<v;y++)m.push(y!==p?h[y]:g);return m}(a.shape,o,i),c=ae([a.shape[o]]),l=a.as2D(-1,c),d=Ty(e.dtype),f=this.segOpCompute(l,"unsortedSegmentSum",r,d,i).reshape(u);return null!=s&&(f=f.transpose(sh(s))),f},n.prototype.segOpCompute=function(e,r,i,o,s){var a=e.shape[0],u=e.shape[1],c=function(f,h){var p,g=!1;for(f<=30?(p=f,g=!0):p=Zf(f,Math.floor(Math.sqrt(f)));!g;)p>h||p===f?g=!0:p=Zf(f,p+1);return p}(u,s),l=new E$({windowSize:c,inSize:u,batchSize:a,numSegments:s},r),d=this.compileAndRun(l,[e,i],o);return d.shape[1]===s?d:(i=ah(0,s).tile([u/c]),this.segOpCompute(d,r,i,o,s))},n.prototype.argMinMaxReduce=function(e,r,i){var o=[r];if(Xn("arg"+i.charAt(0).toUpperCase()+i.slice(1),o,e.rank),!P().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var s=hn(e.shape,o),a=s[0],u=ae(s[1]),c=e.as2D(-1,u);return this.argReduce(c,i).reshape(a)}return this.argReducePacked(e,i)},n.prototype.argMin=function(e,r){return this.argMinMaxReduce(e,r,"min")},n.prototype.argMax=function(e,r){return this.argMinMaxReduce(e,r,"max")},n.prototype.cumsum=function(e,r,i,o){if(r!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+r);var s=new WG(e.shape,i,o);return this.compileAndRun(s,[e])},n.prototype.equal=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(equal(a, b));\n","bool");var i=new Rt("return float(a == b);",e.shape,r.shape);return this.compileAndRun(i,[e,r],"bool")},n.prototype.notEqual=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(notEqual(a, b));\n","bool");var i=new Rt("return float(a != b);",e.shape,r.shape);return this.compileAndRun(i,[e,r],"bool")},n.prototype.less=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.less(e,r);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(lessThan(a, b));\n","bool");var i=new Rt("return float(a < b);",e.shape,r.shape);return this.compileAndRun(i,[e,r],"bool")},n.prototype.lessEqual=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(lessThanEqual(a, b));\n","bool");var i=new Rt("return float(a <= b);",e.shape,r.shape);return this.compileAndRun(i,[e,r],"bool")},n.prototype.greater=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.greater(e,r);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(greaterThan(a, b));\n","bool");var i=new Rt("return float(a > b);",e.shape,r.shape);return this.compileAndRun(i,[e,r],"bool")},n.prototype.greaterEqual=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var i=new Rt("return float(a >= b);",e.shape,r.shape);return this.compileAndRun(i,[e,r],"bool")},n.prototype.logicalNot=function(e){var r=new Te(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[e])},n.prototype.logicalAnd=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var i=new Rt("return float(a >= 1.0 && b >= 1.0);",e.shape,r.shape);return this.compileAndRun(i,[e,r],"bool")},n.prototype.logicalOr=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var i=new Rt("return float(a >= 1.0 || b >= 1.0);",e.shape,r.shape);return this.compileAndRun(i,[e,r],"bool")},n.prototype.select=function(e,r,i){var o=new D$(e.rank,r.shape,r.rank);return this.compileAndRun(o,[e,r,i],tn(r.dtype,i.dtype))},n.prototype.where=function(e){oh("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=e.dataSync();return e0(e.shape,r)},n.prototype.topk=function(e,r,i){return GT(e.dataSync(),e.shape,e.dtype,r)},n.prototype.min=function(e,r){Xn("min",r,e.rank);var i=hn(e.shape,r),o=i[0],s=ae(i[1]),a=e.as2D(-1,s);return this.reduce(a,"min",a.dtype).reshape(o)},n.prototype.minimum=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.minimum(e,r);var i=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zi("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new Rt("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,r.shape);return this.compileAndRun(i,[e,r])},n.prototype.mod=function(e,r){var i=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zi("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new Rt("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,r.shape);return this.compileAndRun(i,[e,r])},n.prototype.max=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,r);Xn("max",r,e.rank);var i=hn(e.shape,r),o=i[0],s=ae(i[1]),a=e.as2D(-1,s);return this.reduce(a,"max",a.dtype).reshape(o)},n.prototype.maximum=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.maximum(e,r);var i=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zi("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new Rt("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,r.shape);return this.compileAndRun(i,[e,r])},n.prototype.all=function(e,r){Xn("all",r,e.rank);var i=hn(e.shape,r),o=i[0],s=ae(i[1]),a=e.as2D(-1,s);return this.reduce(a,"all",a.dtype).reshape(o)},n.prototype.any=function(e,r){Xn("any",r,e.rank);var i=hn(e.shape,r),o=i[0],s=ae(i[1]),a=e.as2D(-1,s);return this.reduce(a,"any",a.dtype).reshape(o)},n.prototype.realDivide=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var i=new Rt("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,r.shape);return this.compileAndRun(i,[e,r],"float32")},n.prototype.floorDiv=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var i=new Rt("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,r.shape);return this.compileAndRun(i,[e,r],"int32")},n.prototype.add=function(e,r){if("complex64"===e.dtype&&"complex64"===r.dtype)return this.complexSeparableBinaryOp(e,r,n0);if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.add(e,r);var i=tn(e.dtype,r.dtype);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,n0,i);var o=new Rt(n0,e.shape,r.shape);return this.compileAndRun(o,[e,r],i)},n.prototype.packedUnaryOp=function(e,r,i){var o=new vl(e.shape,r);return this.compileAndRun(o,[e],i)},n.prototype.packedBinaryOp=function(e,r,i,o,s){void 0===s&&(s=!1);var a=new Zi(i,e.shape,r.shape,s);return this.compileAndRun(a,[e,r],o)},n.prototype.complexSeparableBinaryOp=function(e,r,i){var o=this,s=this.texData.get(e.dataId),a=this.texData.get(r.dataId),u=[[s.complexTensors.real,a.complexTensors.real],[s.complexTensors.imag,a.complexTensors.imag]].map(function(f){var h=f[0],p=f[1],g=o.makeComplexComponentTensorInfo(e,h),m=o.makeComplexComponentTensorInfo(r,p),v=new Rt(i,e.shape,r.shape);return o.compileAndRun(v,[g,m],tn(h.dtype,p.dtype))}),c=u[0],l=u[1],d=this.complex(c,l);return c.dispose(),l.dispose(),d},n.prototype.makeComplexComponentTensorInfo=function(e,r){return{dataId:r.dataId,dtype:r.dtype,shape:e.shape}},n.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>P().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(e.length/2),i=this.addN(e.slice(0,r)),o=this.addN(e.slice(r));return this.addN([i,o])}var s=e.map(function(c){return c.dtype}).reduce(function(c,l){return tn(c,l)}),a=e.map(function(c){return c.shape}),u=P().getBool("WEBGL_PACK")?new mG(e[0].shape,a):new gG(e[0].shape,a);return this.compileAndRun(u,e,s)},n.prototype.subtract=function(e,r){if("complex64"===e.dtype&&"complex64"===r.dtype)return this.complexSeparableBinaryOp(e,r,r0);if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.subtract(e,r);var i=tn(e.dtype,r.dtype);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,r0,e.dtype);var o=new Rt(r0,e.shape,r.shape);return this.compileAndRun(o,[e,r],i)},n.prototype.pow=function(e,r){var i=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zi("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new Rt("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,r.shape),o=tn(e.dtype,r.dtype);return this.compileAndRun(i,[e,r],o)},n.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,AM,e.dtype);var r=new Te(e.shape,AM);return this.compileAndRun(r,[e])},n.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,RM,e.dtype);var r=new Te(e.shape,RM);return this.compileAndRun(r,[e])},n.prototype.sign=function(e){var r=new Te(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(r,[e])},n.prototype.isNaN=function(e){var r=new Te(e.shape,"return float(isnan(x));");return this.compileAndRun(r,[e],"bool")},n.prototype.isInf=function(e){var r=new Te(e.shape,"return float(isinf(x));");return this.compileAndRun(r,[e],"bool")},n.prototype.isFinite=function(e){var r=new Te(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[e],"bool")},n.prototype.round=function(e){var r=new Te(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(r,[e])},n.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,OM,e.dtype);var r=new Te(e.shape,OM);return this.compileAndRun(r,[e])},n.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,NM,e.dtype);var r=new Te(e.shape,NM);return this.compileAndRun(r,[e])},n.prototype.softmax=function(e,r){var i=Ht([r],e.shape),o=this.max(e,i),s=Vn(o.shape,i),a=this.subtract(e,o.reshape(s)),u=this.exp(a),c=this.sum(u,i).reshape(s);return this.realDivide(u,c)},n.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var r=new Te(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(r,[e])},n.prototype.log1p=function(e){var r=new Te(e.shape,"return log(1.0 + x);");return this.compileAndRun(r,[e])},n.prototype.sqrt=function(e){var r=new Te(e.shape,"return sqrt(x);");return this.compileAndRun(r,[e])},n.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var r=new Te(e.shape,"return inversesqrt(x);");return this.compileAndRun(r,[e])},n.prototype.reciprocal=function(e){var r=new Te(e.shape,"return 1.0 / x;");return this.compileAndRun(r,[e])},n.prototype.relu=function(e){var r;return r=P().getBool("WEBGL_PACK")?new vl(e.shape,kM):new Te(e.shape,IM),this.compileAndRun(r,[e])},n.prototype.relu6=function(e){var r;return r=P().getBool("WEBGL_PACK")?new vl(e.shape,PM):new Te(e.shape,SM),this.compileAndRun(r,[e])},n.prototype.prelu=function(e,r){var i=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zi(QT,e.shape,r.shape):new Rt(ZT,e.shape,r.shape);return this.compileAndRun(i,[e,r])},n.prototype.elu=function(e){if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,FM,e.dtype);var r=new Te(e.shape,TM);return this.compileAndRun(r,[e])},n.prototype.eluDer=function(e,r){var i=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zi("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,r.shape):new Rt("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,r.shape);return this.compileAndRun(i,[e,r])},n.prototype.selu=function(e){var r=new Te(e.shape,k$);return this.compileAndRun(r,[e])},n.prototype.int=function(e){var r=new Te(e.shape,"return float(int(x));");return this.compileAndRun(r,[e],"int32")},n.prototype.clip=function(e,r,i){var o,s=(o=P().getBool("WEBGL_PACK_CLIP")?new RG(e.shape):new AG(e.shape)).getCustomSetupFunc(r,i);return this.compileAndRun(o,[e],null,s)},n.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,DM,e.dtype);var r=new Te(e.shape,DM);return this.compileAndRun(r,[e])},n.prototype.complexAbs=function(e){var r=this.texData.get(e.dataId),i=new OG(e.shape),o=[this.makeComplexComponentTensorInfo(e,r.complexTensors.real),this.makeComplexComponentTensorInfo(e,r.complexTensors.imag)];return this.compileAndRun(i,o)},n.prototype.sigmoid=function(e){var r=new Te(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[e])},n.prototype.softplus=function(e){var r=new Te(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(r,[e])},n.prototype.sin=function(e){var r=new Te(e.shape,P$);return this.compileAndRun(r,[e])},n.prototype.cos=function(e){var r=new Te(e.shape,F$);return this.compileAndRun(r,[e])},n.prototype.tan=function(e){var r=new Te(e.shape,"return tan(x);");return this.compileAndRun(r,[e])},n.prototype.asin=function(e){var r=new Te(e.shape,L$);return this.compileAndRun(r,[e])},n.prototype.acos=function(e){var r=new Te(e.shape,B$);return this.compileAndRun(r,[e])},n.prototype.atan=function(e){var r=new Te(e.shape,V$);return this.compileAndRun(r,[e])},n.prototype.atan2=function(e,r){var i=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zi("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new Rt("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,r.shape);return this.compileAndRun(i,[e,r])},n.prototype.sinh=function(e){var r=new Te(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(r,[e])},n.prototype.cosh=function(e){var r=new Te(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(r,[e])},n.prototype.tanh=function(e){var r=new Te(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(r,[e])},n.prototype.asinh=function(e){var r=new Te(e.shape,U$);return this.compileAndRun(r,[e])},n.prototype.acosh=function(e){var r=new Te(e.shape,H$);return this.compileAndRun(r,[e])},n.prototype.atanh=function(e){var r=new Te(e.shape,j$);return this.compileAndRun(r,[e])},n.prototype.erf=function(e){var r=new Te(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(r,[e])},n.prototype.step=function(e,r){var o,i=new Te(e.shape,(void 0===(o=r)&&(o=0),qr+"\n    return x > 0.0 ? 1.0 : float("+o+");\n  "));return this.compileAndRun(i,[e])},n.prototype.conv2dByMatMul=function(e,r,i,o,s,a){var u=e.shape,c=this.texData.get(e.dataId),h="channelsLast"===i.dataFormat,g=u[2]%2!=0&&!!c.isPacked;if((1==u[0]*u[1]*u[2]||1===i.outChannels)&&i.inChannels>1e3||!P().getBool("WEBGL_LAZILY_UNPACK")||!P().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!g){var v=this.reshape(e,[1,h?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],i.inChannels]),y=this.reshape(r,[1,i.inChannels,i.outChannels]);return this.reshape(this.fusedBatchMatMul({a:v,b:y,transposeA:!1,transposeB:!1,bias:o,activation:s,preluActivationWeights:a}),i.outShape)}var b={dataId:e.dataId,shape:[1,h?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),i.inChannels],dtype:e.dtype},_=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,E(ll(c.shape,b.shape),function(){return"packed reshape "+c.shape+" to "+b.shape+" isn't free"});var C=this.reshape(r,[1,i.inChannels,i.outChannels]),T=this.fusedBatchMatMul({a:b,b:C,transposeA:!1,transposeB:!1,bias:o,activation:s,preluActivationWeights:a}),S=this.texData.get(T.dataId);return E(S.isPacked,function(){return"batchMatMul result is expected to be packed"}),c.shape=_,S.shape=i.outShape,M.makeTensorFromDataId(T.dataId,i.outShape,T.dtype)},n.prototype.conv2dWithIm2Row=function(e,r,i,o,s,a){var d=i.outWidth,f=i.outHeight,h="channelsLast"===i.dataFormat,p=i.filterWidth*i.filterHeight*i.inChannels,g=f*d,m=[p,g],v=e.squeeze([0]),y=r.reshape([1,p,-1]),w=new i$(m,v.shape,i),b=this.compileAndRun(w,[v]).reshape([1,m[0],m[1]]),_=null!=o,C=null!=a,T=s?Ch(s,!0):null,S=new o0(b.shape,[1,g,i.outChannels],!0,!1,_,T,C),D=[b,y];return o&&D.push(o),C&&D.push(a),this.compileAndRun(S,D).reshape(h?[1,f,d,i.outChannels]:[1,i.outChannels,f,d])},n.prototype.fusedConv2d=function(e){var r=e.input,i=e.filter,o=e.convInfo,s=e.bias,a=e.activation,u=e.preluActivationWeights;if(1===o.filterHeight&&1===o.filterWidth&&1===o.dilationHeight&&1===o.dilationWidth&&1===o.strideHeight&&1===o.strideWidth&&("SAME"===o.padInfo.type||"VALID"===o.padInfo.type))return this.conv2dByMatMul(r,i,o,s,a,u);if(P().getBool("WEBGL_CONV_IM2COL")&&1===r.shape[0])return this.conv2dWithIm2Row(r,i,o,s,a,u);var c=null!=s,l=null!=u,d=a?Ch(a,!1):null,f=new JT(o,c,d,l),h=[r,i];return s&&h.push(s),u&&h.push(u),this.compileAndRun(f,h)},n.prototype.conv2d=function(e,r,i){if(1===i.filterHeight&&1===i.filterWidth&&1===i.dilationHeight&&1===i.dilationWidth&&1===i.strideHeight&&1===i.strideWidth&&("SAME"===i.padInfo.type||"VALID"===i.padInfo.type))return this.conv2dByMatMul(e,r,i);if(P().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,r,i);var o=new JT(i);return this.compileAndRun(o,[e,r])},n.prototype.conv2dDerInput=function(e,r,i){var o=new FG(i);return this.compileAndRun(o,[e,r])},n.prototype.conv2dDerFilter=function(e,r,i){var o=new PG(i);return this.compileAndRun(o,[e,r])},n.prototype.fusedDepthwiseConv2D=function(e){var r,i=e.input,o=e.filter,s=e.convInfo,a=e.bias,u=e.activation,c=e.preluActivationWeights,l=P().getBool("WEBGL_PACK_DEPTHWISECONV")&&s.strideWidth<=2&&s.outChannels/s.inChannels==1,d=u?Ch(u,l):null,f=[i,o],h=null!=a,p=null!=c;return h&&f.push(a),p&&f.push(c),l?(r=new tM(s,h,d,p),this.compileAndRun(r,f)):(r=new eM(s,h,d,p),this.compileAndRun(r,f))},n.prototype.depthwiseConv2D=function(e,r,i){var o;return P().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1?(o=new tM(i),this.compileAndRun(o,[e,r])):(o=new eM(i),this.compileAndRun(o,[e,r]))},n.prototype.depthwiseConv2DDerInput=function(e,r,i){var o=new UG(i);return this.compileAndRun(o,[e,r])},n.prototype.depthwiseConv2DDerFilter=function(e,r,i){var o=new VG(i);return this.compileAndRun(o,[e,r])},n.prototype.conv3d=function(e,r,i){var o=new HG(i);return this.compileAndRun(o,[e,r])},n.prototype.conv3dDerInput=function(e,r,i){var o=new BG(i);return this.compileAndRun(o,[e,r])},n.prototype.conv3dDerFilter=function(e,r,i){var o=new LG(i);return this.compileAndRun(o,[e,r])},n.prototype.maxPool=function(e,r){var i=new s0(r,"max",!1);return this.compileAndRun(i,[e])},n.prototype.avgPool=function(e,r){var i=new s0(r,"avg",!1);return this.compileAndRun(i,[e],"float32")},n.prototype.maxPoolBackprop=function(e,r,i,o){var s=new s0(o,"max",!0),a=this.compileAndRun(s,[r]),u=new u$(o),c=this.compileAndRun(u,[e,a],r.dtype);return a.dispose(),c},n.prototype.avgPoolBackprop=function(e,r,i){var o=new EG(i);return this.compileAndRun(o,[e],r.dtype)},n.prototype.cast=function(e,r){return Yy(e,r,this)},n.prototype.unstack=function(e,r){for(var i=e.shape[r],o=new Array(e.rank-1),s=0,a=0;a<e.rank;a++)a!==r&&(o[s++]=e.shape[a]);var u=new Array(e.rank).fill(0),c=e.shape.slice();c[r]=1;var l=new Array(i);for(a=0;a<l.length;a++)u[r]=a,l[a]=this.slice(e,u,c).reshape(o);return l},n.prototype.avgPool3d=function(e,r){var i=new a0(r,"avg",!1);return this.compileAndRun(i,[e],"float32")},n.prototype.avgPool3dBackprop=function(e,r,i){var o=new DG(i);return this.compileAndRun(o,[e],r.dtype)},n.prototype.maxPool3d=function(e,r){var i=new a0(r,"max",!1);return this.compileAndRun(i,[e],"float32")},n.prototype.maxPool3dBackprop=function(e,r,i,o){var s=new a0(o,"max",!0),a=this.compileAndRun(s,[r]),u=new c$(o),c=this.compileAndRun(u,[e,a],r.dtype);return a.dispose(),c},n.prototype.reshape=function(e,r){var i=this.texData.get(e.dataId);if(i.isPacked&&!ll(e.shape,r)&&(null===i.texture||!ll(i.shape,r))){var o=this.packedReshape(e,r);return M.makeTensorFromDataId(o.dataId,o.shape,o.dtype)}return yh(e,r)},n.prototype.resizeBilinear=function(e,r,i,o){var s=P().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new b$(e.shape,r,i,o):new y$(e.shape,r,i,o);return this.compileAndRun(s,[e],"float32")},n.prototype.resizeBilinearBackprop=function(e,r,i){var o=new v$(e,r,i);return this.compileAndRun(o,[e])},n.prototype.resizeNearestNeighbor=function(e,r,i,o){var s=new _$(e.shape,r,i,o);return this.compileAndRun(s,[e])},n.prototype.resizeNearestNeighborBackprop=function(e,r,i){var o=new w$(e,r,i);return this.compileAndRun(o,[e])},n.prototype.multinomial=function(e,r,i,o){var s=r?e:Yi(e),c=new l$(s.shape[0],s.shape[1],i),l=c.getCustomSetupFunc(o);return this.compileAndRun(c,[s],"int32",l)},n.prototype.oneHot=function(e,r,i,o){var s=new d$(e.size,r,i,o);return this.compileAndRun(s,[e])},n.prototype.diag=function(e){var r=new qG(e.size);return this.compileAndRun(r,[e])},n.prototype.nonMaxSuppression=function(e,r,i,o,s){return oh("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Qy(e.dataSync(),r.dataSync(),i,o,s)},n.prototype.cropAndResize=function(e,r,i,o,s,a){var u=new jG(e.shape,r.shape,o,s,a);return this.compileAndRun(u,[e,r,i],"float32")},n.prototype.depthToSpace=function(e,r,i){E(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var o=e.shape[0],c=("NHWC"===i?e.shape[1]:e.shape[2])*r,l=("NHWC"===i?e.shape[2]:e.shape[3])*r,d=("NHWC"===i?e.shape[3]:e.shape[1])/(r*r),f=new $G("NHWC"===i?[o,c,l,d]:[o,d,c,l],r,i);return this.compileAndRun(f,[e])},n.prototype.split=function(e,r,i){return WT(e,r,i)},n.prototype.scatterND=function(e,r,i){var o=fl(0,e,i),s=o.sliceRank,a=o.numUpdates,u=o.sliceSize,c=o.strides,l=o.outputSize,d=[l/u,u],f=e.reshape([a,s]),h=r.reshape([a,u]);if(0===l)return yh(gn([]),i);var p=X(0),g=new CM(a,s,f.rank,h.rank,c,d);return this.compileAndRun(g,[h,f,p]).reshape(i)},n.prototype.sparseToDense=function(e,r,i,o){var s=fl(0,e,i),d=new CM(s.numUpdates,s.sliceRank,e.rank,r.rank,s.strides,[s.outputSize,1],!1);return this.compileAndRun(d,[r,e,o]).reshape(i)},n.prototype.fft=function(e){return this.fftImpl(e,!1)},n.prototype.ifft=function(e){return this.fftImpl(e,!0)},n.prototype.fftImpl=function(e,r){var i=this.texData.get(e.dataId),o=new rM("return real * expR - imag * expI;",e.shape,r),s=new rM("return real * expI + imag * expR;",e.shape,r),a=[this.makeComplexComponentTensorInfo(e,i.complexTensors.real),this.makeComplexComponentTensorInfo(e,i.complexTensors.imag)],u=this.compileAndRun(o,a),c=this.compileAndRun(s,a),l=this.complex(u,c).as2D(e.shape[0],e.shape[1]);return u.dispose(),c.dispose(),l},n.prototype.gatherND=function(e,r){var i=r.shape,o=i[i.length-1],s=jy(e,r),a=s[0],u=s[1],c=s[2],l=s[3],d=r.reshape([u,o]),f=e.reshape([e.size/c,c]),h=new n$(o,l,[u,c]);return this.compileAndRun(h,[f,d]).reshape(a)},n.prototype.fill=function(e,r,i){if("string"===(i=i||Qa(r))){var o=Zc(i,ae(e));return o.fill(r),M.makeTensor(o,e,i,this)}var s=new e$(e,r),a=s.getCustomSetupFunc(r);return this.compileAndRun(s,[],i,a)},n.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},n.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},n.prototype.linspace=function(e,r,i){return Xy(e,r,i)},n.prototype.makeTensorInfo=function(e,r){var i=this.write(null,e,r);return this.texData.get(i).usage=null,{dataId:i,shape:e,dtype:r}},n.prototype.makeOutput=function(e,r){var i=this.makeTensorInfo(e,r).dataId;return M.makeTensorFromDataId(i,e,r,this)},n.prototype.unpackTensor=function(e){var r=new z$(e.shape);return this.runWebGLProgram(r,[e],e.dtype)},n.prototype.packTensor=function(e){var r=new f$(e.shape);return this.runWebGLProgram(r,[e],e.dtype,null,!0)},n.prototype.packedReshape=function(e,r){var i=[ul(e.shape)].concat(cl(e.shape)),o={dtype:e.dtype,shape:i,dataId:e.dataId},s=[ul(r)].concat(cl(r)),a=new m$(s,i),u=this.runWebGLProgram(a,[o],e.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},n.prototype.decode=function(e){var r,i=this.texData.get(e),o=i.isPacked,s=i.shape,a=i.dtype,u=rh(s);return r=o?new GG(u):new zG(u),{dtype:a,shape:s,dataId:this.runWebGLProgram(r,[{shape:u,dtype:a,dataId:e}],a,null,!0).dataId}},n.prototype.runWebGLProgram=function(e,r,i,o,s){var a=this;void 0===s&&(s=!1);var u=this.makeTensorInfo(e.outputShape,i),c=this.texData.get(u.dataId);if(e.packedOutput&&(c.isPacked=!0),e.outPackingScheme===rl.DENSE){var l=il(e.outputShape);c.texShape=l.map(function(w){return 2*w})}if(null!=e.outTexUsage&&(c.usage=e.outTexUsage),0===ae(u.shape))return c.values=Za(u.dtype,0),u;var d=[],f=r.map(function(w){if("complex64"===w.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var b=a.texData.get(w.dataId);if(null==b.texture){if(!e.packedInputs&&ae(w.shape)<=P().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:w.shape,texData:null,isUniform:!0,uniformValues:b.values};e.packedInputs&&(b.isPacked=!0,b.shape=w.shape)}else if(!!b.isPacked!=!!e.packedInputs)w=b.isPacked?a.unpackTensor(w):a.packTensor(w),d.push(w),b=a.texData.get(w.dataId);else if(b.isPacked&&!ll(b.shape,w.shape)){var _=w,C=w.shape;w.shape=b.shape,w=a.packedReshape(w,C),d.push(w),b=a.texData.get(w.dataId),_.shape=C}return a.uploadToGPU(w.dataId),{shape:w.shape,texData:b,isUniform:!1}});this.uploadToGPU(u.dataId);var h,w,C,p={shape:u.shape,texData:c,isUniform:!1},g=(w=e,C="",f.concat(p).forEach(function(D){C+=D.shape+"_"+(D.isUniform?"uniform":D.texData.texShape)+"_"+(null!=D.texData&&null!=D.texData.slice&&D.texData.slice.flatOffset>0)}),w.constructor.name+"_"+C+"_"+w.userCode),m=this.getAndSaveBinary(g,function(){return function(w,b,_,C){var T=b.userCode,S=_.map(function(U,G){var q={logicalShape:U.shape,texShape:U.isUniform?null:U.texData.texShape,isUniform:U.isUniform,isPacked:!U.isUniform&&U.texData.isPacked,flatOffset:null};return null!=U.texData&&null!=U.texData.slice&&U.texData.slice.flatOffset>0&&(q.flatOffset=U.texData.slice.flatOffset),{name:b.variableNames[G],shapeInfo:q}}),D=S.map(function(U){return U.shapeInfo}),I={logicalShape:C.shape,texShape:C.texData.texShape,isUniform:!1,isPacked:C.texData.isPacked,flatOffset:null},O=yG(S,I,T,b.packedInputs),R=w.createProgram(O),V=null,L=w.getUniformLocation(R,"NAN",!1);1===P().getNumber("WEBGL_VERSION")&&(V=w.getUniformLocation(R,"INFINITY",!1));for(var B={},z=0;z<b.variableNames.length;z++){var H=b.variableNames[z];B[H]=w.getUniformLocation(R,H,!1),B["offset"+H]=w.getUniformLocation(R,"offset"+H,!1)}return{program:b,source:O,webGLProgram:R,uniformLocations:B,inShapeInfos:D,outShapeInfo:I,infLoc:V,nanLoc:L}}(a.gpgpu,e,f,p)}),v=null!=this.activeTimers;if(v&&(h=this.startTimer()),function(w,b,_,C,T){_M(b.inShapeInfos,_),_M([b.outShapeInfo],[C]);var S=C.texData.texture,D=C.texData.texShape;C.texData.isPacked?w.setOutputPackedMatrixTexture(S,D[0],D[1]):w.setOutputMatrixTexture(S,D[0],D[1]),w.setProgram(b.webGLProgram),1===P().getNumber("WEBGL_VERSION")&&null!==b.infLoc&&w.gl.uniform1f(b.infLoc,1/0),null!==b.nanLoc&&w.gl.uniform1f(b.nanLoc,NaN),_.forEach(function(I,O){var R=b.program.variableNames[O],V=b.uniformLocations[R],L=b.uniformLocations["offset"+R];if(null!=V)if(I.isUniform)if(ae(I.shape)<2)w.gl.uniform1f(V,I.uniformValues[0]);else{var B=I.uniformValues;B instanceof Float32Array||(B=new Float32Array(B)),w.gl.uniform1fv(V,B)}else null!=I.texData.slice&&null!=L&&w.gl.uniform1i(L,I.texData.slice.flatOffset),w.setInputMatrixTexture(I.texData.texture,V,O)}),T?.(w,b.webGLProgram),w.executeProgram()}(this.gpgpu,m,f,p,o),d.forEach(function(w){return a.disposeData(w.dataId)}),v&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)})),!P().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&!1===s){var y=this.unpackTensor(u);return this.disposeData(u.dataId),y}return u},n.prototype.compileAndRun=function(e,r,i,o,s){void 0===s&&(s=!1);var a=this.runWebGLProgram(e,r,i=i||r[0].dtype,o,s);return M.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},n.prototype.getAndSaveBinary=function(e,r){return e in this.binaryCache||(this.binaryCache[e]=r()),this.binaryCache[e]},n.prototype.getTextureManager=function(){return this.textureManager},n.prototype.dispose=function(){var e=this;this.disposed||(P().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){e.gpgpu.deleteProgram(e.binaryCache[r].webGLProgram),delete e.binaryCache[r]}),this.textureManager.dispose(),null!=this.canvas&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},n.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=te(function(){if(!P().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=P().getBool("DEBUG");P().set("DEBUG",!1);var i=e.abs(X(1e-8)).dataSync()[0];if(P().set("DEBUG",r),i>0)return 32}return 16})),this.floatPrecisionValue},n.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},n.prototype.uploadToGPU=function(e){var r,i=this.texData.get(e),o=i.shape,s=i.dtype,a=i.values,c=i.usage,l=i.isPacked;if(null==i.texture){var d,f=null!=this.activeTimers;f&&(d=Wr());var h=i.texShape;if(null==h&&(h=pT(o,l),i.texShape=h),null!=a){var p=rh(o),g=void 0,m=h[1],v=h[0],y=a instanceof Uint8Array;l?(m=(r=ol(h[0],h[1]))[0],g=new ZG(p,[v=r[1],m],y)):g=new XG(p,[v,m],y);var w=this.makeTensorInfo([v,m],s);this.texData.get(w.dataId).usage=y?cr.PIXELS:cr.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),m,v,a);var b=this.runWebGLProgram(g,[w],s,null,!0),_=this.texData.get(b.dataId);i.texture=_.texture,i.texShape=_.texShape,i.isPacked=_.isPacked,i.usage=_.usage,this.disposeData(w.dataId),this.texData.delete(b.dataId),i.values=null,f&&(this.uploadWaitMs+=Wr()-d)}else{var C=this.acquireTexture(h,c,s,l);i.texture=C}}},n.prototype.convertAndCacheOnCPU=function(e,r){var i=this.texData.get(e),o=i.dtype;return this.releaseGPUData(e),null!=r&&(i.values=function(s,a){if("float32"===a||"complex64"===a)return s;if("int32"===a||"bool"===a){for(var u="int32"===a?new Int32Array(s.length):new Uint8Array(s.length),c=0;c<u.length;++c)u[c]=Math.round(s[c]);return u}throw new Error("Unknown dtype "+a)}(r,o)),i.values},n.prototype.acquireTexture=function(e,r,i,o){if(this.numBytesInGPU+=this.computeBytes(e,i),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+s+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,r,o)},n.prototype.computeBytes=function(e,r){return e[0]*e[1]*vy(r)},n}(VT);Y2()&&M.registerBackend("webgl",function(){return new LM},2);var $$=A({square_:function(t){var n=x(t,"x","square");return M.runKernelFunc(function(r,i){return i([n]),r.square(n)},{x:n},null,"Square",{},[n],[])}}),yl="SquaredDifference",BM=A({squaredDifference_:function(t,n){var e,r=x(t,"a","squaredDifference"),i=x(n,"b","squaredDifference");return e=xt(r,i),Re((r=e[0]).shape,(i=e[1]).shape),M.runKernelFunc(function(a,u){var c=a.squaredDifference(r,i);return u([r,i]),c},{a:r,b:i},function(a,u){var c=u[0],l=u[1],d=X(2);return{a:function(){return a.mul(c.sub(l).mul(d))},b:function(){return a.mul(l.sub(c).mul(d))}}},yl,{},[r,i],[])}}),q$=A({abs_:function(t){var n=x(t,"x","abs");return"complex64"===n.dtype?M.runKernelFunc(function(e){return e.complexAbs(n)},{$x:n}):M.runKernelFunc(function(e,r){var i=e.abs(n);return r([n]),i},{x:n},function(e,r){var i=r[0];return{x:function(){return e.mul(i.toFloat().step(-1))}}},"Abs")}}),K$=A({acos_:function(t){var n=x(t,"x","acos");return M.runKernelFunc(function(e,r){var i=e.acos(n);return r([n]),i},{$x:n},function(e,r){var i=r[0];return{$x:function(){return e.divStrict(X(1).sub(i.toFloat().square()).sqrt()).neg()}}})}}),Y$=A({acosh_:function(t){var n=x(t,"x","acosh");return M.runKernelFunc(function(e,r){var i=e.acosh(n);return r([n]),i},{$x:n},function(e,r){var i=r[0];return{$x:function(){return e.divStrict(i.toFloat().square().sub(1).sqrt())}}})}}),X$=A({asin_:function(t){var n=x(t,"x","asin");return M.runKernelFunc(function(e,r){var i=e.asin(n);return r([n]),i},{$x:n},function(e,r){var i=r[0];return{$x:function(){return e.divStrict(X(1).sub(i.toFloat().square()).sqrt())}}})}}),Z$=A({asinh_:function(t){var n=x(t,"x","asinh");return M.runKernelFunc(function(e,r){var i=e.asinh(n);return r([n]),i},{$x:n},function(e,r){var i=r[0];return{$x:function(){return e.divStrict(X(1).add(i.toFloat().square()).sqrt())}}})}}),Q$=A({atan_:function(t){var n=x(t,"x","atan");return M.runKernelFunc(function(e,r){var i=e.atan(n);return r([n]),i},{$x:n},function(e,r){var i=r[0];return{$x:function(){return e.div(i.toFloat().square().add(1))}}})}}),J$=A({atanh_:function(t){var n=x(t,"x","atanh");return M.runKernelFunc(function(e,r){var i=e.atanh(n);return r([n]),i},{$x:n},function(e,r){var i=r[0];return{$x:function(){return e.div(X(1).sub(i.toFloat().square()))}}})}}),e9=A({ceil_:function(t){var n=x(t,"x","ceil");return M.runKernelFunc(function(e){return e.ceil(n)},{$x:n},function(e){return{$x:function(){return We(e)}}})}}),d0=A({clipByValue_:function(t,n,e){var r=x(t,"x","clipByValue");return E(n<=e,function(){return"Error in clip: min ("+n+") must be less than or equal to max ("+e+")."}),M.runKernelFunc(function(s,a){var u=s.clip(r,n,e);return a([r]),u},{x:r},function(s,a){var u=a[0];return{x:function(){return s.where(u.greaterEqual(n).logicalAnd(u.lessEqual(e)),We(s))}}},"ClipByValue",{min:n,max:e},[r])}}),t9=A({cos_:function(t){var n=x(t,"x","cos");return M.runKernelFunc(function(r,i){var o=r.cos(n);return i([n]),o},{x:n},function(r,i){var o=i[0];return{x:function(){return o.toFloat().sin().neg().mul(r)}}},"Cos",{},[n])}}),n9=A({cosh_:function(t){var n=x(t,"x","cosh");return M.runKernelFunc(function(e,r){var i=e.cosh(n);return r([n]),i},{$x:n},function(e,r){var i=r[0];return{$x:function(){return i.toFloat().sinh().mulStrict(e)}}})}}),r9=A({erf_:function(t){var n=x(t,"x","erf");return E("int32"===n.dtype||"float32"===n.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===n.dtype&&(n=n.toFloat()),M.runKernelFunc(function(e,r){var i=e.erf(n);return r([n]),i},{$x:n},function(e,r){var i=r[0];return{$x:function(){return e.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),f0=A({exp_:function(t){var n=x(t,"x","exp");return M.runKernelFunc(function(e,r){var i=e.exp(n);return r([i]),i},{x:n},function(e,r){return{x:function(){return e.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),i9=A({expm1_:function(t){var n=x(t,"x","expm1");return M.runKernelFunc(function(e,r){var i=e.expm1(n);return r([n]),i},{$x:n},function(e,r){var i=r[0];return{$x:function(){return e.mul(i.exp())}}})}}),o9=A({floor_:function(t){var n=x(t,"x","floor");return M.runKernelFunc(function(e){return e.floor(n)},{$x:n},function(e){return{$x:function(){return We(e)}}})}}),s9=A({log_:function(t){var n=x(t,"x","log");return M.runKernelFunc(function(r,i){var o=r.log(n);return i([n]),o},{x:n},function(r,i){var o=i[0];return{x:function(){return r.div(o.toFloat())}}},"Log",{},[n])}}),a9=A({log1p_:function(t){var n=x(t,"x","log1p");return M.runKernelFunc(function(e,r){var i=e.log1p(n);return r([n]),i},{$x:n},function(e,r){var i=r[0];return{$x:function(){return e.div(i.add(1))}}})}}),u9=A({logSigmoid_:function(t){var n=x(t,"x","logSigmoid");return M.runKernelFunc(function(e,r){var i=e.softplus(n.neg()).neg();return r([n]),i},{$x:n},function(e,r){var i=r[0];return{$x:function(){return e.mul(i.neg().sigmoid())}}})}}),xh=A({neg_:function(t){var n=x(t,"x","neg");return M.runKernelFunc(function(r){return r.neg(n)},{x:n},function(r){return{x:function(){return r.neg()}}},"Neg",{},[n])}}),c9=A({reciprocal_:function(t){var n=x(t,"x","reciprocal");return M.runKernelFunc(function(e,r){var i=e.reciprocal(n);return r([n]),i},{$x:n},function(e,r){var i=r[0];return{$x:function(){return e.div(i.square().neg())}}})}}),l9=A({round_:function(t){var n=x(t,"x","round");return M.runKernelFunc(function(e){return e.round(n)},{$x:n},function(e){return{$x:function(){return We(e)}}})}}),VM=A({rsqrt_:function(t){var n=x(t,"x","rsqrt");return M.runKernelFunc(function(r,i){var o=r.rsqrt(n);return i([n]),o},{x:n},function(r,i){var o=i[0];return{x:function(){return r.div(o.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},[n])}}),UM=A({sigmoid_:function(t){var n=x(t,"x","sigmoid");return M.runKernelFunc(function(e,r){var i=e.sigmoid(n);return r([i]),i},{x:n},function(e,r){var i=r[0];return{x:function(){return e.mul(i.mul(X(1).sub(i)))}}},"Sigmoid")}}),d9=A({sign_:function(t){var n=x(t,"x","sign");return M.runKernelFunc(function(e){return e.sign(n)},{$x:n},function(e){return{$x:function(){return We(e)}}})}}),f9=A({isNaN_:function(t){var n=x(t,"x","isNaN");return M.runKernelFunc(function(e){return e.isNaN(n)},{$x:n},function(e){return{$x:function(){return We(e)}}})}}),h9=A({isInf_:function(t){var n=x(t,"x","isInf");return M.runKernelFunc(function(e){return e.isInf(n)},{$x:n},function(e){return{$x:function(){return We(e)}}})}}),p9=A({isFinite_:function(t){var n=x(t,"x","isFinite");return M.runKernelFunc(function(e){return e.isFinite(n)},{$x:n},function(e){return{$x:function(){return We(e)}}})}}),g9=A({sin_:function(t){var n=x(t,"x","sin");return M.runKernelFunc(function(r,i){var o=r.sin(n);return i([n]),o},{x:n},function(r,i){var o=i[0];return{x:function(){return o.toFloat().cos().mul(r)}}},"Sin",{},[n])}}),m9=A({sinh_:function(t){var n=x(t,"x","sinh");return M.runKernelFunc(function(e,r){var i=e.sinh(n);return r([n]),i},{$x:n},function(e,r){var i=r[0];return{$x:function(){return i.toFloat().cosh().mulStrict(e)}}})}}),v9=A({softplus_:function(t){var n=x(t,"x","softplus");return M.runKernelFunc(function(e,r){var i=e.softplus(n);return r([n]),i},{$x:n},function(e,r){var i=r[0];return{$x:function(){return e.mul(i.sigmoid())}}})}}),y9=A({sqrt_:function(t){var n=x(t,"x","sqrt");return M.runKernelFunc(function(e,r){var i=e.sqrt(n);return r([n]),i},{$x:n},function(e,r){var i=r[0];return{$x:function(){return e.div(i.toFloat().sqrt().mul(2))}}})}}),b9=A({step_:function(t,n){void 0===n&&(n=0);var e=x(t,"x","step");return M.runKernelFunc(function(r){return r.step(e,n)},{$x:e},function(r){return{$x:function(){return We(r)}}})}}),w9=A({tan_:function(t){var n=x(t,"x","tan");return M.runKernelFunc(function(e,r){var i=e.tan(n);return r([n]),i},{$x:n},function(e,r){var i=r[0];return{$x:function(){return e.div(i.cos().square())}}})}}),_9=A({tanh_:function(t){var n=x(t,"x","tanh");return M.runKernelFunc(function(e,r){var i=e.tanh(n);return r([i]),i},{x:n},function(e,r){var i=r[0];return{x:function(){return X(1).sub(i.square()).mulStrict(e)}}},"Tanh",{},null,[!0])}});function HM(t,n,e,r,i,o){var s,a,u=x(t,"x","batchNorm"),c=x(n,"mean","batchNorm"),l=x(e,"variance","batchNorm");return null!=i&&(s=x(i,"scale","batchNorm")),null!=r&&(a=x(r,"offset","batchNorm")),E(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),E(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."}),E(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."}),null!=s&&E(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+s.rank+"."}),null!=a&&E(2===a.rank||1===a.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+a.rank+"."}),bl(u,c,l,a,s,o)}function jM(t,n,e,r,i,o){var s,a,u=x(t,"x","batchNorm"),c=x(n,"mean","batchNorm"),l=x(e,"variance","batchNorm");return null!=i&&(s=x(i,"scale","batchNorm")),null!=r&&(a=x(r,"offset","batchNorm")),E(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),E(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."}),E(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."}),null!=s&&E(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+s.rank+"."}),null!=a&&E(3===a.rank||1===a.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+a.rank+"."}),bl(u,c,l,a,s,o)}function WM(t,n,e,r,i,o){var s,a,u=x(t,"x","batchNorm"),c=x(n,"mean","batchNorm"),l=x(e,"variance","batchNorm");return null!=i&&(s=x(i,"scale","batchNorm")),null!=r&&(a=x(r,"offset","batchNorm")),E(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),E(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."}),E(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."}),null!=s&&E(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+s.rank+"."}),null!=a&&E(4===a.rank||1===a.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+a.rank+"."}),bl(u,c,l,a,s,o)}function bl(t,n,e,r,i,o){null==o&&(o=.001);var s,a,u,c=x(t,"x","batchNorm"),l=x(n,"mean","batchNorm"),d=x(e,"variance","batchNorm");return null!=i&&(s=x(i,"scale","batchNorm")),null!=r&&(a=x(r,"offset","batchNorm")),E(l.rank===d.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),E(null==a||l.rank===a.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),E(null==s||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=0===c.rank||1===c.rank?c.as4D(1,1,1,c.size):2===c.rank?c.as4D(1,1,c.shape[0],c.shape[1]):3===c.rank?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c,M.runKernelFunc(function(h,p){var g=h.batchNormalization(u,Eh(l),Eh(d),o,Eh(s),Eh(a));return p([c,l,d,s]),g},{x:c,mean:l,variance:d,scale:s,offset:a},function(h,p){var m=p[0],v=p[1],y=p[2],b=p[3]??X(1),_=Wt(v.shape,u.shape),C=[];if(1===v.rank){for(var T=0;T<u.shape.length-1;++T)C.push(u.shape[T]);C.push(1)}var S=m.sub(v),D=h.mul(b),I=VM(y.add(X(o))),O=I.mul(I).mul(I).mul(X(-.5));return{x:function(){return 1===v.rank?h.mul(nu(I.as4D(1,1,1,v.shape[0]),C)).mul(b).reshape(m.shape):h.mul(I).mul(b).reshape(m.shape)},mean:function(){var R=I.mul(X(-1)).mul(D);return 1===v.rank&&(R=R.sum(_)),R.reshape(v.shape)},variance:function(){var R=O.mul(S).mul(D);return 1===v.rank&&(R=R.sum(_)),R.reshape(v.shape)},scale:function(){var R=S.mul(I),V=h.mul(R);return 1===v.rank&&(V=V.sum(_)),V.reshape(v.shape)},offset:function(){var R=h;return 1===v.rank&&(R=R.sum(_)),R.reshape(v.shape)}}},"BatchNormalization",{varianceEpsilon:o},[c,l,d,s]).reshape(c.shape)}function Eh(t){return null==t?null:0===t.rank?t.as1D():1===t.rank?t:2===t.rank?t.as4D(1,1,t.shape[0],t.shape[1]):3===t.rank?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}function Dh(){_T("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var C9=A({batchNormalization2d_:function(t,n,e,r,i,o){return void 0===r&&(r=.001),Dh(),HM(t,n,e,o,i,r)}}),x9=A({batchNormalization3d_:function(t,n,e,r,i,o){return void 0===r&&(r=.001),Dh(),jM(t,n,e,o,i,r)}}),E9=A({batchNormalization4d_:function(t,n,e,r,i,o){return void 0===r&&(r=.001),Dh(),WM(t,n,e,o,i,r)}}),D9=A({batchNormalization_:function(t,n,e,r,i,o){return void 0===r&&(r=.001),Dh(),bl(t,n,e,o,i,r)}}),zM=A({batchNorm_:bl}),I9=A({batchNorm2d_:HM}),S9=A({batchNorm3d_:jM}),T9=A({batchNorm4d_:WM}),Ih=A({logicalAnd_:function(t,n){var e=x(t,"a","logicalAnd","bool"),r=x(n,"b","logicalAnd","bool");return Re(e.shape,r.shape),M.runKernelFunc(function(i){return i.logicalAnd(e,r)},{a:e,b:r},null,"LogicalAnd")}}),M9=A({logicalNot_:function(t){var n=x(t,"x","logicalNot","bool");return M.runKernelFunc(function(e){return e.logicalNot(n)},{$x:n})}}),GM=A({logicalOr_:function(t,n){var e=x(t,"a","logicalOr","bool"),r=x(n,"b","logicalOr","bool");return Re(e.shape,r.shape),M.runKernelFunc(function(i){return i.logicalOr(e,r)},{$a:e,$b:r})}}),A9=A({logicalXor_:function(t,n){var e=x(t,"a","logicalXor","bool"),r=x(n,"b","logicalXor","bool");return Re(e.shape,r.shape),GM(t,n).logicalAnd(Ih(t,n).logicalNot())}}),Ms=A({where_:function(t,n,e){var r=x(n,"a","where"),i=x(e,"b","where"),o=x(t,"condition","where","bool");return je(r.shape,i.shape,"Error in where: "),1===o.rank?E(o.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):je(o.shape,i.shape,"Error in where: "),M.runKernelFunc(function(s,a){var u=s.select(o,r,i);return a([o]),u},{$condition:o,$a:r,$b:i},function(s,a){var u=a[0];return{$condition:function(){return We(u).toFloat()},$a:function(){return s.mul(u.cast(s.dtype))},$b:function(){return s.mul(u.logicalNot().cast(s.dtype))}}})}}),$M=function(t){return ie(this,void 0,void 0,function(){var n,e,r;return oe(this,function(i){switch(i.label){case 0:return[4,(n=x(t,"condition","whereAsync","bool")).data()];case 1:return e=i.sent(),r=e0(n.shape,e),t!==n&&n.dispose(),[2,r]}})})},Oe=A({add_:function(t,n){var e,r=x(t,"a","add"),i=x(n,"b","add");e=xt(r,i);var o=Re((r=e[0]).shape,(i=e[1]).shape);return M.runKernelFunc(function(s){return s.add(r,i)},{a:r,b:i},function(s){return{a:function(){var a=s,u=Wt(r.shape,o);return u.length>0&&(a=a.sum(u)),a.reshape(r.shape)},b:function(){var a=s,u=Wt(i.shape,o);return u.length>0&&(a=a.sum(u)),a.reshape(i.shape)}}},"Add")}}),R9=A({addN_:function(t){E(Array.isArray(t),function(){return"The argument passed to tf.addN() must be a list of tensors"}),E(t.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+t.length});var n=t.map(function(i,o){return x(i,"tensors"+o,"addN")}),e=n[0];return n.forEach(function(i){if(i.dtype!==e.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),n.forEach(function(i){if(!Ut(i.shape,e.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}),M.runKernelFunc(function(i){return i.addN(n)},n,function(i){var o={};return n.forEach(function(s,a){o[a]=function(){return i.clone()}}),o},"AddN")}}),O9=A({addStrict_:function(t,n){var e=x(t,"a","addStrict"),r=x(n,"b","addStrict");return je(e.shape,r.shape,"Error in addStrict: "),e.add(r)}}),N9=A({atan2_:function(t,n){var e,r=x(t,"a","atan2"),i=x(n,"b","atan2");e=xt(r,i);var o=Re((r=e[0]).shape,(i=e[1]).shape);return M.runKernelFunc(function(s,a){var u=s.atan2(r,i);return a([r,i]),u},{$a:r,$b:i},function(s,a){var u=a[0],c=a[1];return{$a:function(){var l=Oe(u.square(),c.square()),d=s.mul(c.div(l)),f=Wt(u.shape,o);return f.length>0&&(d=d.sum(f)),d.reshape(u.shape)},$b:function(){var l=Oe(u.square(),c.square()),d=xh(s.mul(u.div(l))),f=Wt(c.shape,o);return f.length>0&&(d=d.sum(f)),d.reshape(c.shape)}}})}}),Kr=A({div_:function(t,n){var e,r=x(t,"a","div"),i=x(n,"b","div");if(e=xt(r,i),i=e[1],"int32"===(r=e[0]).dtype&&"int32"===i.dtype)return qM(r,i);var o=Re(r.shape,i.shape);return M.runKernelFunc(function(s,a){var u=s.realDivide(r,i);return a([r,i]),u},{a:r,b:i},function(s,a){var u=a[0],c=a[1];return{a:function(){var l=s.div(c.toFloat()),d=Wt(u.shape,o);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=s.mul(u.toFloat()),d=Wt(c.shape,o);d.length>0&&(l=l.sum(d).reshape(c.shape));var f=c.square();return l.div(f.toFloat()).neg()}}},"Div")}}),k9=A({divNoNan_:function(t,n){var e,r=x(t,"a","div"),i=x(n,"b","div");r=(e=xt(r,i))[0];var o=Kr(r,i=e[1]),s=We(o),a=i.equal(s);return Ms(a,s,o)}}),P9=A({divStrict_:function(t,n){var e=x(t,"a","div"),r=x(n,"b","div");return je(e.shape,r.shape,"Error in divideStrict: "),e.div(r)}}),qM=A({floorDiv_:function(t,n){var e,r=x(t,"a","floorDiv"),i=x(n,"b","floorDiv");e=xt(r,i);var o=Re((r=e[0]).shape,(i=e[1]).shape);return M.runKernelFunc(function(s,a){var u=s.floorDiv(r,i);return a([r,i]),u},{a:r,b:i},function(s,a){var u=a[0],c=a[1];return{a:function(){var l=s.div(c.toFloat()),d=Wt(u.shape,o);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=s.mul(u.toFloat()),d=Wt(c.shape,o);d.length>0&&(l=l.sum(d).reshape(c.shape));var f=c.square();return l.div(f.toFloat()).neg()}}},"FloorDiv")}}),h0=A({maximum_:function(t,n){var e,r=x(t,"a","maximum"),i=x(n,"b","maximum");return e=xt(r,i),i=e[1],"bool"===(r=e[0]).dtype&&(r=r.toInt(),i=i.toInt()),Re(r.shape,i.shape),M.runKernelFunc(function(o,s){var a=o.maximum(r,i);return s([r,i]),a},{a:r,b:i},function(o,s){var a=s[0],u=s[1];return{a:function(){return o.mul(a.greaterEqual(u).toFloat())},b:function(){return o.mul(a.less(u).toFloat())}}},"Maximum")}}),F9=A({maximumStrict_:function(t,n){var e=x(t,"a","maximumStrict"),r=x(n,"b","maximumStrict");return je(e.shape,r.shape,"Error in maximumStrict: "),e.maximum(r)}}),KM=A({minimum_:function(t,n){var e,r=x(t,"a","minimum"),i=x(n,"b","minimum");return e=xt(r,i),i=e[1],"bool"===(r=e[0]).dtype&&(r=r.toInt(),i=i.toInt()),Re(r.shape,i.shape),M.runKernelFunc(function(o,s){var a=o.minimum(r,i);return s([r,i]),a},{a:r,b:i},function(o,s){var a=s[0],u=s[1];return{a:function(){return o.mul(a.lessEqual(u).toFloat())},b:function(){return o.mul(a.greater(u).toFloat())}}},"Minimum")}}),L9=A({minimumStrict_:function(t,n){var e=x(t,"a","minimumStrict"),r=x(n,"b","minimumStrict");return je(e.shape,r.shape,"Error in minimumStrict: "),e.minimum(r)}}),B9=A({mod_:function(t,n){var e,r=x(t,"a","mod"),i=x(n,"b","mod");e=xt(r,i);var o=Re((r=e[0]).shape,(i=e[1]).shape);return M.runKernelFunc(function(s,a){var u=s.mod(r,i);return a([r,i]),u},{$a:r,$b:i},function(s,a){var u=a[0],c=a[1];return{$a:function(){var l=Wt(u.shape,o);return l.length>0?s.sum(l).reshape(u.shape):s},$b:function(){var l=s.mul(u.div(c).floor().neg()),d=Wt(c.shape,o);return d.length>0?l.sum(d).reshape(c.shape):l}}})}}),V9=A({modStrict_:function(t,n){var e=x(t,"a","modStrict"),r=x(n,"b","modStrict");return je(e.shape,r.shape,"Error in modStrict: "),e.mod(r)}}),Cn=A({mul_:function(t,n){var e,r=x(t,"a","mul"),i=x(n,"b","mul");e=xt(r,i);var o=Re((r=e[0]).shape,(i=e[1]).shape);return M.runKernelFunc(function(s,a){var u=s.multiply(r,i);return a([r,i]),u},{a:r,b:i},function(s,a){var u=a[0],c=a[1];return{a:function(){var l=s.mul(c.toFloat()),d=Wt(u.shape,o);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=s.mul(u.toFloat()),d=Wt(c.shape,o);return d.length>0?l.sum(d).reshape(c.shape):l}}},"Mul")}}),U9=A({mulStrict_:function(t,n){var e=x(t,"a","mul"),r=x(n,"b","mul");return je(e.shape,r.shape,"Error in multiplyStrict: "),e.mul(r)}}),Sh=A({pow_:function(t,n){var e,r=x(t,"base","pow"),i=x(n,"exp","pow");e=xt(r,i);var o=Re((r=e[0]).shape,(i=e[1]).shape);return M.runKernelFunc(function(a,u){var c=a.pow(r,i);return u([r,i,c]),c},{a:r,b:i},function(a,u){var c=u[0],l=u[1],d=u[2];return{a:function(){var f=l.toFloat(),h=a.mul(f.mul(c.pow(f.sub(X(1))))),p=Wt(c.shape,o);return p.length>0&&(h=h.sum(p)),h.reshape(c.shape)},b:function(){var f=c.greater(0),h=c.log().where(f,We(c)),p=a.mul(d.mul(h)),g=Wt(l.shape,o);return g.length>0&&(p=p.sum(g)),p.reshape(l.shape)}}},"Pow",{},[r,i],[!0])}}),H9=A({powStrict_:function(t,n){return je(t.shape,n.shape,"Error in powStrict: "),t.pow(n)}}),j9=A({squaredDifferenceStrict_:function(t,n){var e=x(t,"a","squaredDifferenceStrict"),r=x(n,"b","squaredDifferenceStrict");return je(e.shape,r.shape,"Error in squaredDifferenceStrict: "),e.squaredDifference(r)}}),Zt=A({sub_:function(t,n){var e,r=x(t,"a","sub"),i=x(n,"b","sub");e=xt(r,i);var o=Re((r=e[0]).shape,(i=e[1]).shape);return M.runKernelFunc(function(s){return s.subtract(r,i)},{a:r,b:i},function(s){return{a:function(){var a=s,u=Wt(r.shape,o);return u.length>0&&(a=a.sum(u)),a.reshape(r.shape)},b:function(){var a=s,u=Wt(i.shape,o);return u.length>0&&(a=a.sum(u)),a.neg().reshape(i.shape)}}},"Sub")}}),W9=A({subStrict_:function(t,n){var e=x(t,"a","subStrict"),r=x(n,"b","subStrict");return je(e.shape,r.shape,"Error in subStrict: "),e.sub(r)}}),YM=A({equal_:function(t,n){var e,r=x(t,"a","equal"),i=x(n,"b","equal");return e=xt(r,i),Re((r=e[0]).shape,(i=e[1]).shape),M.runKernelFunc(function(o){return o.equal(r,i)},{$a:r,$b:i})}}),z9=A({equalStrict_:function(t,n){var e=x(t,"a","equalStrict"),r=x(n,"b","equalStrict");return je(e.shape,r.shape,"Error in equalStrict: "),e.equal(r)}}),G9=A({greater_:function(t,n){var e,r=x(t,"a","greater"),i=x(n,"b","greater");return e=xt(r,i),Re((r=e[0]).shape,(i=e[1]).shape),M.runKernelFunc(function(o){return o.greater(r,i)},{a:r,b:i},null,"Greater")}}),XM=A({greaterEqual_:function(t,n){var e,r=x(t,"a","greaterEqual"),i=x(n,"b","greaterEqual");return e=xt(r,i),Re((r=e[0]).shape,(i=e[1]).shape),M.runKernelFunc(function(o,s){var a=o.greaterEqual(r,i);return s([r,i]),a},{a:r,b:i},function(o,s){var a=s[0],u=s[1];return{a:function(){return We(a)},b:function(){return We(u)}}},"GreaterEqual")}}),$9=A({greaterEqualStrict_:function(t,n){var e=x(t,"a","greaterEqualStrict"),r=x(n,"b","greaterEqualStrict");return je(e.shape,r.shape,"Error in greaterEqualStrict: "),e.greaterEqual(r)}}),q9=A({greaterStrict_:function(t,n){var e=x(t,"a","greaterStrict"),r=x(n,"b","greaterStrict");return je(e.shape,r.shape,"Error in greaterStrict: "),e.greater(r)}}),K9=A({less_:function(t,n){var e,r=x(t,"a","less"),i=x(n,"b","less");return e=xt(r,i),Re((r=e[0]).shape,(i=e[1]).shape),M.runKernelFunc(function(o){return o.less(r,i)},{a:r,b:i},null,"Less")}}),Y9=A({lessEqual_:function(t,n){var e,r=x(t,"a","lessEqual"),i=x(n,"b","lessEqual");return e=xt(r,i),Re((r=e[0]).shape,(i=e[1]).shape),M.runKernelFunc(function(o,s){var a=o.lessEqual(r,i);return s([r,i]),a},{a:r,b:i},null,"LessEqual")}}),X9=A({lessEqualStrict_:function(t,n){var e=x(t,"a","lessEqualStrict"),r=x(n,"b","lessEqualStrict");return je(e.shape,r.shape,"Error in lessEqualStrict: "),e.lessEqual(r)}}),Z9=A({lessStrict_:function(t,n){var e=x(t,"a","lessStrict"),r=x(n,"b","lessStrict");return je(e.shape,r.shape,"Error in lessStrict: "),e.less(r)}}),Q9=A({notEqual_:function(t,n){var e,r=x(t,"a","notEqual"),i=x(n,"b","notEqual");return e=xt(r,i),Re((r=e[0]).shape,(i=e[1]).shape),M.runKernelFunc(function(o){return o.notEqual(r,i)},{a:r,b:i},null,"NotEqual")}}),J9=A({notEqualStrict_:function(t,n){var e=x(t,"a","notEqualStrict"),r=x(n,"b","notEqualStrict");return je(e.shape,r.shape,"Error in notEqualStrict: "),e.notEqual(r)}});function ZM(t,n){for(var e=[],r=t;r<n;++r)e.push(r);return e}function QM(t){for(var n=[],e=0;e<t.length;++e)for(var r=0;r<t[e].length;++r)n.push(t[e][r]);return n}var p0=A({gather_:function(t,n,e){void 0===e&&(e=0);var r=x(t,"x","gather"),i=x(n,"indices","gather","int32");e=Ht(e,r.shape)[0];var o=function(s,a,u){for(var c=s.shape[u],l=[],d=1,f=1,h=0;h<u;h++)l.push(s.shape[h]),d*=s.shape[h];for(h=0;h<a.rank;h++)l.push(a.shape[h]);for(h=u+1;h<s.rank;h++)l.push(s.shape[h]),f*=s.shape[h];return{batchSize:d,sliceSize:f,dimSize:c,outputShape:l}}(r,i,e);return M.runKernelFunc(function(s,a){var u=s.gather(r,i.flatten(),e);return a([i]),u},{x:r,indices:i},function(s,a){var u=a[0];return{x:function(){var c=r.shape,l=u.size,d=c.slice(0,e),f=d.length,h=c.slice(e,c.length).slice(1),p=h.length,g=ZM(0,f),m=ZM(f+1,f+1+p),v=QM([d,[l],h]),y=s.reshape(v),w=u.reshape([l]),b=QM([[f],g,m]),_=y.transpose(b),C=JM(_,w,r.shape[e]),T=sh(b);return C.transpose(T)},indices:function(){return u}}},"Gather",{axis:e}).reshape(o.outputShape)}}),JM=A({unsortedSegmentSum_:function(t,n,e){var r=x(t,"x","unsortedSegmentSum"),i=x(n,"segmentIds","unsortedSegmentSum","int32");return E(Dt(e),function(){return"numSegments must be of dtype int"}),M.runKernelFunc(function(o,s){var a=o.unsortedSegmentSum(r,i,e);return s([i]),a},{$x:r},function(o,s){var a=s[0];return{$x:function(){return function(u,c){for(var l=h0(c,We(c)),d=p0(u,l),f=XM(c,X(0,"int32")),h=d.rank-f.rank,p=0;p<h;++p)f=Tr(f,p+1);f=Ih(f,tu(d.shape,"bool"));var g=We(d);return Ms(f,d,g)}(o,a)}}})}});function eA(t,n,e,r,i,o,s){void 0===o&&(o="NHWC"),E(t.length===n.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+n.rank+") must match"});var a=t,u=n,c=!1;3===n.rank&&(c=!0,u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]),a=[1,t[0],t[1],t[2]]),E(4===a.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."}),E(4===u.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),E(4===e.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+e.rank});var l="NHWC"===o?a[3]:a[1],d="NHWC"===o?u.shape[3]:u.shape[1];E(l===e.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+e.shape[2]+"."}),E(d===e.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+e.shape[3]+"."}),null!=s&&E(Dt(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var f=vh(o),h=Vo(a,e.shape,r,1,i,s,!1,f),p=M.runKernelFunc(function(g,m){var v=g.conv2dDerInput(u,e,h);return m([e,u]),v},{dy4D:u,filter:e},function(g,m){var v=m[0],y=m[1];return{dy4D:function(){return Mr(g,v,r,i,o,1,s)},filter:function(){return m0(g,y,v.shape,r,i,o,s)}}});return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function g0(t){var o,n="number"==typeof(o=t)?[o,o,o]:2===o.length?[o[0],o[1],1]:o;return 1===n[0]&&1===n[1]&&1===n[2]}function tA(t,n,e,r,i){E(t.length===n.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+n.rank+") must match"});var o=t,s=n,a=!1;4===n.rank&&(a=!0,s=n.as5D(1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]),o=[1,t[0],t[1],t[2],t[3]]);var u=o[4],c=s.shape[4];E(5===o.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."}),E(5===s.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+s.rank}),E(5===e.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+e.rank}),E(u===e.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+e.shape[3]+"."}),E(c===e.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+e.shape[4]+"."});var l=pl(o,e.shape,r,1,i),d=M.runKernelFunc(function(f){return f.conv3dDerInput(s,e,l)},{dy5D:s});return a?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var tq=A({conv1d_:function(t,n,e,r,i,o,s){void 0===i&&(i="NWC"),void 0===o&&(o=1);var a=x(t,"x","conv1d"),u=x(n,"filter","conv1d"),c=a,l=!1;2===a.rank&&(l=!0,c=a.as3D(1,a.shape[0],a.shape[1])),E(3===c.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."}),E(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=s&&E(Dt(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."}),E(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),E(Un(e,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+e+" and dilation '"+o+"'"}),E("NWC"===i,function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var d=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),h=Mr(f,d,[1,e],r,"NHWC",[1,o],s);return l?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),Mr=A({conv2d_:function(t,n,e,r,i,o,s){void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]);var a=x(t,"x","conv2d"),u=x(n,"filter","conv2d"),c=a,l=!1;3===a.rank&&(l=!0,c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),E(4===c.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."}),E(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=s&&E(Dt(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."});var d="NHWC"===i?c.shape[3]:c.shape[1];E(d===u.shape[2],function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+u.shape[2]+"."}),E(Un(e,o),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+o+"'"});var f=vh(i),h=Vo(c.shape,u.shape,e,o,r,s,!1,f),g=M.runKernelFunc(function(m,v){var y=m.conv2d(c,u,h);return v([u,c]),y},{x:c,filter:u},function(m,v){var w=v[0],b=v[1];return E(Is(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}),{x:function(){return nA(b.shape,m,w,e,r,i)},filter:function(){return m0(b,m,w.shape,e,r,i)}}},"Conv2D",h,[u,c]);return l?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),nq=A({conv3d_:function(t,n,e,r,i,o){void 0===i&&(i="NDHWC"),void 0===o&&(o=[1,1,1]);var h,s=x(t,"x","conv3d"),a=x(n,"filter","conv3d"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),E(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),E(5===a.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+a.rank+"."}),E(u.shape[4]===a.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+a.shape[3]+"."}),E((h=o,g0(e)||g0(h)),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+o+"'"}),E("NDHWC"===i,function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."});var l=pl(u.shape,a.shape,e,o,r),d=M.runKernelFunc(function(f,h){var p=f.conv3d(u,a,l);return h([u,a]),p},{x:u,$filter:a},function(f,h){E(g0(o),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var p=h[0],g=h[1];return{x:function(){return tA(p.shape,f,g,e,r)},$filter:function(){return function(m,v,y,w,b){var _=m;4===m.rank&&(_=m.as5D(1,m.shape[0],m.shape[1],m.shape[2],m.shape[3]));var C=v;4===C.rank&&(C=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3])),E(5===_.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+_.shape+"."}),E(5===C.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+C.shape+"."}),E(5===y.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+y+"."}),E(_.shape[4]===y[3],function(){return"Error in conv3dDerFilter: depth of input "+_.shape[4]+") must match input depth in filter ("+y[3]+"."}),E(C.shape[4]===y[4],function(){return"Error in conv3dDerFilter: depth of dy ("+C.shape[4]+") must match output depth for filter ("+y[4]+")."});var T=pl(_.shape,y,w,1,b);return M.runKernelFunc(function(S){return S.conv3dDerFilter(_,C,T)},{x5D:_,dy5D:C})}(p,f,g.shape,e,r)}}});return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),m0=A({conv2dDerFilter_:function(t,n,e,r,i,o,s){void 0===o&&(o="NHWC");var a=t;3===t.rank&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var u=n;3===u.rank&&(u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),E(4===a.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."}),E(4===u.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),E(4===e.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+e+"."});var c="NHWC"===o?a.shape[3]:a.shape[1],l="NHWC"===o?u.shape[3]:u.shape[1];E(c===e[2],function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+e[2]+"."}),E(l===e[3],function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+e[3]+")."}),null!=s&&E(Dt(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var d=vh(o),f=Vo(a.shape,e,r,1,i,s,!1,d);return M.runKernelFunc(function(h){return h.conv2dDerFilter(a,u,f)},{x4D:a,dy4D:u})}}),nA=A({conv2dDerInput_:eA}),Th=A({depthwiseConv2d_:function(t,n,e,r,i,o,s){void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]);var a=x(t,"x","depthwiseConv2d"),u=x(n,"filter","depthwiseConv2d"),c=a,l=!1;3===a.rank&&(l=!0,c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),E(4===c.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."}),E(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),E(c.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==o&&(o=[1,1]),E(Un(e,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+o+"'"}),null!=s&&E(Dt(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."});var d=Vo(c.shape,u.shape,e,o,r,s,!0),h=M.runKernelFunc(function(p,g){var m=p.depthwiseConv2D(c,u,d);return g([c,u]),m},{x:c,filter:u},function(p,g){E(Is(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var m=g[0],v=g[1];return{x:function(){return rA(m.shape,p,v,d)},filter:function(){return iA(m,p,v.shape,d)}}},"DepthwiseConv2dNative",d,[c,u]);return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),rA=A({depthwiseConv2dDerInput_:function(t,n,e,r){var i=n,o=!1;3===n.rank&&(o=!0,i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var s=M.runKernelFunc(function(a){return a.depthwiseConv2DDerInput(i,e,r)},{dy4D:i});return o?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),iA=A({depthwiseConv2dDerFilter_:function(t,n,e,r){var i=t;3===t.rank&&(i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=n;return 3===o.rank&&(o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),M.runKernelFunc(function(s){return s.depthwiseConv2DDerFilter(i,o,r)},{x4D:i,dy4D:o})}}),v0=A({separableConv2d_:function(t,n,e,r,i,o,s){void 0===o&&(o=[1,1]),void 0===s&&(s="NHWC");var a=x(t,"x","separableConv2d"),u=x(n,"depthwiseFilter","separableConv2d"),c=x(e,"pointwiseFilter","separableConv2d"),l=a,d=!1;if(3===a.rank&&(d=!0,l=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),"NCHW"===s)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");E(4===l.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."}),E(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),E(4===c.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),E(1===c.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."}),E(1===c.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."});var f=u.shape[2],h=u.shape[3];E(c.shape[2]===f*h,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*h+", but got "+c.shape[2]+"."});var p=Th(l,u,r,i,s,o),g=Mr(p,c,1,"valid",s);return d?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),rq=A({conv2dTranspose_:function(t,n,e,r,i,o){return eA(e,x(t,"x","conv2dTranspose"),x(n,"filter","conv2dTranspose"),r,i,"NHWC",o)}}),iq=A({conv3dTranspose_:function(t,n,e,r,i){return tA(e,x(t,"x","conv3dTranspose"),x(n,"filter","conv3dTranspose"),r,i)}}),Mh=A({matMul_:function(t,n,e,r){var i;void 0===e&&(e=!1),void 0===r&&(r=!1);var o=x(t,"a","matMul"),s=x(n,"b","matMul");i=xt(o,s),o=i[0],s=i[1];var a=e?o.shape[o.rank-2]:o.shape[o.rank-1],u=r?s.shape[s.rank-1]:s.shape[s.rank-2],c=e?o.shape[o.rank-1]:o.shape[o.rank-2],l=r?s.shape[s.rank-2]:s.shape[s.rank-1],d=o.shape.slice(0,-2),f=s.shape.slice(0,-2),h=ae(d),p=ae(f);E(o.rank>=2&&s.rank>=2&&o.rank===s.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+s.rank+"."}),E(Ut(d,f),function(){return"Error in matMul: outer dimensions ("+d+") and ("+f+") of Tensors with shapes "+o.shape+" and "+s.shape+" must match."}),E(a===u,function(){return"Error in matMul: inner shapes ("+a+") and ("+u+") of Tensors with shapes "+o.shape+" and "+s.shape+" and transposeA="+e+" and transposeB="+r+" must match."});var g=o.shape.slice(0,-2).concat([c,l]),m=e?o.as3D(h,a,c):o.as3D(h,c,a),v=r?s.as3D(p,l,u):s.as3D(p,u,l);return M.runKernelFunc(function(w,b){var _=w.batchMatMul(m,v,e,r);return b([m,v]),_},{a:m,b:v},function(w,b){var C=b[0],T=b[1];return e||r?!e&&r?{a:function(){return w.matMul(T,!1,!1)},b:function(){return w.matMul(C,!0,!1)}}:e&&!r?{a:function(){return T.matMul(w,!1,!0)},b:function(){return C.matMul(w,!1,!1)}}:{a:function(){return T.matMul(w,!0,!0)},b:function(){return w.matMul(C,!0,!0)}}:{a:function(){return w.matMul(T,!1,!0)},b:function(){return C.matMul(w,!0,!1)}}},"BatchMatMul",{transposeA:e,transposeB:r}).reshape(g)}}),oq=A({dot_:function(t,n){var e=x(t,"t1","dot"),r=x(n,"t2","dot");E(!(1!==e.rank&&2!==e.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+e.rank+" and "+r.rank+"."});var i=1===e.rank?e.size:e.shape[1],o=1===r.rank?r.size:r.shape[0];return E(i===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."}),1===e.rank&&1===r.rank?e.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===e.rank&&2===r.rank?e.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===e.rank&&1===r.rank?e.matMul(r.as2D(-1,1)).as1D():e.matMul(r.as2D(r.shape[0],r.shape[1]))}}),sq=A({outerProduct_:function(t,n){var e=x(t,"v1","outerProduct"),r=x(n,"v2","outerProduct");return E(1===e.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+e.rank+" and "+r.rank+"."}),e.as2D(-1,1).matMul(r.as2D(1,-1))}}),wl=A({reverse_:function(t,n){var e=x(t,"x","reverse");if(0===e.rank)return e.clone();var r=Ht(n,e.shape);return M.runKernelFunc(function(i){return i.reverse(e,r)},{$x:e},function(i){return{$x:function(){return i.reverse(r)}}}).reshapeAs(e)}}),aq=A({reverse1d_:function(t){var n=x(t,"x","reverse");return E(1===n.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+n.rank+"."}),wl(n,0)}}),uq=A({reverse2d_:function(t,n){var e=x(t,"x","reverse");return E(2===e.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+e.rank+"."}),wl(e,n)}}),cq=A({reverse3d_:function(t,n){var e=x(t,"x","reverse");return E(3===e.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+e.rank+"."}),wl(e,n)}}),lq=A({reverse4d_:function(t,n){var e=x(t,"x","reverse");return E(4===e.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+e.rank+"."}),wl(e,n)}});function oA(t,n,e,r,i,o){var s=x(t,"x","maxPool"),a=s,u=!1;3===s.rank&&(u=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),null==r&&(r=[1,1]),E(4===a.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+a.rank+"."}),E(Un(e,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+r+"'"}),null!=o&&E(Dt(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var c=ru(a.shape,n,e,r,i,o);if(1===c.filterWidth&&1===c.filterHeight&&Ut(c.inShape,c.outShape))return s.clone();var d=M.runKernelFunc(function(f,h){var p=f.maxPool(a,c);return h([a,p]),p},{x:a},function(f,h){var p=h[0],g=h[1];return{x:function(){return function(m,v,y,w,b,_,C,T){var S=x(m,"dy","maxPoolBackprop"),D=x(v,"input","maxPoolBackprop"),I=x(y,"output","maxPoolBackprop");E(D.rank===S.rank,function(){return"Rank of input ("+D.rank+") does not match rank of dy ("+S.rank+")"}),null==_&&(_=[1,1]),E(Un(b,_),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+_+"'"}),E(4===S.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+S.rank+"."}),E(4===D.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+D.rank+"."});var O=ru(D.shape,w,b,_,C,void 0);return M.runKernelFunc(function(R){return R.maxPoolBackprop(S,D,I,O)},{$dy:S,$input:D})}(f,p,g,n,e,r,i)}}},"MaxPool",c,[a]);return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function sA(t,n,e,r,i,o){var s=x(t,"x","avgPool","float32");null==r&&(r=[1,1]),E(Un(e,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+r+"'"});var a=s,u=!1;3===s.rank&&(u=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),E(4===a.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+a.rank+"."}),null!=o&&E(Dt(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var c=ru(a.shape,n,e,r,i,o);if(1===c.filterWidth&&1===c.filterHeight&&Ut(c.inShape,c.outShape))return s.clone();var l=M.runKernelFunc(function(d){return d.avgPool(a,c)},{x:a},function(d){return{x:function(){return function(f,h,p,g,m,v){var y=x(f,"dy","avgPoolBackprop"),w=x(h,"input","avgPoolBackprop");E(w.rank===y.rank,function(){return"Rank of input ("+w.rank+") does not match rank of dy ("+y.rank+")"}),null==m&&(m=[1,1]),E(Un(g,m),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+g+" and dilations '"+m+"'"});var b=w,_=y,C=!1;3===w.rank&&(C=!0,b=w.as4D(1,w.shape[0],w.shape[1],w.shape[2]),_=y.as4D(1,y.shape[0],y.shape[1],y.shape[2])),E(4===_.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+_.rank+"."}),E(4===b.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+b.rank+"."});var T=ru(b.shape,p,g,m,v),S=M.runKernelFunc(function(D){return D.avgPoolBackprop(_,b,T)},{dy4D:_,input4D:b});return C?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}(d,a,n,e,r,i)}}},"AvgPool",c);return l=l.cast(s.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var nn=A({maxPool_:function(t,n,e,r,i){return oA(t,n,e,1,r,i)}}),_l=A({avgPool_:function(t,n,e,r,i){return sA(t,n,e,1,r,i)}}),dq=A({pool_:function(t,n,e,r,i,o){null==i&&(i=[1,1]),null==o&&(o=1),0===r&&(r="valid");var s=x(t,"x","maxPool"),a=s,u=!1;3===s.rank&&(u=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),E(Un(o,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"});var c,_,C,T,S,l=ru(a.shape,n,o,i,r),d=[l.dilationHeight,l.dilationWidth];c="same"===r?(_=d,C=[l.filterHeight,l.filterWidth].map(function(D,I){return D+(D-1)*(_[I]-1)}).map(function(D){return D-1}),T=C.map(function(D){return Math.floor(D/2)}),S=C.map(function(D,I){return D-T[I]}),C.map(function(D,I){return[T[I],S[I]]})):[[0,0],[0,0]];var f=1===d[0]&&1===d[1],h=function(b,_,C){var T=C.map(function(L){return L[0]}),S=C.map(function(L){return L[1]}),D=b.concat(T,S),I=_.map(function(L,B){return(L-D[B]%L)%L}),O=S.map(function(L,B){return L+I[B]});return[_.map(function(L,B){return[T[B],O[B]]}),_.map(function(L,B){return[0,I[B]]})]}([l.inHeight,l.inWidth],d,c),g=h[1],m=f?r:"valid",v=f?a:MT(a,d,h[0]),y=("avg"===e?function(){return sA(v,n,o,1,m)}:function(){return oA(v,n,o,1,m)})(),w=f?y:IT(y,d,g);return u?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}}),fq=A({maxPool3d_:function(t,n,e,r,i,o,s){void 0===o&&(o="NDHWC");var a=x(t,"x","maxPool3d"),u=a,c=!1;4===a.rank&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),null==s&&(s=[1,1,1]),E(5===u.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),E("NDHWC"===o,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),E(Un(e,s),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+s+"'"}),null!=i&&E(Dt(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var l=hl(u.shape,n,e,s,r,i,o),d=M.runKernelFunc(function(f,h){var p=f.maxPool3d(u,l);return h([u,p]),p},{x:u},function(f,h){var p=h[0],g=h[1];return{x:function(){return function(m,v,y,w,b,_,C,T){var S=x(m,"dy","maxPool3dBackprop"),D=x(v,"input","maxPool3dBackprop"),I=x(y,"output","maxPool3dBackprop"),O=S,R=D,V=I,L=!1;4===D.rank&&(L=!0,O=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3]),R=D.as5D(1,D.shape[0],D.shape[1],D.shape[2],D.shape[3]),V=I.as5D(1,I.shape[0],I.shape[1],I.shape[2],I.shape[3])),E(5===O.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+O.rank+"."}),E(5===R.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+R.rank+"."}),E(5===V.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+V.rank+"."}),null==_&&(_=[1,1,1]),E(Un(b,_),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+_+"'"}),null!=T&&E(Dt(C),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+T+" but got pad "+C+"."});var B=hl(R.shape,w,b,_,C,T),z=M.runKernelFunc(function(H){return H.maxPool3dBackprop(O,R,V,B)},{dy5D:O,input5D:R});return L?z.as4D(z.shape[1],z.shape[2],z.shape[3],z.shape[4]):z}(f,p,g,n,e,s,r,i)}}});return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),hq=A({avgPool3d_:function(t,n,e,r,i,o,s){void 0===o&&(o="NDHWC");var a=x(t,"x","avgPool3d","float32"),u=a,c=!1;4===a.rank&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),null==s&&(s=[1,1,1]),E(5===u.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),E("NDHWC"===o,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),E(Un(e,s),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+s+"'"}),null!=i&&E(Dt(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var l=hl(u.shape,n,e,s,r,i,o),d=M.runKernelFunc(function(f){return f.avgPool3d(u,l)},{x:u},function(f){return{x:function(){return function(h,p,g,m,v,y,w){var b=x(h,"dy","avgPool3dBackprop"),_=x(p,"input","avgPool3dBackprop"),C=b,T=_,S=!1;4===_.rank&&(S=!0,C=b.as5D(1,b.shape[0],b.shape[1],b.shape[2],b.shape[3]),T=_.as5D(1,_.shape[0],_.shape[1],_.shape[2],_.shape[3])),E(5===C.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+C.rank+"."}),E(5===T.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+T.rank+"."}),null==v&&(v=[1,1,1]),E(Un(m,v),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+v+"'"}),null!=w&&E(Dt(y),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+w+" but got pad "+y+"."});var D=hl(T.shape,g,m,v,y,w),I=M.runKernelFunc(function(O){return O.avgPool3dBackprop(C,T,D)},{dy5D:C,input5D:T});return S?I.as4D(I.shape[1],I.shape[2],I.shape[3],I.shape[4]):I}(f,u,n,e,s,r,i)}}});return d=d.cast(u.dtype),c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),bi=A({slice_:function(t,n,e){var r,i,o=x(t,"x","slice");if(0===o.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof n?[n].concat(new Array(o.rank-1).fill(0)):n.length<o.rank?n.concat(new Array(o.rank-n.length).fill(0)):n.slice()).forEach(function(u){E(-1!==u,function(){return"slice() does not support negative begin indexing."})}),i=(i=null==e?new Array(o.rank).fill(-1):"number"==typeof e?[e].concat(new Array(o.rank-1).fill(-1)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(-1)):e).map(function(u,c){return u>=0?u:(E(-1===u,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+c+"."}),o.shape[c]-r[c])}),PT(o,r,i);var s=o.shape;return M.runKernelFunc(function(u){return u.slice(o,r,i)},{x:o},function(u){for(var c=[],l=0;l<u.rank;l++)c.push([r[l],s[l]-r[l]-i[l]]);return{x:function(){return u.pad(c)}}},"Slice",{begin:r,size:i})}}),pq=A({slice1d_:function(t,n,e){var r=x(t,"x","slice1d");return E(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),bi(r,[n],[e])}}),gq=A({slice2d_:function(t,n,e){var r=x(t,"x","slice2d");return E(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),bi(r,n,e)}}),aA=A({slice3d_:function(t,n,e){var r=x(t,"x","slice3d");return E(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),bi(r,n,e)}}),mq=A({slice4d_:function(t,n,e){var r=x(t,"x","slice4d");return E(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),bi(r,n,e)}});function uA(t,n,e,r,i){return n.rank<e.rank&&(n=n.reshape(Vn(n.shape,r))),t.rank<e.rank&&(t=t.reshape(Vn(t.shape,r))),{x:function(){var o=t.mul(e.equal(n).cast(t.dtype));return null==i?o:o.transpose(i)}}}var vq=A({all_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=x(t,"x","all","bool"),i=Ht(n,r.shape),o=i,s=zr(o,r.rank);null!=s&&(r=r.transpose(s),o=Gr(o.length,r.rank));var a=M.runKernelFunc(function(c){return c.all(r,o)},{$x:r});if(e){var u=Vn(a.shape,i);return a.reshape(u)}return a}}),yq=A({any_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=x(t,"x","any","bool"),i=Ht(n,r.shape),o=i,s=zr(o,r.rank);null!=s&&(r=r.transpose(s),o=Gr(o.length,r.rank));var a=M.runKernelFunc(function(c){return c.any(r,o)},{$x:r});if(e){var u=Vn(a.shape,i);return a.reshape(u)}return a}}),bq=A({argMax_:function(t,n){void 0===n&&(n=0);var e=x(t,"x","argMax");null==n&&(n=0);var r=Ht(n,e.shape),i=zr(r,e.rank);return null!=i&&(e=e.transpose(i),r=Gr(r.length,e.rank)),M.runKernelFunc(function(a,u){var c=a.argMax(e,r[0]);return u([e]),c},{x:e},function(a,u){var c=u[0];return{x:function(){return We(c)}}},"ArgMax",{axis:r[0]},[e])}}),wq=A({argMin_:function(t,n){void 0===n&&(n=0);var e=x(t,"x","argMin");null==n&&(n=0);var r=Ht(n,e.shape),i=zr(r,e.rank);return null!=i&&(e=e.transpose(i),r=Gr(r.length,e.rank)),M.runKernelFunc(function(o,s){var a=o.argMin(e,r[0]);return s([e]),a},{$x:e},function(o,s){var a=s[0];return{$x:function(){return We(a)}}})}}),_q=A({logSumExp_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=x(t,"x","logSumExp"),i=Ht(n,r.shape),o=r.max(i,!0),s=r.sub(o).exp().sum(i).log(),a=o.reshape(s.shape).add(s);if(e){var u=Vn(a.shape,i);return a.reshape(u)}return a}}),Ah=A({max_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=x(t,"x","max"),i=r,o=Ht(n,r.shape),s=o,a=zr(s,r.rank);null!=a&&(r=r.transpose(a),s=Gr(s.length,r.rank));var c=M.runKernelFunc(function(d,f){var h=d.max(r,s);return f([i,h]),h},{x:r},function(d,f){return uA(d,f[1],f[0],o,a)},"Max",{axes:s},[r],[!0]);if(e){var l=Vn(c.shape,o);c=c.reshape(l)}return c}}),Cq=A({mean_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=x(t,"x","mean"),i=Ht(n,r.shape),o=ae(hn(r.shape,i)[1]);return ph(function(s){var a=X(o);return{value:(a.dtype===s.dtype?s:s.cast(a.dtype)).div(a).sum(n,e),gradFunc:function(u){var c=s.shape.slice();return i.forEach(function(l){c[l]=1}),u.reshape(c).mul(tu(s.shape,"float32")).div(o)}}})(r)}}),xq=A({min_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=x(t,"x","min"),i=r,o=Ht(n,r.shape),s=o,a=zr(s,r.rank);null!=a&&(r=r.transpose(a),s=Gr(s.length,r.rank));var c=M.runKernelFunc(function(d,f){var h=d.min(r,s);return f([i,h]),h},{x:r},function(d,f){return uA(d,f[1],f[0],o,a)},"Min",{axes:s},[r],[!0]);if(e){var l=Vn(c.shape,o);c=c.reshape(l)}return c}}),Eq=A({moments_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=Ht(n,(t=x(t,"x","moments")).shape),i=t.mean(r,e),o=i.shape;e||(o=Vn(i.shape,r));var s=t.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:s.mean(r,e)}}}),cA=A({sum_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=x(t,"x","sum");"bool"===r.dtype&&(r=r.toInt());var i=Ht(n,r.shape);return ph(function(o){var s=zr(i,o.rank),a=i,u=o;null!=s&&(u=o.transpose(s),a=Gr(a.length,o.rank));var c=function(h){var p=o.shape.slice();return i.forEach(function(g){p[g]=1}),h.reshape(p).mul(tu(o.shape,"float32"))},d=M.runKernelFunc(function(h){return h.sum(u,a)},{x:u},function(h){return{x:function(){return c(h)}}},"Sum",{axes:a});if(e){var f=Vn(d.shape,i);d=d.reshape(f)}return{value:d,gradFunc:c}})(r)}}),Dq=A({prod_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=x(t,"x","prod");"bool"===r.dtype&&(r=r.toInt());var i=Ht(n,r.shape),o=zr(i,r.rank),s=i,a=r;null!=o&&(a=r.transpose(o),s=Gr(s.length,r.rank));var u=M.runKernelFunc(function(l){return l.prod(a,s)},{permutedX:a});if(e){var c=Vn(u.shape,i);u=u.reshape(c)}return u}}),lA=A({elu_:function(t){var n=x(t,"x","elu");return M.runKernelFunc(function(e,r){var i=e.elu(n);return r([i]),i},{$x:n},function(e,r){var i=r[0];return{$x:function(){return M.runKernelFunc(function(o){return o.eluDer(e,i)},{dy:e,y:i})}}})}}),Iq=A({leakyRelu_:function(t,n){void 0===n&&(n=.2);var e=x(t,"x","leakyRelu");return h0(X(n).mul(e),e)}}),dA=A({prelu_:function(t,n){var e=x(t,"x","prelu"),r=x(n,"alpha","prelu");return M.runKernelFunc(function(i,o){var s=i.prelu(e,r);return o([e,r]),s},{x:e,alpha:r},function(i,o){var s=o[0],a=o[1],u=s.greater(0);return{x:function(){return Ms(u,i,i.mul(a))},alpha:function(){var c=Ms(u,We(i),i.mul(s)),l=Wt(a.shape,i.shape);return l.length>0&&(c=c.sum(l)),c.reshape(a.shape)}}},"Prelu")}}),It=A({relu_:function(t){var n=x(t,"x","relu");return"bool"===n.dtype?n.toInt():M.runKernelFunc(function(e,r){var i=e.relu(n);return r([n]),i},{x:n},function(e,r){var i=r[0];return{x:function(){return e.mulStrict(i.step().toFloat())}}},"Relu")}}),fA=A({relu6_:function(t){var n=x(t,"x","relu6");return"bool"===n.dtype?n.toInt():M.runKernelFunc(function(e,r){var i=e.relu6(n);return r([n]),i},{x:n},function(e,r){var i=r[0],o=i.lessEqual(6).mul(i.step());return{x:function(){return e.mulStrict(o.toFloat())}}},"Relu6")}}),Sq=A({selu_:function(t){var n=x(t,"x","selu");return M.runKernelFunc(function(e,r){var i=e.selu(n);return r([n]),i},{$x:n},function(e,r){var i=r[0];return{$x:function(){var o=i.greater(X(0)),s=X(c0),a=X(l0),u=e.mul(a),c=e.mul(s).mul(i.toFloat().exp());return Ms(o,u,c)}}})}}),Uo=A({transpose_:function(t,n){var e=x(t,"x","transpose");return null==n&&(n=e.shape.map(function(i,o){return o}).reverse()),E(e.rank===n.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of perm "+n+"."}),n.forEach(function(i){E(i>=0&&i<e.rank,function(){return"All entries in 'perm' must be between 0 and "+(e.rank-1)+" but got "+n})}),e.rank<=1?e.clone():M.runKernelFunc(function(i){return i.transpose(e,n)},{x:e},function(i){var o=sh(n);return{x:function(){return i.transpose(o)}}},"Transpose",{perm:n})}}),Tq=A({localResponseNormalization_:function(t,n,e,r,i){void 0===n&&(n=5),void 0===e&&(e=1),void 0===r&&(r=1),void 0===i&&(i=.5);var o=x(t,"x","localResponseNormalization");E(4===o.rank||3===o.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+o.rank+"."}),E(Dt(n),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+n+"."});var s=o,a=!1;3===o.rank&&(a=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var u=M.runKernelFunc(function(c,l){var d=c.localResponseNormalization4D(s,n,e,r,i);return l([s,d]),d},{x4D:s},function(c,l){var d=l[0],f=l[1];return{x4D:function(){return M.runKernelFunc(function(h){return h.LRNGrad(c,d,f,n,e,r,i)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),hA=A({norm_:function(t,n,e,r){void 0===n&&(n="euclidean"),void 0===e&&(e=null),void 0===r&&(r=!1);var i=function a(u,c,l){if(void 0===l&&(l=null),0===u.rank)return u.abs();if(1!==u.rank&&null===l)return a(u.reshape([-1]),c,l);if(1===u.rank||"number"==typeof l||Array.isArray(l)&&1===l.length){if(1===c)return u.abs().sum(l);if(c===1/0)return u.abs().max(l);if(c===-1/0)return u.abs().min(l);if("euclidean"===c||2===c)return u.abs().pow(X(2,"int32")).sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}if(Array.isArray(l)&&2===l.length){if(1===c)return u.abs().sum(l[0]).max(l[1]-1);if(c===1/0)return u.abs().sum(l[1]).max(l[0]);if(c===-1/0)return u.abs().sum(l[1]).min(l[0]);if("fro"===c||"euclidean"===c)return u.square().sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}throw new Error("Error in norm: invalid axis: "+l)}(t=x(t,"x","norm"),n,e),o=i.shape;if(r){var s=Ht(e,t.shape);o=Vn(i.shape,s)}return i.reshape(o)}}),Mq=A({basicLSTMCell_:function(t,n,e,r,i,o){var s=x(t,"forgetBias","basicLSTMCell"),a=x(n,"lstmKernel","basicLSTMCell"),u=x(e,"lstmBias","basicLSTMCell"),c=x(r,"data","basicLSTMCell"),l=x(i,"c","basicLSTMCell"),d=x(o,"h","basicLSTMCell"),f=c.concat(d,1).matMul(a).add(u),p=f.shape[1]/4,g=[f.shape[0],p],m=f.slice([0,0],g),v=f.slice([0,p],g),y=f.slice([0,2*p],g),w=f.slice([0,3*p],g),b=m.sigmoid().mulStrict(v.tanh()).addStrict(l.mulStrict(s.add(y).sigmoid())),_=b.tanh().mulStrict(w.sigmoid());return[b,_]}}),Aq=A({multiRNNCell_:function(t,n,e,r){for(var i=x(n,"data","multiRNNCell"),o=dl(e,"c","multiRNNCell"),s=dl(r,"h","multiRNNCell"),a=i,u=[],c=0;c<t.length;c++){var l=t[c](a,o[c],s[c]);u.push(l[0]),u.push(l[1]),a=l[1]}var d=[],f=[];for(c=0;c<u.length;c+=2)d.push(u[c]),f.push(u[c+1]);return[d,f]}}),Rq=A({movingAverage_:function(t,n,e,r,i){void 0===i&&(i=!0);var o=x(t,"v","movingAverage"),s=x(n,"x","movingAverage"),a=x(e,"decay","movingAverage");q2(o,s),E(Ut(o.shape,s.shape),function(){return"Shape mismatch in v and x"});var u=X(1),c=u.sub(a),l=s.sub(o).mul(c);if(i){E(null!=r,function(){return"When using zeroDebias: true, step is required."});var d=x(r,"step","movingAverage");l=l.div(u.sub(Sh(a,d)))}return o.add(l)}}),Oq=A({stridedSlice_:function(t,n,e,r,i,o,s,a,u){if(void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===u&&(u=0),null==r&&(r=new Array(n.length)),0!==s)throw new Error("ellipsis mask is not yet supported");var c=x(t,"x","stridedSlice"),l=zy(a),d=c.shape.slice();l.forEach(function(m){n[m]=0,e[m]=1,d.splice(m,0,1)}),c=c.reshape(d);for(var f=0;f<c.rank;f++)n[f]=FT(i,n,r,c.shape,f),e[f]=LT(o,e,r,c.shape,f),r[f]=r[f]||1;var h=zy(u);h.forEach(function(m){e[m]=n[m]+1,r[m]=1});var p=hh(n,e,r),g=p.filter(function(m,v){return-1===h.indexOf(v)});return r.every(function(m){return 1===m})?bi(c,n,p).reshape(g):M.runKernelFunc(function(m){return m.stridedSlice(c,n,e,r)},{$x:c}).reshape(g)}}),Nq=A({topk_:function(t,n,e){void 0===n&&(n=1),void 0===e&&(e=!0);var r=x(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(n>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+n);var o=M.runKernelFunc(function(s){return s.topk(r,n,e)},{$x:r});return{values:o[0],indices:o[1]}}}),kq=A({scatterND_:function(t,n,e){var r=x(t,"indices","scatterND","int32"),i=x(n,"updates","scatterND");return kT(i,r,e),M.runKernelFunc(function(o){return o.scatterND(r,i,e)},{indices:r,updates:i},null,"ScatterNd",{shape:e})}}),y0=A({fft_:function(t){E("complex64"===t.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+t.dtype+"."});var n=t.shape[t.shape.length-1],r=t.as2D(t.size/n,n);return M.runKernelFunc(function(i){return i.fft(r)},{input:t}).reshape(t.shape)}}),Rh=A({ifft_:function(t){E("complex64"===t.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+t.dtype+"."});var n=t.shape[t.shape.length-1],r=t.as2D(t.size/n,n);return M.runKernelFunc(function(i){return i.ifft(r)},{input:t}).reshape(t.shape)}}),b0=A({rfft_:function(t,n){E("float32"===t.dtype,function(){return"The dtype for rfft() must be real value but got "+t.dtype});var e,r=t.shape[t.shape.length-1],i=t.size/r;if(null!=n&&n<r){var o=t.shape.map(function(v){return 0}),s=t.shape.map(function(v){return v});s[t.shape.length-1]=n,e=t.slice(o,s),r=n}else if(null!=n&&n>r){var a=t.shape.map(function(v){return v});a[t.shape.length-1]=n-r,e=t.concat(wt(a),t.shape.length-1),r=n}else e=t;var u=e.zerosLike(),c=pn(e,u).as2D(i,r),l=y0(c),d=Math.floor(r/2)+1,f=Sr(l),h=vi(l),p=f.split([d,r-d],f.shape.length-1),g=h.split([d,r-d],h.shape.length-1),m=e.shape.slice();return m[e.shape.length-1]=d,pn(p[0],g[0]).reshape(m)}}),pA=A({irfft_:function(t){var n=t.shape[t.shape.length-1],e=t.size/n;if(n<=2){var r=t.as2D(e,n),i=Rh(r);return Sr(i)}var o=[e,2*(n-1)],s=Sr(t).as2D(e,n),a=vi(t).as2D(e,n),u=s.slice([0,1],[e,n-2]).reverse(1),c=a.slice([0,1],[e,n-2]).reverse(1).mul(X(-1)),l=s.concat(u,1),d=a.concat(c,1);return r=pn(l,d).as2D(o[0],o[1]),i=Rh(r),Sr(i)}}),Pq=Object.freeze({fft:y0,ifft:Rh,rfft:b0,irfft:pA}),Fq=A({sparseToDense_:function(t,n,e,r){void 0===r&&(r=0);var i=x(t,"sparseIndices","sparseToDense","int32"),o=x(n,"sparseValues","sparseToDense"),s=x(r,"defaultValue","sparseToDense",o.dtype);return function(a,u,c,l){if("int32"!==a.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+a.dtype+".");if(a.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+a.shape+".");var d=a.rank>0?a.shape[0]:1,f=a.rank>1?a.shape[1]:1;if(c.length!==f)throw new Error("outputShape has incorrect number of elements:, "+c.length+", should be: "+f+".");if(0!==u.rank&&(1!==u.rank||u.size!==d))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+d+"]");if(u.dtype!==l.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,o,e,s),M.runKernelFunc(function(a){return a.sparseToDense(i,o,e,s)},{$sparseIndices:i,$sparseValues:o,$defaultValue:s})}}),Lq=A({gatherND_:function(t,n){var e=x(n,"indices","gatherND","int32"),r=x(t,"x","gatherND");return M.runKernelFunc(function(i){return i.gatherND(r,e)},{x:r,indices:e},null,"GatherNd")}}),Bq=A({diag_:function(t){var n=x(t,"x","diag").flatten(),e=t.shape.concat(t.shape);return M.runKernelFunc(function(r){return r.diag(n)},{$x:n}).reshape(e)}}),Vq=A({dropout_:function(t,n,e,r){var i=x(t,"x","dropout");if(E("float32"===i.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."}),E(n>=0&&n<1,function(){return"rate must be a float in the range [0, 1), but got "+n+"."}),0===n)return t instanceof lt?i.clone():i;var o=function(u,c){if(null==c)return u.shape.slice();if(Ut(u.shape,c))return c;if(u.shape.length===c.length){for(var l=[],d=0;d<u.shape.length;d++)l.push(null==c[d]&&null!=u.shape[d]?u.shape[d]:c[d]);return l}return c}(i,e),s=1-n,a=TT(o,0,1,"float32",r).add(s).floor().div(s);return i.mul(a)}});function gA(t,n,e){for(var r=1-t%2,i=new Float32Array(t),o=0;o<t;++o){var s=2*Math.PI*o/(t+r-1);i[o]=n-e*Math.cos(s)}return jt(i,"float32")}var xn,w0=A({hannWindow_:function(t){return gA(t,.5,.5)}}),mA=A({hammingWindow_:function(t){return gA(t,.54,.46)}}),_0=A({frame_:function(t,n,e,r,i){void 0===r&&(r=!1),void 0===i&&(i=0);for(var o=0,s=[];o+n<=t.size;)s.push(bi(t,o,n)),o+=e;if(r)for(;o<t.size;){var a=o+n-t.size,u=Yt([bi(t,o,n-a),yi([a],i)]);s.push(u),o+=e}return 0===s.length?Bo([],[0,n]):Yt(s).as2D(s.length,n)}}),vA=A({stft_:function(t,n,e,r,i){void 0===i&&(i=w0),null==r&&(r=Math.floor(Math.pow(2,Math.ceil(Math.log(n)/Math.log(2)))));for(var s=_0(t,n,e),a=Cn(s,i(n)),u=[],c=0;c<s.shape[0];c++)u.push(b0(a.slice([c,0],[1,n]),r));return Yt(u)}}),Uq=Object.freeze({hannWindow:w0,hammingWindow:mA,frame:_0,stft:vA});!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(xn||(xn={}));var jq=A({absoluteDifference_:function(t,n,e,r){void 0===r&&(r=xn.SUM_BY_NONZERO_WEIGHTS);var i=x(t,"labels","absoluteDifference"),o=x(n,"predictions","absoluteDifference"),s=null;null!=e&&(s=x(e,"weights","absoluteDifference")),je(i.shape,o.shape,"Error in absoluteDifference: ");var a=i.sub(o).abs();return Qi(a,s,r)}}),Qi=A({computeWeightedLoss_:function(t,n,e){void 0===e&&(e=xn.SUM_BY_NONZERO_WEIGHTS);var r=x(t,"losses","computeWeightedLoss"),i=null;null!=n&&(i=x(n,"weights","computeWeightedLoss"));var o=null==i?r:r.mul(i);if(e===xn.NONE)return o;if(e===xn.SUM)return o.sum();if(e===xn.MEAN){if(null==i)return o.mean();var s=r.size/i.size,a=o.sum().div(i.sum());return s>1?a.div(X(s)):a}if(e===xn.SUM_BY_NONZERO_WEIGHTS){if(null==i)return o.sum().div(X(r.size));var u=i.mul(tu(r.shape)).notEqual(X(0)).sum().toFloat();return o.sum().div(u)}throw Error("Unknown reduction: "+e)}}),Wq=A({cosineDistance_:function(t,n,e,r,i){void 0===i&&(i=xn.SUM_BY_NONZERO_WEIGHTS);var o=x(t,"labels","cosineDistance"),s=x(n,"predictions","cosineDistance"),a=null;null!=r&&(a=x(r,"weights","cosineDistance")),je(o.shape,s.shape,"Error in cosineDistance: ");var u=X(1).sub(o.mul(s).sum(e,!0));return Qi(u,a,i)}}),zq=A({hingeLoss_:function(t,n,e,r){void 0===r&&(r=xn.SUM_BY_NONZERO_WEIGHTS);var i=x(t,"labels","hingeLoss"),o=x(n,"predictions","hingeLoss"),s=null;null!=e&&(s=x(e,"weights","hingeLoss")),je(i.shape,o.shape,"Error in hingeLoss: ");var a=X(1);i=X(2).mul(i).sub(a);var u=a.sub(i.mul(o)).relu();return Qi(u,s,r)}}),Gq=A({huberLoss_:function(t,n,e,r,i){void 0===r&&(r=1),void 0===i&&(i=xn.SUM_BY_NONZERO_WEIGHTS);var o=x(t,"labels","huberLoss"),s=x(n,"predictions","huberLoss"),a=null;null!=e&&(a=x(e,"weights","huberLoss")),je(o.shape,s.shape,"Error in huberLoss: ");var u=X(r),c=s.sub(o).abs(),l=KM(c,u),d=c.sub(l),f=X(.5).mul(l.square()).add(u.mul(d));return Qi(f,a,i)}}),$q=A({logLoss_:function(t,n,e,r,i){void 0===r&&(r=1e-7),void 0===i&&(i=xn.SUM_BY_NONZERO_WEIGHTS);var o=x(t,"labels","logLoss"),s=x(n,"predictions","logLoss"),a=null;null!=e&&(a=x(e,"weights","logLoss")),je(o.shape,s.shape,"Error in logLoss: ");var u=X(1),c=X(r),l=o.mul(s.add(c).log()).neg().sub(u.sub(o).mul(u.sub(s).add(c).log()));return Qi(l,a,i)}}),qq=A({meanSquaredError_:function(t,n,e,r){void 0===r&&(r=xn.SUM_BY_NONZERO_WEIGHTS);var i=x(t,"labels","meanSquaredError"),o=x(n,"predictions","meanSquaredError"),s=null;null!=e&&(s=x(e,"weights","meanSquaredError")),je(i.shape,o.shape,"Error in meanSquaredError: ");var a=i.squaredDifference(o);return Qi(a,s,r)}}),Kq=A({sigmoidCrossEntropy_:function(t,n,e,r,i){void 0===r&&(r=0),void 0===i&&(i=xn.SUM_BY_NONZERO_WEIGHTS);var o=x(t,"multiClassLabels","sigmoidCrossEntropy"),s=x(n,"logits","sigmoidCrossEntropy"),a=null;if(null!=e&&(a=x(e,"weights","sigmoidCrossEntropy")),je(o.shape,s.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=X(r),c=X(1),l=X(.5);o=o.mul(c.sub(u)).add(l.mul(u))}var d=function(f,h){var p=x(f,"labels","sigmoidCrossEntropyWithLogits"),g=x(h,"logits","sigmoidCrossEntropyWithLogits");je(p.shape,g.shape,"Error in sigmoidCrossEntropyWithLogits: ");var m=g.relu(),v=g.mul(p),y=g.abs().neg().exp().log1p();return m.sub(v).add(y)}(o,s);return Qi(d,a,i)}}),Yq=A({softmaxCrossEntropy_:function(t,n,e,r,i){void 0===r&&(r=0),void 0===i&&(i=xn.SUM_BY_NONZERO_WEIGHTS);var o=x(t,"onehotLabels","softmaxCrossEntropy"),s=x(n,"logits","softmaxCrossEntropy"),a=null;if(null!=e&&(a=x(e,"weights","softmaxCrossEntropy")),je(o.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){var u=X(r),c=X(1),l=X(o.shape[1]);o=o.mul(c.sub(u)).add(u.div(l))}var d=function(f,h,p){if(void 0===p&&(p=-1),-1===p&&(p=h.rank-1),p!==h.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+h.rank+" and dim was "+p);return ph(function(g,m,v){var y=m.logSumExp([p],!0),w=m.toFloat().sub(y);return v([g,w]),{value:w.mul(g).neg().sum([p]),gradFunc:function(b,_){var C=_[0],T=_[1],S=Vn(b.shape,[p]);return[b.reshape(S).mul(C.toFloat().sub(T.exp())),b.reshape(S).mul(T.exp().sub(C.toFloat()))]}}})(f,h)}(o,s);return Qi(d,a,i)}}),Xq=Object.freeze({get Reduction(){return xn},absoluteDifference:jq,computeWeightedLoss:Qi,cosineDistance:Wq,hingeLoss:zq,huberLoss:Gq,logLoss:$q,meanSquaredError:qq,sigmoidCrossEntropy:Kq,softmaxCrossEntropy:Yq});function yA(t,n){return void 0===n&&(n=!1),M.tidy(function(){if(2!==t.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+t.shape.length+"D Tensor.");for(var e=t.shape[0],r=t.shape[1],i=ST(e),o=t.clone(),s=Bo([[1]],[1,1]),a=s.clone(),u=e>=r?r:e,c=function(d){var f,h=o,p=a,g=i;f=M.tidy(function(){var m=o.slice([d,d],[e-d,1]),v=m.norm(),y=o.slice([d,d],[1,1]),w=Bo([[-1]]).where(y.greater(0),Bo([[1]])),b=y.sub(w.mul(v)),_=m.div(b);a=1===_.shape[0]?s.clone():s.concat(_.slice([1,0],[_.shape[0]-1,_.shape[1]]),0);var C=w.matMul(b).div(v).neg(),T=o.slice([d,0],[e-d,r]),S=C.mul(a);if(0===d)o=T.sub(S.matMul(a.transpose().matMul(T)));else{var D=T.sub(S.matMul(a.transpose().matMul(T)));o=o.slice([0,0],[d,r]).concat(D,0)}var I=i.slice([0,d],[e,i.shape[1]-d]);if(0===d)i=I.sub(I.matMul(a).matMul(S.transpose()));else{var O=I.sub(I.matMul(a).matMul(S.transpose()));i=i.slice([0,0],[e,d]).concat(O,1)}return[a,o,i]}),a=f[0],o=f[1],i=f[2],Yn([h,p,g])},l=0;l<u;++l)c(l);return!n&&e>r&&(i=i.slice([0,0],[e,r]),o=o.slice([0,0],[r,r])),[i,o]})}var Zq=A({bandPart_:function(t,n,e){if(n%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+n+".");if(e%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+e+".");var r=x(t,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,o=r.shape.slice(-2),s=o[0],a=o[1];if(!(n<=s))throw new Error("bandPart(): numLower ("+n+") must not be greater than the number of rows ("+s+").");if(!(e<=a))throw new Error("bandPart(): numUpper ("+e+") must not be greater than the number of columns ("+a+").");n<0&&(n=s),e<0&&(e=a);var u=ah(0,s,1,"int32").reshape([-1,1]),c=ah(0,a,1,"int32"),l=Zt(u,c),d=Ih(l.lessEqual(X(+n,"int32")),l.greaterEqual(X(-e,"int32"))),f=wt([s,a],r.dtype);return fr(Xt(r.reshape([-1,s,a])).map(function(h){return Ms(d,h,f)})).reshape(i)}}),Qq=A({gramSchmidt_:function(t){var n;if(Array.isArray(t)){n=!1,E(null!=t&&t.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var e=t[0].shape[0],r=function(u){E(t[u].shape[0]===e,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+t[u].shape[0]+" vs. "+e+")"})},i=1;i<t.length;++i)r(i)}else n=!0,t=Vy(t,t.shape[0],0).map(function(u){return AT(u,[0])});E(t.length<=t[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+t.length+") exceeds number of dimensions ("+t[0].shape[0]+")."});var o=[],s=t,a=function(u){o.push(M.tidy(function(){var c=s[u];if(u>0)for(var l=0;l<u;++l){var d=cA(o[l].mulStrict(c)).mul(o[l]);c=c.sub(d)}return c.div(hA(c,"euclidean"))}))};for(i=0;i<t.length;++i)a(i);return n?fr(o,0):o}}),Jq=A({qr_:function(t,n){if(void 0===n&&(n=!1),t.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+t.rank);if(2===t.rank)return yA(t,n);var e=t.shape.slice(0,t.shape.length-2).reduce(function(s,a){return s*a}),r=Xt(t.reshape([e,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),i=[],o=[];return r.forEach(function(s){var a=yA(s,n),c=a[1];i.push(a[0]),o.push(c)}),[fr(i,0).reshape(t.shape),fr(o,0).reshape(t.shape)]}}),e7=Object.freeze({bandPart:Zq,gramSchmidt:Qq,qr:Jq});function Oh(t,n,e,r,i,o){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==o&&(o=0);var s=t.shape[0];return e=Math.min(e,s),E(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),E(2===t.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+t.rank+"'"}),E(4===t.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+t.shape[1]}),E(1===n.rank,function(){return"scores must be a 1D tensor"}),E(n.shape[0]===s,function(){return"scores has incompatible shape with boxes. Expected "+s+", but was "+n.shape[0]}),E(0<=o&&o<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+o+"'"}),{maxOutputSize:e,iouThreshold:r,scoreThreshold:i,softNmsSigma:o}}var t7=A({resizeBilinear_:function(t,n,e){void 0===e&&(e=!1);var r=x(t,"images","resizeBilinear");E(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),E(2===n.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+n+"."});var i=r,o=!1;3===r.rank&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=n[0],a=n[1],u=M.runKernelFunc(function(c,l){return l([i]),c.resizeBilinear(i,s,a,e)},{x:i},function(c,l){return{x:function(){return M.runKernelFunc(function(d){return d.resizeBilinearBackprop(c,l[0],e)},{})}}},"ResizeBilinear",{alignCorners:e,newHeight:s,newWidth:a});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),n7=A({resizeNearestNeighbor_:function(t,n,e){void 0===e&&(e=!1);var r=x(t,"images","resizeNearestNeighbor");E(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),E(2===n.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+n+"."}),E("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var i=r,o=!1;3===r.rank&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=n[0],a=n[1],u=M.runKernelFunc(function(c,l){return l([i]),c.resizeNearestNeighbor(i,s,a,e)},{batchImages:i},function(c,l){return{batchImages:function(){return M.runKernelFunc(function(d){return d.resizeNearestNeighborBackprop(c,l[0],e)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),r7=A({nonMaxSuppression_:function(t,n,e,r,i){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY);var o=x(t,"boxes","nonMaxSuppression"),s=x(n,"scores","nonMaxSuppression"),a=Oh(o,s,e,r,i);return M.runKernelFunc(function(c){return c.nonMaxSuppression(o,s,e,r,i)},{boxes:o,scores:s},null,"NonMaxSuppressionV3",{maxOutputSize:e=a.maxOutputSize,iouThreshold:r=a.iouThreshold,scoreThreshold:i=a.scoreThreshold})}}),o7=A({nonMaxSuppressionWithScore_:function(t,n,e,r,i,o){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===o&&(o=0);var s=x(t,"boxes","nonMaxSuppression"),a=x(n,"scores","nonMaxSuppression"),u=Oh(s,a,e,r,i,o),c={maxOutputSize:e=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},l=M.runKernel("NonMaxSuppressionV5",{boxes:s,scores:a},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),a7=A({cropAndResize_:function(t,n,e,r,i,o){var s=x(t,"image","cropAndResize"),a=x(n,"boxes","cropAndResize","float32"),u=x(e,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var c=a.shape[0];return E(4===s.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+s.rank+"."}),E(2===a.rank&&4===a.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+a.shape+"."}),E(1===u.rank&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+a.shape+"."}),E(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),E(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),E("bilinear"===i||"nearest"===i,function(){return"method must be bilinear or nearest, but was "+i}),M.runKernelFunc(function(l,d){return l.cropAndResize(s,a,u,r,i,o)},{images:s,boxes:a,boxInd:u},null,"CropAndResize",{method:i,extrapolationValue:o,cropSize:r})}}),C0=Object.freeze({resizeBilinear:t7,resizeNearestNeighbor:n7,nonMaxSuppression:r7,nonMaxSuppressionAsync:function(t,n,e,r,i){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),ie(this,void 0,void 0,function(){var o,s,a,u,d;return oe(this,function(f){switch(f.label){case 0:return o=x(t,"boxes","nonMaxSuppressionAsync"),s=x(n,"scores","nonMaxSuppressionAsync"),a=Oh(o,s,e,r,i),e=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return u=f.sent(),d=Qy(u[0],u[1],e,r,i),o!==t&&o.dispose(),s!==n&&s.dispose(),[2,d]}})})},nonMaxSuppressionWithScore:o7,nonMaxSuppressionWithScoreAsync:function(t,n,e,r,i,o){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===o&&(o=0),ie(this,void 0,void 0,function(){var s,a,u,c,f;return oe(this,function(h){switch(h.label){case 0:return s=x(t,"boxes","nonMaxSuppressionAsync"),a=x(n,"scores","nonMaxSuppressionAsync"),u=Oh(s,a,e,r,i,o),e=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,o=u.softNmsSigma,[4,Promise.all([s.data(),a.data()])];case 1:return c=h.sent(),f=Jy(c[0],c[1],e,r,i,o),s!==t&&s.dispose(),a!==n&&a.dispose(),[2,f]}})})},cropAndResize:a7}),x0=function(t,n){return!(t>0)||"linear"===n},E0=function(t,n,e){if(null==e||"linear"===e)return t;if("relu"===e)return t.mul(n.step());throw new Error("Gradient for activation "+e+" has not been implemented yet.")},D0=function(t,n){var e=n,r=Wt(t.shape,n.shape);return r.length>0&&(e=e.sum(r)),e.reshape(t.shape)},I0=function(t,n,e){if("linear"===n)return t;if("relu"===n)return It(t);if("elu"===n)return lA(t);if("relu6"===n)return fA(t);if("prelu"===n)return dA(t,e);throw new Error("Unknown fused activation "+n+".")},u7=A({fusedMatMul_:function(t){var n,e=t.a,r=t.b,i=t.transposeA,o=void 0!==i&&i,s=t.transposeB,a=void 0!==s&&s,u=t.bias,c=t.activation,l=void 0===c?"linear":c,d=t.preluActivationWeights;if(!1===x0(M.state.gradientDepth,l)){var f=Mh(e,r,o,a);return null!=u&&(f=Oe(f,u)),I0(f,l,d)}var h=x(e,"a","fused matMul"),p=x(r,"b","fused matMul");n=xt(h,p),h=n[0],p=n[1];var g=o?h.shape[h.rank-2]:h.shape[h.rank-1],m=a?p.shape[p.rank-1]:p.shape[p.rank-2],v=o?h.shape[h.rank-1]:h.shape[h.rank-2],y=a?p.shape[p.rank-2]:p.shape[p.rank-1],w=h.shape.slice(0,-2),b=p.shape.slice(0,-2),_=ae(w),C=ae(b);E(h.rank>=2&&p.rank>=2&&h.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+p.rank+"."}),E(Ut(w,b),function(){return"Error in fused matMul: outer dimensions ("+w+") and ("+b+") of Tensors with shapes "+h.shape+" and "+p.shape+" must match."}),E(g===m,function(){return"Error in fused matMul: inner shapes ("+g+") and ("+m+") of Tensors with shapes "+h.shape+" and "+p.shape+" and transposeA="+o+" and transposeB="+a+" must match."});var T,S,D=h.shape.slice(0,-2).concat([v,y]),I=o?h.as3D(_,g,v):h.as3D(_,v,g),O=a?p.as3D(C,y,m):p.as3D(C,m,y);null!=u&&Re(D,(T=xt(T=x(u,"bias","fused matMul"),h)[0]).shape),null!=d&&(S=x(d,"prelu weights","fused matMul"));var R={a:I,b:O};return null!=u&&(R.bias=T),null!=d&&(R.preluActivationWeights=S),M.runKernelFunc(function(L,B){var z=L.fusedBatchMatMul({a:I,b:O,transposeA:o,transposeB:a,bias:T,activation:l,preluActivationWeights:S});return B([I,O,z]),z},R,function(L,B){var z=B[0],H=B[1],G=E0(L,B[2],l),q={};return null!=u&&(q={bias:function(){return D0(T,G)}}),Object.assign(o||a?!o&&a?{a:function(){return G.matMul(H,!1,!1)},b:function(){return G.matMul(z,!0,!1)}}:o&&!a?{a:function(){return H.matMul(G,!1,!0)},b:function(){return z.matMul(G,!1,!1)}}:{a:function(){return H.matMul(G,!0,!0)},b:function(){return G.matMul(z,!0,!0)}}:{a:function(){return G.matMul(H,!1,!0)},b:function(){return z.matMul(G,!0,!1)}},q)},"_FusedMatMul",{transposeA:o,transposeB:a,activation:l},[I,O],[!0]).reshape(D)}}),c7=A({fusedConv2d_:function(t){var n=t.x,e=t.filter,r=t.strides,i=t.pad,o=t.dataFormat,s=void 0===o?"NHWC":o,a=t.dilations,u=void 0===a?[1,1]:a,c=t.dimRoundingMode,l=t.bias,d=t.activation,f=void 0===d?"linear":d,h=t.preluActivationWeights;if(!1===x0(M.state.gradientDepth,f=f||"linear")){var p=Mr(n,e,r,i,s,u,c);return null!=l&&(p=Oe(p,l)),I0(p,f,h)}var g=x(n,"x","conv2d"),m=x(e,"filter","conv2d"),v=g,y=!1;3===g.rank&&(y=!0,v=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),E(4===v.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+v.rank+"."}),E(4===m.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+m.rank+"."}),null!=c&&E(Dt(i),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+i+"."}),E(v.shape[3]===m.shape[2],function(){return"Error in conv2d: depth of input ("+v.shape[3]+") must match input depth for filter "+m.shape[2]+"."}),E(Un(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),E("NHWC"===s,function(){return"Error in conv2d: got dataFormat of "+s+" but only NHWC is currently supported."});var w,b,_=Vo(v.shape,m.shape,r,u,i,c);null!=l&&(w=xt(w=x(l,"bias","fused conv2d"),g)[0],Re(_.outShape,w.shape)),null!=h&&(b=x(h,"prelu weights","fused conv2d"));var C={x:v,filter:m};null!=l&&(C.bias=w),null!=h&&(C.preluActivationWeights=b);var S=M.runKernelFunc(function(D,I){var O=D.fusedConv2d({input:v,filter:m,convInfo:_,bias:w,activation:f,preluActivationWeights:b});return I([m,v,O]),O},C,function(D,I){var R=I[0],V=I[1],B=E0(D,I[2],f);E(Is(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var z={};return null!=l&&(z={bias:function(){return D0(w,B)}}),Object.assign({x:function(){return nA(V.shape,B,R,r,i)},filter:function(){return m0(V,B,R.shape,r,i)}},z)},"FusedConv2D",{convInfo:_,activation:f},[m,v],[!0]);return y?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),l7=A({fusedDepthwiseConv2d_:function(t){var n=t.x,e=t.filter,r=t.strides,i=t.pad,o=t.dataFormat,s=void 0===o?"NHWC":o,a=t.dilations,u=void 0===a?[1,1]:a,c=t.dimRoundingMode,l=t.bias,d=t.activation,f=void 0===d?"linear":d,h=t.preluActivationWeights;if(!1===x0(M.state.gradientDepth,f)){var p=Th(n,e,r,i,s,u,c);return null!=l&&(p=Oe(p,l)),I0(p,f,h)}var g=x(n,"x","depthwiseConv2d"),m=x(e,"filter","depthwiseConv2d"),v=g,y=!1;3===g.rank&&(y=!0,v=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),E(4===v.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+v.rank+"."}),E(4===m.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+m.rank+"."}),E(v.shape[3]===m.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+v.shape[3]+") must match the inChannels dimension in filter "+m.shape[2]+"."}),null==u&&(u=[1,1]),E(Un(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),null!=c&&E(Dt(i),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+i+"."});var w,b,_=Vo(v.shape,m.shape,r,u,i,c,!0);null!=l&&(w=xt(w=x(l,"bias","fused conv2d"),g)[0],Re(_.outShape,w.shape)),null!=h&&(b=x(h,"prelu weights","fused depthwiseConv2d"));var C={x:v,filter:m};null!=l&&(C.bias=w),null!=h&&(C.preluActivationWeights=b);var S=M.runKernelFunc(function(D,I){var O=D.fusedDepthwiseConv2D({input:v,filter:m,convInfo:_,bias:w,activation:f,preluActivationWeights:b});return I([m,v,O]),O},C,function(D,I){E(Is(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var O=I[0],R=I[1],L=E0(D,I[2],f),B={};return null!=l&&(B={bias:function(){return D0(w,L)}}),Object.assign({x:function(){return rA(R.shape,L,O,_)},filter:function(){return iA(R,L,O.shape,_)}},B)},"FusedDepthwiseConv2D",{convInfo:_,activation:f},[m,v],[!0]);return y?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),d7=Object.freeze({matMul:u7,conv2d:c7,depthwiseConv2d:l7}),f7=Object.freeze({image:C0,linalg:e7,losses:Xq,spectral:Pq,fused:d7,signal:Uq,square:$$,squaredDifference:BM,conv1d:tq,conv2d:Mr,conv3d:nq,depthwiseConv2d:Th,separableConv2d:v0,conv2dTranspose:rq,conv3dTranspose:iq,op:A,batchNormalization2d:C9,batchNormalization3d:x9,batchNormalization4d:E9,batchNormalization:D9,batchNorm:zM,batchNorm2d:I9,batchNorm3d:S9,batchNorm4d:T9,booleanMaskAsync:function(t,n,e){return ie(this,void 0,void 0,function(){var r,i,o,s,a,u,c,l,d,f,h,p,g;return oe(this,function(m){switch(m.label){case 0:for(r=x(t,"tensor","boolMask"),i=x(n,"mask","boolMask","bool"),o=e??0,a=r.shape,E((s=i.rank)>0,function(){return"mask cannot be scalar"}),je(a.slice(o,o+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=o;c<o+s;c++)u*=a[c];return l=a.slice(0,o).concat([u],a.slice(o+s)),d=r.reshape(l),f=i.reshape([-1]),[4,$M(f)];case 1:return h=m.sent(),p=h.squeeze([1]),g=p0(d,p,o),t!==r&&r.dispose(),n!==i&&i.dispose(),p.dispose(),d.dispose(),f.dispose(),h.dispose(),[2,g]}})})},complex:pn,real:Sr,imag:vi,concat:Yt,concat1d:N8,concat2d:k8,concat3d:P8,concat4d:F8,split:Vy,matMul:Mh,dot:oq,outerProduct:sq,reverse:wl,reverse1d:aq,reverse2d:uq,reverse3d:cq,reverse4d:lq,maxPool:nn,avgPool:_l,pool:dq,maxPool3d:fq,avgPool3d:hq,slice:bi,slice1d:pq,slice2d:gq,slice3d:aA,slice4d:mq,abs:q$,acos:K$,acosh:Y$,asin:X$,asinh:Z$,atan:Q$,atanh:J$,ceil:e9,clipByValue:d0,cos:t9,cosh:n9,erf:r9,exp:f0,expm1:i9,floor:o9,log:s9,log1p:a9,logSigmoid:u9,neg:xh,reciprocal:c9,round:l9,rsqrt:VM,sigmoid:UM,sign:d9,isNaN:f9,isInf:h9,isFinite:p9,sin:g9,sinh:m9,softplus:v9,sqrt:y9,step:b9,tan:w9,tanh:_9,all:vq,any:yq,argMax:bq,argMin:wq,logSumExp:_q,max:Ah,mean:Cq,min:xq,moments:Eq,sum:cA,prod:Dq,equal:YM,equalStrict:z9,greater:G9,greaterEqual:XM,greaterEqualStrict:$9,greaterStrict:q9,less:K9,lessEqual:Y9,lessEqualStrict:X9,lessStrict:Z9,notEqual:Q9,notEqualStrict:J9,add:Oe,addN:R9,addStrict:O9,atan2:N9,div:Kr,divNoNan:k9,divStrict:P9,floorDiv:qM,maximum:h0,maximumStrict:F9,minimum:KM,minimumStrict:L9,mod:B9,modStrict:V9,mul:Cn,mulStrict:U9,pow:Sh,powStrict:H9,squaredDifferenceStrict:j9,sub:Zt,subStrict:W9,elu:lA,leakyRelu:Iq,prelu:dA,relu:It,relu6:fA,selu:Sq,logicalAnd:Ih,logicalNot:M9,logicalOr:GM,logicalXor:A9,where:Ms,whereAsync:$M,buffer:De,print:function G8(t,n){void 0===n&&(n=!1),console.log(t.toString(n))},batchToSpaceND:IT,broadcastTo:$8,cast:q8,clone:K8,cumsum:Y8,depthToSpace:X8,expandDims:Tr,eye:ST,multinomial:Z8,oneHot:Hy,pad:Ds,pad1d:Q8,pad2d:J8,pad3d:eG,pad4d:tG,rand:nG,randomNormal:rG,randomGamma:iG,randomUniform:TT,reshape:$r,spaceToBatchND:MT,squeeze:AT,stack:fr,tile:nu,truncatedNormal:oG,unstack:Xt,setdiff1dAsync:function(t,n){return ie(this,void 0,void 0,function(){var e,r,i,o,s,a,u,c,l,d;return oe(this,function(f){switch(f.label){case 0:return e=x(t,"x","setdiff1d"),r=x(n,"y","setdiff1d"),E(e.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+e.dtype+") and y ("+r.dtype+")."}),E(1===e.rank,function(){return"x should be 1D tensor, but got x ("+e.shape+")."}),E(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,e.data()];case 1:return i=f.sent(),[4,r.data()];case 2:for(o=f.sent(),s=new Set(o),a=0,l=0;l<i.length;l++)s.has(i[l])||a++;for(u=new nl([a],e.dtype),c=new nl([a],"int32"),l=0,d=0;l<i.length;l++)s.has(i[l])||(u.values[d]=i[l],c.values[d]=l,d++);return[2,[u.toTensor(),c.toTensor()]]}})})},fill:yi,linspace:function O8(t,n,e){if(e<=0)throw new Error("The number of values should be positive.");return M.runKernelFunc(function(r){return r.linspace(t,n,e)},{})},ones:tu,range:ah,scalar:X,tensor:gn,tensor1d:jt,tensor2d:Bo,tensor3d:By,tensor4d:Zn,tensor5d:function M8(t,n,e){if(bs(t),null!=n&&5!==n.length)throw new Error("tensor5d() requires shape to have five numbers");var r=mi(t,e);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==n)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Lo(t,n,r,e)},tensor6d:function A8(t,n,e){if(bs(t),null!=n&&6!==n.length)throw new Error("tensor6d() requires shape to have six numbers");var r=mi(t,e);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==n)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Lo(t,n=n||r,r,e)},variable:function R8(t,n,e,r){return void 0===n&&(n=!0),M.makeVariable(t,n,e,r)},zeros:wt,onesLike:DT,zerosLike:We,transpose:Uo,softmax:Yi,logSoftmax:uG,localResponseNormalization:Tq,norm:hA,gather:p0,unsortedSegmentSum:JM,basicLSTMCell:Mq,multiRNNCell:Aq,movingAverage:Rq,stridedSlice:Oq,topk:Nq,scatterND:kq,fft:y0,ifft:Rh,rfft:b0,irfft:pA,sparseToDense:Fq,gatherND:Lq,diag:Bq,dropout:Vq,hannWindow:w0,hammingWindow:mA,frame:_0,stft:vA,inTopKAsync:function(t,n,e){return void 0===e&&(e=1),ie(this,void 0,void 0,function(){var r,i,o,s,a,u,c,l,d,f,h,p,g,m;return oe(this,function(v){switch(v.label){case 0:return r=x(t,"predictions","inTopK"),i=x(n,"targets","inTopK"),E(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),E(r.rank-1===i.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank}),je(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=r.shape[r.shape.length-1],E(e>0&&e<=o,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+e}),[4,r.data()];case 1:return s=v.sent(),[4,i.data()];case 2:for(a=v.sent(),l=(u=[s.length/o,o])[1],d=Za("bool",c=u[0]),f=0;f<c;f++){for(p=s.subarray(h=f*l,h+l),g=[],m=0;m<p.length;m++)g.push({value:p[m],index:m});for(g.sort(function(y,w){return w.value-y.value}),d[f]=0,m=0;m<e;m++)if(g[m].index===a[f]){d[f]=1;break}}return t!==r&&r.dispose(),n!==i&&i.dispose(),[2,gn(d,i.shape,"bool")]}})})}});function W(t,n){Array.isArray(t)||(t=[t]),t.forEach(function(e){null!=e&&E("complex64"!==e.dtype,function(){return n+" does not support complex64 tensors."})})}function S0(t,n,e,r){if("linear"===e)return t.linear(n);if("relu"===e)return t.relu(n);if("elu"===e)return t.elu(n);if("relu6"===e)return t.relu6(n);if("prelu"===e)return t.prelu(n,r);throw new Error("Activation "+e+" has not been implemented for the CPU backend.")}var h7=function(t){function n(){var e=t.call(this)||this;return e.blockSize=48,e.firstUse=!0,e.data=new BT(e,M),e}return Hr(n,t),n.prototype.write=function(e,r,i){this.firstUse&&(this.firstUse=!1,P().get("IS_NODE")&&oh("\n============================\nHi there \u{1f44b}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var o={};return this.data.set(o,{values:e,dtype:i}),o},n.prototype.move=function(e,r,i,o){this.data.set(e,{values:r,dtype:o})},n.prototype.numDataIds=function(){return this.data.numDataIds()},n.prototype.read=function(e){return ie(this,void 0,void 0,function(){return oe(this,function(r){return[2,this.readSync(e)]})})},n.prototype.readSync=function(e){var r=this.data.get(e),o=r.complexTensors;return"complex64"===r.dtype?Zy(this.readSync(o.real.dataId),this.readSync(o.imag.dataId)):this.data.get(e).values},n.prototype.bufferSync=function(e){var r=this.readSync(e.dataId),i=r;if("string"===e.dtype)try{i=r.map(function(o){return Qc(o)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return De(e.shape,e.dtype,i)},n.prototype.makeOutput=function(e,r,i){var o=this.write(e,r,i);return M.makeTensorFromDataId(o,r,i,this)},n.prototype.disposeData=function(e){if(this.data.has(e)){var r=this.data.get(e).complexTensors;null!=r&&(r.real.dispose(),r.imag.dispose()),this.data.delete(e)}},n.prototype.time=function(e){return ie(this,void 0,void 0,function(){var r;return oe(this,function(i){return r=Wr(),e(),[2,{kernelMs:Wr()-r}]})})},n.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},n.prototype.complex=function(e,r){var i=this.makeOutput(null,e.shape,"complex64");return this.data.get(i.dataId).complexTensors={real:M.keep(e.clone()),imag:M.keep(r.clone())},i},n.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},n.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},n.prototype.slice=function(e,r,i){if(W(e,"slice"),Gy(e.shape,r,i)){var o=$y(r,e.strides),s=ae(i);return gn(this.readSync(e.dataId).subarray(o,o+s),i,e.dtype)}for(var a=De(i,e.dtype),u=this.bufferSync(e),c=0;c<a.size;++c){var l=a.indexToLoc(c).map(function(d,f){return d+r[f]});a.values[c]=u.get.apply(u,l)}return a.toTensor()},n.prototype.stridedSlice=function(e,r,i,o){W(e,"stridedSlice");var s=hh(r,i,o);if(s.some(function(h){return 0===h}))return gn([],s);for(var a=De(s,e.dtype),u=this.bufferSync(e),c=0;c<a.size;c++){for(var l=a.indexToLoc(c),d=new Array(l.length),f=0;f<d.length;f++)d[f]=l[f]*o[f]+r[f];a.set.apply(a,[u.get.apply(u,d)].concat(l))}return a.toTensor()},n.prototype.diag=function(e){for(var r=this.readSync(e.dataId),i=De([e.size,e.size],e.dtype),o=i.values,s=0;s<r.length;s++)o[s*e.size+s]=r[s];return i.toTensor()},n.prototype.unstack=function(e,r){for(var i=e.shape[r],o=new Array(e.rank-1),s=0,a=0;a<e.rank;a++)a!==r&&(o[s++]=e.shape[a]);var u=new Array(e.rank).fill(0),c=e.shape.slice();c[r]=1;var l=new Array(i);for(a=0;a<l.length;a++)u[r]=a,l[a]=this.slice(e,u,c).reshape(o);return l},n.prototype.reverse=function(e,r){W(e,"reverse");for(var i=De(e.shape,e.dtype),o=this.bufferSync(e),s=function(u){var c=i.indexToLoc(u),l=c.slice();r.forEach(function(d){return l[d]=e.shape[d]-1-l[d]}),i.set.apply(i,[o.get.apply(o,l)].concat(c))},a=0;a<i.size;a++)s(a);return i.toTensor()},n.prototype.concat=function(e,r){var i=this;if("complex64"===e[0].dtype){var o=e.map(function(h){return Sr(h)}),s=e.map(function(h){return vi(h)});return pn(this.concat(o,r),this.concat(s,r))}var a=e.map(function(h){var p=ae(h.shape.slice(r));return h.as2D(-1,p)}),u=Cs(a.map(function(h){return h.shape}),1),c=De(u,e[0].dtype).values;if(1===a[0].shape[0]){var l=0;a.forEach(function(h){c.set(i.readSync(h.dataId),l),l+=h.size})}else{var d=0;a.forEach(function(h){for(var p=i.readSync(h.dataId),g=0,m=0;m<h.shape[0];++m)for(var v=m*u[1]+d,y=0;y<h.shape[1];++y)c[v+y]=p[g++];d+=h.shape[1]})}var f=Cs(e.map(function(h){return h.shape}),r);return gn(c,f,e[0].dtype)},n.prototype.neg=function(e){return W(e,"neg"),this.multiply(X(-1),e)},n.prototype.add=function(e,r){return"complex64"===e.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(i,o,s,a){return{real:i+s,imag:o+a}}):this.broadcastedBinaryOp(e,r,tn(e.dtype,r.dtype),function(i,o){return i+o})},n.prototype.addN=function(e){var r=this;W(e,"addN");for(var i=e.map(function(l){return r.readSync(l.dataId)}),o=De(e[0].shape,e[0].dtype),s=o.values,a=0;a<e.length;a++)for(var u=i[a],c=0;c<s.length;c++)s[c]+=u[c];return o.toTensor()},n.prototype.softmax=function(e,r){var i=Ht([r],e.shape),o=this.max(e,i),s=Vn(o.shape,i),a=this.subtract(e,o.reshape(s)),u=this.exp(a),c=this.sum(u,i).reshape(s);return this.realDivide(u,c)},n.prototype.subtract=function(e,r){return"complex64"===e.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(i,o,s,a){return{real:i-s,imag:o-a}}):this.broadcastedBinaryOp(e,r,tn(e.dtype,r.dtype),function(i,o){return i-o})},n.prototype.pow=function(e,r){return W([e,r],"pow"),this.broadcastedBinaryOp(e,r,e.dtype,function(i,o){return Math.pow(i,o)})},n.prototype.batchMatMul=function(e,r,i,o){W([e,r],"matMul");for(var s=i?e.shape[1]:e.shape[2],a=i?e.shape[2]:e.shape[1],u=o?r.shape[1]:r.shape[2],c=e.shape[0],l=this.readSync(e.dataId),d=this.readSync(r.dataId),f=i?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],h=f[0],p=f[1],g=f[2],m=o?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],v=m[0],y=m[1],w=m[2],b=a*u,_=De([c,a,u],e.dtype),C=_.values,T=this.blockSize,S=0;S<c;S++)for(var D=0;D<a;D+=T)for(var I=0;I<u;I+=T)for(var O=0;O<s;O+=T)for(var R=Math.min(D+T,a),V=Math.min(I+T,u),L=Math.min(O+T,s),B=D;B<R;B++)for(var z=I;z<V;z++){for(var H=0,U=O;U<L;U++)H+=l[S*h+B*p+U*g]*d[U*v+z*y+S*w];C[S*b+(B*u+z)]+=H}return _.toTensor()},n.prototype.fusedBatchMatMul=function(e){var a=e.bias,u=e.activation,c=e.preluActivationWeights,l=this.batchMatMul(e.a,e.b,e.transposeA,e.transposeB);return a&&(l=this.add(l,a)),u&&(l=S0(this,l,u,c)),l},n.prototype.multiply=function(e,r){return"complex64"===e.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(i,o,s,a){return{real:i*s-o*a,imag:i*a+o*s}}):this.broadcastedBinaryOp(e,r,tn(e.dtype,r.dtype),function(i,o){return i*o})},n.prototype.realDivide=function(e,r){return W([e,r],"realDivide"),this.broadcastedBinaryOp(e,r,"float32",function(i,o){return i/o})},n.prototype.floorDiv=function(e,r){return W([e,r],"floorDiv"),this.broadcastedBinaryOp(e,r,"int32",function(i,o){return Math.floor(i/o)})},n.prototype.sum=function(e,r){W(e,"sum"),Xn("sum",r,e.rank);for(var i=hn(e.shape,r),s=i[1],a=wt(i[0],tn(e.dtype,"int32")),u=ae(s),c=this.readSync(a.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=0,p=0;p<u;++p)h+=l[f+p];c[d]=h}return a},n.prototype.prod=function(e,r){W(e,"sum");for(var i=hn(e.shape,r),s=i[1],a=wt(i[0],tn(e.dtype,"int32")),u=ae(s),c=this.readSync(a.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=1,p=0;p<u;++p)h*=l[f+p];c[d]=h}return a},n.prototype.unsortedSegmentSum=function(e,r,i){W(e,"unsortedSegmentSum");for(var o=[],s=e.rank-r.rank,a=0;a<s;++a)r=r.expandDims(a+1);for(a=0;a<i;++a){var u=X(a,"int32"),c=YM(u,r).asType("float32").mul(e).sum(0);o.push(c)}return fr(o)},n.prototype.argMin=function(e,r){W(e,"argMin");var i=[r];Xn("argMin",i,e.rank);for(var o=hn(e.shape,i),a=o[1],u=wt(o[0],"int32"),c=ae(a),l=this.readSync(u.dataId),d=this.readSync(e.dataId),f=0;f<l.length;++f){for(var h=f*c,p=d[h],g=0,m=0;m<c;++m){var v=d[h+m];v<p&&(p=v,g=m)}l[f]=g}return u},n.prototype.argMax=function(e,r){W(e,"argMax");var i=[r];Xn("argMax",i,e.rank);for(var o=hn(e.shape,i),a=o[1],u=wt(o[0],"int32"),c=ae(a),l=this.readSync(u.dataId),d=this.readSync(e.dataId),f=0;f<l.length;++f){for(var h=f*c,p=d[h],g=0,m=0;m<c;++m){var v=d[h+m];v>p&&(p=v,g=m)}l[f]=g}return u},n.prototype.cumsum=function(e,r,i,o){if(W(e,"cumsum"),r!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+r);for(var s=tn(e.dtype,"int32"),a=wt(e.shape,s),u=this.readSync(a.dataId),c=this.readSync(e.dataId),l=e.shape[e.rank-1],d=o?function(m,v){return m+l-v-1}:function(m,v){return m+v},f=0;f<c.length;f+=l)for(var h=0;h<l;h++){var p=d(f,h);if(0===h)u[p]=i?0:c[p];else{var g=d(f,h-1);u[p]=i?c[g]+u[g]:c[p]+u[g]}}return a},n.prototype.equal=function(e,r){return W([e,r],"equal"),this.broadcastedBinaryOp(e,r,"bool",function(i,o){return i===o?1:0})},n.prototype.notEqual=function(e,r){return W([e,r],"notEqual"),this.broadcastedBinaryOp(e,r,"bool",function(i,o){return i!==o?1:0})},n.prototype.less=function(e,r){return W([e,r],"less"),this.broadcastedBinaryOp(e,r,"bool",function(i,o){return i<o?1:0})},n.prototype.lessEqual=function(e,r){return W([e,r],"lessEqual"),this.broadcastedBinaryOp(e,r,"bool",function(i,o){return i<=o?1:0})},n.prototype.greater=function(e,r){return W([e,r],"greater"),this.broadcastedBinaryOp(e,r,"bool",function(i,o){return i>o?1:0})},n.prototype.greaterEqual=function(e,r){return W([e,r],"greaterEqual"),this.broadcastedBinaryOp(e,r,"bool",function(i,o){return i>=o?1:0})},n.prototype.logicalNot=function(e){W(e,"logicalNot");for(var r=this.readSync(e.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)i[o]=r[o]?0:1;return this.makeOutput(i,e.shape,"bool")},n.prototype.logicalAnd=function(e,r){return W([e,r],"logicalAnd"),this.broadcastedBinaryOp(e,r,"bool",function(i,o){return i&&o})},n.prototype.logicalOr=function(e,r){return W([e,r],"logicalOr"),this.broadcastedBinaryOp(e,r,"bool",function(i,o){return i||o})},n.prototype.select=function(e,r,i){W([e,r,i],"select");for(var o=this.readSync(e.dataId),s=this.readSync(r.dataId),a=this.readSync(i.dataId),u=wt(r.shape,tn(r.dtype,i.dtype)),c=this.readSync(u.dataId),l=0,d=0===e.rank||e.rank>1||1===r.rank?1:ae(r.shape.slice(1)),f=0;f<o.length;f++)for(var h=0;h<d;h++)c[l++]=1===o[f]?s[f]:a[f];return u},n.prototype.where=function(e){W([e],"where");var r=this.readSync(e.dataId);return e0(e.shape,r)},n.prototype.topk=function(e,r,i){return W(e,"topk"),GT(this.readSync(e.dataId),e.shape,e.dtype,r)},n.prototype.min=function(e,r){W(e,"min"),Xn("min",r,e.rank);for(var i=hn(e.shape,r),s=i[1],a=wt(i[0],e.dtype),u=ae(s),c=this.readSync(a.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p){var g=l[f+p];g<h&&(h=g)}c[d]=h}return a},n.prototype.minimum=function(e,r){return W([e,r],"minimum"),this.broadcastedBinaryOp(e,r,e.dtype,function(i,o){return Math.min(i,o)})},n.prototype.mod=function(e,r){return W([e,r],"mod"),this.broadcastedBinaryOp(e,r,e.dtype,function(i,o){var s=i%o;return i<0&&o<0||i>=0&&o>=0?s:(s+o)%o})},n.prototype.max=function(e,r){W(e,"max"),Xn("max",r,e.rank);for(var i=hn(e.shape,r),s=i[1],a=wt(i[0],e.dtype),u=ae(s),c=this.readSync(a.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p){var g=l[f+p];g>h&&(h=g)}c[d]=h}return a},n.prototype.maximum=function(e,r){return W([e,r],"maximum"),this.broadcastedBinaryOp(e,r,e.dtype,function(i,o){return Math.max(i,o)})},n.prototype.all=function(e,r){W(e,"all"),Xn("all",r,e.rank);for(var i=hn(e.shape,r),s=i[1],a=wt(i[0],e.dtype),u=ae(s),c=this.readSync(a.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p)h=h&&l[f+p];c[d]=h}return a},n.prototype.any=function(e,r){W(e,"any"),Xn("any",r,e.rank);for(var i=hn(e.shape,r),s=i[1],a=wt(i[0],e.dtype),u=ae(s),c=this.readSync(a.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p)h=h||l[f+p];c[d]=h}return a},n.prototype.squaredDifference=function(e,r){return W([e,r],"squaredDifference"),this.broadcastedBinaryOp(e,r,e.dtype,function(i,o){var s=i-o;return s*s})},n.prototype.ceil=function(e){W(e,"ceil");for(var r=this.readSync(e.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.ceil(r[o]);return this.makeOutput(i,e.shape,"float32")},n.prototype.floor=function(e){W(e,"floor");for(var r=this.readSync(e.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.floor(r[o]);return this.makeOutput(i,e.shape,"float32")},n.prototype.sign=function(e){W(e,"x");for(var r=this.readSync(e.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=r[o]<0?-1:r[o]>0?1:0;return this.makeOutput(i,e.shape,"float32")},n.prototype.isNaN=function(e){W(e,"x");for(var r=this.readSync(e.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isNaN(r[o])&&(i[o]=1);return this.makeOutput(i,e.shape,"bool")},n.prototype.isInf=function(e){W(e,"x");for(var r=this.readSync(e.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Math.abs(r[o])===1/0&&(i[o]=1);return this.makeOutput(i,e.shape,"bool")},n.prototype.isFinite=function(e){W(e,"x");for(var r=this.readSync(e.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isFinite(r[o])&&(i[o]=1);return this.makeOutput(i,e.shape,"bool")},n.prototype.round=function(e){W(e,"round");for(var r=this.readSync(e.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=Math.floor(r[o]);i[o]=r[o]-s<.5?Math.floor(r[o]):r[o]-s>.5?Math.ceil(r[o]):s%2==0?s:s+1}return this.makeOutput(i,e.shape,"float32")},n.prototype.exp=function(e){W(e,"exp");for(var r=this.readSync(e.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.exp(r[o]);return this.makeOutput(i,e.shape,"float32")},n.prototype.expm1=function(e){W(e,"expm1");for(var r=this.readSync(e.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.expm1(r[o]);return this.makeOutput(i,e.shape,"float32")},n.prototype.log=function(e){W(e,"log");for(var r=this.readSync(e.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.log(r[o]);return this.makeOutput(i,e.shape,"float32")},n.prototype.log1p=function(e){W(e,"log1p");for(var r=this.readSync(e.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.log1p(r[o]);return this.makeOutput(i,e.shape,"float32")},n.prototype.sqrt=function(e){W(e,"sqrt");for(var r=this.readSync(e.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.sqrt(r[o]);return this.makeOutput(i,e.shape,"float32")},n.prototype.rsqrt=function(e){W(e,"rsqrt");for(var r=this.readSync(e.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=1/Math.sqrt(r[o]);return this.makeOutput(i,e.shape,"float32")},n.prototype.reciprocal=function(e){W(e,"reciprocal");for(var r=this.readSync(e.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=1/r[o];return this.makeOutput(i,e.shape,"float32")},n.prototype.linear=function(e){return e},n.prototype.relu=function(e){W(e,"relu");for(var r=wt(e.shape,e.dtype),i=this.readSync(r.dataId),o=this.readSync(e.dataId),s=0;s<o.length;++s)i[s]=Math.max(0,o[s]);return r},n.prototype.relu6=function(e){W(e,"relu");for(var r=wt(e.shape,e.dtype),i=this.readSync(r.dataId),o=this.readSync(e.dataId),s=0;s<o.length;++s)i[s]=Math.min(Math.max(0,o[s]),6);return r},n.prototype.prelu=function(e,r){return W([e,r],"prelu"),this.broadcastedBinaryOp(e,r,e.dtype,function(i,o){return i<0?o*i:i})},n.prototype.elu=function(e){W(e,"elu");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o){var s=i[o];r[o]=s>=0?s:Math.exp(s)-1}return this.makeOutput(r,e.shape,"float32")},n.prototype.eluDer=function(e,r){W([e,r],"eluDer");for(var i=new Float32Array(r.size),o=this.readSync(r.dataId),s=this.readSync(e.dataId),a=0;a<o.length;++a){var u=o[a];i[a]=u>=1?s[a]:s[a]*(u+1)}return this.makeOutput(i,r.shape,"float32")},n.prototype.selu=function(e){W(e,"selu");for(var o=new Float32Array(e.size),s=this.readSync(e.dataId),a=0;a<s.length;++a){var u=s[a];o[a]=u>=0?1.0507009873554805*u:1.7580993408473768*(Math.exp(u)-1)}return this.makeOutput(o,e.shape,"float32")},n.prototype.clip=function(e,r,i){W(e,"clip");for(var o=new Float32Array(e.size),s=this.readSync(e.dataId),a=0;a<s.length;++a){var u=s[a];o[a]=u>i?i:u<r?r:u}return this.makeOutput(o,e.shape,"float32")},n.prototype.abs=function(e){for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.abs(i[o]);return this.makeOutput(r,e.shape,"float32")},n.prototype.complexAbs=function(e){for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<e.size;++o)r[o]=Math.hypot(i[2*o],i[2*o+1]);return this.makeOutput(r,e.shape,"float32")},n.prototype.int=function(e){W(e,"int");for(var r=new Int32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=i[o];return this.makeOutput(r,e.shape,"int32")},n.prototype.sigmoid=function(e){W(e,"sigmoid");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=1/(1+Math.exp(-i[o]));return this.makeOutput(r,e.shape,"float32")},n.prototype.softplus=function(e){W(e,"softplus");for(var r=Math.log(1.1920928955078125e-7)+2,i=new Float32Array(e.size),o=this.readSync(e.dataId),s=0;s<o.length;++s){var l,a=o[s]>-r,u=o[s]<r,c=Math.exp(o[s]);l=u?c:a?o[s]:Math.log(1+c),i[s]=l}return this.makeOutput(i,e.shape,"float32")},n.prototype.sin=function(e){W(e,"sin");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.sin(i[o]);return this.makeOutput(r,e.shape,"float32")},n.prototype.cos=function(e){W(e,"cos");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.cos(i[o]);return this.makeOutput(r,e.shape,"float32")},n.prototype.tan=function(e){W(e,"tan");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.tan(i[o]);return this.makeOutput(r,e.shape,"float32")},n.prototype.asin=function(e){W(e,"asin");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.asin(i[o]);return this.makeOutput(r,e.shape,"float32")},n.prototype.acos=function(e){W(e,"acos");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.acos(i[o]);return this.makeOutput(r,e.shape,"float32")},n.prototype.atan=function(e){W(e,"atan");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.atan(i[o]);return this.makeOutput(r,e.shape,"float32")},n.prototype.atan2=function(e,r){return W([e,r],"atan2"),this.broadcastedBinaryOp(e,r,e.dtype,function(i,o){return Math.atan2(i,o)})},n.prototype.sinh=function(e){W(e,"sinh");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.sinh(i[o]);return this.makeOutput(r,e.shape,"float32")},n.prototype.cosh=function(e){W(e,"cosh");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.cosh(i[o]);return this.makeOutput(r,e.shape,"float32")},n.prototype.tanh=function(e){W(e,"tanh");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=N2(i[o]);return this.makeOutput(r,e.shape,"float32")},n.prototype.asinh=function(e){W(e,"asinh");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.asinh(i[o]);return this.makeOutput(r,e.shape,"float32")},n.prototype.acosh=function(e){W(e,"acosh");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.acosh(i[o]);return this.makeOutput(r,e.shape,"float32")},n.prototype.atanh=function(e){W(e,"atanh");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.atanh(i[o]);return this.makeOutput(r,e.shape,"float32")},n.prototype.erf=function(e){W(e,"erf");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o){var s=Math.sign(i[o]),a=Math.abs(i[o]),u=1/(1+.3275911*a);r[o]=s*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-a*a))}return this.makeOutput(r,e.shape,"float32")},n.prototype.step=function(e,r){void 0===r&&(r=0),W(e,"step");for(var i=new Float32Array(e.size),o=this.readSync(e.dataId),s=0;s<o.length;++s){var a=o[s];i[s]=isNaN(a)?NaN:a>0?1:r}return this.makeOutput(i,e.shape,"float32")},n.prototype.fusedConv2d=function(e){var s=e.bias,a=e.activation,u=e.preluActivationWeights,c=this.conv2d(e.input,e.filter,e.convInfo);return s&&(c=this.add(c,s)),a&&(c=S0(this,c,a,u)),c},n.prototype.conv2d=function(e,r,i){W([e,r],"conv2d");for(var o=i.filterHeight,s=i.filterWidth,a=i.dilationHeight,u=i.dilationWidth,c=i.padInfo.left,l=i.padInfo.top,d="channelsLast"===i.dataFormat,f=De(i.outShape,e.dtype),h=e.strides[0],p=d?e.strides[1]:e.strides[2],g=d?e.strides[2]:1,m=d?1:e.strides[1],v=f.strides[0],y=d?f.strides[1]:f.strides[2],w=d?f.strides[2]:1,b=d?1:f.strides[1],_=this.readSync(e.dataId),C=this.readSync(r.dataId),T=f.values,S=0;S<i.batchSize;++S)for(var D=S*h,I=S*v,O=0;O<i.outHeight;++O)for(var R=I+O*y,V=O*i.strideHeight-l,L=0;L<o;L++){var B=V+L*a;if(!(B<0||B>=i.inHeight))for(var z=L*r.strides[0],H=D+B*p,U=0;U<i.outWidth;++U)for(var G=R+U*w,q=U*i.strideWidth-c,ee=0;ee<s;ee++){var le=q+ee*u;if(!(le<0||le>=i.inWidth))for(var he=H+le*g,Me=z+ee*r.strides[1],Ae=0;Ae<i.inChannels;++Ae){for(var Pe=_[he+Ae*m],ze=0;ze<i.outChannels;++ze)T[G+ze*b]+=Pe*C[Me+ze];Me+=i.outChannels}}}return f.toTensor()},n.prototype.conv3d=function(e,r,i){for(var o=i.filterDepth,s=i.filterHeight,a=i.filterWidth,u=i.dilationDepth,c=i.dilationHeight,l=i.dilationWidth,d=i.padInfo.front,f=i.padInfo.left,h=i.padInfo.top,p=De(i.outShape,e.dtype),g=this.readSync(e.dataId),m=this.readSync(r.dataId),v=p.values,y=0;y<i.batchSize;++y)for(var w=y*e.strides[0],b=y*p.strides[0],_=0;_<i.outDepth;++_)for(var C=b+_*p.strides[1],T=_*i.strideDepth-d,S=0;S<o;S++){var D=T+S*u;if(!(D<0||D>=i.inDepth))for(var I=S*r.strides[0],O=w+D*e.strides[1],R=0;R<i.outHeight;++R)for(var V=C+R*p.strides[2],L=R*i.strideHeight-h,B=0;B<s;B++){var z=L+B*c;if(!(z<0||z>=i.inHeight))for(var H=I+B*r.strides[1],U=O+z*e.strides[2],G=0;G<i.outWidth;++G)for(var q=V+G*i.outChannels,ee=G*i.strideWidth-f,le=0;le<a;le++){var he=ee+le*l;if(!(he<0||he>=i.inWidth))for(var Ae=U+he*i.inChannels,Pe=H+le*r.strides[2],ze=0;ze<i.inChannels;++ze){for(var Le=g[Ae+ze],Ge=0;Ge<i.outChannels;++Ge)v[q+Ge]+=Le*m[Pe+Ge];Pe+=i.outChannels}}}}return p.toTensor()},n.prototype.conv2dDerInput=function(e,r,i){W([e,r],"conv2dDerInput");for(var o=De(i.inShape,"float32"),s=o.values,a=this.readSync(e.dataId),u=this.readSync(r.dataId),c=r.strides,l=c[0],d=c[1],f=c[2],h=i.batchSize,p=i.filterHeight,g=i.filterWidth,m=i.inChannels,v=i.inHeight,y=i.inWidth,w=i.outChannels,b=i.outHeight,_=i.outWidth,C=i.strideHeight,T=i.strideWidth,D=p-1-i.padInfo.top,I=g-1-i.padInfo.left,O="channelsLast"===i.dataFormat,R=o.strides[0],V=O?o.strides[1]:o.strides[2],L=O?o.strides[2]:1,B=O?1:o.strides[1],z=e.strides[0],H=O?e.strides[1]:e.strides[2],U=O?e.strides[2]:1,G=O?1:e.strides[1],q=0;q<h;++q)for(var ee=0;ee<m;++ee)for(var le=0;le<v;++le)for(var he=le-D,Me=Math.max(0,Math.ceil(he/C)),Ae=Math.min(b,(p+he)/C),Pe=0;Pe<y;++Pe){for(var ze=Pe-I,Le=Math.max(0,Math.ceil(ze/T)),Ge=Math.min(_,(g+ze)/T),Ft=0,Be=Me;Be<Ae;++Be)for(var ot=Be*C-he,et=Le;et<Ge;++et)for(var Ot=z*q+H*Be+U*et,St=l*(p-1-ot)+d*(g-1-(et*T-ze))+f*ee,Tt=0;Tt<w;++Tt)Ft+=a[Ot+G*Tt]*u[St+Tt];s[R*q+V*le+L*Pe+B*ee]=Ft}return o.toTensor()},n.prototype.conv3dDerInput=function(e,r,i){for(var o=De(i.inShape,"float32"),s=o.values,a=o.strides,u=a[0],c=a[1],l=a[2],d=a[3],f=this.readSync(e.dataId),h=e.strides,p=h[0],g=h[1],m=h[2],v=h[3],y=this.readSync(r.dataId),w=r.strides,b=w[0],_=w[1],C=w[2],T=w[3],S=i.batchSize,D=i.filterDepth,I=i.filterHeight,O=i.filterWidth,R=i.inChannels,V=i.inDepth,L=i.inHeight,B=i.inWidth,z=i.outChannels,H=i.outDepth,U=i.outHeight,G=i.outWidth,q=i.strideDepth,ee=i.strideHeight,le=i.strideWidth,he=D-1-i.padInfo.front,Me=I-1-i.padInfo.top,Ae=O-1-i.padInfo.left,Pe=0;Pe<S;++Pe)for(var ze=0;ze<R;++ze)for(var Le=0;Le<V;++Le)for(var Ge=Le-he,Ft=Math.max(0,Math.ceil(Ge/q)),Be=Math.min(H,(D+Ge)/q),ot=0;ot<L;++ot)for(var et=ot-Me,Ot=Math.max(0,Math.ceil(et/ee)),St=Math.min(U,(I+et)/ee),Tt=0;Tt<B;++Tt){for(var Ei=Tt-Ae,Di=Math.max(0,Math.ceil(Ei/le)),gr=Math.min(G,(O+Ei)/le),wu=0,io=Ft;io<Be;++io)for(var Zo=io*q-Ge,oo=Ot;oo<St;++oo)for(var _u=oo*ee-et,so=Di;so<gr;++so)for(var Qb=p*Pe+g*io+m*oo+v*so,Cu=b*(D-1-Zo)+_*(I-1-_u)+C*(O-1-(so*le-Ei))+T*ze,Ii=0;Ii<z;++Ii)wu+=f[Qb+Ii]*y[Cu+Ii];s[u*Pe+c*Le+l*ot+d*Tt+ze]=wu}return o.toTensor()},n.prototype.conv2dDerFilter=function(e,r,i){W([e,r],"conv2dDerFilter");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,u=i.filterWidth,c="channelsLast"===i.dataFormat,l=De(i.filterShape,"float32"),d=i.padInfo.left,f=i.padInfo.top,h=this.bufferSync(e),p=this.bufferSync(r),g=0;g<a;++g)for(var m=Math.max(0,Math.ceil((f-g)/o)),v=Math.min(i.outHeight,(i.inHeight+f-g)/o),y=0;y<u;++y)for(var w=Math.max(0,Math.ceil((d-y)/s)),b=Math.min(i.outWidth,(i.inWidth+d-y)/s),_=0;_<i.inChannels;++_)for(var C=0;C<i.outChannels;++C){for(var T=0,S=0;S<i.batchSize;++S)for(var D=m;D<v;++D)for(var I=g+D*o-f,O=w;O<b;++O){var R=y+O*s-d;T+=c?h.get(S,I,R,_)*p.get(S,D,O,C):h.get(S,_,I,R)*p.get(S,C,D,O)}l.set(T,g,y,_,C)}return l.toTensor()},n.prototype.conv3dDerFilter=function(e,r,i){for(var o=i.strideDepth,s=i.strideHeight,a=i.strideWidth,u=i.filterDepth,c=i.filterHeight,l=i.filterWidth,d=De(i.filterShape,"float32"),f=d.values,h=d.strides,p=h[0],g=h[1],m=h[2],v=h[3],y=this.readSync(r.dataId),w=r.strides,b=w[0],_=w[1],C=w[2],T=w[3],S=this.readSync(e.dataId),D=e.strides,I=D[0],O=D[1],R=D[2],V=D[3],L=i.padInfo.front,B=i.padInfo.left,z=i.padInfo.top,H=0;H<u;++H)for(var U=Math.max(0,Math.ceil((L-H)/o)),G=Math.min(i.outDepth,(i.inDepth+L-H)/o),q=H*p,ee=0;ee<c;++ee)for(var le=Math.max(0,Math.ceil((z-ee)/s)),he=Math.min(i.outHeight,(i.inHeight+z-ee)/s),Me=ee*g+q,Ae=0;Ae<l;++Ae)for(var Pe=Math.max(0,Math.ceil((B-Ae)/a)),ze=Math.min(i.outWidth,(i.inWidth+B-Ae)/a),Le=Ae*m+Me,Ge=0;Ge<i.inChannels;++Ge)for(var Ft=Ge*v+Le,Be=0;Be<i.outChannels;++Be){for(var ot=0,et=0;et<i.batchSize;++et)for(var Ot=et*I,St=et*b,Tt=U;Tt<G;++Tt)for(var Ei=(H+Tt*o-L)*O+Ot,Di=Tt*_+St,gr=le;gr<he;++gr)for(var wu=(ee+gr*s-z)*R+Ei,io=gr*C+Di,Zo=Pe;Zo<ze;++Zo)ot+=S[(Ae+Zo*a-B)*V+wu+Ge]*y[Zo*T+io+Be];f[Ft+Be]=ot}return d.toTensor()},n.prototype.fusedDepthwiseConv2D=function(e){var s=e.bias,a=e.activation,u=e.preluActivationWeights,c=this.depthwiseConv2D(e.input,e.filter,e.convInfo);return s&&(c=this.add(c,s)),a&&(c=S0(this,c,a,u)),c},n.prototype.depthwiseConv2D=function(e,r,i){W([e,r],"depthwiseConv2D");for(var o=i.filterHeight,s=i.filterWidth,a=i.dilationHeight,u=i.dilationWidth,c=i.padInfo.left,l=i.padInfo.top,d=i.outChannels/i.inChannels,f=De(i.outShape,e.dtype),h=this.readSync(e.dataId),p=this.readSync(r.dataId),g=f.values,m=0;m<i.batchSize;++m)for(var v=m*e.strides[0],y=m*f.strides[0],w=0;w<i.outHeight;++w)for(var b=y+w*f.strides[1],_=w*i.strideHeight-c,C=0;C<o;++C){var T=_+C*a;if(!(T<0||T>=i.inHeight))for(var S=C*r.strides[0],D=v+T*e.strides[1],I=0;I<i.outWidth;++I)for(var O=b+I*f.strides[2],R=I*i.strideWidth-l,V=0;V<s;++V){var L=R+V*u;if(!(L<0||L>=i.inWidth))for(var z=D+L*i.inChannels,H=O,U=S+V*r.strides[1],G=0;G<i.inChannels;++G){for(var q=h[z+G],ee=0;ee<d;++ee)g[H+ee]+=q*p[U+ee];H+=d,U+=d}}}return f.toTensor()},n.prototype.depthwiseConv2DDerInput=function(e,r,i){W([e,r],"depthwiseConv2DDerInput");for(var o=De(i.inShape,"float32"),s=o.values,a=o.strides,u=a[0],c=a[1],l=a[2],d=this.readSync(e.dataId),f=e.strides,h=f[0],p=f[1],g=f[2],m=this.readSync(r.dataId),v=r.strides,y=v[0],w=v[1],b=v[2],_=i.batchSize,C=i.filterHeight,T=i.filterWidth,S=i.inChannels,D=i.inHeight,I=i.inWidth,R=i.outHeight,V=i.outWidth,L=i.strideHeight,B=i.strideWidth,z=C-1-i.padInfo.top,H=T-1-i.padInfo.left,U=i.outChannels/S,G=0;G<_;++G)for(var q=0;q<S;++q)for(var ee=0;ee<D;++ee)for(var le=ee-z,he=Math.max(0,Math.ceil(le/L)),Me=Math.min(R,(C+le)/L),Ae=0;Ae<I;++Ae){for(var Pe=Ae-H,ze=Math.max(0,Math.ceil(Pe/B)),Le=Math.min(V,(T+Pe)/B),Ge=0,Ft=he;Ft<Me;++Ft)for(var Be=Ft*L-le,ot=ze;ot<Le;++ot)for(var et=h*G+p*Ft+g*ot,Ot=y*(C-1-Be)+w*(T-1-(ot*B-Pe))+b*q,St=0;St<U;++St)Ge+=d[et+(q*U+St)]*m[Ot+St];s[u*G+c*ee+l*Ae+q]=Ge}return o.toTensor()},n.prototype.depthwiseConv2DDerFilter=function(e,r,i){W([e,r],"depthwiseConv2DDerFilter");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,u=i.filterWidth,c=De(i.filterShape,"float32"),l=i.padInfo.left,d=i.padInfo.top,f=i.outChannels/i.inChannels,h=this.bufferSync(e),p=this.bufferSync(r),g=0;g<a;++g)for(var m=Math.max(0,Math.ceil((d-g)/o)),v=Math.min(i.outHeight,(i.inHeight+d-g)/o),y=0;y<u;++y)for(var w=Math.max(0,Math.ceil((l-y)/s)),b=Math.min(i.outWidth,(i.inWidth+l-y)/s),_=0;_<i.outChannels;++_){for(var C=Math.trunc(_/f),T=_%f,S=0,D=0;D<i.batchSize;++D)for(var I=m;I<v;++I)for(var O=g+I*o-d,R=w;R<b;++R)S+=h.get(D,O,y+R*s-l,C)*p.get(D,I,R,_);c.set(S,g,y,C,T)}return c.toTensor()},n.prototype.tile=function(e,r){return W(e,"tile"),zT(this.bufferSync(e),r)},n.prototype.pad=function(e,r,i){W(e,"pad");var o=r.map(function(f,h){return f[0]+e.shape[h]+f[1]}),s=r.map(function(f){return f[0]}),a=this.bufferSync(e),u=De(o,e.dtype);0!==i&&u.values.fill(i);for(var c=0;c<e.size;c++){var l=a.indexToLoc(c),d=l.map(function(f,h){return f+s[h]});u.set.apply(u,[a.get.apply(a,l)].concat(d))}return u.toTensor()},n.prototype.transpose=function(e,r){W(e,"transpose");for(var i=new Array(e.rank),o=0;o<i.length;o++)i[o]=e.shape[r[o]];var s=this.readSync(e.dataId),a=De(i,e.dtype),u=this.bufferSync(e);for(o=0;o<e.size;++o){for(var c=u.indexToLoc(o),l=new Array(c.length),d=0;d<l.length;d++)l[d]=c[r[d]];var f=a.locToIndex(l);a.values[f]=s[o]}return a.toTensor()},n.prototype.gather=function(e,r,i){W([e,r],"gather");var o=e.shape.slice(),s=this.readSync(r.dataId);o[i]=s.length;for(var a=De(o,e.dtype),u=this.bufferSync(e),c=0;c<a.size;++c){var l=a.indexToLoc(c),d=l.slice();d[i]=s[l[i]];var f=u.locToIndex(d);a.values[c]=u.values[f]}return a.toTensor()},n.prototype.batchToSpaceND=function(e,r,i){W([e],"batchToSpaceND");var o=r.reduce(function(d,f){return d*f}),s=ch(e.shape,r,o),a=lh(s.length,r.length),u=dh(e.shape,r,o),c=RT(i,r.length),l=OT(u,i,r.length);return e.reshape(s).transpose(a).reshape(u).slice(c,l)},n.prototype.spaceToBatchND=function(e,r,i){W([e],"spaceToBatchND");var o=r.reduce(function(f,h){return f*h}),s=[[0,0]];s.push.apply(s,i);for(var a=1+r.length;a<e.shape.length;++a)s.push([0,0]);var u=e.pad(s),c=ch(u.shape,r,o,!1),l=lh(c.length,r.length,!1),d=dh(u.shape,r,o,!1);return u.reshape(c).transpose(l).reshape(d)},n.prototype.pool=function(e,r,i){W(e,"pool");for(var o=r.strideHeight,s=r.strideWidth,a=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,h="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(e.dataId),g=De(r.outShape,e.dtype),m=g.values,v=r.outShape[1]*r.outShape[2]*r.outShape[3],y=r.outShape[2]*r.outShape[3],w=r.outShape[3],b=0;b<r.batchSize;++b)for(var _=b*v,C=b*e.strides[0],T=0;T<r.inChannels;++T)for(var S=0;S<r.outHeight;++S)for(var D=S*o-d,I=Math.max(0,D),O=Math.min(r.inHeight,c+D),R=_+S*y,V=0;V<r.outWidth;++V){for(var L=V*s-f,B=Math.max(0,L),z=Math.min(r.inWidth,l+L),H=h,U=0,G=0,q=I;q<O;q+=a){for(var ee=C+q*e.strides[1],le=B;le<z;le+=u){var he=p[ee+le*e.strides[2]+T];"max"===i&&he>H?H=he:"avg"===i&&(U+=he,G++)}if(isNaN(H))break}m[R+V*w+T]="avg"===i?U/G:H}return g.toTensor()},n.prototype.maxPool=function(e,r){return this.pool(e,r,"max")},n.prototype.maxPoolPositions=function(e,r){for(var i=De(r.outShape,"int32"),o=r.strideHeight,s=r.strideWidth,a=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,h=this.bufferSync(e),p=0;p<r.batchSize;++p)for(var g=0;g<r.inChannels;++g)for(var m=0;m<r.outHeight;++m){for(var v=m*o-d,y=v;y<0;)y+=a;for(var w=Math.min(r.inHeight,c+v),b=0;b<r.outWidth;++b){for(var _=b*s-f,C=_;C<0;)C+=u;for(var T=Math.min(r.inWidth,l+_),S=Number.NEGATIVE_INFINITY,D=-1,I=y;I<w;I+=a)for(var O=I-v,R=C;R<T;R+=u){var V=R-_,L=h.get(p,I,R,g);L>S&&(S=L,D=O*l+V)}i.set(D,p,m,b,g)}}return i.toTensor()},n.prototype.maxPoolBackprop=function(e,r,i,o){W([r,i],"maxPoolBackprop");for(var s=this.maxPoolPositions(r,o),a=o.strideHeight,u=o.strideWidth,c=o.dilationHeight,l=o.dilationWidth,d=o.effectiveFilterHeight,f=o.effectiveFilterWidth,h=f-1-o.padInfo.left,p=d-1-o.padInfo.top,g=De(r.shape,"float32"),m=this.bufferSync(s),v=this.bufferSync(e),y=0;y<o.batchSize;++y)for(var w=0;w<o.inChannels;++w)for(var b=0;b<o.inHeight;++b)for(var _=0;_<o.inWidth;++_){for(var C=b-p,T=_-h,S=0,D=0;D<d;D+=c){var I=(C+D)/a;if(!(I<0||I>=o.outHeight||Math.floor(I)!==I))for(var O=0;O<f;O+=l){var R=(T+O)/u;if(!(R<0||R>=o.outWidth||Math.floor(R)!==R)){var V=d*f-1-m.get(y,I,R,w)===D*f+O?1:0;0!==V&&(S+=v.get(y,I,R,w)*V)}}}g.set(S,y,b,_,w)}return g.toTensor()},n.prototype.avgPoolBackprop=function(e,r,i){W([e,r],"avgPoolBackprop");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,u=i.filterWidth,c=i.dilationHeight,l=i.dilationWidth,d=i.effectiveFilterHeight,f=i.effectiveFilterWidth,h=f-1-i.padInfo.left,p=d-1-i.padInfo.top,g=De(r.shape,"float32"),m=1/(a*u),v=this.bufferSync(e),y=0;y<i.batchSize;++y)for(var w=0;w<i.inChannels;++w)for(var b=0;b<i.inHeight;++b)for(var _=0;_<i.inWidth;++_){for(var C=b-p,T=_-h,S=0,D=0;D<d;D+=c){var I=(C+D)/o;if(!(I<0||I>=i.outHeight||Math.floor(I)!==I))for(var O=0;O<f;O+=l){var R=(T+O)/s;R<0||R>=i.outWidth||Math.floor(R)!==R||(S+=v.get(y,I,R,w))}}g.set(S*m,y,b,_,w)}return g.toTensor()},n.prototype.pool3d=function(e,r,i){W(e,"pool3d");for(var o=r.strideDepth,s=r.strideHeight,a=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,g=r.padInfo.top,m=r.padInfo.left,v="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,y=this.readSync(e.dataId),w=De(r.outShape,e.dtype),b=w.values,_=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],C=r.outShape[2]*r.outShape[3]*r.outShape[4],T=r.outShape[3]*r.outShape[4],S=r.outShape[4],D=0;D<r.batchSize;++D)for(var I=D*_,O=D*e.strides[0],R=0;R<r.inChannels;++R)for(var V=0;V<r.outDepth;++V){for(var L=V*o-p,B=L;B<0;)B+=u;for(var z=Math.min(r.inDepth,d+L),H=I+V*C,U=0;U<r.outHeight;++U){for(var G=U*s-g,q=G;q<0;)q+=c;for(var ee=Math.min(r.inHeight,f+G),le=H+U*T,he=0;he<r.outWidth;++he){for(var Me=he*a-m,Ae=Me;Ae<0;)Ae+=l;for(var Pe=Math.min(r.inWidth,h+Me),ze=le+he*S,Le=v,Ge=0,Ft=0,Be=B;Be<z;Be+=u){for(var ot=O+Be*e.strides[1],et=q;et<ee;et+=c){for(var Ot=ot+et*e.strides[2],St=Ae;St<Pe;St+=l){var Tt=y[Ot+St*e.strides[3]+R];if("max"===i&&Tt>Le?Le=Tt:"avg"===i&&(Ge+=Tt,Ft++),isNaN(Le))break}if(isNaN(Le))break}if(isNaN(Le))break}b[ze+R]="avg"===i?Ge/Ft:Le}}}return w.toTensor()},n.prototype.avgPool3d=function(e,r){return W(e,"avgPool3d"),this.pool3d(e,r,"avg").toFloat()},n.prototype.avgPool3dBackprop=function(e,r,i){W([e,r],"avgPool3dBackprop");for(var o=i.strideDepth,s=i.strideHeight,a=i.strideWidth,u=i.filterDepth,c=i.filterHeight,l=i.filterWidth,d=i.dilationDepth,f=i.dilationHeight,h=i.dilationWidth,p=i.effectiveFilterDepth,g=i.effectiveFilterHeight,m=i.effectiveFilterWidth,v=p-1-i.padInfo.front,y=m-1-i.padInfo.left,w=g-1-i.padInfo.top,b=De(r.shape,"float32"),_=1/(u*c*l),C=this.bufferSync(e),T=0;T<i.batchSize;++T)for(var S=0;S<i.inChannels;++S)for(var D=0;D<i.inDepth;++D)for(var I=0;I<i.inHeight;++I)for(var O=0;O<i.inWidth;++O){for(var R=D-v,V=I-w,L=O-y,B=0,z=0;z<p;z+=d){var H=(R+z)/o;if(!(H<0||H>=i.outDepth||Math.floor(H)!==H))for(var U=0;U<g;U+=f){var G=(V+U)/s;if(!(G<0||G>=i.outHeight||Math.floor(G)!==G))for(var q=0;q<m;q+=h){var ee=(L+q)/a;ee<0||ee>=i.outWidth||Math.floor(ee)!==ee||(B+=C.get(T,H,G,ee,S))}}}b.set(B*_,T,D,I,O,S)}return b.toTensor()},n.prototype.maxPool3d=function(e,r){return W(e,"maxPool3d"),this.pool3d(e,r,"max").toFloat()},n.prototype.maxPool3dPositions=function(e,r){for(var i=De(r.outShape,"int32"),o=r.strideDepth,s=r.strideHeight,a=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,g=r.padInfo.top,m=r.padInfo.left,v=this.bufferSync(e),y=0;y<r.batchSize;++y)for(var w=0;w<r.inChannels;++w)for(var b=0;b<r.outDepth;++b){for(var _=b*o-p,C=_;C<0;)C+=u;for(var T=Math.min(r.inDepth,d+_),S=0;S<r.outHeight;++S){for(var D=S*s-g,I=D;I<0;)I+=c;for(var O=Math.min(r.inHeight,f+D),R=0;R<r.outWidth;++R){for(var V=R*a-m,L=V;L<0;)L+=l;for(var B=Math.min(r.inWidth,h+V),z=Number.NEGATIVE_INFINITY,H=-1,U=C;U<T;U+=u)for(var G=U-_,q=I;q<O;q+=c)for(var ee=q-D,le=L;le<B;le+=l){var he=le-V,Me=v.get(y,U,q,le,w);Me>=z&&(z=Me,H=G*f*h+ee*f+he)}i.set(H,y,b,S,R,w)}}}return i.toTensor()},n.prototype.maxPool3dBackprop=function(e,r,i,o){W([r,i],"maxPool3dBackprop");for(var s=this.maxPool3dPositions(r,o),a=o.strideDepth,u=o.strideHeight,c=o.strideWidth,l=o.dilationDepth,d=o.dilationHeight,f=o.dilationWidth,h=o.effectiveFilterDepth,p=o.effectiveFilterHeight,g=o.effectiveFilterWidth,m=h-1-o.padInfo.front,v=g-1-o.padInfo.left,y=p-1-o.padInfo.top,w=De(r.shape,"float32"),b=this.bufferSync(s),_=this.bufferSync(e),C=0;C<o.batchSize;++C)for(var T=0;T<o.inChannels;++T)for(var S=0;S<o.inDepth;++S)for(var D=0;D<o.inHeight;++D)for(var I=0;I<o.inWidth;++I){for(var O=S-m,R=D-y,V=I-v,L=0,B=0;B<h;B+=l){var z=(O+B)/a;if(!(z<0||z>=o.outDepth||Math.floor(z)!==z))for(var H=0;H<p;H+=d){var U=(R+H)/u;if(!(U<0||U>=o.outHeight||Math.floor(U)!==U))for(var G=0;G<g;G+=f){var q=(V+G)/c;if(!(q<0||q>=o.outWidth||Math.floor(q)!==q)){var ee=h*p*g-1-b.get(C,z,U,q,T)===B*p*g+H*g+G?1:0;0!==ee&&(L+=_.get(C,z,U,q,T)*ee)}}}}w.set(L,C,S,D,I,T)}return w.toTensor()},n.prototype.cast=function(e,r){return Yy(e,r,this)},n.prototype.reshape=function(e,r){return yh(e,r)},n.prototype.avgPool=function(e,r){return W(e,"avgPool"),this.pool(e,r,"avg").toFloat()},n.prototype.resizeBilinear=function(e,r,i,o){W(e,"resizeBilinear");for(var s=e.shape,a=s[0],u=s[1],c=s[2],l=s[3],d=this.readSync(e.dataId),f=new Float32Array(ae([a,r,i,l])),h=[o&&r>1?u-1:u,o&&i>1?c-1:c],p=[o&&r>1?r-1:r,o&&i>1?i-1:i],g=0,m=h[0]/p[0],v=h[1]/p[1],y=0;y<a;y++)for(var w=0;w<r;w++)for(var b=m*w,_=Math.floor(b),C=b-_,T=Math.min(u-1,Math.ceil(b)),S=y*e.strides[0]+_*e.strides[1],D=y*e.strides[0]+T*e.strides[1],I=0;I<i;I++)for(var O=v*I,R=Math.floor(O),V=O-R,L=Math.min(c-1,Math.ceil(O)),B=S+R*e.strides[2],z=D+R*e.strides[2],H=S+L*e.strides[2],U=D+L*e.strides[2],G=0;G<l;G++){var q=d[B+G],ee=d[z+G],le=q+(d[H+G]-q)*V;f[g++]=le+(ee+(d[U+G]-ee)*V-le)*C}return gn(f,[a,r,i,l])},n.prototype.resizeBilinearBackprop=function(e,r,i){W([e,r],"resizeBilinearBackprop");for(var o=r.shape,s=o[0],a=o[1],u=o[2],c=o[3],l=e.shape,d=l[1],f=l[2],h=new Float32Array(s*a*u*c),p=[i&&d>1?a-1:a,i&&f>1?u-1:u],g=[i&&d>1?d-1:d,i&&f>1?f-1:f],m=p[0]/g[0],v=p[1]/g[1],y=this.readSync(e.dataId),w=0,b=0;b<s;b++)for(var _=b*r.strides[0],C=0;C<d;C++)for(var T=C*m,S=Math.floor(T),D=Math.min(Math.ceil(T),a-1),I=_+S*r.strides[1],O=_+D*r.strides[1],R=T-S,V=1-R,L=0;L<f;L++)for(var B=L*v,z=Math.floor(B),H=Math.min(Math.ceil(B),u-1),U=B-z,G=1-U,q=I+z*r.strides[2],ee=I+H*r.strides[2],le=O+z*r.strides[2],he=O+H*r.strides[2],Me=V*G,Ae=V*U,Pe=R*G,ze=R*U,Le=0;Le<c;Le++){var Ge=y[w++];h[q+Le]+=Ge*Me,h[ee+Le]+=Ge*Ae,h[le+Le]+=Ge*Pe,h[he+Le]+=Ge*ze}return Zn(h,[s,u,a,c],r.dtype)},n.prototype.resizeNearestNeighbor=function(e,r,i,o){W(e,"resizeNearestNeighbor");for(var s=e.shape,a=s[0],u=s[1],c=s[2],l=s[3],d=this.readSync(e.dataId),f=new Float32Array(a*r*i*l),h=[o&&r>1?u-1:u,o&&i>1?c-1:c],p=[o&&r>1?r-1:r,o&&i>1?i-1:i],g=h[0]/p[0],m=h[1]/p[1],v=0,y=0;y<a;y++)for(var w=y*e.strides[0],b=0;b<r;b++)for(var _=g*b,C=w+Math.min(u-1,o?Math.round(_):Math.floor(_))*e.strides[1],T=0;T<i;T++)for(var S=m*T,D=C+Math.min(c-1,o?Math.round(S):Math.floor(S))*e.strides[2],I=0;I<l;I++)f[v++]=d[D+I];return gn(f,[a,r,i,l],e.dtype)},n.prototype.resizeNearestNeighborBackprop=function(e,r,i){W([e,r],"resizeNearestNeighborBackprop");for(var o=r.shape,s=o[0],a=o[1],u=o[2],c=o[3],l=e.shape,d=l[1],f=l[2],h=new Float32Array(s*a*u*c),p=this.readSync(e.dataId),g=[i&&d>1?a-1:a,i&&f>1?u-1:u],m=[i&&d>1?d-1:d,i&&f>1?f-1:f],v=g[0]/m[0],y=g[1]/m[1],w=1/v,b=1/y,_=2*Math.ceil(w)+2,C=2*Math.ceil(b)+2,T=0;T<s;T++)for(var S=T*r.strides[0],D=0;D<a;D++)for(var I=S+D*r.strides[1],O=Math.floor(D*w),R=Math.floor(O-_/2),V=0;V<u;V++)for(var L=I+V*r.strides[2],B=Math.floor(V*b),z=Math.floor(B-C/2),H=0;H<c;H++){for(var U=0,G=0;G<_;G++){var q=G+R;if(!(q<0||q>=d)){var ee=S+q*e.strides[1],le=q*v;if(D===Math.min(a-1,i?Math.round(le):Math.floor(le)))for(var he=0;he<C;he++){var Me=he+z;if(!(Me<0||Me>=f)){var Ae=ee+Me*e.strides[2],Pe=Me*y;V===Math.min(u-1,i?Math.round(Pe):Math.floor(Pe))&&(U+=p[Ae+H])}}}}h[L+H]=U}return Zn(h,r.shape,r.dtype)},n.prototype.batchNormalization=function(e,r,i,o,s,a){W([e,r,i,s,a],"batchNorm");for(var u=this.readSync(e.dataId),c=this.readSync(r.dataId),l=this.readSync(i.dataId),d=s?this.readSync(s.dataId):new Float32Array([1]),f=a?this.readSync(a.dataId):new Float32Array([0]),h=new Float32Array(u.length),p=f.length,g=d.length,m=l.length,v=c.length,y=0,w=0,b=0,_=0,C=0;C<u.length;++C)h[C]=f[y++]+(u[C]-c[w++])*d[b++]/Math.sqrt(l[_++]+o),y>=p&&(y=0),w>=v&&(w=0),b>=g&&(b=0),_>=m&&(_=0);return Zn(h,e.shape)},n.prototype.localResponseNormalization4D=function(e,r,i,o,s){W(e,"localResponseNormalization4D");var a=e.shape[3],u=a-1,c=this.readSync(e.dataId),l=e.size,d=new Float32Array(l);function f(m){for(var v=m%a,y=m-v+Math.max(0,v-r),w=m-v+Math.min(v+r,u),b=0;y<=w;y++){var _=c[y];b+=_*_}return b}for(var h=0;h<l;h++){var p=f(h),g=c[h]*Math.pow(i+o*p,-s);d[h]=g}return Zn(d,e.shape)},n.prototype.LRNGrad=function(e,r,i,o,s,a,u){W(e,"LRNGrad");for(var c=e.shape[3],l=this.readSync(e.dataId),d=this.readSync(r.dataId),f=this.readSync(i.dataId),h=new Float32Array(e.size),p=e.size,g=0;g<p;g++){for(var m=g%c,v=g-m+Math.max(0,m-o),y=g-m+Math.min(c,m+o+1),w=0,b=v;b<y;b++)w+=Math.pow(d[b],2);for(w=a*w+s,b=v;b<y;b++){var _=-2*a*u*d[b]*f[g]/w;g===b&&(_+=Math.pow(w,-u)),h[b]+=_*=l[g]}}return Zn(h,e.shape)},n.prototype.multinomial=function(e,r,i,o){W(e,"multinomial");for(var s=r?e:Yi(e),a=s.shape[0],u=s.shape[1],c=wt([a,i],"int32"),l=this.readSync(c.dataId),d=this.readSync(s.dataId),f=0;f<a;++f){var h=f*u,p=new Float32Array(u-1);p[0]=d[h];for(var g=1;g<p.length;++g)p[g]=p[g-1]+d[h+g];for(var m=uh(o.toString()),v=f*i,y=0;y<i;++y){var w=m();l[v+y]=p.length;for(var b=0;b<p.length;b++)if(w<p[b]){l[v+y]=b;break}}}return c},n.prototype.oneHot=function(e,r,i,o){W(e,"oneHot");var s=new Float32Array(e.size*r);s.fill(o);for(var a=this.readSync(e.dataId),u=0;u<e.size;++u)a[u]>=0&&a[u]<r&&(s[u*r+a[u]]=i);return Bo(s,[e.size,r],"int32")},n.prototype.nonMaxSuppression=function(e,r,i,o,s){return W(e,"nonMaxSuppression"),Qy(this.readSync(e.dataId),this.readSync(r.dataId),i,o,s)},n.prototype.fft=function(e){return this.fftBatch(e,!1)},n.prototype.ifft=function(e){return this.fftBatch(e,!0)},n.prototype.fftBatch=function(e,r){for(var i=e.shape[0],o=e.shape[1],s=De(e.shape,"float32"),a=De(e.shape,"float32"),u=Sr(e).as2D(i,o),c=vi(e).as2D(i,o),l=0;l<i;l++)for(var d=u.slice([l,0],[1,o]),f=c.slice([l,0],[1,o]),h=pn(d,f),p=this.readSync(this.fftImpl(h,r).dataId),g=0;g<o;g++){var m=UT(p,g);s.values[l*o+g]=m.real,a.values[l*o+g]=m.imag}return pn(s.toTensor(),a.toTensor()).as2D(i,o)},n.prototype.fftImpl=function(e,r){var i=e.as1D(),o=i.size;if(this.isExponentOf2(o)){var s=this.fftRadix2(i,o,r).as2D(e.shape[0],e.shape[1]);return r&&(s=pn(Sr(s).div(X(o)),vi(s).div(X(o)))),s}var a=this.readSync(e.dataId),u=function(c){for(var l=new Float32Array(c.length/2),d=new Float32Array(c.length/2),f=0;f<c.length;f+=2)l[f/2]=c[f],d[f/2]=c[f+1];return{real:l,imag:d}}(this.fourierTransformByMatmul(a,o,r));return pn(u.real,u.imag).as2D(e.shape[0],e.shape[1])},n.prototype.isExponentOf2=function(e){return 0==(e&e-1)},n.prototype.fftRadix2=function(e,r,i){if(1===r)return e;var o=this.readSync(e.dataId),s=r/2,a=function(v){for(var y=Math.ceil(v.length/4),w=new Float32Array(y),b=new Float32Array(y),_=0;_<v.length;_+=4)w[Math.floor(_/4)]=v[_],b[Math.floor(_/4)]=v[_+1];return{real:w,imag:b}}(o),u=pn(a.real,a.imag).as1D(),c=function(v){for(var y=Math.floor(v.length/4),w=new Float32Array(y),b=new Float32Array(y),_=2;_<v.length;_+=4)w[Math.floor(_/4)]=v[_],b[Math.floor(_/4)]=v[_+1];return{real:w,imag:b}}(o),l=pn(c.real,c.imag).as1D();u=this.fftRadix2(u,s,i),l=this.fftRadix2(l,s,i);var d=function(v,y){for(var w=new Float32Array(v/2),b=new Float32Array(v/2),_=0;_<Math.ceil(v/2);_++){var C=(y?2:-2)*Math.PI*(_/v);w[_]=Math.cos(C),b[_]=Math.sin(C)}return{real:w,imag:b}}(r,i),f=pn(d.real,d.imag).mul(l),h=u.add(f),p=u.sub(f),g=Sr(h).concat(Sr(p)),m=vi(h).concat(vi(p));return pn(g,m).as1D()},n.prototype.fourierTransformByMatmul=function(e,r,i){for(var o=new Float32Array(2*r),s=0;s<r;s++){for(var a=0,u=0,c=0;c<r;c++){var l=lG(s*c,r,i),d=UT(e,c);a+=d.real*l.real-d.imag*l.imag,u+=d.real*l.imag+d.imag*l.real}i&&(a/=r,u/=r),cG(o,a,u,s)}return o},n.prototype.depthToSpace=function(e,r,i){E("NHWC"===i,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+i}),E(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var o=e.shape[0],s=e.shape[1],a=e.shape[2],u=e.shape[3],c=s*r,l=a*r,d=u/(r*r),f=this.readSync(e.dataId),h=new Float32Array(o*c*l*d),p=0,g=0;g<o;++g)for(var m=0;m<c;++m)for(var v=Math.floor(m/r),y=m%r,w=0;w<l;++w)for(var b=Math.floor(w/r),_=(y*r+w%r)*d,C=0;C<d;++C)h[p++]=f[C+_+u*(b+a*(v+s*g))];return Zn(h,[o,c,l,d])},n.prototype.broadcastedBinaryOp=function(e,r,i,o){var s=Re(e.shape,r.shape),a=De(s,i),u=this.readSync(e.dataId),c=this.readSync(r.dataId),l=Xi(e.shape,s),d=Xi(r.shape,s),f=a.values;if(l.length+d.length===0)for(var h=0;h<f.length;++h)f[h]=o(u[h%u.length],c[h%c.length]);else{var p=this.bufferSync(e),g=this.bufferSync(r),m=function(v){var y=a.indexToLoc(v),w=y.slice(-e.rank);l.forEach(function(T){return w[T]=0});var b=p.locToIndex(w),_=y.slice(-r.rank);d.forEach(function(T){return _[T]=0});var C=g.locToIndex(_);f[v]=o(u[b],c[C])};for(h=0;h<f.length;++h)m(h)}return a.toTensor()},n.prototype.broadcastedBinaryComplexOp=function(e,r,i){var o=Re(e.shape,r.shape),s=De(o,"float32"),a=De(o,"float32"),u=this.readSync(e.dataId),c=this.readSync(r.dataId),l=Xi(e.shape,o),d=Xi(r.shape,o),f=s.values,h=a.values;if(l.length+d.length===0)for(var p=0;p<f.length;p++){var g=p%u.length,m=p%c.length,v=i(u[2*g],u[2*g+1],c[2*m],c[2*m+1]);f[p]=v.real,h[p]=v.imag}else{var y=this.bufferSync(this.data.get(e.dataId).complexTensors.real),w=this.bufferSync(this.data.get(r.dataId).complexTensors.real),b=function(_){var C=s.indexToLoc(_),T=C.slice(-e.rank);l.forEach(function(R){return T[R]=0});var S=y.locToIndex(T),D=C.slice(-r.rank);d.forEach(function(R){return D[R]=0});var I=w.locToIndex(D),O=i(u[2*S],u[2*S+1],c[2*I],c[2*I+1]);f[_]=O.real,h[_]=O.imag};for(p=0;p<f.length;p++)b(p)}return this.complex(s.toTensor(),a.toTensor())},n.prototype.split=function(e,r,i){return WT(e,r,i)},n.prototype.dispose=function(){},n.prototype.floatPrecision=function(){return 32},n.prototype.epsilon=function(){return 1e-7},n.prototype.cropAndResize=function(e,r,i,o,s,a){for(var u=e.shape,c=u[0],l=u[1],d=u[2],f=u[3],h=r.shape[0],p=o[0],g=o[1],m=De([h,p,g,f],"float32"),v=this.readSync(r.dataId),y=this.readSync(i.dataId),w=this.readSync(e.dataId),b=e.strides,_=m.strides,C=0;C<h;C++){var T=4*C,S=v[T],D=v[T+1],I=v[T+2],O=v[T+3],R=y[C];if(!(R>=c))for(var V=p>1?(I-S)*(l-1)/(p-1):0,L=g>1?(O-D)*(d-1)/(g-1):0,B=0;B<p;B++){var z=p>1?S*(l-1)+B*V:.5*(S+I)*(l-1);if(z<0||z>l-1)for(var H=0;H<g;H++)for(var U=0;U<f;U++){var G=U+H*_[2]+B*_[1]+C*_[0];m.values[G]=a}else if("bilinear"===s){var q=Math.floor(z),ee=Math.ceil(z),le=z-q;for(H=0;H<g;H++)if((Be=g>1?D*(d-1)+H*L:.5*(D+O)*(d-1))<0||Be>d-1)for(U=0;U<f;U++)m.values[G=U+H*_[2]+B*_[1]+C*_[0]]=a;else{var he=Math.floor(Be),Me=Math.ceil(Be),Ae=Be-he;for(U=0;U<f;U++){var Pe=w[G=U+he*b[2]+q*b[1]+R*b[0]],ze=w[G=U+Me*b[2]+q*b[1]+R*b[0]],Le=w[G=U+he*b[2]+ee*b[1]+R*b[0]],Ge=Pe+(ze-Pe)*Ae,Ft=Le+(w[G=U+Me*b[2]+ee*b[1]+R*b[0]]-Le)*Ae;m.values[G=U+H*_[2]+B*_[1]+C*_[0]]=Ge+(Ft-Ge)*le}}}else for(H=0;H<g;++H){var Be;if((Be=g>1?D*(d-1)+H*L:.5*(D+O)*(d-1))<0||Be>d-1)for(U=0;U<f;U++)m.values[G=U+H*_[2]+B*_[1]+C*_[0]]=a;else{var ot=Math.round(Be),et=Math.round(z);for(U=0;U<f;U++)m.values[U+H*_[2]+B*_[1]+C*_[0]]=w[U+ot*b[2]+et*b[1]+R*b[0]]}}}}return m.toTensor()},n.prototype.sparseToDense=function(e,r,i,o){var s=fl(0,e,i);return this.scatter(e,r,i,s.outputSize,s.sliceSize,s.numUpdates,s.sliceRank,s.strides,o,!1)},n.prototype.gatherND=function(e,r){var i=r.shape,o=i[i.length-1],s=jy(e,r),a=s[0],u=s[1],c=s[2],l=s[3];if(0===u)return gn([],a,e.dtype);for(var d=new nl([u,c],e.dtype),f=this.readSync(r.dataId),h=this.readSync(e.dataId),p=0;p<u;p++){for(var g=[],m=0,v=0;v<o;v++){var y=f[p*o+v];m+=y*l[v],g.push(y)}if(m<0||m>=e.size/c)throw new Error("Invalid indices: "+g+" does not index into "+e.shape);for(var w=0;w<c;w++)d.values[p*c+w]=h[m*c+w]}return d.toTensor().reshape(a)},n.prototype.scatterND=function(e,r,i){var o=fl(0,e,i),s=o.sliceRank,a=o.numUpdates,u=o.sliceSize,c=o.strides,l=o.outputSize,d=X(0);return this.scatter(e,r,i,l,u,a,s,c,d,!0)},n.prototype.fill=function(e,r,i){var o=Zc(i=i||Qa(r),ae(e));return o.fill(r),M.makeTensor(o,e,i,this)},n.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},n.prototype.zerosLike=function(e){var r=Zc(e.dtype,ae(e.shape));return this.makeOutput(r,e.shape,e.dtype)},n.prototype.linspace=function(e,r,i){return Xy(e,r,i)},n.prototype.scatter=function(e,r,i,o,s,a,u,c,l,d){var f=[o/s,s],h=this.readSync(e.dataId),p=this.readSync(r.dataId);if(0===o)return gn([],i,r.dtype);var g=new nl(f,r.dtype);g.values.fill(this.readSync(l.dataId)[0]);for(var m=0;m<a;m++){for(var v=[],y=0,w=0;w<u;w++){var b=h[m*u+w];v.push(b),y+=b*c[w]}if(y<0||y>=o/s)throw new Error("Invalid indices: "+v+" does not index into "+i);for(var _=0;_<s;_++)d?g.values[y*s+_]+=p[m*s+_]:g.values[y*s+_]=0===r.rank?p[0]:p[m*s+_]}return g.toTensor().reshape(i)},n}(VT);M.registerBackend("cpu",function(){return new h7},1);for(var T0=0,bA=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(t){var n=t.inputs,r=t.attrs,o=n.boxes,s=n.scores,u=r.maxOutputSize,c=r.iouThreshold,l=r.scoreThreshold,d=r.softNmsSigma,f=t.backend;W(o,"NonMaxSuppressionWithScore");var h=Jy(f.data.get(o.dataId).values,f.data.get(s.dataId).values,u,c,l,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(t){var r=t.inputs.x,i=t.backend;W(r,"square");for(var o=i.data.get(r.dataId).values,s=new Float32Array(o.length),a=0;a<o.length;++a){var u=o[a];s[a]=u*u}return{dataId:i.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:yl,backendName:"cpu",kernelFunc:function(t){var n=t.inputs,i=n.a,o=n.b,s=t.backend;W([i,o],yl);var a=s.data.get(i.dataId).values,u=s.data.get(o.dataId).values,c=function(f,h,p,g,m,v){var y=Re(f,h),w=y.length,b=jr(y),_=Za(m,ae(y)),C=f.length,T=h.length,S=jr(f),D=jr(h),I=Xi(f,y),O=Xi(h,y);if(I.length+O.length===0)for(var R=0;R<_.length;++R)_[R]=v(p[R%p.length],g[R%g.length]);else{var V=function(L){var B=j2(L,w,b),z=B.slice(-C);I.forEach(function(q){return z[q]=0});var H=Cy(z,C,S),U=B.slice(-T);O.forEach(function(q){return U[q]=0});var G=Cy(U,T,D);_[L]=v(p[H],g[G])};for(R=0;R<_.length;++R)V(R)}return[_,y]}(i.shape,o.shape,a,u,i.dtype,function(f,h){var p=f-h;return p*p}),d=c[1];return{dataId:s.write(c[0],d,i.dtype),shape:d,dtype:i.dtype}}}];T0<bA.length;T0++)A2(bA[T0]);for(var cu,p7=function(t){this.variableNames=["A"];var n=_n(),e=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+e+".0);\n\n        vec4 values = "+n.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},g7=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=_n(),e=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+e+".0);\n            vec4 values = "+n.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+n.output+" = result;\n      }\n    "},M0=0,wA=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(t){var e=t.backend,i=t.inputs.pixels,s=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,u=s?[i.videoWidth,i.videoHeight]:[i.width,i.height],c=u[0],l=u[1],d=[l,c],f=[l,c,t.attrs.numChannels];(a||s)&&(null==cu&&(cu=document.createElement("canvas").getContext("2d")),cu.canvas.width=c,cu.canvas.height=l,cu.drawImage(i,0,0,c,l),i=cu.canvas);var h=e.makeTensorInfo(d,"int32");e.texData.get(h.dataId).usage=cr.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(h.dataId),i);var p=P().getBool("WEBGL_PACK")?new g7(f):new p7(f),g=e.runWebGLProgram(p,[h],"int32");return e.disposeData(h.dataId),g}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(t){var n=t.inputs,e=t.backend,r=t.attrs;oh("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var s=n.scores,u=r.maxOutputSize,c=r.iouThreshold,l=r.scoreThreshold,d=r.softNmsSigma,f=e,h=Jy(f.readSync(n.boxes.dataId),f.readSync(s.dataId),u,c,l,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(t){var r=t.inputs.x,i=t.backend,o=new Te(r.shape,"return x * x;");return i.runWebGLProgram(o,[r],r.dtype)}},{kernelName:yl,backendName:"webgl",kernelFunc:function(t){var n=t.inputs,i=n.a,o=n.b,s=t.backend,a=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zi("return (a - b) * (a - b);",i.shape,o.shape):new Rt("return (a - b) * (a - b);",i.shape,o.shape);return s.compileAndRun(a,[i,o])}}];M0<wA.length;M0++)A2(wA[M0]);for(var A0=0,_A=[{kernelName:"Square",gradFunc:function(t,n){var e=n[0];return{x:function(){return t.mul(e.toFloat().mul(2))}}}},{kernelName:yl,gradFunc:function(t,n){var e=n[0],r=n[1],i=X(2);return{a:function(){return Cn(t,Cn(i,Zt(e,r)))},b:function(){return Cn(t,Cn(i,Zt(r,e)))}}}}];A0<_A.length;A0++)y8(_A[A0]);var m7=function(){function t(){}return t.prototype.fetch=function(n,e){return fetch(n,e)},t.prototype.now=function(){return performance.now()},t.prototype.encode=function(n,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Browser's encoder only supports utf-8, but got "+e);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(n)},t.prototype.decode=function(n,e){return new TextDecoder(e).decode(n)},t}();P().get("IS_BROWSER")&&P().setPlatform("browser",new m7);var R0,y7=function(){function t(){this.util=xu(118),this.textEncoder=new this.util.TextEncoder}return t.prototype.fetch=function(n,e){return null!=P().global.fetch?P().global.fetch(n,e):(null==R0&&(R0=xu(655)),R0(n,e))},t.prototype.now=function(){var n=process.hrtime();return 1e3*n[0]+n[1]/1e6},t.prototype.encode=function(n,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(n)},t.prototype.decode=function(n,e){return 0===n.length?"":new this.util.TextDecoder(e).decode(n)},t}();P().get("IS_NODE")&&P().setPlatform("node",new y7);var O0={float32:4,int32:4,uint16:2,uint8:1,bool:1},Nh=4;function CA(t,n){for(var e={},r=0,i=function(a){var u=a.name,c=a.dtype,l=a.shape,d=ae(l),f=void 0;if("quantization"in a){var h=a.quantization;if("uint8"!==h.dtype&&"uint16"!==h.dtype)throw new Error("Weight "+a.name+" has unknown quantization dtype "+h.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=O0[h.dtype],g=t.slice(r,r+d*p),m="uint8"===h.dtype?new Uint8Array(g):new Uint16Array(g);if("float32"===c)f=Float32Array.from(m,function(C){return C*h.scale+h.min});else{if("int32"!==c)throw new Error("Unsupported dtype in weight '"+u+"': "+c);f=Int32Array.from(m,function(C){return Math.round(C*h.scale+h.min)})}r+=d*p}else if("string"===c){var v=ae(a.shape);f=[];for(var y=0;y<v;y++){var w=new Uint32Array(t.slice(r,r+Nh))[0];r+=Nh;var b=new Uint8Array(t.slice(r,r+w));f.push(b),r+=w}}else{var _=O0[c];if(g=t.slice(r,r+d*_),"float32"===c)f=new Float32Array(g);else if("int32"===c)f=new Int32Array(g);else{if("bool"!==c)throw new Error("Unsupported dtype in weight '"+u+"': "+c);f=new Uint8Array(g)}r+=d*_}e[u]=gn(f,l,c)},o=0,s=n;o<s.length;o++)i(s[o]);return e}function b7(t){if(null===t)throw new Error("Invalid input value: "+JSON.stringify(t));var n=0,e=[];t.forEach(function(o){if(n+=o.byteLength,e.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+o.constructor.name)});var r=new Uint8Array(n),i=0;return e.forEach(function(o){r.set(new Uint8Array(o.buffer),i),i+=o.byteLength}),r.buffer}var N0=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function xA(t){return N0?Buffer.byteLength(t):new Blob([t]).size}function k0(t){var n=0;t.forEach(function(i){n+=i.byteLength});var e=new Uint8Array(n),r=0;return t.forEach(function(i){e.set(new Uint8Array(i),r),r+=i.byteLength}),e.buffer}function EA(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);var n=t.split("/");return n[n.length-1]}function Cl(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:xA(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:xA(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}var hr=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerSaveRouter=function(n){t.getInstance().saveRouters.push(n)},t.registerLoadRouter=function(n){t.getInstance().loadRouters.push(n)},t.getSaveHandlers=function(n){return t.getHandlers(n,"save")},t.getLoadHandlers=function(n,e){return t.getHandlers(n,"load",e)},t.getHandlers=function(n,e,r){var i=[];return("load"===e?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach(function(o){var s=o(n,r);null!==s&&i.push(s)}),i},t}(),lu="://",Ho=function(){function t(){this.managers={}}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerManager=function(n,e){E(null!=n,function(){return"scheme must not be undefined or null."}),n.endsWith(lu)&&(n=n.slice(0,n.indexOf(lu))),E(n.length>0,function(){return"scheme must not be an empty string."});var r=t.getInstance();E(null==r.managers[n],function(){return"A model store manager is already registered for scheme '"+n+"'."}),r.managers[n]=e},t.getManager=function(n){var e=this.getInstance().managers[n];if(null==e)throw new Error("Cannot find model manager for scheme '"+n+"'");return e},t.getSchemes=function(){return Object.keys(this.getInstance().managers)},t}();function kh(t){if(-1===t.indexOf(lu))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Ho.getSchemes().join(","));return{scheme:t.split(lu)[0],path:t.split(lu)[1]}}function DA(t,n,e){return void 0===e&&(e=!1),ie(this,void 0,void 0,function(){var r,i,o,s,a,u,c,l,d;return oe(this,function(f){switch(f.label){case 0:return E(t!==n,function(){return"Old path and new path are the same: '"+t+"'"}),E((r=hr.getLoadHandlers(t)).length>0,function(){return"Copying failed because no load handler is found for source URL "+t+"."}),E(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+t+"."}),i=r[0],E((o=hr.getSaveHandlers(n)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+n+"."}),E(o.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+n+"."}),s=o[0],a=kh(t).scheme,u=kh(t).path,c=a===kh(t).scheme,[4,i.load()];case 1:return l=f.sent(),e&&c?[4,Ho.getManager(a).removeModel(u)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,s.save(l)];case 4:return d=f.sent(),!e||c?[3,6]:[4,Ho.getManager(a).removeModel(u)];case 5:f.sent(),f.label=6;case 6:return[2,d.modelArtifactsInfo]}})})}var As="models_store",jo="model_info_store";function IA(){if(!P().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var t=window||self,n=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==n)throw new Error("The current browser does not appear to support IndexedDB.");return n}function P0(t){var n=t.result;n.createObjectStore(As,{keyPath:"modelPath"}),n.createObjectStore(jo,{keyPath:"modelPath"})}var du=function(){function t(n){if(this.indexedDB=IA(),null==n||!n)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=n}return t.prototype.save=function(n){return ie(this,void 0,void 0,function(){return oe(this,function(e){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,n)]})})},t.prototype.load=function(){return ie(this,void 0,void 0,function(){return oe(this,function(n){return[2,this.databaseAction(this.modelPath)]})})},t.prototype.databaseAction=function(n,e){var r=this;return new Promise(function(i,o){var s=r.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return P0(s)},s.onsuccess=function(){var a=s.result;if(null==e){var u=a.transaction(As,"readonly"),c=u.objectStore(As).get(r.modelPath);c.onsuccess=function(){if(null==c.result)return a.close(),o(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));i(c.result.modelArtifacts)},c.onerror=function(g){return a.close(),o(c.error)},u.oncomplete=function(){return a.close()}}else{var l,d=Cl(e),f=a.transaction(jo,"readwrite"),h=f.objectStore(jo),p=h.put({modelPath:r.modelPath,modelArtifactsInfo:d});p.onsuccess=function(){var g=(l=a.transaction(As,"readwrite")).objectStore(As).put({modelPath:r.modelPath,modelArtifacts:e,modelArtifactsInfo:d});g.onsuccess=function(){return i({modelArtifactsInfo:d})},g.onerror=function(m){var v=(h=f.objectStore(jo)).delete(r.modelPath);v.onsuccess=function(){return a.close(),o(g.error)},v.onerror=function(y){return a.close(),o(g.error)}}},p.onerror=function(g){return a.close(),o(p.error)},f.oncomplete=function(){null==l?a.close():l.oncomplete=function(){return a.close()}}}},s.onerror=function(a){return o(s.error)}})},t.URL_SCHEME="indexeddb://",t}(),SA=function(t){return P().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(du.URL_SCHEME)?(n=t.slice(du.URL_SCHEME.length),new du(n)):null;var n};hr.registerSaveRouter(SA),hr.registerLoadRouter(SA);var w7=function(){function t(){this.indexedDB=IA()}return t.prototype.listModels=function(){return ie(this,void 0,void 0,function(){var n=this;return oe(this,function(e){return[2,new Promise(function(r,i){var o=n.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return P0(o)},o.onsuccess=function(){var s=o.result,a=s.transaction(jo,"readonly"),u=a.objectStore(jo).getAll();u.onsuccess=function(){for(var c={},l=0,d=u.result;l<d.length;l++){var f=d[l];c[f.modelPath]=f.modelArtifactsInfo}r(c)},u.onerror=function(c){return s.close(),i(u.error)},a.oncomplete=function(){return s.close()}},o.onerror=function(s){return i(o.error)}})]})})},t.prototype.removeModel=function(n){return ie(this,void 0,void 0,function(){var e=this;return oe(this,function(r){var i;return n=(i=n).startsWith(du.URL_SCHEME)?i.slice(du.URL_SCHEME.length):i,[2,new Promise(function(o,s){var a=e.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return P0(a)},a.onsuccess=function(){var u,c=a.result,l=c.transaction(jo,"readwrite"),d=l.objectStore(jo),f=d.get(n);f.onsuccess=function(){if(null==f.result)return c.close(),s(new Error("Cannot find model with path '"+n+"' in IndexedDB."));var h=d.delete(n),p=function(){var g=(u=c.transaction(As,"readwrite")).objectStore(As).delete(n);g.onsuccess=function(){return o(f.result.modelArtifactsInfo)},g.onerror=function(m){return s(f.error)}};h.onsuccess=p,h.onerror=function(g){return p(),c.close(),s(f.error)}},f.onerror=function(h){return c.close(),s(f.error)},l.oncomplete=function(){null==u?c.close():u.oncomplete=function(){return c.close()}}},a.onerror=function(u){return s(a.error)}})]})})},t}();if(P().getBool("IS_BROWSER"))try{Ho.registerManager(du.URL_SCHEME,new w7)}catch{}var Ji="/",fu="tensorflowjs_models",TA="info",_7="model_topology",C7="weight_specs",x7="weight_data",E7="model_metadata";function MA(t){return{info:[fu,t,TA].join(Ji),topology:[fu,t,_7].join(Ji),weightSpecs:[fu,t,C7].join(Ji),weightData:[fu,t,x7].join(Ji),modelMetadata:[fu,t,E7].join(Ji)}}function D7(t){var n=t.split(Ji);if(n.length<3)throw new Error("Invalid key format: "+t);return n.slice(1,n.length-1).join(Ji)}var hu=function(){function t(n){if(!P().getBool("IS_BROWSER")||typeof window>"u"||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==n||!n)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=n,this.keys=MA(this.modelPath)}return t.prototype.save=function(n){return ie(this,void 0,void 0,function(){var e,r,i;return oe(this,function(o){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(n.modelTopology),r=JSON.stringify(n.weightSpecs),i=Cl(n);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(s){if(N0)return Buffer.from(s).toString("base64");for(var a=new Uint8Array(s),u="",c=0,l=a.length;c<l;c++)u+=String.fromCharCode(a[c]);return btoa(u)}(n.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}return[2]})})},t.prototype.load=function(){return ie(this,void 0,void 0,function(){var n,e,r,i,o,s,a;return oe(this,function(u){if(null==(n=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==n.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},null==(r=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=r,null==(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=i,null!=(o=this.LS.getItem(this.keys.modelMetadata))&&(s=JSON.parse(o),e.format=s.format,e.generatedBy=s.generatedBy,e.convertedBy=s.convertedBy,e.userDefinedMetadata=s.userDefinedMetadata),null==(a=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(c){if(N0){var l=Buffer.from(c,"base64");return l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength)}for(var d=atob(c),f=new Uint8Array(d.length),h=0;h<d.length;++h)f.set([d.charCodeAt(h)],h);return f.buffer}(a),[2,e]})})},t.URL_SCHEME="localstorage://",t}(),AA=function(t){return P().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(hu.URL_SCHEME)?(n=t.slice(hu.URL_SCHEME.length),new hu(n)):null;var n};hr.registerSaveRouter(AA),hr.registerLoadRouter(AA);var I7=function(){function t(){E(P().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),E(typeof window>"u"||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return t.prototype.listModels=function(){return ie(this,void 0,void 0,function(){var n,e,r,i,o,s;return oe(this,function(a){for(n={},e=fu+Ji,r=Ji+TA,i=0;i<this.LS.length;++i)(o=this.LS.key(i)).startsWith(e)&&o.endsWith(r)&&(s=D7(o),n[s]=JSON.parse(this.LS.getItem(o)));return[2,n]})})},t.prototype.removeModel=function(n){return ie(this,void 0,void 0,function(){var e,r;return oe(this,function(i){var o;if(n=(o=n).startsWith(hu.URL_SCHEME)?o.slice(hu.URL_SCHEME.length):o,e=MA(n),null==this.LS.getItem(e.info))throw new Error("Cannot find model at path '"+n+"'");return r=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,r]})})},t}();if(P().getBool("IS_BROWSER"))try{Ho.registerManager(hu.URL_SCHEME,new I7)}catch{}function RA(t){return new Promise(function(n){return setTimeout(n)}).then(t)}var F0=function(){function t(n){if(!P().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");n.startsWith(t.URL_SCHEME)&&(n=n.slice(t.URL_SCHEME.length)),null!=n&&0!==n.length||(n="model"),this.modelTopologyFileName=n+".json",this.weightDataFileName=n+".weights.bin"}return t.prototype.save=function(n){return ie(this,void 0,void 0,function(){var e,o,s,a;return oe(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([n.weightData],{type:"application/octet-stream"})),!(n.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return o=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:n.weightSpecs}]})],{type:"application/json"})),(s=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,s.href=o,[4,RA(function(){return s.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),null==n.weightData?[3,4]:((a=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,a.href=e,[4,RA(function(){return a.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:Cl(n)}]}})})},t.URL_SCHEME="downloads://",t}(),A7=function(){function t(n){if(null==n||n.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+n);this.files=n}return t.prototype.load=function(){return ie(this,void 0,void 0,function(){var n,e,r=this;return oe(this,function(i){return n=this.files[0],e=this.files.slice(1),[2,new Promise(function(o,s){var a=new FileReader;a.onload=function(u){var c=JSON.parse(u.target.result),l=c.modelTopology;if(null!=l){0===e.length&&o({modelTopology:l});var d=c.weightsManifest;if(null!=d){var f;try{f=r.checkManifestAndWeightFiles(d,e)}catch(m){return void s(m)}var h=[],p=[],g=[];d.forEach(function(m){m.paths.forEach(function(v){p.push(v),g.push(null)}),h.push.apply(h,m.weights)}),d.forEach(function(m){m.paths.forEach(function(v){var y=new FileReader;y.onload=function(w){var b=w.target.result,_=p.indexOf(v);g[_]=b,-1===g.indexOf(null)&&o({modelTopology:l,weightSpecs:h,weightData:k0(g),format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata})},y.onerror=function(w){return s("Failed to weights data from file of path '"+v+"'.")},y.readAsArrayBuffer(f[v])})})}else s(new Error("weightManifest field is missing from file "+n.name))}else s(new Error("modelTopology field is missing from file "+n.name))},a.onerror=function(u){return s("Failed to read model topology and weights manifest JSON from file '"+n.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(n)})]})})},t.prototype.checkManifestAndWeightFiles=function(n,e){for(var r=[],i=e.map(function(u){return EA(u.name)}),o={},s=0,a=n;s<a.length;s++)a[s].paths.forEach(function(u){var c=EA(u);if(-1!==r.indexOf(c))throw new Error("Duplicate file basename found in weights manifest: '"+c+"'");if(r.push(c),-1===i.indexOf(c))throw new Error("Weight file with basename '"+c+"' is not provided.");o[u]=e[i.indexOf(c)]});if(r.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+e.length+").");return o},t}();function OA(t,n,e,r){var o;E(null!=(o=t)&&Array.isArray(o)&&o.length>0,function(){return"promises must be a none empty array"}),function(o,s){E(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o}),E(s>=0&&s<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+s}),E(s>=o,function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+s})}(e=e??0,r=r??1);var i=0;return Promise.all(t.map(function(o){return o.then(function(s){var a=e+ ++i/t.length*(r-e);return n(a),s}),o}))}function NA(t,n){return ie(this,void 0,void 0,function(){var e,r,i,o,s,a,u,c,l;return oe(this,function(d){switch(d.label){case 0:return null==n&&(n={}),e=null==n.fetchFunc?P().platform.fetch:n.fetchFunc,r=t.map(function(f){return e(f,n.requestInit,{isBinary:!0})}),i=0,o=.5,null!=n.onProgress?[3,2]:[4,Promise.all(r)];case 1:return s=d.sent(),[3,4];case 2:return[4,OA(r,n.onProgress,i,o)];case 3:s=d.sent(),d.label=4;case 4:return a=s.map(function(f){return f.arrayBuffer()}),u=.5,c=1,null!=n.onProgress?[3,6]:[4,Promise.all(a)];case 5:return l=d.sent(),[3,8];case 6:return[4,OA(a,n.onProgress,u,c)];case 7:l=d.sent(),d.label=8;case 8:return[2,l]}})})}function kA(t){var n=this;return function(e,r,i){return void 0===r&&(r=""),ie(n,void 0,void 0,function(){var o,s,a,u,c,l,d,f,h,p;return oe(this,function(g){switch(g.label){case 0:if(o=e.map(function(){return!1}),s={},a=null!=i?i.map(function(){return!1}):[],u=[],e.forEach(function(m,v){var y=0;m.weights.forEach(function(w){var _=O0["quantization"in w?w.quantization.dtype:w.dtype]*ae(w.shape),C=function(){o[v]=!0,null==s[v]&&(s[v]=[]),s[v].push({manifestEntry:w,groupOffset:y,sizeBytes:_})};null!=i?i.forEach(function(T,S){T===w.name&&(C(),a[S]=!0)}):C(),u.push(w.name),y+=_})}),!a.every(function(m){return m}))throw c=i.filter(function(m,v){return!a[v]}),new Error("Could not find weights in manifest with names: "+c.join(", ")+". \nManifest JSON has weights with names: "+u.join(", ")+".");return l=o.reduce(function(m,v,y){return v&&m.push(y),m},[]),d=[],l.forEach(function(m){e[m].paths.forEach(function(v){var y=r+(r.endsWith("/")?"":"/")+v;d.push(y)})}),[4,t(d)];case 1:return f=g.sent(),h={},p=0,l.forEach(function(m){for(var v=e[m].paths.length,y=0,w=0;w<v;w++)y+=f[p+w].byteLength;for(var b=new ArrayBuffer(y),_=new Uint8Array(b),C=0,T=0;T<v;T++){var S=new Uint8Array(f[p+T]);_.set(S,C),C+=S.byteLength}s[m].forEach(function(D){var I=CA(b.slice(D.groupOffset,D.groupOffset+D.sizeBytes),[D.manifestEntry]);for(var O in I)h[O]=I[O]}),p+=v}),[2,h]}})})}}hr.registerSaveRouter(function(t){return P().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(F0.URL_SCHEME)?(void 0===(n=t.slice(F0.URL_SCHEME.length))&&(n="model"),new F0(n)):null;var n});var PA=function(){function t(n,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,null!=e.fetchFunc?(E("function"==typeof e.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=e.fetchFunc):this.fetch=P().platform.fetch,E(null!=n&&n.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(n)&&E(2===n.length,function(){return"URL paths for http must have a length of 2, (actual length is "+n.length+")."}),this.path=n,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return t.prototype.save=function(n){return ie(this,void 0,void 0,function(){var e,o;return oe(this,function(s){switch(s.label){case 0:if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,e.body.append("model.json",new Blob([JSON.stringify({modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata,weightsManifest:[{paths:["./model.weights.bin"],weights:n.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=n.weightData&&e.body.append("model.weights.bin",new Blob([n.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((o=s.sent()).ok)return[2,{modelArtifactsInfo:Cl(n),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},t.prototype.load=function(){return ie(this,void 0,void 0,function(){var n,e,r,i,o,s,a,u,c,l,d,f;return oe(this,function(h){switch(h.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(n=h.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+n.status+". Please verify this URL points to the model JSON of the model to load.");h.label=2;case 2:return h.trys.push([2,4,,5]),[4,n.json()];case 3:return e=h.sent(),[3,5];case 4:throw h.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(o=e.weightsManifest,s=e.generatedBy,a=e.convertedBy,u=e.format,c=e.userDefinedMetadata,null==(i=e.modelTopology)&&null==o)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==o?[3,7]:[4,this.loadWeights(o)];case 6:f=h.sent(),l=f[0],d=f[1],h.label=7;case 7:return[2,{modelTopology:i,weightSpecs:l,weightData:d,userDefinedMetadata:c,generatedBy:s,convertedBy:a,format:u}]}})})},t.prototype.loadWeights=function(n){return ie(this,void 0,void 0,function(){var r,i,o,s,a,u,c,d,f;return oe(this,function(h){switch(h.label){case 0:for(void 0,void 0,g=(p=Array.isArray(this.path)?this.path[1]:this.path).lastIndexOf("/"),m=p.lastIndexOf("?"),r=[p.substring(0,g)+"/",m>g?p.substring(m):""],i=r[0],o=r[1],s=this.weightPathPrefix||i,a=[],u=0,c=n;u<c.length;u++)a.push.apply(a,c[u].weights);return d=[],n.forEach(function(p){p.paths.forEach(function(g){d.push(s+g+o)})}),[4,NA(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=h.sent(),[2,[a,k0(f)]]}var p,g,m})})},t.URL_SCHEME_REGEX=/^https?:\/\//,t}();function L0(t){return null!=t.match(PA.URL_SCHEME_REGEX)}var FA=function(t,n){return typeof fetch>"u"?null:(Array.isArray(t)?t.every(function(e){return L0(e)}):L0(t))?B0(t,{onProgress:n}):null};function B0(t,n){return new PA(t,n)}hr.registerSaveRouter(FA),hr.registerLoadRouter(FA);var pu,V0=function(){function t(n){this.modelArtifacts=n}return t.prototype.load=function(){return ie(this,void 0,void 0,function(){return oe(this,function(n){return[2,this.modelArtifacts]})})},t}(),R7=function(){function t(n){this.saveHandler=n}return t.prototype.save=function(n){return ie(this,void 0,void 0,function(){return oe(this,function(e){return[2,this.saveHandler(n)]})})},t}(),LA=Object.freeze({browserFiles:function(t){return new A7(t)},browserHTTPRequest:function(t,n){return B0(t,n)},concatenateArrayBuffers:k0,decodeWeights:CA,encodeWeights:function(t,n){return ie(this,void 0,void 0,function(){var e,r,i,o,s,a=this;return oe(this,function(u){switch(u.label){case 0:for(e=[],r=[],i=Array.isArray(t)?t.map(function(c){return c.name}):Object.keys(t),o=function(c){var l=i[c],d=Array.isArray(t)?t[c].tensor:t[l];if("float32"!==d.dtype&&"int32"!==d.dtype&&"bool"!==d.dtype&&"string"!==d.dtype)throw new Error("Unsupported dtype in weight '"+l+"': "+d.dtype);var f={name:l,shape:d.shape,dtype:d.dtype};if("string"===d.dtype){var h=new Promise(function(p){return ie(a,void 0,void 0,function(){var g,m,v,y,w,b,_;return oe(this,function(C){switch(C.label){case 0:return[4,d.bytes()];case 1:for(g=C.sent(),m=g.reduce(function(T,S){return T+S.length},0)+Nh*g.length,v=new Uint8Array(m),y=0,w=0;w<g.length;w++)b=g[w],_=new Uint8Array(new Uint32Array([b.length]).buffer),v.set(_,y),v.set(b,y+=Nh),y+=b.length;return p(v),[2]}})})});r.push(h)}else r.push(d.data());null!=n&&(f.group=n),e.push(f)},s=0;s<i.length;++s)o(s);return[4,Promise.all(r)];case 1:return[2,{data:b7(u.sent()),specs:e}]}})})},fromMemory:function(t,n,e,r){return 1===arguments.length?null!=t.modelTopology||null!=t.weightSpecs?new V0(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new V0({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new V0({modelTopology:t,weightSpecs:n,weightData:e,trainingConfig:r}))},getLoadHandlers:function(t,n){return hr.getLoadHandlers(t,n)},getModelArtifactsInfoForJSON:Cl,getSaveHandlers:function(t){return hr.getSaveHandlers(t)},http:B0,isHTTPScheme:L0,loadWeights:function(t,n,e,r){return void 0===n&&(n=""),ie(this,void 0,void 0,function(){return oe(this,function(i){return[2,kA(function(o){return NA(o,{requestInit:r})})(t,n,e)]})})},registerLoadRouter:function(t){return hr.registerLoadRouter(t)},registerSaveRouter:function(t){return hr.registerSaveRouter(t)},weightsLoaderFactory:kA,withSaveHandler:function(t){return new R7(t)},copyModel:function(t,n){return ie(this,void 0,void 0,function(){return oe(this,function(e){return[2,DA(t,n,!1)]})})},listModels:function(){return ie(this,void 0,void 0,function(){var t,n,e,r,i,o,s;return oe(this,function(a){switch(a.label){case 0:t=Ho.getSchemes(),n={},e=0,r=t,a.label=1;case 1:return e<r.length?[4,Ho.getManager(i=r[e]).listModels()]:[3,4];case 2:for(s in o=a.sent())n[i+lu+s]=o[s];a.label=3;case 3:return e++,[3,1];case 4:return[2,n]}})})},moveModel:function(t,n){return ie(this,void 0,void 0,function(){return oe(this,function(e){return[2,DA(t,n,!0)]})})},removeModel:function(t){return ie(this,void 0,void 0,function(){var n;return oe(this,function(e){return n=kh(t),[2,Ho.getManager(n.scheme).removeModel(n.path)]})})}}),O7=A({confusionMatrix_:function(t,n,e){var r=x(t,"labels","confusionMatrix"),i=x(n,"predictions","confusionMatrix");E(null==e||e>0&&Number.isInteger(e),function(){return"If provided, numClasses must be a positive integer, but got "+e}),E(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),E(1===i.rank,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),E(r.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),E(e>0&&Number.isInteger(e),function(){return"numClasses is required to be a positive integer, but got "+e});var o=Hy(r.asType("int32"),e),s=Hy(i.asType("int32"),e);return o.transpose().matMul(s).asType("int32")}}),N7=(Object.freeze({confusionMatrix:O7}),A({fromPixels_:function(t,n){if(void 0===n&&(n=3),n>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var e=!1,r=!1,i=!1,o=!1,s=!1;if(t.data instanceof Uint8Array)e=!0;else if(typeof ImageData<"u"&&t instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)o=!0;else{if(null==t.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);s=!0}if(i&&i&&t.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=T2("FromPixels",M.backendName))return M.runKernel("FromPixels",{pixels:t},{numChannels:n});var a,u,c=i?[t.videoWidth,t.videoHeight]:[t.width,t.height],l=c[0],d=c[1];if(s?a=t.getContext("2d").getImageData(0,0,l,d).data:r||e?a=t.data:(o||i)&&(null==pu&&(pu=document.createElement("canvas").getContext("2d")),pu.canvas.width=l,pu.canvas.height=d,pu.drawImage(t,0,0,l,d),a=pu.getImageData(0,0,l,d).data),4===n)u=new Int32Array(a);else{var f=l*d;u=new Int32Array(f*n);for(var h=0;h<f;h++)for(var p=0;p<n;++p)u[h*n+p]=a[4*h+p]}return By(u,[d,l,n],"int32")}})),U0=Object.freeze({toPixels:function(t,n){return ie(this,void 0,void 0,function(){var e,r,i,o,s,a,u,c,l,h,p,g,m,v,y,w,b,_,C,T,S;return oe(this,function(D){switch(D.label){case 0:if(e=x(t,"img","toPixels"),t instanceof lt||(e=e.toInt()),2!==e.rank&&3!==e.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+e.rank+".");if(r=e.shape.slice(0,2),i=r[0],o=r[1],(s=2===e.rank?1:e.shape[2])>4||2===s)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+s);return[4,e.data()];case 1:return a=D.sent(),u=e.min(),c=e.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(l=D.sent(),h=l[0][0],p=l[1][0],u.dispose(),c.dispose(),"float32"===e.dtype){if(h<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+p+"].")}else{if("int32"!==e.dtype)throw new Error("Unsupported type for toPixels: "+e.dtype+". Please use float32 or int32 tensors.");if(h<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+p+"].")}for(g="float32"===e.dtype?255:1,m=new Uint8ClampedArray(o*i*4),v=0;v<i*o;++v)y=void 0,w=void 0,b=void 0,_=void 0,1===s?(y=a[v]*g,w=a[v]*g,b=a[v]*g,_=255):3===s?(y=a[3*v]*g,w=a[3*v+1]*g,b=a[3*v+2]*g,_=255):4===s&&(y=a[4*v]*g,w=a[4*v+1]*g,b=a[4*v+2]*g,_=a[4*v+3]*g),m[0+(C=4*v)]=Math.round(y),m[C+1]=Math.round(w),m[C+2]=Math.round(b),m[C+3]=Math.round(_);return null!=n&&(n.width=o,n.height=i,T=n.getContext("2d"),S=new ImageData(m,o,i),T.putImageData(S,0,0)),e!==t&&e.dispose(),[2,m]}})})},fromPixels:N7}),BA=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(n,e){return new n(e)},t}(),VA=function(){function t(){this.classNameMap={}}return t.getMap=function(){return null==t.instance&&(t.instance=new t),t.instance},t.register=function(n){t.getMap().classNameMap[n.className]=[n,n.fromConfig]},t}();function Wo(t){E(null!=t.className,function(){return"Class being registered does not have the static className property defined."}),E("string"==typeof t.className,function(){return"className is required to be a string, but got type "+typeof t.className}),E(t.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),VA.register(t)}function H0(){return 32===M.backend.floatPrecision()?.001:.1}function j0(t,n,e){var r=!0;if((fn(t)||fn(n))&&(r=!1),fn(t)&&fn(n)&&(r=!0),r){var i=t.constructor.name,o=n.constructor.name;if(i!==o)throw new Error("Arrays are of different type. Actual: "+i+". Expected: "+o)}if(Array.isArray(t)&&Array.isArray(n)){var s=mi(t),a=mi(n);if(!Ut(s,a))throw new Error("Arrays have different shapes. Actual: ["+s+"]. Expected: ["+a+"]")}var u=fn(t)?t:$i(t),c=fn(n)?n:$i(n);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+".\nActual:   "+u+".\nExpected: "+c+".");for(var l=0;l<c.length;++l){var d=u[l],f=c[l];if(!e(d,f))throw new Error("Arrays differ: actual["+l+"] = "+d+", expected["+l+"] = "+f+".\nActual:   "+u+".\nExpected: "+c+".")}}function W0(t,n,e){return!isFinite(t)&&!isFinite(n)||!(isNaN(t)||isNaN(n)||Math.abs(t-n)>e)}Object.freeze({Serializable:BA,SerializationMap:VA,registerClass:Wo}),Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(t,n,e){return null==e&&(e=H0()),j0(t,n,function(r,i){return W0(r,i,e)})},testEpsilon:H0,expectPromiseToFail:function(t,n){t().then(function(){return n.fail()},function(){return n()})},expectArraysEqual:function(t,n){var e="string"==typeof n||"number"==typeof n||"boolean"==typeof n?[n]:n;return Po(t)||Po(t[0])||Po(n)||Po(n[0])?j0(t,e,function(r,i){return r==i}):j0(t,n,function(r,i){return W0(r,i,0)})},expectNumbersClose:function(t,n,e){if(null==e&&(e=H0()),!W0(t,n,e))throw new Error("Numbers differ: actual === "+t+", expected === "+n)},expectValuesInRange:function(t,n,e){for(var r=0;r<t.length;r++)if(t[r]<n||t[r]>e)throw new Error("Value out of range:"+t[r]+" low: "+n+", high: "+e)},expectArrayBuffersEqual:function(t,n){expect(new Float32Array(t)).toEqual(new Float32Array(n))}}),Object.freeze({gpgpu_util:r$,webgl_util:S8,forceHalfFloat:function(){P().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:LM,setWebGLContext:X2,GPGPUContext:wM});var Rs=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Hr(n,t),n.prototype.minimize=function(e,r,i){void 0===r&&(r=!1);var o=this.computeGradients(e,i),s=o.value,a=o.grads;if(null!=i){var u=i.map(function(c){return{name:c.name,tensor:a[c.name]}});this.applyGradients(u)}else this.applyGradients(a);return Yn(a),r?s:(s.dispose(),null)},Object.defineProperty(n.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),n.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},n.prototype.computeGradients=function(e,r){return function aG(t,n){E(Fo(t),function(){return"The f passed in variableGrads(f) must be a function"}),E(null==n||Array.isArray(n)&&n.every(function(l){return l instanceof eu}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var e=null!=n;if(!e)for(var r in n=[],M.registeredVariables)n.push(M.registeredVariables[r]);var i=e?n.filter(function(l){return!l.trainable}):null,o=n.length;E((n=n.filter(function(l){return l.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."});var s=M.gradients(t,n,null,!0),a=s.value,u=s.grads;E(u.some(function(l){return null!=l}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),E(0===a.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+a.rank+" tensor"});var c={};return n.forEach(function(l,d){null!=u[d]&&(c[l.name]=u[d])}),i?.forEach(function(l){return c[l.name]=null}),{value:a,grads:c}}(e,r)},n.prototype.dispose=function(){null!=this.iterations_&&Yn(this.iterations_)},n.prototype.saveIterations=function(){return ie(this,void 0,void 0,function(){return oe(this,function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:X(this.iterations_,"int32")}]})})},n.prototype.getWeights=function(){return ie(this,void 0,void 0,function(){return oe(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},n.prototype.setWeights=function(e){return ie(this,void 0,void 0,function(){return oe(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},n.prototype.extractIterations=function(e){return ie(this,void 0,void 0,function(){var r;return oe(this,function(i){switch(i.label){case 0:return r=this,[4,e[0].tensor.data()];case 1:return r.iterations_=i.sent()[0],[2,e.slice(1)]}})})},n}(BA);Object.defineProperty(Rs,Symbol.hasInstance,{value:function(t){return null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients}});var HA=function(t){function n(e,r,i){void 0===i&&(i=null);var o=t.call(this)||this;return o.learningRate=e,o.rho=r,o.epsilon=i,o.accumulatedGrads=[],o.accumulatedUpdates=[],null==i&&(o.epsilon=M.backend.epsilon()),o}return Hr(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e)).forEach(function(i,o){var s=M.registeredVariables[i];null==r.accumulatedGrads[o]&&(r.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:te(function(){return We(s).variable(!1)})}),null==r.accumulatedUpdates[o]&&(r.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:te(function(){return We(s).variable(!1)})});var a=Array.isArray(e)?e[o].tensor:e[i];if(null!=a){var u=r.accumulatedGrads[o].variable,c=r.accumulatedUpdates[o].variable;te(function(){var l=u.mul(r.rho).add(a.square().mul(1-r.rho)),d=c.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(a),f=c.mul(r.rho).add(d.square().mul(1-r.rho));u.assign(l),c.assign(f);var h=d.mul(-r.learningRate).add(s);s.assign(h)})}}),this.incrementIterations()},n.prototype.dispose=function(){null!=this.accumulatedUpdates&&(Yn(this.accumulatedGrads.map(function(e){return e.variable})),Yn(this.accumulatedUpdates.map(function(e){return e.variable})))},n.prototype.getWeights=function(){return ie(this,void 0,void 0,function(){var e;return oe(this,function(r){switch(r.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},n.prototype.setWeights=function(e){return ie(this,void 0,void 0,function(){var r;return oe(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(e)];case 1:return e=i.sent(),this.accumulatedGrads=e.slice(0,r=e.length/2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},n.fromConfig=function(e,r){return new e(r.learningRate,r.rho,r.epsilon)},n.className="Adadelta",n}(Rs);Wo(HA);var jA=function(t){function n(e,r){void 0===r&&(r=.1);var i=t.call(this)||this;return i.learningRate=e,i.initialAccumulatorValue=r,i.accumulatedGrads=[],i}return Hr(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e)).forEach(function(i,o){var s=M.registeredVariables[i];null==r.accumulatedGrads[o]&&(r.accumulatedGrads[o]={originalName:i+"/accumulator",variable:te(function(){return yi(s.shape,r.initialAccumulatorValue).variable(!1)})});var a=Array.isArray(e)?e[o].tensor:e[i];if(null!=a){var u=r.accumulatedGrads[o].variable;te(function(){var c=u.add(a.square());u.assign(c);var l=a.div(c.add(M.backend.epsilon()).sqrt()).mul(-r.learningRate).add(s);s.assign(l)})}}),this.incrementIterations()},n.prototype.dispose=function(){null!=this.accumulatedGrads&&Yn(this.accumulatedGrads.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return ie(this,void 0,void 0,function(){return oe(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},n.prototype.setWeights=function(e){return ie(this,void 0,void 0,function(){return oe(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),this.accumulatedGrads=e.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},n.fromConfig=function(e,r){return new e(r.learningRate,r.initialAccumulatorValue)},n.className="Adagrad",n}(Rs);Wo(jA);var WA=function(t){function n(e,r,i,o){void 0===o&&(o=null);var s=t.call(this)||this;return s.learningRate=e,s.beta1=r,s.beta2=i,s.epsilon=o,s.accumulatedFirstMoment=[],s.accumulatedSecondMoment=[],te(function(){s.accBeta1=X(r).variable(),s.accBeta2=X(i).variable()}),null==o&&(s.epsilon=M.backend.epsilon()),s}return Hr(n,t),n.prototype.applyGradients=function(e){var r=this,i=Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e);te(function(){var o=Zt(1,r.accBeta1),s=Zt(1,r.accBeta2);i.forEach(function(a,u){var c=M.registeredVariables[a];null==r.accumulatedFirstMoment[u]&&(r.accumulatedFirstMoment[u]={originalName:a+"/m",variable:te(function(){return We(c).variable(!1)})}),null==r.accumulatedSecondMoment[u]&&(r.accumulatedSecondMoment[u]={originalName:a+"/v",variable:te(function(){return We(c).variable(!1)})});var l=Array.isArray(e)?e[u].tensor:e[a];if(null!=l){var d=r.accumulatedFirstMoment[u].variable,f=r.accumulatedSecondMoment[u].variable,h=d.mul(r.beta1).add(l.mul(1-r.beta1)),p=f.mul(r.beta2).add(l.square().mul(1-r.beta2)),g=h.div(o),m=p.div(s);d.assign(h),f.assign(p);var v=g.div(m.sqrt().add(r.epsilon)).mul(-r.learningRate).add(c);c.assign(v)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Yn(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedSecondMoment&&Yn(this.accumulatedSecondMoment.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return ie(this,void 0,void 0,function(){var e;return oe(this,function(r){switch(r.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},n.prototype.setWeights=function(e){return ie(this,void 0,void 0,function(){var r,i=this;return oe(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(e)];case 1:return e=o.sent(),te(function(){i.accBeta1.assign(Sh(i.beta1,i.iterations_+1)),i.accBeta2.assign(Sh(i.beta2,i.iterations_+1))}),this.accumulatedFirstMoment=e.slice(0,r=e.length/2).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(r,2*r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},n.fromConfig=function(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon)},n.className="Adam",n}(Rs);Wo(WA);var zA=function(t){function n(e,r,i,o,s){void 0===o&&(o=null),void 0===s&&(s=0);var a=t.call(this)||this;return a.learningRate=e,a.beta1=r,a.beta2=i,a.epsilon=o,a.decay=s,a.accumulatedFirstMoment=[],a.accumulatedWeightedInfNorm=[],te(function(){a.iteration=X(0).variable(),a.accBeta1=X(r).variable()}),null==o&&(a.epsilon=M.backend.epsilon()),a}return Hr(n,t),n.prototype.applyGradients=function(e){var r=this,i=Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e);te(function(){var o=Zt(1,r.accBeta1),s=Kr(-r.learningRate,r.iteration.mul(r.decay).add(1));i.forEach(function(a,u){var c=M.registeredVariables[a];null==r.accumulatedFirstMoment[u]&&(r.accumulatedFirstMoment[u]={originalName:a+"/m",variable:We(c).variable(!1)}),null==r.accumulatedWeightedInfNorm[u]&&(r.accumulatedWeightedInfNorm[u]={originalName:a+"/v",variable:We(c).variable(!1)});var l=Array.isArray(e)?e[u].tensor:e[a];if(null!=l){var d=r.accumulatedFirstMoment[u].variable,f=r.accumulatedWeightedInfNorm[u].variable,h=d.mul(r.beta1).add(l.mul(1-r.beta1)),p=f.mul(r.beta2),g=l.abs(),m=p.maximum(g);d.assign(h),f.assign(m);var v=s.div(o).mul(h.div(m.add(r.epsilon))).add(c);c.assign(v)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Yn(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedWeightedInfNorm&&Yn(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return ie(this,void 0,void 0,function(){return oe(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},n.prototype.setWeights=function(e){return ie(this,void 0,void 0,function(){return oe(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},n.fromConfig=function(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},n.className="Adamax",n}(Rs);Wo(zA);var z0=function(t){function n(e){var r=t.call(this)||this;return r.learningRate=e,r.setLearningRate(e),r}return Hr(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e)).forEach(function(i,o){var s=Array.isArray(e)?e[o].tensor:e[i];if(null!=s){var a=M.registeredVariables[i];te(function(){var u=r.c.mul(s).add(a);a.assign(u)})}}),this.incrementIterations()},n.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=function T8(t){return M.keep(t)}(X(-e))},n.prototype.dispose=function(){this.c.dispose()},n.prototype.getWeights=function(){return ie(this,void 0,void 0,function(){return oe(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},n.prototype.setWeights=function(e){return ie(this,void 0,void 0,function(){return oe(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=r.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate}},n.fromConfig=function(e,r){return new e(r.learningRate)},n.className="SGD",n}(Rs);Wo(z0);var GA=function(t){function n(e,r,i){void 0===i&&(i=!1);var o=t.call(this,e)||this;return o.learningRate=e,o.momentum=r,o.useNesterov=i,o.accumulations=[],o.m=X(o.momentum),o}return Hr(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e)).forEach(function(i,o){var s=M.registeredVariables[i];null==r.accumulations[o]&&(r.accumulations[o]={originalName:i+"/momentum",variable:te(function(){return We(s).variable(!1)})});var a=r.accumulations[o].variable,u=Array.isArray(e)?e[o].tensor:e[i];null!=u&&te(function(){var c,l=r.m.mul(a).add(u);c=r.useNesterov?r.c.mul(u.add(l.mul(r.m))).add(s):r.c.mul(l).add(s),a.assign(l),s.assign(c)})}),this.incrementIterations()},n.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&Yn(this.accumulations.map(function(e){return e.variable}))},n.prototype.setMomentum=function(e){this.momentum=e},n.prototype.getWeights=function(){return ie(this,void 0,void 0,function(){return oe(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},n.prototype.setWeights=function(e){return ie(this,void 0,void 0,function(){return oe(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),this.accumulations=e.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},n.fromConfig=function(e,r){return new e(r.learningRate,r.momentum,r.useNesterov)},n.className="Momentum",n}(z0);Wo(GA);var $A=function(t){function n(e,r,i,o,s){void 0===r&&(r=.9),void 0===i&&(i=0),void 0===o&&(o=null),void 0===s&&(s=!1);var a=t.call(this)||this;if(a.learningRate=e,a.decay=r,a.momentum=i,a.epsilon=o,a.accumulatedMeanSquares=[],a.accumulatedMoments=[],a.accumulatedMeanGrads=[],a.centered=s,null==o&&(a.epsilon=M.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return a}return Hr(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e)).forEach(function(i,o){var s=M.registeredVariables[i];null==r.accumulatedMeanSquares[o]&&(r.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:te(function(){return We(s).variable(!1)})}),null==r.accumulatedMoments[o]&&(r.accumulatedMoments[o]={originalName:i+"/momentum",variable:te(function(){return We(s).variable(!1)})}),null==r.accumulatedMeanGrads[o]&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:te(function(){return We(s).variable(!1)})});var a=Array.isArray(e)?e[o].tensor:e[i];if(null!=a){var u=r.accumulatedMeanSquares[o].variable,c=r.accumulatedMoments[o].variable;te(function(){var l=u.mul(r.decay).add(a.square().mul(1-r.decay));if(r.centered){var d=r.accumulatedMeanGrads[o].variable,f=d.mul(r.decay).add(a.mul(1-r.decay)),h=c.mul(r.momentum).add(a.mul(r.learningRate).div(l.sub(f.square().add(r.epsilon)).sqrt()));u.assign(l),d.assign(f),c.assign(h);var p=s.sub(h);s.assign(p)}else{var g=u.mul(r.decay).add(a.square().mul(1-r.decay));h=c.mul(r.momentum).add(a.mul(r.learningRate).div(g.add(r.epsilon).sqrt())),u.assign(g),c.assign(h),p=s.sub(h),s.assign(p)}})}}),this.incrementIterations()},n.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&Yn(this.accumulatedMeanSquares.map(function(e){return e.variable})),null!=this.accumulatedMeanGrads&&this.centered&&Yn(this.accumulatedMeanGrads.map(function(e){return e.variable})),null!=this.accumulatedMoments&&Yn(this.accumulatedMoments.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return ie(this,void 0,void 0,function(){var e;return oe(this,function(r){switch(r.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},n.prototype.setWeights=function(e){return ie(this,void 0,void 0,function(){var r;return oe(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(e)];case 1:return e=i.sent(),this.accumulatedMeanSquares=e.slice(0,r=this.centered?e.length/3:e.length/2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*r,3*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},n.fromConfig=function(e,r){return new e(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},n.className="RMSProp",n}(Rs);Wo($A),function(){function t(){}t.sgd=function(n){return new z0(n)},t.momentum=function(n,e,r){return void 0===r&&(r=!1),new GA(n,e,r)},t.rmsprop=function(n,e,r,i,o){return void 0===e&&(e=.9),void 0===r&&(r=0),void 0===i&&(i=null),void 0===o&&(o=!1),new $A(n,e,r,i,o)},t.adam=function(n,e,r,i){return void 0===n&&(n=.001),void 0===e&&(e=.9),void 0===r&&(r=.999),void 0===i&&(i=null),new WA(n,e,r,i)},t.adadelta=function(n,e,r){return void 0===n&&(n=.001),void 0===e&&(e=.95),void 0===r&&(r=null),new HA(n,e,r)},t.adamax=function(n,e,r,i,o){return void 0===n&&(n=.002),void 0===e&&(e=.9),void 0===r&&(r=.999),void 0===i&&(i=null),void 0===o&&(o=0),new zA(n,e,r,i,o)},t.adagrad=function(n,e){return void 0===e&&(e=.1),new jA(n,e)}}(),typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"&&setImmediate,lt.prototype.squaredDifference=function(t){return BM(this,t)},k=f7;var G0=function(t,n){return(G0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])})(t,n)};function xe(t,n){function e(){this.constructor=t}G0(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}var En=function(){return En=Object.assign||function(n){for(var e,r=1,i=arguments.length;r<i;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},En.apply(this,arguments)};function ue(t,n,e,r){return new(e||(e=Promise))(function(o,s){function a(l){try{c(r.next(l))}catch(d){s(d)}}function u(l){try{c(r.throw(l))}catch(d){s(d)}}function c(l){l.done?o(l.value):function i(o){return o instanceof e?o:new e(function(s){s(o)})}(l.value).then(a,u)}c((r=r.apply(t,n||[])).next())})}function ce(t,n){var r,i,o,s,e={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(l){return function u(c){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,i&&(o=2&c[0]?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++,i=c[1],c=[0];continue;case 7:c=e.ops.pop(),e.trys.pop();continue;default:if(!(o=(o=e.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){e=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){e.label=c[1];break}if(6===c[0]&&e.label<o[1]){e.label=o[1],o=c;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(c);break}o[2]&&e.ops.pop(),e.trys.pop();continue}c=n.call(t,e)}catch(l){c=[6,l],i=0}finally{r=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,l])}}}function xl(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),i=0;for(n=0;n<e;n++)for(var o=arguments[n],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}var Ns=function(){function t(n,e){if(!ks(n)||!ks(e))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:n,height:e}));this._width=n,this._height=e}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.reverse=function(){return new t(1/this.width,1/this.height)},t}();function El(t,n){return t instanceof lt&&t.shape.length===n}function Fh(t){return El(t,3)}function zo(t){return El(t,4)}function KA(t){return t%2==0}function YA(t){return t&&t.width&&t.height}function $0(t){return t.reduce(function(n,e){return n.add(e)},new Qe(0,0)).div(new Qe(t.length,t.length))}function Dl(t,n,e){return Array(t).fill(0).map(function(r,i){return n+i*e})}function ks(t){return!!t&&t!==1/0&&t!==-1/0&&!isNaN(t)||0===t}function XA(t){return ks(t)&&0<=t&&t<=1}var Qe=function(){function t(n,e){this._x=n,this._y=e}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),t.prototype.add=function(n){return new t(this.x+n.x,this.y+n.y)},t.prototype.sub=function(n){return new t(this.x-n.x,this.y-n.y)},t.prototype.mul=function(n){return new t(this.x*n.x,this.y*n.y)},t.prototype.div=function(n){return new t(this.x/n.x,this.y/n.y)},t.prototype.abs=function(){return new t(Math.abs(this.x),Math.abs(this.y))},t.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t}(),eo=function(){function t(n,e){void 0===e&&(e=!0);var r=n||{},i=[r.left,r.top,r.right,r.bottom].every(ks),o=[r.x,r.y,r.width,r.height].every(ks);if(!o&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var s=o?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],a=s[0],u=s[1],c=s[2],l=s[3];t.assertIsValidBox({x:a,y:u,width:c,height:l},"Box.constructor",e),this._x=a,this._y=u,this._width=c,this._height=l}return t.isRect=function(n){return!!n&&[n.x,n.y,n.width,n.height].every(ks)},t.assertIsValidBox=function(n,e,r){if(void 0===r&&(r=!1),!t.isRect(n))throw new Error(e+" - invalid box: "+JSON.stringify(n)+", expected object with properties x, y, width, height");if(!r&&(n.width<0||n.height<0))throw new Error(e+" - width ("+n.width+") and height ("+n.height+") must be positive numbers")},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeft",{get:function(){return new Qe(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topRight",{get:function(){return new Qe(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeft",{get:function(){return new Qe(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomRight",{get:function(){return new Qe(this.right,this.bottom)},enumerable:!0,configurable:!0}),t.prototype.round=function(){var n=[this.x,this.y,this.width,this.height].map(function(s){return Math.round(s)});return new t({x:n[0],y:n[1],width:n[2],height:n[3]})},t.prototype.floor=function(){var n=[this.x,this.y,this.width,this.height].map(function(s){return Math.floor(s)});return new t({x:n[0],y:n[1],width:n[2],height:n[3]})},t.prototype.toSquare=function(){var n=this,e=n.x,r=n.y,i=n.width,o=n.height,s=Math.abs(i-o);return i<o&&(e-=s/2,i+=s),o<i&&(r-=s/2,o+=s),new t({x:e,y:r,width:i,height:o})},t.prototype.rescale=function(n){var e=YA(n)?n.width:n,r=YA(n)?n.height:n;return new t({x:this.x*e,y:this.y*r,width:this.width*e,height:this.height*r})},t.prototype.pad=function(n,e){var r=[this.x-n/2,this.y-e/2,this.width+n,this.height+e];return new t({x:r[0],y:r[1],width:r[2],height:r[3]})},t.prototype.clipAtImageBorders=function(n,e){var r=this,o=r.y,s=r.right,a=r.bottom,u=Math.max(r.x,0),c=Math.max(o,0),d=a-c;return new t({x:u,y:c,width:Math.min(s-u,n-u),height:Math.min(d,e-c)}).floor()},t.prototype.shift=function(n,e){return new t({x:this.x+n,y:this.y+e,width:this.width,height:this.height})},t.prototype.padAtBorders=function(n,e){var r=this.width+1,i=this.height+1,a=r,u=i,c=this.left,l=this.top,d=this.right,f=this.bottom;return d>e&&(a=-d+e+r,d=e),f>n&&(u=-f+n+i,f=n),c<1&&(u=2-c,c=1),l<1&&(u=2-l,l=1),{dy:1,edy:u,dx:1,edx:a,y:l,ey:f,x:c,ex:d,w:r,h:i}},t.prototype.calibrate=function(n){return new t({left:this.left+n.left*this.width,top:this.top+n.top*this.height,right:this.right+n.right*this.width,bottom:this.bottom+n.bottom*this.height}).toSquare().round()},t}(),Lh=function(t){function n(e,r,i,o,s){return void 0===s&&(s=!1),t.call(this,{left:e,top:r,right:i,bottom:o},s)||this}return xe(n,t),n}(eo),ZA=function(){function t(n,e,r,i,o){this._imageDims=new Ns(o.width,o.height),this._score=n,this._classScore=e,this._className=r,this._box=new eo(i).rescale(this._imageDims)}return Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativeBox",{get:function(){return new eo(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),t.prototype.forSize=function(n,e){return new t(this.score,this.classScore,this.className,this.relativeBox,{width:n,height:e})},t}(),Yr=function(t){function n(e,r,i){return t.call(this,e,e,"",r,i)||this}return xe(n,t),n.prototype.forSize=function(e,r){var i=t.prototype.forSize.call(this,e,r);return new n(i.score,i.relativeBox,i.imageDims)},n}(ZA);function j7(t,n,e){void 0===e&&(e=!0);var o=Math.max(0,Math.min(t.right,n.right)-Math.max(t.left,n.left))*Math.max(0,Math.min(t.bottom,n.bottom)-Math.max(t.top,n.top));return e?o/(t.area+n.area-o):o/Math.min(t.area,n.area)}function Il(t,n,e,r){void 0===r&&(r=!0);for(var i=n.map(function(a,u){return{score:a,boxIndex:u}}).sort(function(a,u){return a.score-u.score}).map(function(a){return a.boxIndex}),o=[],s=function(){var a=i.pop();o.push(a);for(var u=i,c=[],l=0;l<u.length;l++)c.push(j7(t[a],t[u[l]],r));i=i.filter(function(p,g){return c[g]<=e})};i.length>0;)s();return o}function Sl(t,n){return te(function(){var e=n[0],r=n[1],i=n[2],o=yi(xl(t.shape.slice(0,3),[1]),e),s=yi(xl(t.shape.slice(0,3),[1]),r),a=yi(xl(t.shape.slice(0,3),[1]),i),u=Yt([o,s,a],3);return Zt(t,u)})}function q0(t){return 1/(1+Math.exp(-t))}var Qt,K0=function(t){function n(e,r,i,o,s){return void 0===s&&(s=!1),t.call(this,{x:e,y:r,width:i,height:o},s)||this}return xe(n,t),n}(eo),Tl=function(){function t(n,e,r){void 0===r&&(r=new Qe(0,0));var i=e.width,o=e.height;this._imgDims=new Ns(i,o),this._shift=r,this._positions=n.map(function(s){return s.mul(new Qe(i,o)).add(r)})}return Object.defineProperty(t.prototype,"shift",{get:function(){return new Qe(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativePositions",{get:function(){var n=this;return this._positions.map(function(e){return e.sub(n._shift).div(new Qe(n.imageWidth,n.imageHeight))})},enumerable:!0,configurable:!0}),t.prototype.forSize=function(n,e){return new this.constructor(this.relativePositions,{width:n,height:e})},t.prototype.shiftBy=function(n,e){return new this.constructor(this.relativePositions,this._imgDims,new Qe(n,e))},t.prototype.shiftByPoint=function(n){return this.shiftBy(n.x,n.y)},t.prototype.align=function(n,e){if(void 0===e&&(e={}),n){var r=n instanceof Yr?n.box.floor():new eo(n);return this.shiftBy(r.x,r.y).align(null,e)}var i=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),s=i.minBoxPadding;return i.useDlibAlignment?this.alignDlib():this.alignMinBbox(s)},t.prototype.alignDlib=function(){var n=this.getRefPointsForAlignment(),r=n[1],i=n[2],o=function(d){return i.sub(d).magnitude()},s=(o(n[0])+o(r))/2,a=Math.floor(s/.45),u=$0(n),c=Math.floor(Math.max(0,u.x-.5*a)),l=Math.floor(Math.max(0,u.y-.43*a));return new K0(c,l,Math.min(a,this.imageWidth+c),Math.min(a,this.imageHeight+l))},t.prototype.alignMinBbox=function(n){var e=function H7(t){var n=t.map(function(a){return a.x}),e=t.map(function(a){return a.y}),r=n.reduce(function(a,u){return u<a?u:a},1/0),i=e.reduce(function(a,u){return u<a?u:a},1/0),o=n.reduce(function(a,u){return a<u?u:a},0),s=e.reduce(function(a,u){return a<u?u:a},0);return new Lh(r,i,o,s)}(this.positions);return e.pad(e.width*n,e.height*n)},t.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},t}(),q7=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return xe(n,t),n.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],$0([e[3],e[4]])]},n}(Tl),QA=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return xe(n,t),n.prototype.getJawOutline=function(){return this.positions.slice(0,17)},n.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},n.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},n.prototype.getNose=function(){return this.positions.slice(27,36)},n.prototype.getLeftEye=function(){return this.positions.slice(36,42)},n.prototype.getRightEye=function(){return this.positions.slice(42,48)},n.prototype.getMouth=function(){return this.positions.slice(48,68)},n.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map($0)},n}(Tl),JA=function(){function t(n,e){this._label=n,this._distance=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),t.prototype.toString=function(n){return void 0===n&&(n=!0),this.label+(n?" ("+function V7(t,n){void 0===n&&(n=2);var e=Math.pow(10,n);return Math.floor(t*e)/e}(this.distance)+")":"")},t}(),eR=function(t){function n(e,r){var i=t.call(this,e)||this;return i._label=r,i}return xe(n,t),n.assertIsValidLabeledBox=function(e,r){if(eo.assertIsValidBox(e,r),!ks(e.label))throw new Error(r+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),n}(eo),Bh=function(){function t(n,e){if("string"!=typeof n)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=n,this._descriptors=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(n){return Array.from(n)})}},t.fromJSON=function(n){var e=n.descriptors.map(function(r){return new Float32Array(r)});return new t(n.label,e)},t}();function tR(t){return t.detection instanceof Yr}function Ml(t,n){return Object.assign({},t,{detection:n})}function nR(){var t=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:t,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function rR(t){var n="";if(!t)try{t=xu(Object(function(){var i=new Error("Cannot find module 'fs'");throw i.code="MODULE_NOT_FOUND",i}()))}catch(r){n=r.toString()}return{readFile:t?function(r){return new Promise(function(i,o){t.readFile(r,function(s,a){return s?o(s):i(a)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+n)}}}function iR(){var t=global.Canvas||global.HTMLCanvasElement,n=global.Image||global.HTMLImageElement,i=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=rR();return En({Canvas:t||function s(){},CanvasRenderingContext2D:global.CanvasRenderingContext2D||function s(){},Image:n||function s(){},ImageData:global.ImageData||function s(){},Video:global.HTMLVideoElement||function s(){},createCanvasElement:function(){if(t)return new t;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(n)return new n;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:i},o)}function oR(){return"object"==typeof window&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function sR(){return"object"==typeof global&&typeof process<"u"&&!!process.version}function Y0(t){Qt=t}function X0(){oR()&&Y0(nR()),sR()&&Y0(iR())}!function(t){function n(e,r,i,o){var s=t.call(this,e,r)||this;return s._score=i,s._classScore=o,s}xe(n,t),n.assertIsValidPredictedBox=function(e,r){if(eR.assertIsValidLabeledBox(e,r),!XA(e.score)||!XA(e.classScore))throw new Error(r+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(eR);var Dn={getEnv:function K7(){if(!Qt)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Qt},setEnv:Y0,initialize:X0,createBrowserEnv:nR,createFileSystem:rR,createNodejsEnv:iR,monkeyPatch:function Y7(t){if(Qt||X0(),!Qt)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var n=t.Canvas,e=void 0===n?Qt.Canvas:n,r=t.Image,i=void 0===r?Qt.Image:r;Qt.Canvas=e,Qt.Image=i,Qt.createCanvasElement=t.createCanvasElement||function(){return new e},Qt.createImageElement=t.createImageElement||function(){return new i},Qt.ImageData=t.ImageData||Qt.ImageData,Qt.Video=t.Video||Qt.Video,Qt.fetch=t.fetch||Qt.fetch,Qt.readFile=t.readFile||Qt.readFile},isBrowser:oR,isNodejs:sR};function Z0(t){return Dn.isNodejs()||"string"!=typeof t?t:document.getElementById(t)}function wi(t){var n=Dn.getEnv(),e=n.Canvas;if(t instanceof n.CanvasRenderingContext2D)return t;var i=Z0(t);if(!(i instanceof e))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=i.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}X0();var Ps=function(t){return t.TOP_LEFT="TOP_LEFT",t.TOP_RIGHT="TOP_RIGHT",t.BOTTOM_LEFT="BOTTOM_LEFT",t.BOTTOM_RIGHT="BOTTOM_RIGHT",t}(Ps||{}),aR=function t(n){void 0===n&&(n={});var r=n.backgroundColor,i=n.fontColor,o=n.fontSize,s=n.fontStyle,a=n.padding;this.anchorPosition=n.anchorPosition||Ps.TOP_LEFT,this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=i||"rgba(255, 255, 255, 1)",this.fontSize=o||14,this.fontStyle=s||"Georgia",this.padding=a||4};!function(){function t(n,e,r){void 0===r&&(r={}),this.text="string"==typeof n?[n]:n instanceof t?n.text:n,this.anchor=e,this.options=new aR(r)}t.prototype.measureWidth=function(n){var e=this.options.padding;return this.text.map(function(r){return n.measureText(r).width}).reduce(function(r,i){return r<i?i:r},0)+2*e},t.prototype.measureHeight=function(){var n=this.options;return this.text.length*n.fontSize+2*n.padding},t.prototype.getUpperLeft=function(n,e){var r=this.options.anchorPosition,i=r===Ps.BOTTOM_RIGHT||r===Ps.TOP_RIGHT,o=r===Ps.BOTTOM_LEFT||r===Ps.BOTTOM_RIGHT,s=this.measureWidth(n),a=this.measureHeight(),u=i?this.anchor.x-s:this.anchor.x,c=o?this.anchor.y-a:this.anchor.y;if(e){var d=e.height;return{x:Math.max(Math.min(u,e.width-s),0),y:Math.max(Math.min(c,d-a),0)}}return{x:u,y:c}},t.prototype.draw=function(n){var e=Z0(n),r=wi(e),i=this.options,o=i.backgroundColor,s=i.fontColor,a=i.fontSize,c=i.padding;r.font=a+"px "+i.fontStyle;var l=this.measureWidth(r),d=this.measureHeight();r.fillStyle=o;var f=this.getUpperLeft(r,e);r.fillRect(f.x,f.y,l,d),r.fillStyle=s,this.text.forEach(function(h,p){r.fillText(h,c+f.x,c+f.y+(p+1)*a)})}}();function uR(t){var n=Dn.getEnv();return t instanceof n.Image&&t.complete||t instanceof n.Video&&t.readyState>=3}function Q0(t){var n=Dn.getEnv(),r=n.Video;return t instanceof n.Image?new Ns(t.naturalWidth,t.naturalHeight):t instanceof r?new Ns(t.videoWidth,t.videoHeight):new Ns(t.width,t.height)}function Vh(t){var n=t.width,e=t.height,i=(0,Dn.getEnv().createCanvasElement)();return i.width=n,i.height=e,i}function J0(t,n){var e=Dn.getEnv().ImageData;if(!(t instanceof e||uR(t)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=n||Q0(t),i=r.width,o=r.height,s=Vh({width:i,height:o});return t instanceof e?wi(s).putImageData(t,0,0):wi(s).drawImage(t,0,0,i,o),s}function J7(t,n){return ue(this,void 0,void 0,function(){var e,r,i,o,s,a;return ce(this,function(u){switch(u.label){case 0:return e=n||Dn.getEnv().createCanvasElement(),r=t.shape.slice(zo(t)?1:0),i=r[0],o=r[1],s=r[2],a=te(function(){return t.as3D(i,o,s).toInt()}),[4,U0.toPixels(a,e)];case 1:return u.sent(),a.dispose(),[2,e]}})})}function cR(t){var n=Dn.getEnv();return t instanceof n.Image||t instanceof n.Canvas||t instanceof n.Video}var Uh=function(){function t(n,e){var r=this;if(void 0===e&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(n))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+n);this._treatAsBatchInput=e,this._batchSize=n.length,n.forEach(function(i,o){if(Fh(i))return r._imageTensors[o]=i,void(r._inputDimensions[o]=i.shape);if(zo(i)){var s=i.shape[0];if(1!==s)throw new Error("NetInput - tf.Tensor4D with batchSize "+s+" passed, but not supported in input array");return r._imageTensors[o]=i,void(r._inputDimensions[o]=i.shape.slice(1))}var a=i instanceof Dn.getEnv().Canvas?i:J0(i);r._canvases[o]=a,r._inputDimensions[o]=[a.height,a.width,3]})}return Object.defineProperty(t.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reshapedInputDimensions",{get:function(){var n=this;return Dl(this.batchSize,0,1).map(function(e,r){return n.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),t.prototype.getInput=function(n){return this.canvases[n]||this.imageTensors[n]},t.prototype.getInputDimensions=function(n){return this._inputDimensions[n]},t.prototype.getInputHeight=function(n){return this._inputDimensions[n][0]},t.prototype.getInputWidth=function(n){return this._inputDimensions[n][1]},t.prototype.getReshapedInputDimensions=function(n){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function U7(t,n){var e=t.width,r=t.height,i=n/Math.max(r,e);return new Ns(Math.round(e*i),Math.round(r*i))}({width:this.getInputWidth(n),height:this.getInputHeight(n)},this.inputSize)},t.prototype.toBatchTensor=function(n,e){var r=this;return void 0===e&&(e=!0),this._inputSize=n,te(function(){var i=Dl(r.batchSize,0,1).map(function(s){var a=r.getInput(s);if(a instanceof lt){var u=zo(a)?a:a.expandDims();return u=function W7(t,n){return void 0===n&&(n=!1),te(function(){var e=t.shape.slice(1),r=e[0],i=e[1];if(r===i)return t;var o=Math.abs(r-i),s=Math.round(o*(n?.5:1)),a=r>i?2:1,u=function(h){var p=t.shape.slice();return p[a]=h,yi(p,0)},c=u(s),l=o-c.shape[a],f=[n&&l?u(l):null,t,c].filter(function(h){return!!h}).map(function(h){return h.toFloat()});return Yt(f,a)})}(u,e),(u.shape[1]!==n||u.shape[2]!==n)&&(u=C0.resizeBilinear(u,[n,n])),u.as3D(n,n,3)}if(a instanceof Dn.getEnv().Canvas)return U0.fromPixels(function eK(t,n,e){void 0===e&&(e=!1);var r=Dn.getEnv(),o=r.Canvas;if(!(t instanceof r.Image||t instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var s=Q0(t),a=n/Math.max(s.height,s.width),u=a*s.width,c=a*s.height,l=Vh({width:n,height:n}),d=t instanceof o?t:J0(t),f=Math.abs(u-c)/2,h=e&&u<c?f:0,p=e&&c<u?f:0;return wi(l).drawImage(d,h,p,u,c),l}(a,n,e));throw new Error("toBatchTensor - at batchIdx "+s+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+a)});return fr(i.map(function(s){return s.toFloat()})).as4D(r.batchSize,n,n,3)})},t}();function rn(t){return ue(this,void 0,void 0,function(){var n,e,r;return ce(this,function(i){switch(i.label){case 0:if(t instanceof Uh)return[2,t];if(!(n=Array.isArray(t)?t:[t]).length)throw new Error("toNetInput - empty array passed as input");return e=function(o){return Array.isArray(t)?" at input index "+o+":":""},(r=n.map(Z0)).forEach(function(o,s){if(!cR(o)&&!Fh(o)&&!zo(o))throw"string"==typeof n[s]?new Error("toNetInput -"+e(s)+" string passed, but could not resolve HTMLElement for element id "+n[s]):new Error("toNetInput -"+e(s)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(zo(o)){var a=o.shape[0];if(1!==a)throw new Error("toNetInput -"+e(s)+" tf.Tensor4D with batchSize "+a+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(o){return cR(o)&&function Q7(t){return new Promise(function(n,e){if(t instanceof Dn.getEnv().Canvas||uR(t))return n();function r(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),n(o))}function i(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),e(o))}t.addEventListener("load",r),t.addEventListener("error",i)})}(o)}))];case 1:return i.sent(),[2,new Uh(r,Array.isArray(t))]}})})}function eb(t,n){return ue(this,void 0,void 0,function(){var e,r,i,o,s,a;return ce(this,function(c){switch(c.label){case 0:return e=Dn.getEnv().Canvas,r=t,t instanceof e?[3,5]:[4,rn(t)];case 1:if((i=c.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(o=i.getInput(0))instanceof e?(s=o,[3,4]):[3,2];case 2:return[4,J7(o)];case 3:s=c.sent(),c.label=4;case 4:r=s,c.label=5;case 5:return a=wi(r),[2,n.map(function(l){return l instanceof Yr?l.forSize(r.width,r.height).box.floor():l}).map(function(l){return l.clipAtImageBorders(r.width,r.height)}).map(function(l){var d=l.x,f=l.y,h=l.width,p=l.height,g=Vh({width:h,height:p});return wi(g).putImageData(a.getImageData(d,f,h,p),0,0),g})]}})})}function tb(t,n){return ue(this,void 0,void 0,function(){return ce(this,function(e){if(!Fh(t)&&!zo(t))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(zo(t)&&t.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,te(function(){var r=t.shape.slice(zo(t)?1:0),i=r[0],o=r[1],s=r[2];return n.map(function(c){return c instanceof Yr?c.forSize(o,i).box:c}).map(function(c){return c.clipAtImageBorders(o,i)}).map(function(c){var l=c.x,d=c.y,f=c.width,h=c.height;return aA(t.as3D(i,o,s),[d,l,0],[h,f,s])})})]})})}function tK(t,n){return ue(this,void 0,void 0,function(){var r;return ce(this,function(i){switch(i.label){case 0:return[4,(0,Dn.getEnv().fetch)(t,n)];case 1:if(!((r=i.sent()).status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function nK(t){return ue(this,void 0,void 0,function(){return ce(this,function(n){switch(n.label){case 0:return[4,tK(t)];case 1:return[2,n.sent().json()]}})})}function lR(t,n){var e=n+"-weights_manifest.json";if(!t)return{modelBaseUri:"",manifestUri:e};if("/"===t)return{modelBaseUri:"/",manifestUri:"/"+e};var r=t.startsWith("http://")?"http://":t.startsWith("https://")?"https://":"",i=(t=t.replace(r,"")).split("/").filter(function(a){return a}),o=t.endsWith(".json")?i[i.length-1]:e,s=r+(t.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return{modelBaseUri:s=t.startsWith("/")?"/"+s:s,manifestUri:"/"===s?"/"+o:s+"/"+o}}function rK(t,n){return ue(this,void 0,void 0,function(){var e,i,o;return ce(this,function(s){switch(s.label){case 0:return e=lR(t,n),i=e.modelBaseUri,[4,nK(e.manifestUri)];case 1:return o=s.sent(),[2,LA.loadWeights(o,i)]}})})}function dR(t,n,e){void 0===e&&(e=!1);var r=e?Q0(n):n,i=r.width,o=r.height;return t.width=i,t.height=o,{width:i,height:o}}var to=function(){function t(n){this._name=n,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),t.prototype.getParamFromPath=function(n){var e=this.traversePropertyPath(n);return e.obj[e.objProp]},t.prototype.reassignParamFromPath=function(n,e){var r=this.traversePropertyPath(n),i=r.obj,o=r.objProp;i[o].dispose(),i[o]=e},t.prototype.getParamList=function(){var n=this;return this._paramMappings.map(function(e){var r=e.paramPath;return{path:r,tensor:n.getParamFromPath(r)}})},t.prototype.getTrainableParams=function(){return this.getParamList().filter(function(n){return n.tensor instanceof eu})},t.prototype.getFrozenParams=function(){return this.getParamList().filter(function(n){return!(n.tensor instanceof eu)})},t.prototype.variable=function(){var n=this;this.getFrozenParams().forEach(function(e){n.reassignParamFromPath(e.path,e.tensor.variable())})},t.prototype.freeze=function(){var n=this;this.getTrainableParams().forEach(function(e){var r=e.path,i=e.tensor,o=gn(i.dataSync());i.dispose(),n.reassignParamFromPath(r,o)})},t.prototype.dispose=function(n){void 0===n&&(n=!0),this.getParamList().forEach(function(e){if(n&&e.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()}),this._params=void 0},t.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(n){return Array.from(n.tensor.dataSync())}).reduce(function(n,e){return n.concat(e)}))},t.prototype.load=function(n){return ue(this,void 0,void 0,function(){return ce(this,function(e){switch(e.label){case 0:return n instanceof Float32Array?(this.extractWeights(n),[2]):[4,this.loadFromUri(n)];case 1:return e.sent(),[2]}})})},t.prototype.loadFromUri=function(n){return ue(this,void 0,void 0,function(){var e;return ce(this,function(r){switch(r.label){case 0:if(n&&"string"!=typeof n)throw new Error(this._name+".loadFromUri - expected model uri");return[4,rK(n,this.getDefaultModelName())];case 1:return e=r.sent(),this.loadFromWeightMap(e),[2]}})})},t.prototype.loadFromDisk=function(n){return ue(this,void 0,void 0,function(){var e,r,i,o,a,u,c,l,d;return ce(this,function(f){switch(f.label){case 0:if(n&&"string"!=typeof n)throw new Error(this._name+".loadFromDisk - expected model file path");return e=Dn.getEnv().readFile,r=lR(n,this.getDefaultModelName()),i=r.manifestUri,o=r.modelBaseUri,a=LA.weightsLoaderFactory(function(h){return Promise.all(h.map(function(p){return e(p).then(function(g){return g.buffer})}))}),l=(c=JSON).parse,[4,e(i)];case 1:return u=l.apply(c,[f.sent().toString()]),[4,a(u,o)];case 2:return d=f.sent(),this.loadFromWeightMap(d),[2]}})})},t.prototype.loadFromWeightMap=function(n){var e=this.extractParamsFromWeigthMap(n),i=e.params;this._paramMappings=e.paramMappings,this._params=i},t.prototype.extractWeights=function(n){var e=this.extractParams(n),i=e.params;this._paramMappings=e.paramMappings,this._params=i},t.prototype.traversePropertyPath=function(n){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var e=n.split("/").reduce(function(o,s){if(!o.nextObj.hasOwnProperty(s))throw new Error("traversePropertyPath - object does not have property "+s+", for path "+n);return{obj:o.nextObj,objProp:s,nextObj:o.nextObj[s]}},{nextObj:this.params}),r=e.obj,i=e.objProp;if(!(r&&i&&r[i]instanceof lt))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+n);return{obj:r,objProp:i}},t}();function pr(t,n,e){return te(function(){var r=v0(t,n.depthwise_filter,n.pointwise_filter,e,"same");return Oe(r,n.bias)})}function nb(t,n,e){return void 0===e&&(e=!1),te(function(){var r=It(e?Oe(Mr(t,n.conv0.filters,[2,2],"same"),n.conv0.bias):pr(t,n.conv0,[2,2])),i=pr(r,n.conv1,[1,1]),s=pr(It(Oe(r,i)),n.conv2,[1,1]);return It(Oe(r,Oe(i,s)))})}function Hh(t,n,e,r){return void 0===e&&(e=!1),void 0===r&&(r=!0),te(function(){var i=It(e?Oe(Mr(t,n.conv0.filters,r?[2,2]:[1,1],"same"),n.conv0.bias):pr(t,n.conv0,r?[2,2]:[1,1])),o=pr(i,n.conv1,[1,1]),a=pr(It(Oe(i,o)),n.conv2,[1,1]),c=pr(It(Oe(i,Oe(o,a))),n.conv3,[1,1]);return It(Oe(i,Oe(o,Oe(a,c))))})}function Xr(t,n,e,r){return void 0===e&&(e="same"),void 0===r&&(r=!1),te(function(){var i=Oe(Mr(t,n.filters,[1,1],e),n.bias);return r?It(i):i})}function no(t,n){Object.keys(t).forEach(function(e){n.some(function(r){return r.originalPath===e})||t[e].dispose()})}function jh(t,n){return function(e,r,i,o){var s=Zn(t(e*r*i*i),[i,i,e,r]),a=jt(t(r));return n.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:s,bias:a}}}function rb(t,n){return function(e,r,i){var o=Bo(t(e*r),[e,r]),s=jt(t(r));return n.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:o,bias:s}}}var fR=function t(n,e,r){this.depthwise_filter=n,this.pointwise_filter=e,this.bias=r};function ib(t,n){return function(e,r,i){var o=Zn(t(9*e),[3,3,e,1]),s=Zn(t(e*r),[1,1,e,r]),a=jt(t(r));return n.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new fR(o,s,a)}}function ob(t){return function(n){var e=t(n+"/depthwise_filter",4),r=t(n+"/pointwise_filter",4),i=t(n+"/bias",1);return new fR(e,r,i)}}function Go(t,n){return function(e,r,i){var o=t[e];if(!El(o,r))throw new Error("expected weightMap["+e+"] to be a Tensor"+r+"D, instead have "+o);return n.push({originalPath:e,paramPath:i||e}),o}}function ro(t){var n=t;return{extractWeights:function e(i){var o=n.slice(0,i);return n=n.slice(i),o},getRemainingWeights:function r(){return n}}}function hR(t,n){var e=jh(t,n),r=ib(t,n);function i(s,a,u,c){return void 0===c&&(c=!1),{conv0:c?e(s,a,3,u+"/conv0"):r(s,a,u+"/conv0"),conv1:r(a,a,u+"/conv1"),conv2:r(a,a,u+"/conv2")}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:function o(s,a,u,c){void 0===c&&(c=!1);var l=i(s,a,u,c);return{conv0:l.conv0,conv1:l.conv1,conv2:l.conv2,conv3:r(a,a,u+"/conv3")}}}}function pR(t){return function(n){return{filters:t(n+"/filters",4),bias:t(n+"/bias",1)}}}function gR(t,n){var e=Go(t,n),r=pR(e),i=ob(e);return{extractDenseBlock3Params:function o(a,u){return void 0===u&&(u=!1),{conv0:u?r(a+"/conv0"):i(a+"/conv0"),conv1:i(a+"/conv1"),conv2:i(a+"/conv2")}},extractDenseBlock4Params:function s(a,u){return void 0===u&&(u=!1),{conv0:u?r(a+"/conv0"):i(a+"/conv0"),conv1:i(a+"/conv1"),conv2:i(a+"/conv2"),conv3:i(a+"/conv3")}}}}var mR=function(t){function n(){return t.call(this,"FaceFeatureExtractor")||this}return xe(n,t),n.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return te(function(){var a=Hh(Sl(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(X(255)),r.dense0,!0);return a=Hh(a,r.dense1),a=Hh(a,r.dense2),a=Hh(a,r.dense3),_l(a,[7,7],[2,2],"valid")})},n.prototype.forward=function(e){return ue(this,void 0,void 0,function(){var r;return ce(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,rn(e)];case 1:return[2,r.apply(this,[i.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function oK(t){var n=[],e=gR(t,n).extractDenseBlock4Params,r={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2"),dense3:e("dense3")};return no(t,n),{params:r,paramMappings:n}}(e)},n.prototype.extractParams=function(e){return function iK(t){var n=[],e=ro(t),i=e.getRemainingWeights,o=hR(e.extractWeights,n).extractDenseBlock4Params,s=o(3,32,"dense0",!0),a=o(32,64,"dense1"),u=o(64,128,"dense2"),c=o(128,256,"dense3");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:n,params:{dense0:s,dense1:a,dense2:u,dense3:c}}}(e)},n}(to);function _i(t,n){return te(function(){return Oe(Mh(t,n.weights),n.bias)})}function vR(t){var n={},e={};return Object.keys(t).forEach(function(r){(r.startsWith("fc")?e:n)[r]=t[r]}),{featureExtractorMap:n,classifierMap:e}}var yR=function(t){function n(e,r){var i=t.call(this,e)||this;return i._faceFeatureExtractor=r,i}return xe(n,t),Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(e){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return te(function(){var o=e instanceof Uh?r.faceFeatureExtractor.forwardInput(e):e;return _i(o.as2D(o.shape[0],-1),i.fc)})},n.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},n.prototype.loadClassifierParams=function(e){var r=this.extractClassifierParams(e),o=r.paramMappings;this._params=r.params,this._paramMappings=o},n.prototype.extractClassifierParams=function(e){return function sK(t,n,e){var r=[],i=ro(t),s=i.getRemainingWeights,u=rb(i.extractWeights,r)(n,e,"fc");if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:r,params:{fc:u}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},n.prototype.extractParamsFromWeigthMap=function(e){var r=vR(e),o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(r.featureExtractorMap),function aK(t){var n=[],e=Go(t,n),i={fc:function r(o){return{weights:e(o+"/weights",2),bias:e(o+"/bias",1)}}("fc")};return no(t,n),{params:i,paramMappings:n}}(o)},n.prototype.extractParams=function(e){var r=this.getClassifierChannelsIn(),i=this.getClassifierChannelsOut(),o=i*r+i,s=e.slice(0,e.length-o),a=e.slice(e.length-o);return this.faceFeatureExtractor.extractWeights(s),this.extractClassifierParams(a)},n}(to),bR=["neutral","happy","sad","angry","fearful","disgusted","surprised"],uK=function(){function t(n){var e=this;if(7!==n.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+n.length);bR.forEach(function(r,i){e[r]=n[i]})}return t.prototype.asSortedArray=function(){var n=this;return bR.map(function(e){return{expression:e,probability:n[e]}}).sort(function(e,r){return r.probability-e.probability})},t}(),cK=function(t){function n(e){return void 0===e&&(e=new mR),t.call(this,"FaceExpressionNet",e)||this}return xe(n,t),n.prototype.forwardInput=function(e){var r=this;return te(function(){return Yi(r.runNet(e))})},n.prototype.forward=function(e){return ue(this,void 0,void 0,function(){var r;return ce(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,rn(e)];case 1:return[2,r.apply(this,[i.sent()])]}})})},n.prototype.predictExpressions=function(e){return ue(this,void 0,void 0,function(){var r,i,o,s,a=this;return ce(this,function(u){switch(u.label){case 0:return[4,rn(e)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return i=u.sent(),[4,Promise.all(Xt(i).map(function(c){return ue(a,void 0,void 0,function(){var l;return ce(this,function(d){switch(d.label){case 0:return[4,c.data()];case 1:return l=d.sent(),c.dispose(),[2,l]}})})}))];case 3:return o=u.sent(),i.dispose(),s=o.map(function(c){return new uK(c)}),[2,r.isBatchInput?s:s[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_expression_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n.prototype.getClassifierChannelsOut=function(){return 7},n}(yR);function wR(t,n){return Object.assign({},t,{expressions:n})}function _R(t){return tR(t)&&t.landmarks instanceof Tl&&t.unshiftedLandmarks instanceof Tl&&t.alignedRect instanceof Yr}function Wh(t,n){var e=t.detection.box,r=n.shiftBy(e.x,e.y),i=r.align(),o=t.detection.imageDims,s=new Yr(t.detection.score,i.rescale(o.reverse()),o);return Object.assign({},t,{landmarks:r,unshiftedLandmarks:n,alignedRect:s})}function CR(t,n,e){return Oe(Mr(t,n.filters,e,"same"),n.bias)}function sb(t,n,e){void 0===e&&(e=!0);var r=e?It(t):t;return r=pr(r,n.separable_conv0,[1,1]),r=pr(It(r),n.separable_conv1,[1,1]),r=nn(r,[3,3],[2,2],"same"),Oe(r,CR(t,n.expansion_conv,[2,2]))}var vK=function(t){function n(e){var r=t.call(this,"TinyXception")||this;return r._numMainBlocks=e,r}return xe(n,t),n.prototype.forwardInput=function(e){var r=this,i=this.params;if(!i)throw new Error("TinyXception - load model before inference");return te(function(){var a=Sl(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(X(256)),u=It(CR(a,i.entry_flow.conv_in,[2,2]));return u=sb(u,i.entry_flow.reduction_block_0,!1),u=sb(u,i.entry_flow.reduction_block_1),Dl(r._numMainBlocks,0,1).forEach(function(c){u=function mK(t,n){var e=pr(It(t),n.separable_conv0,[1,1]);return e=pr(It(e),n.separable_conv1,[1,1]),e=pr(It(e),n.separable_conv2,[1,1]),Oe(e,t)}(u,i.middle_flow["main_block_"+c])}),u=sb(u,i.exit_flow.reduction_block),u=It(pr(u,i.exit_flow.separable_conv,[1,1]))})},n.prototype.forward=function(e){return ue(this,void 0,void 0,function(){var r;return ce(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,rn(e)];case 1:return[2,r.apply(this,[i.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"tiny_xception_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function gK(t,n){var e=[],r=function pK(t,n){var e=Go(t,n),r=pR(e),i=ob(e);return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:function o(a){return{separable_conv0:i(a+"/separable_conv0"),separable_conv1:i(a+"/separable_conv1"),expansion_conv:r(a+"/expansion_conv")}},extractMainBlockParams:function s(a){return{separable_conv0:i(a+"/separable_conv0"),separable_conv1:i(a+"/separable_conv1"),separable_conv2:i(a+"/separable_conv2")}}}}(t,e),o=r.extractSeparableConvParams,s=r.extractReductionBlockParams,a=r.extractMainBlockParams,d={conv_in:(0,r.extractConvParams)("entry_flow/conv_in"),reduction_block_0:s("entry_flow/reduction_block_0"),reduction_block_1:s("entry_flow/reduction_block_1")},f={};Dl(n,0,1).forEach(function(m){f["main_block_"+m]=a("middle_flow/main_block_"+m)});var g={reduction_block:s("exit_flow/reduction_block"),separable_conv:o("exit_flow/separable_conv")};return no(t,e),{params:{entry_flow:d,middle_flow:f,exit_flow:g},paramMappings:e}}(e,this._numMainBlocks)},n.prototype.extractParams=function(e){return function hK(t,n){var e=[],r=ro(t),o=r.getRemainingWeights,s=function fK(t,n){var e=jh(t,n),r=ib(t,n);return{extractConvParams:e,extractSeparableConvParams:r,extractReductionBlockParams:function i(s,a,u){return{separable_conv0:r(s,a,u+"/separable_conv0"),separable_conv1:r(a,a,u+"/separable_conv1"),expansion_conv:e(s,a,1,u+"/expansion_conv")}},extractMainBlockParams:function o(s,a){return{separable_conv0:r(s,s,a+"/separable_conv0"),separable_conv1:r(s,s,a+"/separable_conv1"),separable_conv2:r(s,s,a+"/separable_conv2")}}}}(r.extractWeights,e),u=s.extractSeparableConvParams,c=s.extractReductionBlockParams,l=s.extractMainBlockParams,p={conv_in:(0,s.extractConvParams)(3,32,3,"entry_flow/conv_in"),reduction_block_0:c(32,64,"entry_flow/reduction_block_0"),reduction_block_1:c(64,128,"entry_flow/reduction_block_1")},g={};Dl(n,0,1).forEach(function(w){g["main_block_"+w]=l(128,"middle_flow/main_block_"+w)});var y={reduction_block:c(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{entry_flow:p,middle_flow:g,exit_flow:y}}}(e,this._numMainBlocks)},n}(to),ab=function(t){return t.FEMALE="female",t.MALE="male",t}(ab||{}),wK=function(t){function n(e){void 0===e&&(e=new vK(2));var r=t.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=e,r}return xe(n,t),Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(e){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return te(function(){var o=e instanceof Uh?r.faceFeatureExtractor.forwardInput(e):e,s=_l(o,[7,7],[2,2],"valid").as2D(o.shape[0],-1);return{age:_i(s,i.fc.age).as1D(),gender:_i(s,i.fc.gender)}})},n.prototype.forwardInput=function(e){var r=this;return te(function(){var i=r.runNet(e);return{age:i.age,gender:Yi(i.gender)}})},n.prototype.forward=function(e){return ue(this,void 0,void 0,function(){var r;return ce(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,rn(e)];case 1:return[2,r.apply(this,[i.sent()])]}})})},n.prototype.predictAgeAndGender=function(e){return ue(this,void 0,void 0,function(){var r,i,o,s,a,u,c=this;return ce(this,function(l){switch(l.label){case 0:return[4,rn(e)];case 1:return r=l.sent(),[4,this.forwardInput(r)];case 2:return i=l.sent(),o=Xt(i.age),s=Xt(i.gender),a=o.map(function(d,f){return{ageTensor:d,genderTensor:s[f]}}),[4,Promise.all(a.map(function(d){var f=d.ageTensor,h=d.genderTensor;return ue(c,void 0,void 0,function(){var p,g,m,v,y;return ce(this,function(w){switch(w.label){case 0:return[4,f.data()];case 1:return p=w.sent()[0],[4,h.data()];case 2:return g=w.sent()[0],v=(m=g>.5)?ab.MALE:ab.FEMALE,y=m?g:1-g,f.dispose(),h.dispose(),[2,{age:p,gender:v,genderProbability:y}]}})})}))];case 3:return u=l.sent(),i.age.dispose(),i.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},n.prototype.getDefaultModelName=function(){return"age_gender_model"},n.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},n.prototype.loadClassifierParams=function(e){var r=this.extractClassifierParams(e),o=r.paramMappings;this._params=r.params,this._paramMappings=o},n.prototype.extractClassifierParams=function(e){return function yK(t){var n=[],e=ro(t),i=e.getRemainingWeights,o=rb(e.extractWeights,n),s=o(512,1,"fc/age"),a=o(512,2,"fc/gender");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:n,params:{fc:{age:s,gender:a}}}}(e)},n.prototype.extractParamsFromWeigthMap=function(e){var r=vR(e),o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(r.featureExtractorMap),function bK(t){var n=[],e=Go(t,n);function r(o){return{weights:e(o+"/weights",2),bias:e(o+"/bias",1)}}var i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return no(t,n),{params:i,paramMappings:n}}(o)},n.prototype.extractParams=function(e){var i=e.slice(0,e.length-1539),o=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(o)},n}(to),xR=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return xe(n,t),n.prototype.postProcess=function(e,r,i){var o=i.map(function(a){var u=a.width,c=a.height,l=r/Math.max(c,u);return{width:u*l,height:c*l}}),s=o.length;return te(function(){var a=function(f,h){return fr([yi([68],f),yi([68],h)],1).as2D(1,136).as1D()},u=function(f,h){var p=o[f],g=p.width,m=p.height;return h(g,m)?Math.abs(g-m)/2:0};return e.mul(yi([s,136],r)).sub(fr(Array.from(Array(s),function(f,h){return a(function(f){return u(f,function(h,p){return h<p})}(h),function(f){return u(f,function(h,p){return p<h})}(h))}))).div(fr(Array.from(Array(s),function(f,h){return a(o[h].width,o[h].height)})))})},n.prototype.forwardInput=function(e){var r=this;return te(function(){var i=r.runNet(e);return r.postProcess(i,e.inputSize,e.inputDimensions.map(function(o){return{height:o[0],width:o[1]}}))})},n.prototype.forward=function(e){return ue(this,void 0,void 0,function(){var r;return ce(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,rn(e)];case 1:return[2,r.apply(this,[i.sent()])]}})})},n.prototype.detectLandmarks=function(e){return ue(this,void 0,void 0,function(){var r,i,o,s=this;return ce(this,function(a){switch(a.label){case 0:return[4,rn(e)];case 1:return r=a.sent(),i=te(function(){return Xt(s.forwardInput(r))}),[4,Promise.all(i.map(function(u,c){return ue(s,void 0,void 0,function(){var l,d,f,h,p;return ce(this,function(g){switch(g.label){case 0:return f=(d=Array).from,[4,u.data()];case 1:return l=f.apply(d,[g.sent()]),h=l.filter(function(m,v){return KA(v)}),p=l.filter(function(m,v){return!KA(v)}),[2,new QA(Array(68).fill(0).map(function(m,v){return new Qe(h[v],p[v])}),{height:r.getInputHeight(c),width:r.getInputWidth(c)})]}})})}))];case 2:return o=a.sent(),i.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},n.prototype.getClassifierChannelsOut=function(){return 136},n}(yR),ER=function(t){function n(e){return void 0===e&&(e=new mR),t.call(this,"FaceLandmark68Net",e)||this}return xe(n,t),n.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n}(xR),xK=function(t){function n(){return t.call(this,"TinyFaceFeatureExtractor")||this}return xe(n,t),n.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return te(function(){var a=nb(Sl(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(X(255)),r.dense0,!0);return a=nb(a,r.dense1),a=nb(a,r.dense2),_l(a,[14,14],[2,2],"valid")})},n.prototype.forward=function(e){return ue(this,void 0,void 0,function(){var r;return ce(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,rn(e)];case 1:return[2,r.apply(this,[i.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function _K(t){var n=[],e=gR(t,n).extractDenseBlock3Params,r={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2")};return no(t,n),{params:r,paramMappings:n}}(e)},n.prototype.extractParams=function(e){return function CK(t){var n=[],e=ro(t),i=e.getRemainingWeights,o=hR(e.extractWeights,n).extractDenseBlock3Params,s=o(3,32,"dense0",!0),a=o(32,64,"dense1"),u=o(64,128,"dense2");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:n,params:{dense0:s,dense1:a,dense2:u}}}(e)},n}(to),EK=function(t){function n(e){return void 0===e&&(e=new xK),t.call(this,"FaceLandmark68TinyNet",e)||this}return xe(n,t),n.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},n.prototype.getClassifierChannelsIn=function(){return 128},n}(xR);function ub(t,n,e,r,i){void 0===i&&(i="same");var o=n.conv,a=o.bias,u=Mr(t,o.filters,e,i);return u=function DK(t,n){return Oe(Cn(t,n.weights),n.biases)}(u=Oe(u,a),n.scale),r?It(u):u}function DR(t,n){return ub(t,n,[1,1],!1)}function IR(t,n){return ub(t,n,[2,2],!0,"valid")}function SK(t,n){function o(a,u,c,l){var d=function r(a,u,c,l){var d=function e(a,u,c){var l=t(a),d=l.length/(u*c*c);if(function B7(t){return t%1!=0}(d))throw new Error("depth has to be an integer: "+d+", weights.length: "+l.length+", numFilters: "+u+", filterSize: "+c);return te(function(){return Uo(Zn(l,[u,d,c,c]),[2,3,1,0])})}(a,u,c),f=jt(t(u));return n.push({paramPath:l+"/filters"},{paramPath:l+"/bias"}),{filters:d,bias:f}}(a,u,c,l+"/conv"),f=function i(a,u){var c=jt(t(a)),l=jt(t(a));return n.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:c,biases:l}}(u,l+"/scale");return{conv:d,scale:f}}return{extractConvLayerParams:o,extractResidualLayerParams:function s(a,u,c,l,d){return void 0===d&&(d=!1),{conv1:o((d?.5:1)*a,u,c,l+"/conv1"),conv2:o(a,u,c,l+"/conv2")}}}}function AK(t){var n=[],e=function MK(t,n){var e=Go(t,n);function i(s){var a=e(s+"/conv/filters",4),u=e(s+"/conv/bias",1),c=function r(s){return{weights:e(s+"/scale/weights",1),biases:e(s+"/scale/biases",1)}}(s);return{conv:{filters:a,bias:u},scale:c}}return{extractConvLayerParams:i,extractResidualLayerParams:function o(s){return{conv1:i(s+"/conv1"),conv2:i(s+"/conv2")}}}}(t,n),i=e.extractResidualLayerParams,o=(0,e.extractConvLayerParams)("conv32_down"),s=i("conv32_1"),a=i("conv32_2"),u=i("conv32_3"),c=i("conv64_down"),l=i("conv64_1"),d=i("conv64_2"),f=i("conv64_3"),h=i("conv128_down"),p=i("conv128_1"),g=i("conv128_2"),m=i("conv256_down"),v=i("conv256_1"),y=i("conv256_2"),w=i("conv256_down_out"),b=t.fc;if(n.push({originalPath:"fc",paramPath:"fc"}),!function L7(t){return El(t,2)}(b))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+b);var _={conv32_down:o,conv32_1:s,conv32_2:a,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:d,conv64_3:f,conv128_down:h,conv128_1:p,conv128_2:g,conv256_down:m,conv256_1:v,conv256_2:y,conv256_down_out:w,fc:b};return no(t,n),{params:_,paramMappings:n}}function Ci(t,n){var e=function IK(t,n){return ub(t,n,[1,1],!0)}(t,n.conv1);return e=DR(e,n.conv2),e=Oe(e,t),It(e)}function zh(t,n){var e=IR(t,n.conv1);e=DR(e,n.conv2);var r=_l(t,2,2,"valid"),i=wt(r.shape),o=r.shape[3]!==e.shape[3];if(r.shape[1]!==e.shape[1]||r.shape[2]!==e.shape[2]){var a=xl(e.shape);a[1]=1;var u=wt(a),c=xl((e=Yt([e,u],1)).shape);c[2]=1;var l=wt(c);e=Yt([e,l],2)}return r=o?Yt([r,i],3):r,e=Oe(r,e),It(e)}!function(t){xe(function n(){return null!==t&&t.apply(this,arguments)||this},t)}(ER);var RK=function(t){function n(){return t.call(this,"FaceRecognitionNet")||this}return xe(n,t),n.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return te(function(){var a=IR(Sl(e.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(X(256)),r.conv32_down);a=Ci(a=nn(a,3,2,"valid"),r.conv32_1),a=Ci(a,r.conv32_2),a=Ci(a,r.conv32_3),a=Ci(a=zh(a,r.conv64_down),r.conv64_1),a=Ci(a,r.conv64_2),a=Ci(a,r.conv64_3),a=Ci(a=zh(a,r.conv128_down),r.conv128_1),a=Ci(a,r.conv128_2),a=Ci(a=zh(a,r.conv256_down),r.conv256_1);var u=(a=zh(a=Ci(a,r.conv256_2),r.conv256_down_out)).mean([1,2]);return Mh(u,r.fc)})},n.prototype.forward=function(e){return ue(this,void 0,void 0,function(){var r;return ce(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,rn(e)];case 1:return[2,r.apply(this,[i.sent()])]}})})},n.prototype.computeFaceDescriptor=function(e){return ue(this,void 0,void 0,function(){var r,i,o,s=this;return ce(this,function(a){switch(a.label){case 0:return[4,rn(e)];case 1:return r=a.sent(),i=te(function(){return Xt(s.forwardInput(r))}),[4,Promise.all(i.map(function(u){return u.data()}))];case 2:return o=a.sent(),i.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_recognition_model"},n.prototype.extractParamsFromWeigthMap=function(e){return AK(e)},n.prototype.extractParams=function(e){return function TK(t){var n=ro(t),e=n.extractWeights,r=n.getRemainingWeights,i=[],o=SK(e,i),a=o.extractResidualLayerParams,u=(0,o.extractConvLayerParams)(4704,32,7,"conv32_down"),c=a(9216,32,3,"conv32_1"),l=a(9216,32,3,"conv32_2"),d=a(9216,32,3,"conv32_3"),f=a(36864,64,3,"conv64_down",!0),h=a(36864,64,3,"conv64_1"),p=a(36864,64,3,"conv64_2"),g=a(36864,64,3,"conv64_3"),m=a(147456,128,3,"conv128_down",!0),v=a(147456,128,3,"conv128_1"),y=a(147456,128,3,"conv128_2"),w=a(589824,256,3,"conv256_down",!0),b=a(589824,256,3,"conv256_1"),_=a(589824,256,3,"conv256_2"),C=a(589824,256,3,"conv256_down_out"),T=te(function(){return Uo(Bo(e(32768),[128,256]),[1,0])});if(i.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:d,conv64_down:f,conv64_1:h,conv64_2:p,conv64_3:g,conv128_down:m,conv128_1:v,conv128_2:y,conv256_down:w,conv256_1:b,conv256_2:_,conv256_down_out:C,fc:T},paramMappings:i}}(e)},n}(to);function SR(t,n,e){return Object.assign({},t,{gender:n,genderProbability:e})}var TR=function(){function t(n){var e=void 0===n?{}:n,r=e.minFaceSize,i=e.scaleFactor,o=e.maxNumScales,s=e.scoreThresholds,a=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=i||.709,this._maxNumScales=o||10,this._scoreThresholds=s||[.6,.7,.7],this._scaleSteps=a,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(u){return"number"!=typeof u}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return"number"!=typeof u})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(t.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),t}();function xi(t,n,e){return te(function(){var r=Mr(t,n.filters,e,"same");return r=Oe(r,n.batch_norm_offset),d0(r,0,6)})}function HK(t,n,e){var r=t.arraySync(),i=Math.min(r[n][0],r[n][2]),o=Math.min(r[n][1],r[n][3]),s=Math.max(r[n][0],r[n][2]),a=Math.max(r[n][1],r[n][3]),u=Math.min(r[e][0],r[e][2]),c=Math.min(r[e][1],r[e][3]),l=Math.max(r[e][0],r[e][2]),d=Math.max(r[e][1],r[e][3]),f=(s-i)*(a-o),h=(l-u)*(d-c);if(f<=0||h<=0)return 0;var p=Math.max(i,u),g=Math.max(o,c),m=Math.min(s,l),v=Math.min(a,d),y=Math.max(m-p,0)*Math.max(v-g,0);return y/(f+h-y)}function gu(t,n){return te(function(){var e=t.shape[0];return{boxPredictionEncoding:$r(Xr(t,n.box_encoding_predictor),[e,-1,1,4]),classPrediction:$r(Xr(t,n.class_predictor),[e,-1,3])}})}var Gh=function(){function t(n){var e=void 0===n?{}:n,r=e.minConfidence,i=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=i||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(t.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),t}(),MR=function(t){function n(){return t.call(this,"SsdMobilenetv1")||this}return xe(n,t),n.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return te(function(){var i=e.toBatchTensor(512,!1).toFloat(),s=function VK(t,n){return te(function(){var e=null,r=xi(t,n.conv_0,[2,2]);if([n.conv_1,n.conv_2,n.conv_3,n.conv_4,n.conv_5,n.conv_6,n.conv_7,n.conv_8,n.conv_9,n.conv_10,n.conv_11,n.conv_12,n.conv_13].forEach(function(o,s){var a=s+1,u=function BK(t){return[2,4,6,12].some(function(n){return n===t})?[2,2]:[1,1]}(a);r=function LK(t,n,e){return te(function(){var r=Th(t,n.filters,e,"same");return r=zM(r,n.batch_norm_mean,n.batch_norm_variance,n.batch_norm_offset,n.batch_norm_scale,.0010000000474974513),d0(r,0,6)})}(r,o.depthwise_conv,u),r=xi(r,o.pointwise_conv,[1,1]),11===a&&(e=r)}),null===e)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:e}})}(Zt(Cn(i,X(.007843137718737125)),X(1)),r.mobilenetv1),a=function GK(t,n,e){return te(function(){var r=xi(t,e.conv_0,[1,1]),i=xi(r,e.conv_1,[2,2]),o=xi(i,e.conv_2,[1,1]),s=xi(o,e.conv_3,[2,2]),a=xi(s,e.conv_4,[1,1]),u=xi(a,e.conv_5,[2,2]),c=xi(u,e.conv_6,[1,1]),l=xi(c,e.conv_7,[2,2]),d=gu(n,e.box_predictor_0),f=gu(t,e.box_predictor_1),h=gu(i,e.box_predictor_2),p=gu(s,e.box_predictor_3),g=gu(u,e.box_predictor_4),m=gu(l,e.box_predictor_5);return{boxPredictions:Yt([d.boxPredictionEncoding,f.boxPredictionEncoding,h.boxPredictionEncoding,p.boxPredictionEncoding,g.boxPredictionEncoding,m.boxPredictionEncoding],1),classPredictions:Yt([d.classPrediction,f.classPrediction,h.classPrediction,p.classPrediction,g.classPrediction,m.classPrediction],1)}})}(s.out,s.conv11,r.prediction_layer);return function zK(t,n,e){return te(function(){var r=t.shape[0],i=function WK(t,n){var e=function jK(t){var n=Xt(Uo(t,[1,0])),e=[Zt(n[2],n[0]),Zt(n[3],n[1])];return{sizes:e,centers:[Oe(n[0],Kr(e[0],X(2))),Oe(n[1],Kr(e[1],X(2)))]}}(t),r=e.sizes,i=e.centers,o=Xt(Uo(n,[1,0])),s=Kr(Cn(f0(Kr(o[2],X(5))),r[0]),X(2)),a=Oe(Cn(Kr(o[0],X(10)),r[0]),i[0]),u=Kr(Cn(f0(Kr(o[3],X(5))),r[1]),X(2)),c=Oe(Cn(Kr(o[1],X(10)),r[1]),i[1]);return Uo(fr([Zt(a,s),Zt(c,u),Oe(a,s),Oe(c,u)]),[1,0])}($r(nu(e.extra_dim,[r,1,1]),[-1,4]),$r(t,[-1,4]));i=$r(i,[r,i.shape[0]/r,4]);var o=UM(bi(n,[0,0,1],[-1,-1,-1])),s=bi(o,[0,0,0],[-1,-1,1]);return s=$r(s,[r,s.shape[1]]),{boxes:Xt(i),scores:Xt(s)}})}(a.boxPredictions,a.classPredictions,r.output_layer)})},n.prototype.forward=function(e){return ue(this,void 0,void 0,function(){var r;return ce(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,rn(e)];case 1:return[2,r.apply(this,[i.sent()])]}})})},n.prototype.locateFaces=function(e,r){return void 0===r&&(r={}),ue(this,void 0,void 0,function(){var i,o,s,a,u,c,l,d,f,h,p,g,m,y,w,b,_,C,T,S;return ce(this,function(D){switch(D.label){case 0:return i=new Gh(r),o=i.maxResults,s=i.minConfidence,[4,rn(e)];case 1:for(a=D.sent(),u=this.forwardInput(a),d=(c=u.boxes)[0],f=(l=u.scores)[0],h=1;h<c.length;h++)c[h].dispose(),l[h].dispose();return m=(g=Array).from,[4,f.data()];case 2:return p=m.apply(g,[D.sent()]),y=function UK(t,n,e,r,i){var s=Math.min(e,t.shape[0]),a=n.map(function(l,d){return{score:l,boxIndex:d}}).filter(function(l){return l.score>i}).sort(function(l,d){return d.score-l.score}),u=function(l){return l<=r?1:0},c=[];return a.forEach(function(l){if(!(c.length>=s)){for(var d=l.score,f=c.length-1;f>=0;--f){var h=HK(t,l.boxIndex,c[f]);if(0!==h&&(l.score*=u(h),l.score<=i))break}d===l.score&&c.push(l.boxIndex)}}),c}(d,p,o,.5,s),w=a.getReshapedInputDimensions(0),_=(b=a.inputSize)/w.width,C=b/w.height,T=d.arraySync(),S=y.map(function(I){var O=[Math.max(0,T[I][0]),Math.min(1,T[I][2])].map(function(H){return H*C}),R=O[0],V=O[1],L=[Math.max(0,T[I][1]),Math.min(1,T[I][3])].map(function(H){return H*_}),B=L[0];return new Yr(p[I],new K0(B,R,L[1]-B,V-R),{height:a.getInputHeight(0),width:a.getInputWidth(0)})}),d.dispose(),f.dispose(),[2,S]}})})},n.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function PK(t){var n=[],e=function kK(t,n){var e=Go(t,n);function r(c,l,d){return{filters:e(c+"/Conv2d_"+l+"_pointwise/weights",4,d+"/filters"),batch_norm_offset:e(c+"/Conv2d_"+l+"_pointwise/convolution_bn_offset",1,d+"/batch_norm_offset")}}function i(c){var l="mobilenetv1/conv_"+c,d="MobilenetV1/Conv2d_"+c+"_depthwise",f=l+"/depthwise_conv",h=l+"/pointwise_conv";return{depthwise_conv:{filters:e(d+"/depthwise_weights",4,f+"/filters"),batch_norm_scale:e(d+"/BatchNorm/gamma",1,f+"/batch_norm_scale"),batch_norm_offset:e(d+"/BatchNorm/beta",1,f+"/batch_norm_offset"),batch_norm_mean:e(d+"/BatchNorm/moving_mean",1,f+"/batch_norm_mean"),batch_norm_variance:e(d+"/BatchNorm/moving_variance",1,f+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",c,h)}}function s(c,l){return{filters:e(c+"/weights",4,l+"/filters"),bias:e(c+"/biases",1,l+"/bias")}}function a(c){return{box_encoding_predictor:s("Prediction/BoxPredictor_"+c+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+c+"/box_encoding_predictor"),class_predictor:s("Prediction/BoxPredictor_"+c+"/ClassPredictor","prediction_layer/box_predictor_"+c+"/class_predictor")}}return{extractMobilenetV1Params:function o(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}},extractPredictionLayerParams:function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:a(0),box_predictor_1:a(1),box_predictor_2:a(2),box_predictor_3:a(3),box_predictor_4:a(4),box_predictor_5:a(5)}}}}(t,n),r=e.extractMobilenetV1Params,i=e.extractPredictionLayerParams,o=t["Output/extra_dim"];if(n.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Fh(o))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+o);var s={mobilenetv1:r(),prediction_layer:i(),output_layer:{extra_dim:o}};return no(t,n),{params:s,paramMappings:n}}(e)},n.prototype.extractParams=function(e){return function NK(t){var n=[],e=ro(t),r=e.extractWeights,i=e.getRemainingWeights,o=function OK(t,n){function r(u,c,l,d,f){var h=Zn(t(u*c*l*l),[l,l,u,c]),p=jt(t(c));return n.push({paramPath:d+"/filters"},{paramPath:d+"/"+(f?"batch_norm_offset":"bias")}),{filters:h,bias:p}}function i(u,c,l,d){var f=r(u,c,l,d,!0);return{filters:f.filters,batch_norm_offset:f.bias}}function o(u,c,l){var d=function e(u,c){var l=Zn(t(9*u),[3,3,u,1]),d=jt(t(u)),f=jt(t(u)),h=jt(t(u)),p=jt(t(u));return n.push({paramPath:c+"/filters"},{paramPath:c+"/batch_norm_scale"},{paramPath:c+"/batch_norm_offset"},{paramPath:c+"/batch_norm_mean"},{paramPath:c+"/batch_norm_variance"}),{filters:l,batch_norm_scale:d,batch_norm_offset:f,batch_norm_mean:h,batch_norm_variance:p}}(u,l+"/depthwise_conv");return{depthwise_conv:d,pointwise_conv:i(u,c,1,l+"/pointwise_conv")}}return{extractMobilenetV1Params:function s(){return{conv_0:i(3,32,3,"mobilenetv1/conv_0"),conv_1:o(32,64,"mobilenetv1/conv_1"),conv_2:o(64,128,"mobilenetv1/conv_2"),conv_3:o(128,128,"mobilenetv1/conv_3"),conv_4:o(128,256,"mobilenetv1/conv_4"),conv_5:o(256,256,"mobilenetv1/conv_5"),conv_6:o(256,512,"mobilenetv1/conv_6"),conv_7:o(512,512,"mobilenetv1/conv_7"),conv_8:o(512,512,"mobilenetv1/conv_8"),conv_9:o(512,512,"mobilenetv1/conv_9"),conv_10:o(512,512,"mobilenetv1/conv_10"),conv_11:o(512,512,"mobilenetv1/conv_11"),conv_12:o(512,1024,"mobilenetv1/conv_12"),conv_13:o(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function a(){return{conv_0:i(1024,256,1,"prediction_layer/conv_0"),conv_1:i(256,512,3,"prediction_layer/conv_1"),conv_2:i(512,128,1,"prediction_layer/conv_2"),conv_3:i(128,256,3,"prediction_layer/conv_3"),conv_4:i(256,128,1,"prediction_layer/conv_4"),conv_5:i(128,256,3,"prediction_layer/conv_5"),conv_6:i(256,64,1,"prediction_layer/conv_6"),conv_7:i(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:r(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:r(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:r(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:r(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:r(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}(r,n),a=o.extractPredictionLayerParams,u=(0,o.extractMobilenetV1Params)(),c=a(),d={extra_dim:By(r(20472),[1,5118,4])};if(n.push({paramPath:"output_layer/extra_dim"}),0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:d},paramMappings:n}}(e)},n}(to);!function(t){xe(function n(){return null!==t&&t.apply(this,arguments)||this},t)}(MR);var KK=[new Qe(.738768,.874946),new Qe(2.42204,2.65704),new Qe(4.30971,7.04493),new Qe(10.246,4.59428),new Qe(12.6868,11.8741)],YK=[new Qe(1.603231,2.094468),new Qe(6.041143,7.080126),new Qe(2.882459,3.518061),new Qe(4.266906,5.178857),new Qe(9.041765,10.66308)],XK=[117.001,114.697,97.404],$h=function(t){return"number"==typeof t};function cb(t){return te(function(){var n=Cn(t,X(.10000000149011612));return Oe(It(Zt(t,n)),n)})}function $o(t,n){return te(function(){var e=Ds(t,[[0,0],[1,1],[1,1],[0,0]]);return e=Mr(e,n.conv.filters,[1,1],"valid"),e=Zt(e,n.bn.sub),e=Cn(e,n.bn.truediv),cb(e=Oe(e,n.conv.bias))})}function qo(t,n){return te(function(){var e=Ds(t,[[0,0],[1,1],[1,1],[0,0]]);return e=v0(e,n.depthwise_filter,n.pointwise_filter,[1,1],"valid"),cb(e=Oe(e,n.bias))})}var lb=function(){function t(n){var e=void 0===n?{}:n,r=e.inputSize,i=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=i||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),t}(),AR=function(t){function n(e){var r=t.call(this,"TinyYolov2")||this;return function JK(t){if(!t)throw new Error("invalid config: "+t);if("boolean"!=typeof t.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+t.withSeparableConvs);if(!$h(t.iouThreshold)||t.iouThreshold<0||t.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+t.iouThreshold);if(!Array.isArray(t.classes)||!t.classes.length||!t.classes.every(function(n){return"string"==typeof n}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(t.classes));if(!Array.isArray(t.anchors)||!t.anchors.length||!t.anchors.map(function(n){return n||{}}).every(function(n){return $h(n.x)&&$h(n.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(t.anchors));if(t.meanRgb&&(!Array.isArray(t.meanRgb)||3!==t.meanRgb.length||!t.meanRgb.every($h)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(t.meanRgb))}(e),r._config=e,r}return xe(n,t),Object.defineProperty(n.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),n.prototype.runTinyYolov2=function(e,r){var i=$o(e,r.conv0);return i=$o(i=nn(i,[2,2],[2,2],"same"),r.conv1),i=$o(i=nn(i,[2,2],[2,2],"same"),r.conv2),i=$o(i=nn(i,[2,2],[2,2],"same"),r.conv3),i=$o(i=nn(i,[2,2],[2,2],"same"),r.conv4),i=$o(i=nn(i,[2,2],[2,2],"same"),r.conv5),i=$o(i=nn(i,[2,2],[1,1],"same"),r.conv6),Xr(i=$o(i,r.conv7),r.conv8,"valid",!1)},n.prototype.runMobilenet=function(e,r){var i=this.config.isFirstLayerConv2d?cb(Xr(e,r.conv0,"valid",!1)):qo(e,r.conv0);return i=qo(i=nn(i,[2,2],[2,2],"same"),r.conv1),i=qo(i=nn(i,[2,2],[2,2],"same"),r.conv2),i=qo(i=nn(i,[2,2],[2,2],"same"),r.conv3),i=qo(i=nn(i,[2,2],[2,2],"same"),r.conv4),i=qo(i=nn(i,[2,2],[2,2],"same"),r.conv5),i=nn(i,[2,2],[1,1],"same"),i=r.conv6?qo(i,r.conv6):i,Xr(i=r.conv7?qo(i,r.conv7):i,r.conv8,"valid",!1)},n.prototype.forwardInput=function(e,r){var i=this,o=this.params;if(!o)throw new Error("TinyYolov2 - load model before inference");return te(function(){var s=e.toBatchTensor(r,!1).toFloat();return s=(s=i.config.meanRgb?Sl(s,i.config.meanRgb):s).div(X(256)),i.config.withSeparableConvs?i.runMobilenet(s,o):i.runTinyYolov2(s,o)})},n.prototype.forward=function(e,r){return ue(this,void 0,void 0,function(){var i;return ce(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,rn(e)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent()]}})})},n.prototype.detect=function(e,r){return void 0===r&&(r={}),ue(this,void 0,void 0,function(){var i,o,s,a,u,c,l,d,f,h,p,g,y=this;return ce(this,function(w){switch(w.label){case 0:return i=new lb(r),o=i.inputSize,s=i.scoreThreshold,[4,rn(e)];case 1:return a=w.sent(),[4,this.forwardInput(a,o)];case 2:return u=w.sent(),c=te(function(){return Xt(u)[0].expandDims()}),l={width:a.getInputWidth(0),height:a.getInputHeight(0)},[4,this.extractBoxes(c,a.getReshapedInputDimensions(0),s)];case 3:return d=w.sent(),u.dispose(),c.dispose(),f=d.map(function(b){return b.box}),h=d.map(function(b){return b.score}),p=d.map(function(b){return b.classScore}),g=d.map(function(b){return y.config.classes[b.label]}),[2,Il(f.map(function(b){return b.rescale(o)}),h,this.config.iouThreshold,!0).map(function(b){return new ZA(h[b],p[b],g[b],f[b],l)})]}})})},n.prototype.getDefaultModelName=function(){return""},n.prototype.extractParamsFromWeigthMap=function(e){return function rY(t,n){var a,e=[],r=function nY(t,n){var e=Go(t,n);function i(a){return{filters:e(a+"/filters",4),bias:e(a+"/bias",1)}}return{extractConvParams:i,extractConvWithBatchNormParams:function o(a){var u=i(a+"/conv"),c=function r(a){return{sub:e(a+"/sub",1),truediv:e(a+"/truediv",1)}}(a+"/bn");return{conv:u,bn:c}},extractSeparableConvParams:ob(e)}}(t,e),i=r.extractConvParams,o=r.extractConvWithBatchNormParams,s=r.extractSeparableConvParams;if(n.withSeparableConvs){var u=n.filterSizes&&n.filterSizes.length||9;a={conv0:n.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:i("conv8")}}else a={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return no(t,e),{params:a,paramMappings:e}}(e,this.config)},n.prototype.extractParams=function(e){var r=this.config.filterSizes||n.DEFAULT_FILTER_SIZES,i=r?r.length:void 0;if(7!==i&&8!==i&&9!==i)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+i+" filterSizes in config");return function tY(t,n,e,r){var f,i=ro(t),s=i.getRemainingWeights,a=[],u=function eY(t,n){var e=jh(t,n),o=ib(t,n);return{extractConvParams:e,extractConvWithBatchNormParams:function i(s,a,u){var c=e(s,a,3,u+"/conv"),l=function r(s,a){var u=jt(t(s)),c=jt(t(s));return n.push({paramPath:a+"/sub"},{paramPath:a+"/truediv"}),{sub:u,truediv:c}}(a,u+"/bn");return{conv:c,bn:l}},extractSeparableConvParams:o}}(i.extractWeights,a),c=u.extractConvParams,l=u.extractConvWithBatchNormParams,d=u.extractSeparableConvParams;if(n.withSeparableConvs){var h=r[0],p=r[1],g=r[2],m=r[3],v=r[4],y=r[5],w=r[6],b=r[7],_=r[8];f={conv0:n.isFirstLayerConv2d?c(h,p,3,"conv0"):d(h,p,"conv0"),conv1:d(p,g,"conv1"),conv2:d(g,m,"conv2"),conv3:d(m,v,"conv3"),conv4:d(v,y,"conv4"),conv5:d(y,w,"conv5"),conv6:b?d(w,b,"conv6"):void 0,conv7:_?d(b,_,"conv7"):void 0,conv8:c(_||b||w,5*e,1,"conv8")}}else g=r[2],m=r[3],v=r[4],y=r[5],w=r[6],b=r[7],_=r[8],f={conv0:l(h=r[0],p=r[1],"conv0"),conv1:l(p,g,"conv1"),conv2:l(g,m,"conv2"),conv3:l(m,v,"conv3"),conv4:l(v,y,"conv4"),conv5:l(y,w,"conv5"),conv6:l(w,b,"conv6"),conv7:l(b,_,"conv7"),conv8:c(_,5*e,1,"conv8")};if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{params:f,paramMappings:a}}(e,this.config,this.boxEncodingSize,r)},n.prototype.extractBoxes=function(e,r,i){return ue(this,void 0,void 0,function(){var o,s,a,u,c,l,d,f,h,p,g,m,v,y,w,b,_,C,T,S,D,I,O,R,V,L,B,z,H,U=this;return ce(this,function(G){switch(G.label){case 0:return o=r.width,s=r.height,a=Math.max(o,s),u=a/o,c=a/s,l=e.shape[1],d=this.config.anchors.length,f=te(function(){var q=e.reshape([l,l,d,U.boxEncodingSize]);return[q.slice([0,0,0,0],[l,l,d,4]),q.slice([0,0,0,4],[l,l,d,1]),U.withClassScores?Yi(q.slice([0,0,0,5],[l,l,d,U.config.classes.length]),3):X(0)]}),h=f[0],g=f[2],m=[],[4,(p=f[1]).array()];case 1:return v=G.sent(),[4,h.array()];case 2:y=G.sent(),w=0,G.label=3;case 3:if(!(w<l))return[3,12];b=0,G.label=4;case 4:if(!(b<l))return[3,11];_=0,G.label=5;case 5:return _<d?(C=q0(v[w][b][_][0]),!i||C>i?(T=(b+q0(y[w][b][_][0]))/l*u,S=(w+q0(y[w][b][_][1]))/l*c,D=Math.exp(y[w][b][_][2])*this.config.anchors[_].x/l*u,I=Math.exp(y[w][b][_][3])*this.config.anchors[_].y/l*c,O=T-D/2,R=S-I/2,V={row:w,col:b,anchor:_},this.withClassScores?[4,this.extractPredictedClass(g,V)]:[3,7]):[3,9]):[3,10];case 6:return H=G.sent(),[3,8];case 7:H={classScore:1,label:0},G.label=8;case 8:B=(L=H).classScore,z=L.label,m.push(En({box:new Lh(O,R,O+D,R+I),score:C,classScore:C*B,label:z},V)),G.label=9;case 9:return _++,[3,5];case 10:return b++,[3,4];case 11:return w++,[3,3];case 12:return h.dispose(),p.dispose(),g.dispose(),[2,m]}})})},n.prototype.extractPredictedClass=function(e,r){return ue(this,void 0,void 0,function(){var i,o,s,a;return ce(this,function(u){switch(u.label){case 0:return i=r.row,o=r.col,s=r.anchor,[4,e.array()];case 1:return a=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(c,l){return a[i][o][s][l]}).map(function(c,l){return{classScore:c,label:l}}).reduce(function(c,l){return c.classScore>l.classScore?c:l})]}})})},n.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],n}(to),oY=function(t){function n(e){void 0===e&&(e=!0);var i=Object.assign({},{withSeparableConvs:e,iouThreshold:.4,classes:["face"]},e?{anchors:YK,meanRgb:XK}:{anchors:KK,withClassScores:!0});return t.call(this,i)||this}return xe(n,t),Object.defineProperty(n.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(e,r){return ue(this,void 0,void 0,function(){return ce(this,function(o){switch(o.label){case 0:return[4,this.detect(e,r)];case 1:return[2,o.sent().map(function(s){return new Yr(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},n.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},n}(AR),RR=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return xe(n,t),n}(lb),Al=function(){function t(){}return t.prototype.then=function(n){return ue(this,void 0,void 0,function(){var e;return ce(this,function(r){switch(r.label){case 0:return e=n,[4,this.run()];case 1:return[2,e.apply(void 0,[r.sent()])]}})})},t.prototype.run=function(){return ue(this,void 0,void 0,function(){return ce(this,function(n){throw new Error("ComposableTask - run is not implemented")})})},t}();function OR(t,n){return Object.assign({},t,{descriptor:n})}function qh(t,n,e,r,i){return void 0===i&&(i=function(o){return o.alignedRect}),ue(this,void 0,void 0,function(){var o,s,a,u,c;return ce(this,function(l){switch(l.label){case 0:return o=t.map(function(d){return _R(d)?i(d):d.detection}),(a=r)?[3,5]:n instanceof lt?[4,tb(n,o)]:[3,2];case 1:return u=l.sent(),[3,4];case 2:return[4,eb(n,o)];case 3:u=l.sent(),l.label=4;case 4:a=u,l.label=5;case 5:return[4,e(s=a)];case 6:return c=l.sent(),s.forEach(function(d){return d instanceof lt&&d.dispose()}),[2,c]}})})}function db(t,n,e,r,i){return ue(this,void 0,void 0,function(){var o=this;return ce(this,function(s){return[2,qh([t],n,function(a){return ue(o,void 0,void 0,function(){return ce(this,function(u){return[2,e(a[0])]})})},r,i)]})})}function fb(t,n){var r=n[1];return{height:Math.floor(n[0]*t),width:Math.floor(r*t)}}var hb=function(t){function n(e,r,i,o){return t.call(this,{left:e,top:r,right:i,bottom:o},!0)||this}return xe(n,t),n}(eo);function NR(t){return te(function(){return Cn(Zt(t,X(127.5)),X(.0078125))})}function mu(t,n){return te(function(){return Oe(It(t),Cn(n,xh(It(xh(t)))))})}function pb(t,n,e){return void 0===e&&(e=!1),te(function(){var r=Xr(t,n.conv1,"valid");return r=mu(r,n.prelu1_alpha),r=mu(r=Xr(r=nn(r,e?[2,2]:[3,3],[2,2],"same"),n.conv2,"valid"),n.prelu2_alpha),mu(r=Xr(r=e?r:nn(r,[3,3],[2,2],"valid"),n.conv3,"valid"),n.prelu3_alpha)})}function gY(t,n,e,r,i){i.stage1=[];var o=n.map(function(f){return te(function(){var h={scale:f},p=function hY(t,n){return te(function(){var e=fb(n,t.shape.slice(1)),s=NR(C0.resizeBilinear(t,[e.height,e.width]));return Uo(s,[0,2,1,3])})}(t,f),g=Date.now(),m=function fY(t,n){return te(function(){var e=pb(t,n,!0),r=Xr(e,n.conv4_1,"valid"),i=Tr(Ah(r,3),3);return{prob:Yi(Zt(r,i),3),regions:Xr(e,n.conv4_2,"valid")}})}(p,r),v=m.prob,y=m.regions;return h.pnet=Date.now()-g,{scoresTensor:Xt(Xt(v,3)[1])[0],regionsTensor:Xt(y)[0],scale:f,statsForScale:h}})}),s=o.map(function(f){var h=f.scoresTensor,p=f.regionsTensor,m=f.statsForScale,v=function pY(t,n,e,r){for(var i=[],o=t.arraySync(),s=0;s<t.shape[0];s++)for(var a=0;a<t.shape[1];a++)o[s][a]>=r&&i.push(new Qe(a,s));return i.map(function(c){var l=new Lh(Math.round((2*c.y+1)/e),Math.round((2*c.x+1)/e),Math.round((2*c.y+12)/e),Math.round((2*c.x+12)/e)),d=o[c.y][c.x],f=n.arraySync();return{cell:l,score:d,region:new hb(f[c.y][c.x][0],f[c.y][c.x][1],f[c.y][c.x][2],f[c.y][c.x][3])}})}(h,p,f.scale,e);if(h.dispose(),p.dispose(),!v.length)return i.stage1.push(m),[];var y=Date.now(),w=Il(v.map(function(b){return b.cell}),v.map(function(b){return b.score}),.5);return m.nms=Date.now()-y,m.numBoxes=w.length,i.stage1.push(m),w.map(function(b){return v[b]})}),a=s.reduce(function(f,h){return f.concat(h)},[]),u=[],c=[];if(a.length>0){var l=Date.now(),d=Il(a.map(function(f){return f.cell}),a.map(function(f){return f.score}),.7);i.stage1_nms=Date.now()-l,c=d.map(function(f){return a[f].score}),u=d.map(function(f){return a[f]}).map(function(f){var h=f.cell,p=f.region;return new Lh(h.left+p.left*h.width,h.top+p.top*h.height,h.right+p.right*h.width,h.bottom+p.bottom*h.height).toSquare().round()})}return{boxes:u,scores:c}}function kR(t,n,e){var r=e.width,i=e.height;return ue(this,void 0,void 0,function(){var o,s,a,u=this;return ce(this,function(c){switch(c.label){case 0:return o=wi(t),[4,Promise.all(n.map(function(l){return ue(u,void 0,void 0,function(){var d,m,v,y;return ce(this,function(w){return d=l.padAtBorders(t.height,t.width),y=o.getImageData(m=d.x-1,v=d.y-1,d.ex-m,d.ey-v),[2,Dn.isNodejs()?J0(y):createImageBitmap(y)]})})}))];case 1:return s=c.sent(),a=[],s.forEach(function(l){var f=wi(Vh({width:r,height:i}));f.drawImage(l,0,0,r,i);for(var h=f.getImageData(0,0,r,i).data,p=[],g=0;g<h.length;g+=4)p.push(h[g+2]),p.push(h[g+1]),p.push(h[g]);a.push(p)}),[2,a.map(function(l){return te(function(){return NR(Uo(Zn(l,[1,r,i,3]),[0,2,1,3]).toFloat())})})]}})})}function vY(t,n,e,r,i){return ue(this,void 0,void 0,function(){var o,s,a,u,c,l,d,f,h,p,g,m,v,y;return ce(this,function(w){switch(w.label){case 0:return o=Date.now(),[4,kR(t,n,{width:24,height:24})];case 1:return s=w.sent(),i.stage2_extractImagePatches=Date.now()-o,o=Date.now(),a=s.map(function(b){var _=function mY(t,n){return te(function(){var e=pb(t,n),o=mu(_i($r(e,[e.shape[0],n.fc1.weights.shape[0]]),n.fc1),n.prelu4_alpha),s=_i(o,n.fc2_1),a=Tr(Ah(s,1),1),u=Yi(Zt(s,a),1),c=_i(o,n.fc2_2);return{scores:Xt(u,1)[1],regions:c}})}(b,r);return b.dispose(),_}),i.stage2_rnet=Date.now()-o,u=a.length>1?Yt(a.map(function(b){return b.scores})):a[0].scores,d=(l=Array).from,[4,u.data()];case 2:return c=d.apply(l,[w.sent()]),u.dispose(),f=c.map(function(b,_){return{score:b,idx:_}}).filter(function(b){return b.score>e}).map(function(b){return b.idx}),h=f.map(function(b){return n[b]}),p=f.map(function(b){return c[b]}),g=[],m=[],h.length>0&&(o=Date.now(),v=Il(h,p,.7),i.stage2_nms=Date.now()-o,y=v.map(function(b){var _=a[f[b]].regions.arraySync();return new hb(_[0][0],_[0][1],_[0][2],_[0][3])}),m=v.map(function(b){return p[b]}),g=v.map(function(b,_){return h[b].calibrate(y[_])})),a.forEach(function(b){b.regions.dispose(),b.scores.dispose()}),[2,{boxes:g,scores:m}]}})})}function bY(t,n,e,r,i){return ue(this,void 0,void 0,function(){var o,s,a,u,c,l,d,f,h,p,g,m,v,y,w;return ce(this,function(b){switch(b.label){case 0:return o=Date.now(),[4,kR(t,n,{width:48,height:48})];case 1:return s=b.sent(),i.stage3_extractImagePatches=Date.now()-o,o=Date.now(),a=s.map(function(_){var C=function yY(t,n){return te(function(){var e=pb(t,n);e=mu(e=Xr(e=nn(e,[2,2],[2,2],"same"),n.conv4,"valid"),n.prelu4_alpha);var o=mu(_i($r(e,[e.shape[0],n.fc1.weights.shape[0]]),n.fc1),n.prelu5_alpha),s=_i(o,n.fc2_1),a=Tr(Ah(s,1),1),u=Yi(Zt(s,a),1),c=_i(o,n.fc2_2),l=_i(o,n.fc2_3);return{scores:Xt(u,1)[1],regions:c,points:l}})}(_,r);return _.dispose(),C}),i.stage3_onet=Date.now()-o,u=a.length>1?Yt(a.map(function(_){return _.scores})):a[0].scores,d=(l=Array).from,[4,u.data()];case 2:return c=d.apply(l,[b.sent()]),u.dispose(),f=c.map(function(_,C){return{score:_,idx:C}}).filter(function(_){return _.score>e}).map(function(_){return _.idx}),h=f.map(function(_){var C=a[_].regions.arraySync();return new hb(C[0][0],C[0][1],C[0][2],C[0][3])}),p=f.map(function(_,C){return n[_].calibrate(h[C])}),g=f.map(function(_){return c[_]}),m=[],v=[],y=[],p.length>0&&(o=Date.now(),w=Il(p,g,.7,!1),i.stage3_nms=Date.now()-o,m=w.map(function(_){return p[_]}),v=w.map(function(_){return g[_]}),y=w.map(function(_,C){return Array(5).fill(0).map(function(T,S){var D=a[_].points.arraySync();return new Qe(D[0][S]*(m[C].width+1)+m[C].left,D[0][S+5]*(m[C].height+1)+m[C].top)})})),a.forEach(function(_){_.regions.dispose(),_.scores.dispose(),_.points.dispose()}),[2,{boxes:m,scores:v,points:y}]}})})}var wY=function(t){function n(){return t.call(this,"Mtcnn")||this}return xe(n,t),n.prototype.load=function(e){return ue(this,void 0,void 0,function(){return ce(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.load.call(this,e)]})})},n.prototype.loadFromDisk=function(e){return ue(this,void 0,void 0,function(){return ce(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.loadFromDisk.call(this,e)]})})},n.prototype.forwardInput=function(e,r){return void 0===r&&(r={}),ue(this,void 0,void 0,function(){var i,o,s,a,u,c,l,d,f,h,p,g,m,v,w,b,_,C,T,S;return ce(this,function(D){switch(D.label){case 0:if(!(i=this.params))throw new Error("Mtcnn - load model before inference");if(!(o=e.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return s={},a=Date.now(),u=te(function(){return function sY(t){return te(function(){return fr(Xt(t,3).reverse(),3)})}(Tr(U0.fromPixels(o)).toFloat())}),c=function(I){return u.dispose(),s.total=Date.now()-a,I},l=u.shape.slice(1),d=l[0],f=l[1],h=new TR(r),p=h.minFaceSize,g=h.scaleFactor,m=h.maxNumScales,v=h.scoreThresholds,w=(h.scaleSteps||function dY(t,n,e){for(var o=12/t,s=[],a=Math.min(e[0],e[1])*o,u=0;a>=12;)s.push(o*Math.pow(n,u)),a*=n,u+=1;return s}(p,g,[d,f])).filter(function(I){var O=fb(I,[d,f]);return Math.min(O.width,O.height)>12}).slice(0,m),s.scales=w,s.pyramid=w.map(function(I){return fb(I,[d,f])}),b=Date.now(),[4,gY(u,w,v[0],i.pnet,s)];case 1:return _=D.sent(),s.total_stage1=Date.now()-b,_.boxes.length?(s.stage2_numInputBoxes=_.boxes.length,b=Date.now(),[4,vY(o,_.boxes,v[1],i.rnet,s)]):[2,c({results:[],stats:s})];case 2:return C=D.sent(),s.total_stage2=Date.now()-b,C.boxes.length?(s.stage3_numInputBoxes=C.boxes.length,b=Date.now(),[4,bY(o,C.boxes,v[2],i.onet,s)]):[2,c({results:[],stats:s})];case 3:return T=D.sent(),s.total_stage3=Date.now()-b,S=T.boxes.map(function(I,O){return Wh(Ml({},new Yr(T.scores[O],new K0(I.left/f,I.top/d,I.width/f,I.height/d),{height:d,width:f})),new q7(T.points[O].map(function(R){return R.sub(new Qe(I.left,I.top)).div(new Qe(I.width,I.height))}),{width:I.width,height:I.height}))}),[2,c({results:S,stats:s})]}})})},n.prototype.forward=function(e,r){return void 0===r&&(r={}),ue(this,void 0,void 0,function(){var i;return ce(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,rn(e)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent().results]}})})},n.prototype.forwardWithStats=function(e,r){return void 0===r&&(r={}),ue(this,void 0,void 0,function(){var i;return ce(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,rn(e)];case 1:return[2,i.apply(this,[o.sent(),r])]}})})},n.prototype.getDefaultModelName=function(){return"mtcnn_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function lY(t){var n=[],e=function cY(t,n){var e=Go(t,n);function r(l){return{filters:e(l+"/weights",4,l+"/filters"),bias:e(l+"/bias",1)}}function i(l){return{weights:e(l+"/weights",2),bias:e(l+"/bias",1)}}function o(l){return e(l,1)}function s(l){return{conv1:r(l+"/conv1"),prelu1_alpha:o(l+"/prelu1_alpha"),conv2:r(l+"/conv2"),prelu2_alpha:o(l+"/prelu2_alpha"),conv3:r(l+"/conv3"),prelu3_alpha:o(l+"/prelu3_alpha")}}return{extractPNetParams:function a(){var l=s("pnet"),d=r("pnet/conv4_1"),f=r("pnet/conv4_2");return En(En({},l),{conv4_1:d,conv4_2:f})},extractRNetParams:function u(){var l=s("rnet"),d=i("rnet/fc1"),f=o("rnet/prelu4_alpha"),h=i("rnet/fc2_1"),p=i("rnet/fc2_2");return En(En({},l),{fc1:d,prelu4_alpha:f,fc2_1:h,fc2_2:p})},extractONetParams:function c(){var l=s("onet"),d=r("onet/conv4"),f=o("onet/prelu4_alpha"),h=i("onet/fc1"),p=o("onet/prelu5_alpha"),g=i("onet/fc2_1"),m=i("onet/fc2_2"),v=i("onet/fc2_3");return En(En({},l),{conv4:d,prelu4_alpha:f,fc1:h,prelu5_alpha:p,fc2_1:g,fc2_2:m,fc2_3:v})}}}(t,n),i=e.extractRNetParams,o=e.extractONetParams,s=(0,e.extractPNetParams)(),a=i(),u=o();return no(t,n),{params:{pnet:s,rnet:a,onet:u},paramMappings:n}}(e)},n.prototype.extractParams=function(e){return function uY(t){var n=ro(t),r=n.getRemainingWeights,i=[],o=function aY(t,n){var e=jh(t,n),r=rb(t,n);function i(c,l){var d=jt(t(c));return n.push({paramPath:l}),d}function o(c,l,d){return void 0===d&&(d=!1),{conv1:e(c[0],c[1],3,l+"/conv1"),prelu1_alpha:i(c[1],l+"/prelu1_alpha"),conv2:e(c[1],c[2],3,l+"/conv2"),prelu2_alpha:i(c[2],l+"/prelu2_alpha"),conv3:e(c[2],c[3],d?2:3,l+"/conv3"),prelu3_alpha:i(c[3],l+"/prelu3_alpha")}}return{extractPNetParams:function s(){var c=o([3,10,16,32],"pnet"),l=e(32,2,1,"pnet/conv4_1"),d=e(32,4,1,"pnet/conv4_2");return En(En({},c),{conv4_1:l,conv4_2:d})},extractRNetParams:function a(){var c=o([3,28,48,64],"rnet",!0),l=r(576,128,"rnet/fc1"),d=i(128,"rnet/prelu4_alpha"),f=r(128,2,"rnet/fc2_1"),h=r(128,4,"rnet/fc2_2");return En(En({},c),{fc1:l,prelu4_alpha:d,fc2_1:f,fc2_2:h})},extractONetParams:function u(){var c=o([3,32,64,64],"onet"),l=e(64,128,2,"onet/conv4"),d=i(128,"onet/prelu4_alpha"),f=r(1152,256,"onet/fc1"),h=i(256,"onet/prelu5_alpha"),p=r(256,2,"onet/fc2_1"),g=r(256,4,"onet/fc2_2"),m=r(256,10,"onet/fc2_3");return En(En({},c),{conv4:l,prelu4_alpha:d,fc1:f,prelu5_alpha:h,fc2_1:p,fc2_2:g,fc2_3:m})}}}(n.extractWeights,i),a=o.extractRNetParams,u=o.extractONetParams,c=(0,o.extractPNetParams)(),l=a(),d=u();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:c,rnet:l,onet:d},paramMappings:i}}(e)},n}(to),CY=[new Qe(1.603231,2.094468),new Qe(6.041143,7.080126),new Qe(2.882459,3.518061),new Qe(4.266906,5.178857),new Qe(9.041765,10.66308)],xY=[117.001,114.697,97.404],EY=function(t){function n(){return t.call(this,{withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:CY,meanRgb:xY,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]})||this}return xe(n,t),Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(e,r){return ue(this,void 0,void 0,function(){return ce(this,function(o){switch(o.label){case 0:return[4,this.detect(e,r)];case 1:return[2,o.sent().map(function(s){return new Yr(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},n.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},n}(AR),Je={ssdMobilenetv1:new MR,tinyFaceDetector:new EY,tinyYolov2:new oY,mtcnn:new wY,faceLandmark68Net:new ER,faceLandmark68TinyNet:new EK,faceRecognitionNet:new RK,faceExpressionNet:new cK,ageGenderNet:new wK};function PR(t,n){return Object.assign({},t,{age:n})}var FR=function(t){function n(e,r,i){var o=t.call(this)||this;return o.parentTask=e,o.input=r,o.extractedFaces=i,o}return xe(n,t),n}(Al),gb=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return xe(n,t),n.prototype.run=function(){return ue(this,void 0,void 0,function(){var e,r,i=this;return ce(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return[4,qh(e=o.sent(),this.input,function(s){return ue(i,void 0,void 0,function(){return ce(this,function(a){switch(a.label){case 0:return[4,Promise.all(s.map(function(u){return Je.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,e.map(function(s,a){return wR(s,r[a])})]}})})},n.prototype.withAgeAndGender=function(){return new bb(this,this.input)},n}(FR),mb=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return xe(n,t),n.prototype.run=function(){return ue(this,void 0,void 0,function(){var e,r;return ce(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(e=i.sent())?[4,db(e,this.input,function(o){return Je.faceExpressionNet.predictExpressions(o)},this.extractedFaces)]:[2];case 2:return r=i.sent(),[2,wR(e,r)]}})})},n.prototype.withAgeAndGender=function(){return new wb(this,this.input)},n}(FR),vb=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return xe(n,t),n.prototype.withAgeAndGender=function(){return new _b(this,this.input)},n.prototype.withFaceDescriptors=function(){return new xb(this,this.input)},n}(gb),yb=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return xe(n,t),n.prototype.withAgeAndGender=function(){return new Cb(this,this.input)},n.prototype.withFaceDescriptor=function(){return new Eb(this,this.input)},n}(mb),LR=function(t){function n(e,r,i){var o=t.call(this)||this;return o.parentTask=e,o.input=r,o.extractedFaces=i,o}return xe(n,t),n}(Al),bb=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return xe(n,t),n.prototype.run=function(){return ue(this,void 0,void 0,function(){var e,r,i=this;return ce(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return[4,qh(e=o.sent(),this.input,function(s){return ue(i,void 0,void 0,function(){return ce(this,function(a){switch(a.label){case 0:return[4,Promise.all(s.map(function(u){return Je.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,e.map(function(s,a){var u=r[a],c=u.age;return PR(SR(s,u.gender,u.genderProbability),c)})]}})})},n.prototype.withFaceExpressions=function(){return new gb(this,this.input)},n}(LR),wb=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return xe(n,t),n.prototype.run=function(){return ue(this,void 0,void 0,function(){var e,r,i;return ce(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(e=a.sent())?[4,db(e,this.input,function(u){return Je.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=a.sent(),i=r.age,[2,PR(SR(e,r.gender,r.genderProbability),i)]}})})},n.prototype.withFaceExpressions=function(){return new mb(this,this.input)},n}(LR),_b=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return xe(n,t),n.prototype.withFaceExpressions=function(){return new vb(this,this.input)},n.prototype.withFaceDescriptors=function(){return new xb(this,this.input)},n}(bb),Cb=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return xe(n,t),n.prototype.withFaceExpressions=function(){return new yb(this,this.input)},n.prototype.withFaceDescriptor=function(){return new Eb(this,this.input)},n}(wb),BR=function(t){function n(e,r){var i=t.call(this)||this;return i.parentTask=e,i.input=r,i}return xe(n,t),n}(Al),xb=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return xe(n,t),n.prototype.run=function(){return ue(this,void 0,void 0,function(){var e;return ce(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return[4,qh(e=i.sent(),this.input,function(o){return Promise.all(o.map(function(s){return Je.faceRecognitionNet.computeFaceDescriptor(s)}))},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,i.sent().map(function(o,s){return OR(e[s],o)})]}})})},n.prototype.withFaceExpressions=function(){return new vb(this,this.input)},n.prototype.withAgeAndGender=function(){return new _b(this,this.input)},n}(BR),Eb=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return xe(n,t),n.prototype.run=function(){return ue(this,void 0,void 0,function(){var e,r;return ce(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(e=i.sent())?[4,db(e,this.input,function(o){return Je.faceRecognitionNet.computeFaceDescriptor(o)},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=i.sent(),[2,OR(e,r)]}})})},n.prototype.withFaceExpressions=function(){return new yb(this,this.input)},n.prototype.withAgeAndGender=function(){return new Cb(this,this.input)},n}(BR),VR=function(t){function n(e,r,i){var o=t.call(this)||this;return o.parentTask=e,o.input=r,o.useTinyLandmarkNet=i,o}return xe(n,t),Object.defineProperty(n.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Je.faceLandmark68TinyNet:Je.faceLandmark68Net},enumerable:!0,configurable:!0}),n}(Al),IY=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return xe(n,t),n.prototype.run=function(){return ue(this,void 0,void 0,function(){var e,r,i,o,s,a=this;return ce(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return e=u.sent(),r=e.map(function(c){return c.detection}),this.input instanceof lt?[4,tb(this.input,r)]:[3,3];case 2:return o=u.sent(),[3,5];case 3:return[4,eb(this.input,r)];case 4:o=u.sent(),u.label=5;case 5:return i=o,[4,Promise.all(i.map(function(c){return a.landmarkNet.detectLandmarks(c)}))];case 6:return s=u.sent(),i.forEach(function(c){return c instanceof lt&&c.dispose()}),[2,e.map(function(c,l){return Wh(c,s[l])})]}})})},n.prototype.withFaceExpressions=function(){return new vb(this,this.input)},n.prototype.withAgeAndGender=function(){return new _b(this,this.input)},n.prototype.withFaceDescriptors=function(){return new xb(this,this.input)},n}(VR),SY=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return xe(n,t),n.prototype.run=function(){return ue(this,void 0,void 0,function(){var e,r,i,o,s;return ce(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(e=a.sent())?(r=e.detection,this.input instanceof lt?[4,tb(this.input,[r])]:[3,3]):[2];case 2:return o=a.sent(),[3,5];case 3:return[4,eb(this.input,[r])];case 4:o=a.sent(),a.label=5;case 5:return[4,this.landmarkNet.detectLandmarks((i=o)[0])];case 6:return s=a.sent(),i.forEach(function(u){return u instanceof lt&&u.dispose()}),[2,Wh(e,s)]}})})},n.prototype.withFaceExpressions=function(){return new yb(this,this.input)},n.prototype.withAgeAndGender=function(){return new Cb(this,this.input)},n.prototype.withFaceDescriptor=function(){return new Eb(this,this.input)},n}(VR),UR=function(t){function n(e,r){void 0===r&&(r=new Gh);var i=t.call(this)||this;return i.input=e,i.options=r,i}return xe(n,t),n}(Al),HR=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return xe(n,t),n.prototype.run=function(){return ue(this,void 0,void 0,function(){var e,r,i,o;return ce(this,function(s){switch(s.label){case 0:return r=(e=this).input,(i=e.options)instanceof TR?[4,Je.mtcnn.forward(r,i)]:[3,2];case 1:return[2,s.sent().map(function(a){return a.detection})];case 2:if(!(o=i instanceof RR?function(a){return Je.tinyFaceDetector.locateFaces(a,i)}:i instanceof Gh?function(a){return Je.ssdMobilenetv1.locateFaces(a,i)}:i instanceof lb?function(a){return Je.tinyYolov2.locateFaces(a,i)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,o(r)]}})})},n.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(r){return ue(e,void 0,void 0,function(){var i;return ce(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i.map(function(s){return Ml({},s)}))]}})})})},n.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new IY(this.runAndExtendWithFaceDetections(),this.input,e)},n.prototype.withFaceExpressions=function(){return new gb(this.runAndExtendWithFaceDetections(),this.input)},n.prototype.withAgeAndGender=function(){return new bb(this.runAndExtendWithFaceDetections(),this.input)},n}(UR);function jR(t,n){var e=new Ns(n.width,n.height),r=e.width,i=e.height;if(r<=0||i<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:r,height:i}));if(Array.isArray(t))return t.map(function(a){return jR(a,{width:r,height:i})});if(_R(t)){var o=t.detection.forSize(r,i),s=t.unshiftedLandmarks.forSize(o.box.width,o.box.height);return Wh(Ml(t,o),s)}return tR(t)?Ml(t,t.detection.forSize(r,i)):t instanceof Tl||t instanceof Yr?t.forSize(r,i):t}!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}xe(n,t),n.prototype.run=function(){return ue(this,void 0,void 0,function(){var e,r;return ce(this,function(i){switch(i.label){case 0:return[4,new HR(this.input,this.options)];case 1:return e=i.sent(),r=e[0],e.forEach(function(o){o.score>r.score&&(r=o)}),[2,r]}})})},n.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(r){return ue(e,void 0,void 0,function(){var i;return ce(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i?Ml({},i):void 0)]}})})})},n.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new SY(this.runAndExtendWithFaceDetection(),this.input,e)},n.prototype.withFaceExpressions=function(){return new mb(this.runAndExtendWithFaceDetection(),this.input)},n.prototype.withAgeAndGender=function(){return new wb(this.runAndExtendWithFaceDetection(),this.input)}}(UR),function(){function t(n,e){void 0===e&&(e=.6),this._distanceThreshold=e;var r=Array.isArray(n)?n:[n];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var i=1,o=function(){return"person "+i++};this._labeledDescriptors=r.map(function(s){if(s instanceof Bh)return s;if(s instanceof Float32Array)return new Bh(o(),[s]);if(s.descriptor&&s.descriptor instanceof Float32Array)return new Bh(o(),[s.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}Object.defineProperty(t.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),t.prototype.computeMeanDistance=function(n,e){return e.map(function(r){return function MY(t,n){if(t.length!==n.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var e=Array.from(t),r=Array.from(n);return Math.sqrt(e.map(function(i,o){return i-r[o]}).reduce(function(i,o){return i+Math.pow(o,2)},0))}(r,n)}).reduce(function(r,i){return r+i},0)/(e.length||1)},t.prototype.matchDescriptor=function(n){var e=this;return this.labeledDescriptors.map(function(r){return new JA(r.label,e.computeMeanDistance(n,r.descriptors))}).reduce(function(r,i){return r.distance<i.distance?r:i})},t.prototype.findBestMatch=function(n){var e=this.matchDescriptor(n);return e.distance<this.distanceThreshold?e:new JA("unknown",e.distance)},t.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(n){return n.toJSON()})}},t.fromJSON=function(n){return new t(n.labeledDescriptors.map(function(r){return Bh.fromJSON(r)}),n.distanceThreshold)}}();const AY=["videoElement"],RY=["canvasElement"];function OY(t,n){1&t&&(Z(0,"div",15),He(1,"No user detected"),Q())}function NY(t,n){1&t&&(Z(0,"div",16),He(1,"Multi user detected"),Q())}function kY(t,n){if(1&t&&(Z(0,"div",17),He(1),Q()),2&t){const e=qe();Y(1),Do("You are good to go, Capturing in ... ",e.capturingIn,"")}}function PY(t,n){1&t&&(Z(0,"div",17),He(1,"Done"),Q())}function FY(t,n){1&t&&(Z(0,"div",18),He(1,"Loading ..."),Q())}function LY(t,n){if(1&t&&(Z(0,"div",19)(1,"div",20),He(2),Q()()),2&t){const e=qe();Y(2),Do("Getting you to the next step in ",e.nextStepIn,"")}}let BY=(()=>{class t{constructor(e,r){this._router=e,this._route=r,this.validUser=!1,this.multiuser=!1,this.invalidUser=!1,this.capturingIn=3,this.nextStepIn=5,this._mediaRecorderSetUp()}ngOnInit(){var e=this;return Ya(function*(){yield e._loadFaceDetectionModel(),yield e._detectFaces()})()}_mediaRecorderSetUp(){var e=this;return Ya(function*(){try{const r={video:{facingMode:"user",width:{ideal:1920},height:{ideal:1080}},audio:!0};e._stream=yield navigator.mediaDevices.getUserMedia(r),e.videoElement.nativeElement.srcObject=e._stream}catch{alert("Please allow permissions to access the camera and microphone.")}})()}_loadFaceDetectionModel(){return Ya(function*(){yield Je.tinyFaceDetector.loadFromUri("assets/models"),yield Je.faceLandmark68Net.load("assets/models")})()}_detectFaces(){var e=this;return Ya(function*(){const r=e.videoElement.nativeElement,i=e.canvasElement.nativeElement,o=i.getContext("2d"),s=document.getElementById("videoDiv");r&&s&&i&&o&&r.addEventListener("play",Ya(function*(){dR(i,{width:s.clientWidth,height:s.clientHeight}),e._faceDetectTimer=setInterval(Ya(function*(){dR(i,{width:s.clientWidth,height:s.clientHeight});const a=yield function TY(t,n){return void 0===n&&(n=new Gh),new HR(t,n)}(r,new RR).withFaceLandmarks();if(1==a.length?(e.validUser=!0,e.multiuser=!1,e.invalidUser=!1,e.timer=setTimeout(()=>{if(0===e.capturingIn){clearInterval(e.timer),o.drawImage(r,0,0,i.width,i.height);var u=i.toDataURL("image/png");u?(clearInterval(e._faceDetectTimer),e.userImg=u,document.getElementById("userVideo").style.display="none",document.getElementById("userImg").style.display="block",e._stream.getTracks().forEach(c=>{c.stop()}),e.nextStep()):e.capturingIn=3}else e.capturingIn--},1e3)):a.length>1?(e.multiuser=!0,e.validUser=!1,e.invalidUser=!1,e.capturingIn=3):(e.invalidUser=!0,e.validUser=!1,e.multiuser=!1,e.capturingIn=3),s){const u=jR(a,{width:s.clientWidth,height:s.clientHeight});null!==o&&(o.clearRect(0,0,i.width,i.height),u.forEach(c=>{const l=c.detection.box;o.beginPath(),o.rect(l.x,l.y,l.width,l.height),o.lineWidth=1.5,o.strokeStyle="#399953",o.stroke()}))}}),1e3)}))})()}ngOnDestroy(){this._stream.getTracks().forEach(e=>{e.stop()}),clearInterval(this._faceDetectTimer),clearInterval(this.timer)}nextStep(){let e=setInterval(()=>{0===this.nextStepIn?(clearInterval(e),this._router.navigate(["../otp"],{relativeTo:this._route})):this.nextStepIn--},1e3)}static#e=this.\u0275fac=function(r){return new(r||t)(F(Bn),F(No))};static#t=this.\u0275cmp=an({type:t,selectors:[["app-video"]],viewQuery:function(r,i){if(1&r&&(ka(AY,5),ka(RY,5)),2&r){let o;xr(o=Er())&&(i.videoElement=o.first),xr(o=Er())&&(i.canvasElement=o.first)}},decls:16,vars:9,consts:[[1,"user-video"],[1,"user-msgs"],["class","invalid-user",4,"ngIf"],["class","multi-user",4,"ngIf"],["class","valid-user",4,"ngIf"],["class","loading-user",4,"ngIf"],["id","userVideo",1,""],[3,"ngClass"],["id","videoDiv","autoplay","",3,"muted"],["videoElement",""],["id","canvasDiv"],["canvasElement",""],["id","userImg",1,""],["alt","",1,"user-image",3,"src"],["class","next",4,"ngIf"],[1,"invalid-user"],[1,"multi-user"],[1,"valid-user"],[1,"loading-user"],[1,"next"],[1,"next-step"]],template:function(r,i){1&r&&(Z(0,"div",0)(1,"div",1),de(2,OY,2,0,"div",2),de(3,NY,2,0,"div",3),de(4,kY,2,1,"div",4),de(5,PY,2,0,"div",4),de(6,FY,2,0,"div",5),Q(),Z(7,"div",6)(8,"div",7),ht(9,"video",8,9)(11,"canvas",10,11),Q()(),Z(13,"div",12),ht(14,"img",13),Q(),de(15,LY,3,1,"div",14),Q()),2&r&&(Y(2),K("ngIf",i.invalidUser),Y(1),K("ngIf",i.multiuser),Y(1),K("ngIf",i.validUser&&!i.userImg),Y(1),K("ngIf",i.userImg),Y(1),K("ngIf",!i.validUser&&!i.invalidUser&&!i.multiuser),Y(2),K("ngClass",i.invalidUser||i.multiuser?"invalid-video-card":i.validUser?"valid-video-card":"loading-video-card"),Y(1),K("muted",!0),Y(5),K("src",i.userImg,kg),Y(1),K("ngIf",i.userImg))},dependencies:[To,Wi],styles:['.invalid-video-card[_ngcontent-%COMP%], .valid-video-card[_ngcontent-%COMP%], .loading-video-card[_ngcontent-%COMP%]{width:20rem;height:24rem;display:flex;margin:auto}.invalid-video-card[_ngcontent-%COMP%]   video[_ngcontent-%COMP%], .invalid-video-card[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%], .valid-video-card[_ngcontent-%COMP%]   video[_ngcontent-%COMP%], .valid-video-card[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%], .loading-video-card[_ngcontent-%COMP%]   video[_ngcontent-%COMP%], .loading-video-card[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:cover}.invalid-video-card[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%], .valid-video-card[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%], .loading-video-card[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{position:relative;z-index:1;left:-100%}.invalid-video-card[_ngcontent-%COMP%]   video[_ngcontent-%COMP%], .valid-video-card[_ngcontent-%COMP%]   video[_ngcontent-%COMP%], .loading-video-card[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{border-radius:8px}.user-msgs[_ngcontent-%COMP%]{margin-bottom:1rem;display:flex;justify-content:center;font-weight:600;font-size:1.1rem;font-family:cursive}.user-msgs[_ngcontent-%COMP%]   .valid-user[_ngcontent-%COMP%]{color:#399953}.user-msgs[_ngcontent-%COMP%]   .multi-user[_ngcontent-%COMP%], .user-msgs[_ngcontent-%COMP%]   .invalid-user[_ngcontent-%COMP%]{color:#d53e33}.user-msgs[_ngcontent-%COMP%]   .loading-user[_ngcontent-%COMP%]{color:#868686}.next[_ngcontent-%COMP%]{margin:1rem;display:flex;justify-content:center;font-weight:600;font-size:1.1rem;font-family:cursive}.next[_ngcontent-%COMP%]   .next-step[_ngcontent-%COMP%]{color:#0c3823}.user-image[_ngcontent-%COMP%]{height:100%;width:100%;border-radius:5px}#userImg[_ngcontent-%COMP%]{display:none}@keyframes _ngcontent-%COMP%_rotate{to{transform:rotate(1turn)}}.invalid-video-card[_ngcontent-%COMP%]{position:relative;z-index:0;width:100%;height:100%;border-radius:10px;overflow:hidden;padding:.3rem;display:flex;align-items:center;font-family:sans-serif;font-weight:700}.invalid-video-card[_ngcontent-%COMP%]:before{content:"";position:absolute;z-index:-2;left:-50%;top:-50%;width:200%;height:200%;background-color:#d53e33;background-repeat:no-repeat;background-size:50% 50%,50% 50%;background-position:0 0,100% 0,100% 100%,0 100%;background-image:linear-gradient(#d53e33,#d53e33),linear-gradient(#d53e33,#d53e33),linear-gradient(#d53e33,#d53e33),linear-gradient(#d53e33,#fff);animation:_ngcontent-%COMP%_rotate 4s linear infinite}.invalid-video-card[_ngcontent-%COMP%]:after{content:"";position:absolute;z-index:-1;left:6px;top:6px;width:calc(100% - 12px);height:calc(100% - 12px);background:white;border-radius:5px}.valid-video-card[_ngcontent-%COMP%]{position:relative;z-index:0;width:100%;height:100%;border-radius:10px;overflow:hidden;padding:.3rem;display:flex;align-items:center;font-family:sans-serif;font-weight:700}.valid-video-card[_ngcontent-%COMP%]:before{content:"";position:absolute;z-index:-2;left:-50%;top:-50%;width:200%;height:200%;background-color:#399953;background-repeat:no-repeat;background-size:50% 50%,50% 50%;background-position:0 0,100% 0,100% 100%,0 100%;background-image:linear-gradient(#399953,#399953),linear-gradient(#399953,#399953),linear-gradient(#399953,#399953),linear-gradient(#399953,#fff);animation:_ngcontent-%COMP%_rotate 4s linear infinite}.valid-video-card[_ngcontent-%COMP%]:after{content:"";position:absolute;z-index:-1;left:6px;top:6px;width:calc(100% - 12px);height:calc(100% - 12px);background:white;border-radius:5px}.loading-video-card[_ngcontent-%COMP%]{position:relative;z-index:0;width:100%;height:100%;border-radius:10px;overflow:hidden;padding:.3rem;display:flex;align-items:center;font-family:sans-serif;font-weight:700}.loading-video-card[_ngcontent-%COMP%]:before{content:"";position:absolute;z-index:-2;left:-50%;top:-50%;width:200%;height:200%;background-color:#fff;background-repeat:no-repeat;background-size:50% 50%,50% 50%;background-position:0 0,100% 0,100% 100%,0 100%;background-image:linear-gradient(#fff,#fff),linear-gradient(#fff,#fff),linear-gradient(#fff,#fff),linear-gradient(#fff,#fff);animation:_ngcontent-%COMP%_rotate 4s linear infinite}.loading-video-card[_ngcontent-%COMP%]:after{content:"";position:absolute;z-index:-1;left:6px;top:6px;width:calc(100% - 12px);height:calc(100% - 12px);background:white;border-radius:5px}']})}return t})();class Db{static equals(n,e,r){return r?this.resolveFieldData(n,r)===this.resolveFieldData(e,r):this.equalsByValue(n,e)}static equalsByValue(n,e){if(n===e)return!0;if(n&&e&&"object"==typeof n&&"object"==typeof e){var o,s,a,r=Array.isArray(n),i=Array.isArray(e);if(r&&i){if((s=n.length)!=e.length)return!1;for(o=s;0!=o--;)if(!this.equalsByValue(n[o],e[o]))return!1;return!0}if(r!=i)return!1;var u=this.isDate(n),c=this.isDate(e);if(u!=c)return!1;if(u&&c)return n.getTime()==e.getTime();var l=n instanceof RegExp,d=e instanceof RegExp;if(l!=d)return!1;if(l&&d)return n.toString()==e.toString();var f=Object.keys(n);if((s=f.length)!==Object.keys(e).length)return!1;for(o=s;0!=o--;)if(!Object.prototype.hasOwnProperty.call(e,f[o]))return!1;for(o=s;0!=o--;)if(!this.equalsByValue(n[a=f[o]],e[a]))return!1;return!0}return n!=n&&e!=e}static resolveFieldData(n,e){if(n&&e){if(this.isFunction(e))return e(n);if(-1==e.indexOf("."))return n[e];{let r=e.split("."),i=n;for(let o=0,s=r.length;o<s;++o){if(null==i)return null;i=i[r[o]]}return i}}return null}static isFunction(n){return!!(n&&n.constructor&&n.call&&n.apply)}static reorderArray(n,e,r){n&&e!==r&&(r>=n.length&&(r%=n.length,e%=n.length),n.splice(r,0,n.splice(e,1)[0]))}static insertIntoOrderedArray(n,e,r,i){if(r.length>0){let o=!1;for(let s=0;s<r.length;s++)if(this.findIndexInList(r[s],i)>e){r.splice(s,0,n),o=!0;break}o||r.push(n)}else r.push(n)}static findIndexInList(n,e){let r=-1;if(e)for(let i=0;i<e.length;i++)if(e[i]==n){r=i;break}return r}static contains(n,e){if(null!=n&&e&&e.length)for(let r of e)if(this.equals(n,r))return!0;return!1}static removeAccents(n){return n&&n.search(/[\xC0-\xFF]/g)>-1&&(n=n.replace(/[\xC0-\xC5]/g,"A").replace(/[\xC6]/g,"AE").replace(/[\xC7]/g,"C").replace(/[\xC8-\xCB]/g,"E").replace(/[\xCC-\xCF]/g,"I").replace(/[\xD0]/g,"D").replace(/[\xD1]/g,"N").replace(/[\xD2-\xD6\xD8]/g,"O").replace(/[\xD9-\xDC]/g,"U").replace(/[\xDD]/g,"Y").replace(/[\xDE]/g,"P").replace(/[\xE0-\xE5]/g,"a").replace(/[\xE6]/g,"ae").replace(/[\xE7]/g,"c").replace(/[\xE8-\xEB]/g,"e").replace(/[\xEC-\xEF]/g,"i").replace(/[\xF1]/g,"n").replace(/[\xF2-\xF6\xF8]/g,"o").replace(/[\xF9-\xFC]/g,"u").replace(/[\xFE]/g,"p").replace(/[\xFD\xFF]/g,"y")),n}static isDate(n){return"[object Date]"===Object.prototype.toString.call(n)}static isEmpty(n){return null==n||""===n||Array.isArray(n)&&0===n.length||!this.isDate(n)&&"object"==typeof n&&0===Object.keys(n).length}static isNotEmpty(n){return!this.isEmpty(n)}static compare(n,e,r,i=1){let o=-1;const s=this.isEmpty(n),a=this.isEmpty(e);return o=s&&a?0:s?i:a?-i:"string"==typeof n&&"string"==typeof e?n.localeCompare(e,r,{numeric:!0}):n<e?-1:n>e?1:0,o}static sort(n,e,r=1,i,o=1){return(1===o?r:o)*Db.compare(n,e,i,r)}static merge(n,e){if(null!=n||null!=e)return null!=n&&"object"!=typeof n||null!=e&&"object"!=typeof e?null!=n&&"string"!=typeof n||null!=e&&"string"!=typeof e?e||n:[n||"",e||""].join(" "):{...n||{},...e||{}}}static isPrintableCharacter(n=""){return this.isNotEmpty(n)&&1===n.length&&n.match(/\S| /)}static getItemValue(n,...e){return this.isFunction(n)?n(...e):n}static findLastIndex(n,e){let r=-1;if(this.isNotEmpty(n))try{r=n.findLastIndex(e)}catch{r=n.lastIndexOf([...n].reverse().find(e))}return r}static findLast(n,e){let r;if(this.isNotEmpty(n))try{r=n.findLast(e)}catch{r=[...n].reverse().find(e)}return r}}var WR=0;!function UY(){let t=[];const i=o=>o&&parseInt(o.style.zIndex,10)||0}();const HY=["*"];let zR=(()=>{class t{label;spin=!1;styleClass;role;ariaLabel;ariaHidden;ngOnInit(){this.getAttributes()}getAttributes(){const e=Db.isEmpty(this.label);this.role=e?void 0:"img",this.ariaLabel=e?void 0:this.label,this.ariaHidden=e}getClassNames(){return`p-icon ${this.styleClass?this.styleClass+" ":""}${this.spin?"p-icon-spin":""}`}static \u0275fac=function(r){return new(r||t)};static \u0275cmp=an({type:t,selectors:[["ng-component"]],hostAttrs:[1,"p-element","p-icon-wrapper"],inputs:{label:"label",spin:"spin",styleClass:"styleClass"},standalone:!0,features:[Na],ngContentSelectors:HY,decls:1,vars:0,template:function(r,i){1&r&&(Ma(),_o(0))},encapsulation:2,changeDetection:0})}return t})(),GR=(()=>{class t extends zR{pathId;ngOnInit(){this.pathId="url(#"+function VY(t="pn_id_"){return`${t}${++WR}`}()+")"}static \u0275fac=function(){let e;return function(i){return(e||(e=$t(t)))(i||t)}}();static \u0275cmp=an({type:t,selectors:[["SpinnerIcon"]],standalone:!0,features:[Ye,Na],decls:6,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M6.99701 14C5.85441 13.999 4.72939 13.7186 3.72012 13.1832C2.71084 12.6478 1.84795 11.8737 1.20673 10.9284C0.565504 9.98305 0.165424 8.89526 0.041387 7.75989C-0.0826496 6.62453 0.073125 5.47607 0.495122 4.4147C0.917119 3.35333 1.59252 2.4113 2.46241 1.67077C3.33229 0.930247 4.37024 0.413729 5.4857 0.166275C6.60117 -0.0811796 7.76026 -0.0520535 8.86188 0.251112C9.9635 0.554278 10.9742 1.12227 11.8057 1.90555C11.915 2.01493 11.9764 2.16319 11.9764 2.31778C11.9764 2.47236 11.915 2.62062 11.8057 2.73C11.7521 2.78503 11.688 2.82877 11.6171 2.85864C11.5463 2.8885 11.4702 2.90389 11.3933 2.90389C11.3165 2.90389 11.2404 2.8885 11.1695 2.85864C11.0987 2.82877 11.0346 2.78503 10.9809 2.73C9.9998 1.81273 8.73246 1.26138 7.39226 1.16876C6.05206 1.07615 4.72086 1.44794 3.62279 2.22152C2.52471 2.99511 1.72683 4.12325 1.36345 5.41602C1.00008 6.70879 1.09342 8.08723 1.62775 9.31926C2.16209 10.5513 3.10478 11.5617 4.29713 12.1803C5.48947 12.7989 6.85865 12.988 8.17414 12.7157C9.48963 12.4435 10.6711 11.7264 11.5196 10.6854C12.3681 9.64432 12.8319 8.34282 12.8328 7C12.8328 6.84529 12.8943 6.69692 13.0038 6.58752C13.1132 6.47812 13.2616 6.41667 13.4164 6.41667C13.5712 6.41667 13.7196 6.47812 13.8291 6.58752C13.9385 6.69692 14 6.84529 14 7C14 8.85651 13.2622 10.637 11.9489 11.9497C10.6356 13.2625 8.85432 14 6.99701 14Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(r,i){1&r&&(tg(),Z(0,"svg",0)(1,"g"),ht(2,"path",1),Q(),Z(3,"defs")(4,"clipPath",2),ht(5,"rect",3),Q()()()),2&r&&(Eo(i.getClassNames()),bt("aria-label",i.ariaLabel)("aria-hidden",i.ariaHidden)("role",i.role),Y(1),bt("clip-path",i.pathId),Y(3),K("id",i.pathId))},encapsulation:2})}return t})(),on=(()=>{class t{static zindex=1e3;static calculatedScrollbarWidth=null;static calculatedScrollbarHeight=null;static browser;static addClass(e,r){e&&r&&(e.classList?e.classList.add(r):e.className+=" "+r)}static addMultipleClasses(e,r){if(e&&r)if(e.classList){let i=r.trim().split(" ");for(let o=0;o<i.length;o++)e.classList.add(i[o])}else{let i=r.split(" ");for(let o=0;o<i.length;o++)e.className+=" "+i[o]}}static removeClass(e,r){e&&r&&(e.classList?e.classList.remove(r):e.className=e.className.replace(new RegExp("(^|\\b)"+r.split(" ").join("|")+"(\\b|$)","gi")," "))}static removeMultipleClasses(e,r){e&&r&&[r].flat().filter(Boolean).forEach(i=>i.split(" ").forEach(o=>this.removeClass(e,o)))}static hasClass(e,r){return!(!e||!r)&&(e.classList?e.classList.contains(r):new RegExp("(^| )"+r+"( |$)","gi").test(e.className))}static siblings(e){return Array.prototype.filter.call(e.parentNode.children,function(r){return r!==e})}static find(e,r){return Array.from(e.querySelectorAll(r))}static findSingle(e,r){return this.isElement(e)?e.querySelector(r):null}static index(e){let r=e.parentNode.childNodes,i=0;for(var o=0;o<r.length;o++){if(r[o]==e)return i;1==r[o].nodeType&&i++}return-1}static indexWithinGroup(e,r){let i=e.parentNode?e.parentNode.childNodes:[],o=0;for(var s=0;s<i.length;s++){if(i[s]==e)return o;i[s].attributes&&i[s].attributes[r]&&1==i[s].nodeType&&o++}return-1}static appendOverlay(e,r,i="self"){"self"!==i&&e&&r&&this.appendChild(e,r)}static alignOverlay(e,r,i="self",o=!0){e&&r&&(o&&(e.style.minWidth=`${t.getOuterWidth(r)}px`),"self"===i?this.relativePosition(e,r):this.absolutePosition(e,r))}static relativePosition(e,r){const i=v=>{if(v)return"relative"===getComputedStyle(v).getPropertyValue("position")?v:i(v.parentElement)},o=e.offsetParent?{width:e.offsetWidth,height:e.offsetHeight}:this.getHiddenElementDimensions(e),s=r.offsetHeight,a=r.getBoundingClientRect(),u=this.getWindowScrollTop(),c=this.getWindowScrollLeft(),l=this.getViewport(),f=i(e)?.getBoundingClientRect()||{top:-1*u,left:-1*c};let h,p;a.top+s+o.height>l.height?(h=a.top-f.top-o.height,e.style.transformOrigin="bottom",a.top+h<0&&(h=-1*a.top)):(h=s+a.top-f.top,e.style.transformOrigin="top");const g=a.left+o.width-l.width;p=o.width>l.width?-1*(a.left-f.left):g>0?a.left-f.left-g:a.left-f.left,e.style.top=h+"px",e.style.left=p+"px"}static absolutePosition(e,r){const i=e.offsetParent?{width:e.offsetWidth,height:e.offsetHeight}:this.getHiddenElementDimensions(e),o=i.height,s=i.width,a=r.offsetHeight,u=r.offsetWidth,c=r.getBoundingClientRect(),l=this.getWindowScrollTop(),d=this.getWindowScrollLeft(),f=this.getViewport();let h,p;c.top+a+o>f.height?(h=c.top+l-o,e.style.transformOrigin="bottom",h<0&&(h=l)):(h=a+c.top+l,e.style.transformOrigin="top"),p=c.left+s>f.width?Math.max(0,c.left+d+u-s):c.left+d,e.style.top=h+"px",e.style.left=p+"px"}static getParents(e,r=[]){return null===e.parentNode?r:this.getParents(e.parentNode,r.concat([e.parentNode]))}static getScrollableParents(e){let r=[];if(e){let i=this.getParents(e);const o=/(auto|scroll)/,s=a=>{let u=window.getComputedStyle(a,null);return o.test(u.getPropertyValue("overflow"))||o.test(u.getPropertyValue("overflowX"))||o.test(u.getPropertyValue("overflowY"))};for(let a of i){let u=1===a.nodeType&&a.dataset.scrollselectors;if(u){let c=u.split(",");for(let l of c){let d=this.findSingle(a,l);d&&s(d)&&r.push(d)}}9!==a.nodeType&&s(a)&&r.push(a)}}return r}static getHiddenElementOuterHeight(e){e.style.visibility="hidden",e.style.display="block";let r=e.offsetHeight;return e.style.display="none",e.style.visibility="visible",r}static getHiddenElementOuterWidth(e){e.style.visibility="hidden",e.style.display="block";let r=e.offsetWidth;return e.style.display="none",e.style.visibility="visible",r}static getHiddenElementDimensions(e){let r={};return e.style.visibility="hidden",e.style.display="block",r.width=e.offsetWidth,r.height=e.offsetHeight,e.style.display="none",e.style.visibility="visible",r}static scrollInView(e,r){let i=getComputedStyle(e).getPropertyValue("borderTopWidth"),o=i?parseFloat(i):0,s=getComputedStyle(e).getPropertyValue("paddingTop"),a=s?parseFloat(s):0,u=e.getBoundingClientRect(),l=r.getBoundingClientRect().top+document.body.scrollTop-(u.top+document.body.scrollTop)-o-a,d=e.scrollTop,f=e.clientHeight,h=this.getOuterHeight(r);l<0?e.scrollTop=d+l:l+h>f&&(e.scrollTop=d+l-f+h)}static fadeIn(e,r){e.style.opacity=0;let i=+new Date,o=0,s=function(){o=+e.style.opacity.replace(",",".")+((new Date).getTime()-i)/r,e.style.opacity=o,i=+new Date,+o<1&&(window.requestAnimationFrame&&requestAnimationFrame(s)||setTimeout(s,16))};s()}static fadeOut(e,r){var i=1,a=50/r;let u=setInterval(()=>{(i-=a)<=0&&(i=0,clearInterval(u)),e.style.opacity=i},50)}static getWindowScrollTop(){let e=document.documentElement;return(window.pageYOffset||e.scrollTop)-(e.clientTop||0)}static getWindowScrollLeft(){let e=document.documentElement;return(window.pageXOffset||e.scrollLeft)-(e.clientLeft||0)}static matches(e,r){var i=Element.prototype;return(i.matches||i.webkitMatchesSelector||i.mozMatchesSelector||i.msMatchesSelector||function(s){return-1!==[].indexOf.call(document.querySelectorAll(s),this)}).call(e,r)}static getOuterWidth(e,r){let i=e.offsetWidth;if(r){let o=getComputedStyle(e);i+=parseFloat(o.marginLeft)+parseFloat(o.marginRight)}return i}static getHorizontalPadding(e){let r=getComputedStyle(e);return parseFloat(r.paddingLeft)+parseFloat(r.paddingRight)}static getHorizontalMargin(e){let r=getComputedStyle(e);return parseFloat(r.marginLeft)+parseFloat(r.marginRight)}static innerWidth(e){let r=e.offsetWidth,i=getComputedStyle(e);return r+=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight),r}static width(e){let r=e.offsetWidth,i=getComputedStyle(e);return r-=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight),r}static getInnerHeight(e){let r=e.offsetHeight,i=getComputedStyle(e);return r+=parseFloat(i.paddingTop)+parseFloat(i.paddingBottom),r}static getOuterHeight(e,r){let i=e.offsetHeight;if(r){let o=getComputedStyle(e);i+=parseFloat(o.marginTop)+parseFloat(o.marginBottom)}return i}static getHeight(e){let r=e.offsetHeight,i=getComputedStyle(e);return r-=parseFloat(i.paddingTop)+parseFloat(i.paddingBottom)+parseFloat(i.borderTopWidth)+parseFloat(i.borderBottomWidth),r}static getWidth(e){let r=e.offsetWidth,i=getComputedStyle(e);return r-=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight)+parseFloat(i.borderLeftWidth)+parseFloat(i.borderRightWidth),r}static getViewport(){let e=window,r=document,i=r.documentElement,o=r.getElementsByTagName("body")[0];return{width:e.innerWidth||i.clientWidth||o.clientWidth,height:e.innerHeight||i.clientHeight||o.clientHeight}}static getOffset(e){var r=e.getBoundingClientRect();return{top:r.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),left:r.left+(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0)}}static replaceElementWith(e,r){let i=e.parentNode;if(!i)throw"Can't replace element";return i.replaceChild(r,e)}static getUserAgent(){if(navigator&&this.isClient())return navigator.userAgent}static isIE(){var e=window.navigator.userAgent;return e.indexOf("MSIE ")>0||(e.indexOf("Trident/")>0?(e.indexOf("rv:"),!0):e.indexOf("Edge/")>0)}static isIOS(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}static isAndroid(){return/(android)/i.test(navigator.userAgent)}static isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0}static appendChild(e,r){if(this.isElement(r))r.appendChild(e);else{if(!(r&&r.el&&r.el.nativeElement))throw"Cannot append "+r+" to "+e;r.el.nativeElement.appendChild(e)}}static removeChild(e,r){if(this.isElement(r))r.removeChild(e);else{if(!r.el||!r.el.nativeElement)throw"Cannot remove "+e+" from "+r;r.el.nativeElement.removeChild(e)}}static removeElement(e){"remove"in Element.prototype?e.remove():e.parentNode.removeChild(e)}static isElement(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName}static calculateScrollbarWidth(e){if(e){let r=getComputedStyle(e);return e.offsetWidth-e.clientWidth-parseFloat(r.borderLeftWidth)-parseFloat(r.borderRightWidth)}{if(null!==this.calculatedScrollbarWidth)return this.calculatedScrollbarWidth;let r=document.createElement("div");r.className="p-scrollbar-measure",document.body.appendChild(r);let i=r.offsetWidth-r.clientWidth;return document.body.removeChild(r),this.calculatedScrollbarWidth=i,i}}static calculateScrollbarHeight(){if(null!==this.calculatedScrollbarHeight)return this.calculatedScrollbarHeight;let e=document.createElement("div");e.className="p-scrollbar-measure",document.body.appendChild(e);let r=e.offsetHeight-e.clientHeight;return document.body.removeChild(e),this.calculatedScrollbarWidth=r,r}static invokeElementMethod(e,r,i){e[r].apply(e,i)}static clearSelection(){if(window.getSelection)window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().rangeCount>0&&window.getSelection().getRangeAt(0).getClientRects().length>0&&window.getSelection().removeAllRanges();else if(document.selection&&document.selection.empty)try{document.selection.empty()}catch{}}static getBrowser(){if(!this.browser){let e=this.resolveUserAgent();this.browser={},e.browser&&(this.browser[e.browser]=!0,this.browser.version=e.version),this.browser.chrome?this.browser.webkit=!0:this.browser.webkit&&(this.browser.safari=!0)}return this.browser}static resolveUserAgent(){let e=navigator.userAgent.toLowerCase(),r=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:r[1]||"",version:r[2]||"0"}}static isInteger(e){return Number.isInteger?Number.isInteger(e):"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}static isHidden(e){return!e||null===e.offsetParent}static isVisible(e){return e&&null!=e.offsetParent}static isExist(e){return null!==e&&typeof e<"u"&&e.nodeName&&e.parentNode}static focus(e,r){e&&document.activeElement!==e&&e.focus(r)}static getFocusableElements(e,r=""){let i=this.find(e,`button:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${r},\n                [href][clientHeight][clientWidth]:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${r},\n                input:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${r},\n                select:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${r},\n                textarea:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${r},\n                [tabIndex]:not([tabIndex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${r},\n                [contenteditable]:not([tabIndex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${r}`),o=[];for(let s of i)"none"!=getComputedStyle(s).display&&"hidden"!=getComputedStyle(s).visibility&&o.push(s);return o}static getFirstFocusableElement(e,r){const i=this.getFocusableElements(e,r);return i.length>0?i[0]:null}static getLastFocusableElement(e,r){const i=this.getFocusableElements(e,r);return i.length>0?i[i.length-1]:null}static getNextFocusableElement(e,r=!1){const i=t.getFocusableElements(e);let o=0;if(i&&i.length>0){const s=i.indexOf(i[0].ownerDocument.activeElement);r?o=-1==s||0===s?i.length-1:s-1:-1!=s&&s!==i.length-1&&(o=s+1)}return i[o]}static generateZIndex(){return this.zindex=this.zindex||999,++this.zindex}static getSelection(){return window.getSelection?window.getSelection().toString():document.getSelection?document.getSelection().toString():document.selection?document.selection.createRange().text:null}static getTargetElement(e,r){if(!e)return null;switch(e){case"document":return document;case"window":return window;case"@next":return r?.nextElementSibling;case"@prev":return r?.previousElementSibling;case"@parent":return r?.parentElement;case"@grandparent":return r?.parentElement.parentElement;default:const i=typeof e;if("string"===i)return document.querySelector(e);if("object"===i&&e.hasOwnProperty("nativeElement"))return this.isExist(e.nativeElement)?e.nativeElement:void 0;const s=(a=e)&&a.constructor&&a.call&&a.apply?e():e;return s&&9===s.nodeType||this.isExist(s)?s:null}var a}static isClient(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}static getAttribute(e,r){if(e){const i=e.getAttribute(r);return isNaN(i)?"true"===i||"false"===i?"true"===i:i:+i}}static calculateBodyScrollbarWidth(){return window.innerWidth-document.documentElement.offsetWidth}static blockBodyScroll(e="p-overflow-hidden"){document.body.style.setProperty("--scrollbar-width",this.calculateBodyScrollbarWidth()+"px"),this.addClass(document.body,e)}static unblockBodyScroll(e="p-overflow-hidden"){document.body.style.removeProperty("--scrollbar-width"),this.removeClass(document.body,e)}}return t})(),jY=(()=>{class t{document;platformId;renderer;el;zone;config;constructor(e,r,i,o,s,a){this.document=e,this.platformId=r,this.renderer=i,this.el=o,this.zone=s,this.config=a}animationListener;mouseDownListener;timeout;ngAfterViewInit(){Av(this.platformId)&&this.config&&this.config.ripple&&this.zone.runOutsideAngular(()=>{this.create(),this.mouseDownListener=this.renderer.listen(this.el.nativeElement,"mousedown",this.onMouseDown.bind(this))})}onMouseDown(e){let r=this.getInk();if(!r||"none"===this.document.defaultView?.getComputedStyle(r,null).display)return;if(on.removeClass(r,"p-ink-active"),!on.getHeight(r)&&!on.getWidth(r)){let a=Math.max(on.getOuterWidth(this.el.nativeElement),on.getOuterHeight(this.el.nativeElement));r.style.height=a+"px",r.style.width=a+"px"}let i=on.getOffset(this.el.nativeElement),o=e.pageX-i.left+this.document.body.scrollTop-on.getWidth(r)/2,s=e.pageY-i.top+this.document.body.scrollLeft-on.getHeight(r)/2;this.renderer.setStyle(r,"top",s+"px"),this.renderer.setStyle(r,"left",o+"px"),on.addClass(r,"p-ink-active"),this.timeout=setTimeout(()=>{let a=this.getInk();a&&on.removeClass(a,"p-ink-active")},401)}getInk(){const e=this.el.nativeElement.children;for(let r=0;r<e.length;r++)if("string"==typeof e[r].className&&-1!==e[r].className.indexOf("p-ink"))return e[r];return null}resetInk(){let e=this.getInk();e&&on.removeClass(e,"p-ink-active")}onAnimationEnd(e){this.timeout&&clearTimeout(this.timeout),on.removeClass(e.currentTarget,"p-ink-active")}create(){let e=this.renderer.createElement("span");this.renderer.addClass(e,"p-ink"),this.renderer.appendChild(this.el.nativeElement,e),this.renderer.setAttribute(e,"aria-hidden","true"),this.renderer.setAttribute(e,"role","presentation"),this.animationListener||(this.animationListener=this.renderer.listen(e,"animationend",this.onAnimationEnd.bind(this)))}remove(){let e=this.getInk();e&&(this.mouseDownListener&&this.mouseDownListener(),this.animationListener&&this.animationListener(),this.mouseDownListener=null,this.animationListener=null,on.removeElement(e))}ngOnDestroy(){this.config&&this.config.ripple&&this.remove()}static \u0275fac=function(r){return new(r||t)(F(Fn),F(yo),F(si),F(en),F(rt),F(Jz,8))};static \u0275dir=ge({type:t,selectors:[["","pRipple",""]],hostAttrs:[1,"p-ripple","p-element"]})}return t})(),WY=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=_t({type:t});static \u0275inj=yt({imports:[Kn]})}return t})();function zY(t,n){1&t&&Vi(0)}function GY(t,n){if(1&t&&ht(0,"span",8),2&t){const e=qe(3);Eo("p-button-loading-icon pi-spin "+e.loadingIcon),K("ngClass",e.iconClass()),bt("aria-hidden",!0)("data-pc-section","loadingicon")}}function $Y(t,n){1&t&&ht(0,"SpinnerIcon",9),2&t&&(K("styleClass",qe(3).spinnerIconClass())("spin",!0),bt("aria-hidden",!0)("data-pc-section","loadingicon"))}function qY(t,n){if(1&t&&(bo(0),de(1,GY,1,5,"span",6),de(2,$Y,1,4,"SpinnerIcon",7),wo()),2&t){const e=qe(2);Y(1),K("ngIf",e.loadingIcon),Y(1),K("ngIf",!e.loadingIcon)}}function KY(t,n){}function YY(t,n){1&t&&de(0,KY,0,0,"ng-template")}function XY(t,n){if(1&t&&(Z(0,"span",10),de(1,YY,1,0,null,1),Q()),2&t){const e=qe(2);K("ngClass",e.iconClass()),bt("aria-hidden",!0)("data-pc-section","loadingicon"),Y(1),K("ngTemplateOutlet",e.loadingIconTemplate)}}function ZY(t,n){if(1&t&&(bo(0),de(1,qY,3,2,"ng-container",2),de(2,XY,2,4,"span",5),wo()),2&t){const e=qe();Y(1),K("ngIf",!e.loadingIconTemplate),Y(1),K("ngIf",e.loadingIconTemplate)}}function QY(t,n){if(1&t&&ht(0,"span",8),2&t){const e=qe(2);Eo(e.icon),K("ngClass",e.iconClass()),bt("data-pc-section","icon")}}function JY(t,n){}function eX(t,n){1&t&&de(0,JY,0,0,"ng-template",12),2&t&&K("ngIf",!qe(3).icon)}function tX(t,n){if(1&t&&(Z(0,"span",8),de(1,eX,1,1,null,1),Q()),2&t){const e=qe(2);K("ngClass",e.iconClass()),bt("data-pc-section","icon"),Y(1),K("ngTemplateOutlet",e.iconTemplate)}}function nX(t,n){if(1&t&&(bo(0),de(1,QY,1,4,"span",6),de(2,tX,2,3,"span",11),wo()),2&t){const e=qe();Y(1),K("ngIf",e.icon&&!e.iconTemplate),Y(1),K("ngIf",!e.icon&&e.iconTemplate)}}function rX(t,n){if(1&t&&(Z(0,"span",13),He(1),Q()),2&t){const e=qe();bt("aria-hidden",e.icon&&!e.label)("data-pc-section","label"),Y(1),ef(e.label)}}function iX(t,n){if(1&t&&(Z(0,"span",8),He(1),Q()),2&t){const e=qe();Eo(e.badgeClass),K("ngClass",e.badgeStyleClass()),bt("data-pc-section","badge"),Y(1),ef(e.badge)}}const oX=["*"];let $R=(()=>{class t{type="button";iconPos="left";icon;badge;label;disabled;loading=!1;loadingIcon;raised=!1;rounded=!1;text=!1;plain=!1;severity;outlined=!1;link=!1;size;style;styleClass;badgeClass;ariaLabel;onClick=new $e;onFocus=new $e;onBlur=new $e;contentTemplate;loadingIconTemplate;iconTemplate;templates;spinnerIconClass(){return Object.entries(this.iconClass()).filter(([,e])=>!!e).reduce((e,[r])=>e+` ${r}`,"p-button-loading-icon")}iconClass(){return{"p-button-icon":!0,"p-button-icon-left":"left"===this.iconPos&&this.label,"p-button-icon-right":"right"===this.iconPos&&this.label,"p-button-icon-top":"top"===this.iconPos&&this.label,"p-button-icon-bottom":"bottom"===this.iconPos&&this.label}}buttonClass(){return{"p-button p-component":!0,"p-button-icon-only":(this.icon||this.iconTemplate||this.loadingIcon||this.loadingIconTemplate)&&!this.label,"p-button-vertical":("top"===this.iconPos||"bottom"===this.iconPos)&&this.label,"p-disabled":this.disabled||this.loading,"p-button-loading":this.loading,"p-button-loading-label-only":this.loading&&!this.icon&&this.label&&!this.loadingIcon&&"left"===this.iconPos,"p-button-link":this.link,[`p-button-${this.severity}`]:this.severity,"p-button-raised":this.raised,"p-button-rounded":this.rounded,"p-button-text":this.text,"p-button-outlined":this.outlined,"p-button-sm":"small"===this.size,"p-button-lg":"large"===this.size,"p-button-plain":this.plain}}ngAfterContentInit(){this.templates?.forEach(e=>{switch(e.getType()){case"content":default:this.contentTemplate=e.template;break;case"icon":this.iconTemplate=e.template;break;case"loadingicon":this.loadingIconTemplate=e.template}})}badgeStyleClass(){return{"p-badge p-component":!0,"p-badge-no-gutter":this.badge&&1===String(this.badge).length}}static \u0275fac=function(r){return new(r||t)};static \u0275cmp=an({type:t,selectors:[["p-button"]],contentQueries:function(r,i,o){if(1&r&&ds(o,hy,4),2&r){let s;xr(s=Er())&&(i.templates=s)}},hostAttrs:[1,"p-element"],hostVars:2,hostBindings:function(r,i){2&r&&xo("p-disabled",i.disabled)},inputs:{type:"type",iconPos:"iconPos",icon:"icon",badge:"badge",label:"label",disabled:"disabled",loading:"loading",loadingIcon:"loadingIcon",raised:"raised",rounded:"rounded",text:"text",plain:"plain",severity:"severity",outlined:"outlined",link:"link",size:"size",style:"style",styleClass:"styleClass",badgeClass:"badgeClass",ariaLabel:"ariaLabel"},outputs:{onClick:"onClick",onFocus:"onFocus",onBlur:"onBlur"},ngContentSelectors:oX,decls:7,vars:14,consts:[["pRipple","",3,"ngStyle","disabled","ngClass","click","focus","blur"],[4,"ngTemplateOutlet"],[4,"ngIf"],["class","p-button-label",4,"ngIf"],[3,"ngClass","class",4,"ngIf"],["class","p-button-loading-icon",3,"ngClass",4,"ngIf"],[3,"class","ngClass",4,"ngIf"],[3,"styleClass","spin",4,"ngIf"],[3,"ngClass"],[3,"styleClass","spin"],[1,"p-button-loading-icon",3,"ngClass"],[3,"ngClass",4,"ngIf"],[3,"ngIf"],[1,"p-button-label"]],template:function(r,i){1&r&&(Ma(),Z(0,"button",0),Fe("click",function(s){return i.onClick.emit(s)})("focus",function(s){return i.onFocus.emit(s)})("blur",function(s){return i.onBlur.emit(s)}),_o(1),de(2,zY,1,0,"ng-container",1),de(3,ZY,3,2,"ng-container",2),de(4,nX,3,2,"ng-container",2),de(5,rX,2,3,"span",3),de(6,iX,2,5,"span",4),Q()),2&r&&(Eo(i.styleClass),K("ngStyle",i.style)("disabled",i.disabled||i.loading)("ngClass",i.buttonClass()),bt("type",i.type)("aria-label",i.ariaLabel)("data-pc-name","button")("data-pc-section","root"),Y(2),K("ngTemplateOutlet",i.contentTemplate),Y(1),K("ngIf",i.loading),Y(1),K("ngIf",!i.loading),Y(1),K("ngIf",!i.contentTemplate&&i.label),Y(1),K("ngIf",!i.contentTemplate&&i.badge))},dependencies:function(){return[To,Wi,Tc,Sc,jY,GR]},encapsulation:2,changeDetection:0})}return t})(),qR=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=_t({type:t});static \u0275inj=yt({imports:[Kn,WY,Yc,GR,Yc]})}return t})(),KR=(()=>{class t{constructor(e,r){this._renderer=e,this._elementRef=r,this.onChange=i=>{},this.onTouched=()=>{}}setProperty(e,r){this._renderer.setProperty(this._elementRef.nativeElement,e,r)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static#e=this.\u0275fac=function(r){return new(r||t)(F(si),F(en))};static#t=this.\u0275dir=ge({type:t})}return t})(),Ls=(()=>{class t extends KR{static#e=this.\u0275fac=function(){let e;return function(i){return(e||(e=$t(t)))(i||t)}}();static#t=this.\u0275dir=ge({type:t,features:[Ye]})}return t})();const Zr=new se("NgValueAccessor"),uX={provide:Zr,useExisting:ut(()=>vu),multi:!0},lX=new se("CompositionEventMode");let vu=(()=>{class t extends KR{constructor(e,r,i){super(e,r),this._compositionMode=i,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function cX(){const t=So()?So().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}())}writeValue(e){this.setProperty("value",e??"")}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}static#e=this.\u0275fac=function(r){return new(r||t)(F(si),F(en),F(lX,8))};static#t=this.\u0275dir=ge({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,i){1&r&&Fe("input",function(s){return i._handleInput(s.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(s){return i._compositionEnd(s.target.value)})},features:[gt([uX]),Ye]})}return t})();const In=new se("NgValidators"),Yo=new se("NgAsyncValidators");function iO(t){if(!t)return Xh;let n,e;return"string"==typeof t?(e="","^"!==t.charAt(0)&&(e+="^"),e+=t,"$"!==t.charAt(t.length-1)&&(e+="$"),n=new RegExp(e)):(e=t.toString(),n=t),r=>{if(function Ko(t){return null==t||("string"==typeof t||Array.isArray(t))&&0===t.length}(r.value))return null;const i=r.value;return n.test(i)?null:{pattern:{requiredPattern:e,actualValue:i}}}}function Xh(t){return null}function oO(t){return null!=t}function sO(t){return hc(t)?Jt(t):t}function aO(t){let n={};return t.forEach(e=>{n=null!=e?{...n,...e}:n}),0===Object.keys(n).length?null:n}function uO(t,n){return n.map(e=>e(t))}function cO(t){return t.map(n=>function fX(t){return!t.validate}(n)?n:e=>n.validate(e))}function Ib(t){return null!=t?function lO(t){if(!t)return null;const n=t.filter(oO);return 0==n.length?null:function(e){return aO(uO(e,n))}}(cO(t)):null}function Sb(t){return null!=t?function dO(t){if(!t)return null;const n=t.filter(oO);return 0==n.length?null:function(e){return function sX(...t){const n=Iw(t),{args:e,keys:r}=pS(t),i=new Lt(o=>{const{length:s}=e;if(!s)return void o.complete();const a=new Array(s);let u=s,c=s;for(let l=0;l<s;l++){let d=!1;er(e[l]).subscribe(Bt(o,f=>{d||(d=!0,c--),a[l]=f},()=>u--,void 0,()=>{(!u||!d)&&(c||o.next(r?mS(r,a):a),o.complete())}))}});return n?i.pipe(gS(n)):i}(uO(e,n).map(sO)).pipe(at(aO))}}(cO(t)):null}function fO(t,n){return null===t?[n]:Array.isArray(t)?[...t,n]:[t,n]}function hO(t){return t._rawValidators}function pO(t){return t._rawAsyncValidators}function Tb(t){return t?Array.isArray(t)?t:[t]:[]}function Zh(t,n){return Array.isArray(t)?t.includes(n):t===n}function gO(t,n){const e=Tb(n);return Tb(t).forEach(i=>{Zh(e,i)||e.push(i)}),e}function mO(t,n){return Tb(n).filter(e=>!Zh(t,e))}class vO{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=Ib(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=Sb(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,e){return!!this.control&&this.control.hasError(n,e)}getError(n,e){return this.control?this.control.getError(n,e):null}}class Hn extends vO{get formDirective(){return null}get path(){return null}}class Xo extends vO{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class yO{constructor(n){this._cd=n}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let Qh=(()=>{class t extends yO{constructor(e){super(e)}static#e=this.\u0275fac=function(r){return new(r||t)(F(Xo,2))};static#t=this.\u0275dir=ge({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,i){2&r&&xo("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[Ye]})}return t})();const Rl="VALID",ep="INVALID",yu="PENDING",Ol="DISABLED";function Rb(t){return(tp(t)?t.validators:t)||null}function Ob(t,n){return(tp(n)?n.asyncValidators:t)||null}function tp(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}class CO{constructor(n,e){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(n),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get valid(){return this.status===Rl}get invalid(){return this.status===ep}get pending(){return this.status==yu}get disabled(){return this.status===Ol}get enabled(){return this.status!==Ol}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(gO(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(gO(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(mO(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(mO(n,this._rawAsyncValidators))}hasValidator(n){return Zh(this._rawValidators,n)}hasAsyncValidator(n){return Zh(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){this.touched=!0,this._parent&&!n.onlySelf&&this._parent.markAsTouched(n)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(n=>n.markAllAsTouched())}markAsUntouched(n={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}markAsDirty(n={}){this.pristine=!1,this._parent&&!n.onlySelf&&this._parent.markAsDirty(n)}markAsPristine(n={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}markAsPending(n={}){this.status=yu,!1!==n.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!n.onlySelf&&this._parent.markAsPending(n)}disable(n={}){const e=this._parentMarkedDirty(n.onlySelf);this.status=Ol,this.errors=null,this._forEachChild(r=>{r.disable({...n,onlySelf:!0})}),this._updateValue(),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...n,skipPristineCheck:e}),this._onDisabledChange.forEach(r=>r(!0))}enable(n={}){const e=this._parentMarkedDirty(n.onlySelf);this.status=Rl,this._forEachChild(r=>{r.enable({...n,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors({...n,skipPristineCheck:e}),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(n){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Rl||this.status===yu)&&this._runAsyncValidator(n.emitEvent)),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(n)}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ol:Rl}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n){if(this.asyncValidator){this.status=yu,this._hasOwnPendingAsyncValidator=!0;const e=sO(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:n})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(n,e={}){this.errors=n,this._updateControlsErrors(!1!==e.emitEvent)}get(n){let e=n;return null==e||(Array.isArray(e)||(e=e.split(".")),0===e.length)?null:e.reduce((r,i)=>r&&r._find(i),this)}getError(n,e){const r=e?this.get(e):this;return r&&r.errors?r.errors[n]:null}hasError(n,e){return!!this.getError(n,e)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(n)}_initObservables(){this.valueChanges=new $e,this.statusChanges=new $e}_calculateStatus(){return this._allControlsDisabled()?Ol:this.errors?ep:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(yu)?yu:this._anyControlsHaveStatus(ep)?ep:Rl}_anyControlsHaveStatus(n){return this._anyControls(e=>e.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n={}){this.pristine=!this._anyControlsDirty(),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}_updateTouched(n={}){this.touched=this._anyControlsTouched(),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){tp(n)&&null!=n.updateOn&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){return!n&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=function vX(t){return Array.isArray(t)?Ib(t):t||null}(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=function yX(t){return Array.isArray(t)?Sb(t):t||null}(this._rawAsyncValidators)}}class np extends CO{constructor(n,e,r){super(Rb(e),Ob(r,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(n,e){return this.controls[n]?this.controls[n]:(this.controls[n]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(n,e,r={}){this.registerControl(n,e),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(n,e={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(n,e,r={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],e&&this.registerControl(n,e),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,e={}){(function _O(t,n,e){t._forEachChild((r,i)=>{if(void 0===e[i])throw new $(1002,"")})})(this,0,n),Object.keys(n).forEach(r=>{(function wO(t,n,e){const r=t.controls;if(!(n?Object.keys(r):r).length)throw new $(1e3,"");if(!r[e])throw new $(1001,"")})(this,!0,r),this.controls[r].setValue(n[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){null!=n&&(Object.keys(n).forEach(r=>{const i=this.controls[r];i&&i.patchValue(n[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n={},e={}){this._forEachChild((r,i)=>{r.reset(n?n[i]:null,{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(n,e,r)=>(n[r]=e.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(e,r)=>!!r._syncPendingControls()||e);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(e=>{const r=this.controls[e];r&&n(r,e)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(const[e,r]of Object.entries(this.controls))if(this.contains(e)&&n(r))return!0;return!1}_reduceValue(){return this._reduceChildren({},(e,r,i)=>((r.enabled||this.disabled)&&(e[i]=r.value),e))}_reduceChildren(n,e){let r=n;return this._forEachChild((i,o)=>{r=e(r,i,o)}),r}_allControlsDisabled(){for(const n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}}const Bs=new se("CallSetDisabledState",{providedIn:"root",factory:()=>Nl}),Nl="always";function kl(t,n,e=Nl){(function Nb(t,n){const e=hO(t);null!==n.validator?t.setValidators(fO(e,n.validator)):"function"==typeof e&&t.setValidators([e]);const r=pO(t);null!==n.asyncValidator?t.setAsyncValidators(fO(r,n.asyncValidator)):"function"==typeof r&&t.setAsyncValidators([r]);const i=()=>t.updateValueAndValidity();op(n._rawValidators,i),op(n._rawAsyncValidators,i)})(t,n),n.valueAccessor.writeValue(t.value),(t.disabled||"always"===e)&&n.valueAccessor.setDisabledState?.(t.disabled),function _X(t,n){n.valueAccessor.registerOnChange(e=>{t._pendingValue=e,t._pendingChange=!0,t._pendingDirty=!0,"change"===t.updateOn&&xO(t,n)})}(t,n),function xX(t,n){const e=(r,i)=>{n.valueAccessor.writeValue(r),i&&n.viewToModelUpdate(r)};t.registerOnChange(e),n._registerOnDestroy(()=>{t._unregisterOnChange(e)})}(t,n),function CX(t,n){n.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,"blur"===t.updateOn&&t._pendingChange&&xO(t,n),"submit"!==t.updateOn&&t.markAsTouched()})}(t,n),function wX(t,n){if(n.valueAccessor.setDisabledState){const e=r=>{n.valueAccessor.setDisabledState(r)};t.registerOnDisabledChange(e),n._registerOnDestroy(()=>{t._unregisterOnDisabledChange(e)})}}(t,n)}function ip(t,n,e=!0){const r=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(r),n.valueAccessor.registerOnTouched(r)),function sp(t,n){let e=!1;if(null!==t){if(null!==n.validator){const i=hO(t);if(Array.isArray(i)&&i.length>0){const o=i.filter(s=>s!==n.validator);o.length!==i.length&&(e=!0,t.setValidators(o))}}if(null!==n.asyncValidator){const i=pO(t);if(Array.isArray(i)&&i.length>0){const o=i.filter(s=>s!==n.asyncValidator);o.length!==i.length&&(e=!0,t.setAsyncValidators(o))}}}const r=()=>{};return op(n._rawValidators,r),op(n._rawAsyncValidators,r),e}(t,n),t&&(n._invokeOnDestroyCallbacks(),t._registerOnCollectionChange(()=>{}))}function op(t,n){t.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(n)})}function xO(t,n){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function Pb(t,n){if(!t.hasOwnProperty("model"))return!1;const e=t.model;return!!e.isFirstChange()||!Object.is(n,e.currentValue)}function Fb(t,n){if(!n)return null;let e,r,i;return Array.isArray(n),n.forEach(o=>{o.constructor===vu?e=o:function IX(t){return Object.getPrototypeOf(t.constructor)===Ls}(o)?r=o:i=o}),i||r||e||null}function IO(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}function SO(t){return"object"==typeof t&&null!==t&&2===Object.keys(t).length&&"value"in t&&"disabled"in t}const Bb=class extends CO{constructor(n=null,e,r){super(Rb(e),Ob(r,e)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(n),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),tp(e)&&(e.nonNullable||e.initialValueIsDefault)&&(this.defaultValue=SO(n)?n.value:n)}setValue(n,e={}){this.value=this._pendingValue=n,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(r=>r(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(n,e={}){this.setValue(n,e)}reset(n=this.defaultValue,e={}){this._applyFormState(n),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){IO(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){IO(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(n){SO(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}},RX={provide:Xo,useExisting:ut(()=>Fl)},AO=(()=>Promise.resolve())();let Fl=(()=>{class t extends Xo{constructor(e,r,i,o,s,a){super(),this._changeDetectorRef=s,this.callSetDisabledState=a,this.control=new Bb,this._registered=!1,this.name="",this.update=new $e,this._parent=e,this._setValidators(r),this._setAsyncValidators(i),this.valueAccessor=Fb(0,o)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){const r=e.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),Pb(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){kl(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){AO.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){const r=e.isDisabled.currentValue,i=0!==r&&function Ba(t){return"boolean"==typeof t?t:null!=t&&"false"!==t}(r);AO.then(()=>{i&&!this.control.disabled?this.control.disable():!i&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?function rp(t,n){return[...n.path,t]}(e,this._parent):[e]}static#e=this.\u0275fac=function(r){return new(r||t)(F(Hn,9),F(In,10),F(Yo,10),F(Zr,10),F(fs,8),F(Bs,8))};static#t=this.\u0275dir=ge({type:t,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[gt([RX]),Ye,rr]})}return t})(),OO=(()=>{class t{static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275mod=_t({type:t});static#n=this.\u0275inj=yt({})}return t})();const Vb=new se("NgModelWithFormControlWarning"),LX={provide:Xo,useExisting:ut(()=>Ub)};let Ub=(()=>{class t extends Xo{set isDisabled(e){}static#e=this._ngModelWarningSentOnce=!1;constructor(e,r,i,o,s){super(),this._ngModelWarningConfig=o,this.callSetDisabledState=s,this.update=new $e,this._ngModelWarningSent=!1,this._setValidators(e),this._setAsyncValidators(r),this.valueAccessor=Fb(0,i)}ngOnChanges(e){if(this._isControlChanged(e)){const r=e.form.previousValue;r&&ip(r,this,!1),kl(this.form,this,this.callSetDisabledState),this.form.updateValueAndValidity({emitEvent:!1})}Pb(e,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&ip(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_isControlChanged(e){return e.hasOwnProperty("form")}static#t=this.\u0275fac=function(r){return new(r||t)(F(In,10),F(Yo,10),F(Zr,10),F(Vb,8),F(Bs,8))};static#n=this.\u0275dir=ge({type:t,selectors:[["","formControl",""]],inputs:{form:["formControl","form"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],features:[gt([LX]),Ye,rr]})}return t})(),Vs=(()=>{class t{constructor(){this._validator=Xh}ngOnChanges(e){if(this.inputName in e){const r=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):Xh,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return null!=e}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275dir=ge({type:t,features:[rr]})}return t})();const tZ={provide:In,useExisting:ut(()=>qb),multi:!0};let qb=(()=>{class t extends Vs{constructor(){super(...arguments),this.inputName="pattern",this.normalizeInput=e=>e,this.createValidator=e=>iO(e)}static#e=this.\u0275fac=function(){let e;return function(i){return(e||(e=$t(t)))(i||t)}}();static#t=this.\u0275dir=ge({type:t,selectors:[["","pattern","","formControlName",""],["","pattern","","formControl",""],["","pattern","","ngModel",""]],hostVars:1,hostBindings:function(r,i){2&r&&bt("pattern",i._enabled?i.pattern:null)},inputs:{pattern:"pattern"},features:[gt([tZ]),Ye]})}return t})(),qO=(()=>{class t{static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275mod=_t({type:t});static#n=this.\u0275inj=yt({imports:[OO]})}return t})(),KO=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:Bs,useValue:e.callSetDisabledState??Nl}]}}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275mod=_t({type:t});static#n=this.\u0275inj=yt({imports:[qO]})}return t})(),YO=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:Vb,useValue:e.warnOnNgModelWithFormControl??"always"},{provide:Bs,useValue:e.callSetDisabledState??Nl}]}}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275mod=_t({type:t});static#n=this.\u0275inj=yt({imports:[qO]})}return t})(),Kb=(()=>{class t{el;ngModel;cd;filled;constructor(e,r,i){this.el=e,this.ngModel=r,this.cd=i}ngAfterViewInit(){this.updateFilledState(),this.cd.detectChanges()}ngDoCheck(){this.updateFilledState()}onInput(){this.updateFilledState()}updateFilledState(){this.filled=this.el.nativeElement.value&&this.el.nativeElement.value.length||this.ngModel&&this.ngModel.model}static \u0275fac=function(r){return new(r||t)(F(en),F(Fl,8),F(fs))};static \u0275dir=ge({type:t,selectors:[["","pInputText",""]],hostAttrs:[1,"p-inputtext","p-component","p-element"],hostVars:2,hostBindings:function(r,i){1&r&&Fe("input",function(s){return i.onInput(s)}),2&r&&xo("p-filled",i.filled)}})}return t})(),Yb=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=_t({type:t});static \u0275inj=yt({imports:[Kn]})}return t})();function rZ(t,n){if(1&t&&(bo(0),ht(1,"span",2),wo()),2&t){const e=qe();Y(1),K("innerHTML",e.i.text,Y1)}}function iZ(t,n){1&t&&Vi(0)}const oZ=function(t){return{$implicit:t}};var Sn=function(t){return t[t.ing=0]="ing",t[t.pause=1]="pause",t[t.stop=2]="stop",t[t.done=3]="done",t}(Sn||{});let XO=(()=>{class t{constructor(e){this.ngZone=e,this.fns=[],this.commands=[],this.nextTime=0,this.ing=!1}start(){!0!==this.ing&&(this.ing=!0,this.nextTime=+new Date,this.ngZone.runOutsideAngular(()=>{this.process()}))}process(){for(;this.commands.length;)this.commands.shift()();let e=+new Date-this.nextTime;const r=1+Math.floor(e/100);e=100-e%100,this.nextTime+=100*r;for(let i=0,o=this.fns.length;i<o;i+=2){let s=this.fns[i+1];if(0===s)this.fns[i](r);else{s+=2*r-1;const a=Math.floor(s/20);a>0&&this.fns[i](a),this.fns[i+1]=s%20+1}}this.ing&&setTimeout(()=>this.process(),e)}add(e,r){return this.commands.push(()=>{this.fns.push(e),this.fns.push(1e3===r?1:0),this.ing=!0}),this}remove(e){return this.commands.push(()=>{const r=this.fns.indexOf(e);-1!==r&&this.fns.splice(r,2),this.ing=this.fns.length>0}),this}}return t.\u0275fac=function(e){return new(e||t)(pe(rt))},t.\u0275prov=fe({token:t,factory:t.\u0275fac}),t})(),ZO=(()=>{class t{constructor(e){this.locale=e,this.demand=!1,this.leftTime=0,this.format="HH:mm:ss",this.timezone="+0000",this.formatDate=({date:r,formatStr:i,timezone:o})=>RI(new Date(r),i,this.locale,o||this.timezone||"+0000")}}return t.\u0275fac=function(e){return new(e||t)(pe(Lr))},t.\u0275prov=fe({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),QO=(()=>{class t{constructor(e,r,i,o,s){this.locale=e,this.timer=r,this.defCog=i,this.cdr=o,this.ngZone=s,this.frequency=1e3,this._notify={},this.status=Sn.ing,this.isDestroy=!1,this.i={},this.left=0,this.event=new $e}set config(e){null!=e.notify&&!Array.isArray(e.notify)&&e.notify>0&&(e.notify=[e.notify]),this._config=e}get config(){return this._config}begin(){this.status=Sn.ing,this.callEvent("start")}restart(){this.status!==Sn.stop&&this.destroy(),this.init(),this.callEvent("restart")}stop(){this.status!==Sn.stop&&(this.status=Sn.stop,this.destroy(),this.callEvent("stop"))}pause(){this.status===Sn.stop||this.status===Sn.pause||(this.status=Sn.pause,this.callEvent("pause"))}resume(){this.status===Sn.stop||this.status!==Sn.pause||(this.status=Sn.ing,this.callEvent("resume"))}callEvent(e){this.event.emit({action:e,left:this.left,status:this.status,text:this.i.text})}init(){const{locale:e,defCog:r}=this,i=this.config={...new ZO(e),...r,...this.config},o=this.frequency=~i.format.indexOf("S")?100:1e3;this.status=i.demand?Sn.pause:Sn.ing,this.getLeft();const s=this.reflow;this.reflow=(a=0,u=!1)=>s.apply(this,[a,u]),Array.isArray(i.notify)&&i.notify.forEach(a=>{if(a<1)throw new Error("The notify config must be a positive integer.");a*=1e3,this._notify[a-=a%o]=!0}),this.timer.add(this.reflow,o).start(),this.reflow(0,!0)}destroy(){return this.timer.remove(this.reflow),this}reflow(e=0,r=!1){if(this.isDestroy)return;const{status:i,config:o,_notify:s}=this;if(!r&&i!==Sn.ing)return;let a=this.left=this.left-this.frequency*e;a<1&&(a=0),this.i={value:a,text:o.formatDate({date:a,formatStr:o.format,timezone:o.timezone})},"function"==typeof o.prettyText&&(this.i.text=o.prettyText(this.i.text)),this.cdr.detectChanges(),(0===o.notify||s[a])&&this.ngZone.run(()=>{this.callEvent("notify")}),0===a&&this.ngZone.run(()=>{this.status=Sn.done,this.destroy(),this.callEvent("done")})}getLeft(){const{config:e,frequency:r}=this;let i=1e3*e.leftTime;const o=e.stopTime;!i&&o&&(i=o-(new Date).getTime()),this.left=i-i%r}ngOnInit(){this.init(),this.config.demand||this.begin()}ngOnDestroy(){this.isDestroy=!0,this.destroy()}ngOnChanges(e){e.config.firstChange||this.restart()}}return t.\u0275fac=function(e){return new(e||t)(F(Lr),F(XO),F(ZO),F(fs),F(rt))},t.\u0275cmp=an({type:t,selectors:[["countdown"]],hostVars:2,hostBindings:function(e,r){2&e&&xo("count-down",!0)},inputs:{config:"config",render:"render"},outputs:{event:"event"},standalone:!0,features:[gt([XO]),rr,Na],decls:2,vars:5,consts:[[4,"ngIf"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"innerHTML"]],template:function(e,r){1&e&&(de(0,rZ,2,1,"ng-container",0),de(1,iZ,1,0,"ng-container",1)),2&e&&(K("ngIf",!r.render),Y(1),K("ngTemplateOutlet",r.render)("ngTemplateOutletContext",function iD(t,n,e,r){return oD(j(),Rn(),t,n,e,r)}(3,oZ,r.i)))},dependencies:[Kn,Wi,Tc],encapsulation:2,changeDetection:0}),t})(),sZ=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=_t({type:t}),t.\u0275inj=yt({imports:[QO]}),t})();function aZ(t,n){if(1&t){const e=fc();Z(0,"input",3,4),Fe("paste",function(i){return Ri(e),Oi(qe(2).handlePaste(i))})("keyup",function(i){const s=Ri(e).index;return Oi(qe(2).onKeyUp(i,s))})("input",function(i){return Ri(e),Oi(qe(2).onInput(i))})("keydown",function(i){const s=Ri(e).index;return Oi(qe(2).onKeyDown(i,s))}),Q()}if(2&t){const e=n.$implicit,r=n.index,i=qe(2);Tm("otp-input ",i.config.inputClass,""),K("pattern",i.config.allowNumbersOnly?"\\d*":"")("type",i.inputType)("placeholder",(null==i.config?null:i.config.placeholder)||"")("ngStyle",i.config.inputStyles)("formControl",i.otpForm.controls[e])("id",i.getBoxId(r))}}function uZ(t,n){if(1&t&&(Z(0,"div",1),de(1,aZ,2,9,"input",2),function lD(t,n){const e=Ue();let r;const i=t+ke;e.firstCreatePass?(r=function KV(t,n){if(n)for(let e=n.length-1;e>=0;e--){const r=n[e];if(t===r.name)return r}}(n,e.pipeRegistry),e.data[i]=r,r.onDestroy&&(e.destroyHooks??=[]).push(i,r.onDestroy)):r=e.data[i];const o=r.factory||(r.factory=ns(r.type)),a=jn(F);try{const u=od(!1),c=o();return od(u),function RB(t,n,e,r){e>=t.data.length&&(t.data[e]=null,t.blueprint[e]=null),n[e]=r}(e,j(),i,c),c}finally{jn(a)}}(2,"keys"),Q()),2&t){const e=qe();Tm("ng-otp-input-wrapper wrapper ",e.config.containerClass,""),Zd("id","c_",e.componentKey,""),K("ngStyle",e.config.containerStyles),Y(1),K("ngForOf",dD(2,6,null==e.otpForm?null:e.otpForm.controls))}}class bu{static ifTab(n){return this.ifKey(n,"Tab")}static ifDelete(n){return this.ifKey(n,"Delete;Del")}static ifBackspace(n){return this.ifKey(n,"Backspace")}static ifRightArrow(n){return this.ifKey(n,"ArrowRight;Right")}static ifLeftArrow(n){return this.ifKey(n,"ArrowLeft;Left")}static ifSpacebar(n){return this.ifKey(n,"Spacebar; ")}static ifKey(n,e){return e.split(";").some(i=>i===n.key)}}let Xb=(()=>{class t{transform(e){return Object.keys(e)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=Tn({name:"keys",type:t,pure:!0}),t})(),cZ=(()=>{class t{constructor(e,r){this.keysPipe=e,this.document=r,this.config={length:4},this.onInputChange=new $e,this.inputControls=new Array(this.config.length),this.componentKey=Math.random().toString(36).substring(2)+(new Date).getTime().toString(36)}get inputType(){return this.config?.isPasswordInput?"password":this.config?.allowNumbersOnly?"tel":"text"}ngOnInit(){this.otpForm=new np({});for(let e=0;e<this.config.length;e++)this.otpForm.addControl(this.getControlName(e),new Bb);this.otpForm.valueChanges.subscribe(e=>{this.keysPipe.transform(this.otpForm.controls).forEach(r=>{var i=this.otpForm.controls[r].value;i&&i.length>1&&(i.length>=this.config.length?this.setValue(i):this.rebuildValue())})})}ngAfterViewInit(){if(!this.config.disableAutoFocus){const e=this.document.getElementById(`c_${this.componentKey}`);if(e){const r=e.getElementsByClassName("otp-input")[0];r&&r.focus&&r.focus()}}}getControlName(e){return`ctrl_${e}`}onKeyDown(e,r){const i=this.getBoxId(r-1),o=this.getBoxId(r);return bu.ifSpacebar(e)?(e.preventDefault(),!1):bu.ifBackspace(e)?(e.target.value?this.clearInput(o,r):(this.clearInput(i,r-1),this.setSelected(i)),void this.rebuildValue()):void 0}onInput(e){if(this.config.allowNumbersOnly&&!this.validateNumber(this.currentVal?`${this.currentVal}${e.target.value}`:e.target.value))return e.target.value="",e.stopPropagation(),void e.preventDefault()}onKeyUp(e,r){bu.ifTab(e)&&(r-=1);const i=this.getBoxId(r+1),o=this.getBoxId(r-1),s=this.getBoxId(r);return bu.ifRightArrow(e)?(e.preventDefault(),void this.setSelected(i)):bu.ifLeftArrow(e)?(e.preventDefault(),void this.setSelected(o)):bu.ifDelete(e)?(e.target.value?this.clearInput(s,r):(this.clearInput(o,r-1),this.setSelected(o)),void this.rebuildValue()):void(e.target.value&&(this.ifValidKeyCode(e)&&this.setSelected(i),this.rebuildValue()))}validateNumber(e){return e&&/^[0-9]+$/.test(e)}getBoxId(e){return`otp_${e}_${this.componentKey}`}clearInput(e,r){let i=this.getControlName(r);this.otpForm.controls[i]?.setValue(null);const o=this.document.getElementById(e);o&&o instanceof HTMLInputElement&&(o.value=null)}setSelected(e){this.focusTo(e);const r=this.document.getElementById(e);r&&r.setSelectionRange&&setTimeout(()=>{r.setSelectionRange(0,1)},0)}ifValidKeyCode(e){const r=e.key;return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||/[a-zA-Z0-9-_]/.test(r)}focusTo(e){const r=this.document.getElementById(e);r&&r.focus()}setValue(e){if(!this.config.allowNumbersOnly||!isNaN(e)){if(this.otpForm.reset(),!e)return void this.rebuildValue();if(e=e.toString().replace(/\s/g,""),Array.from(e).forEach((i,o)=>{this.otpForm.get(this.getControlName(o))&&this.otpForm.get(this.getControlName(o)).setValue(i)}),!this.config.disableAutoFocus){const i=this.document.getElementById(`c_${this.componentKey}`);var r=e.length<this.config.length?e.length:this.config.length-1;let o=i.getElementsByClassName("otp-input")[r];o&&o.focus&&o.focus()}this.rebuildValue()}}rebuildValue(){let e="";this.keysPipe.transform(this.otpForm.controls).forEach(r=>{if(this.otpForm.controls[r].value){let i=this.otpForm.controls[r].value,o=i.length>1,s=!this.config.allowNumbersOnly&&this.config.letterCase&&("upper"==this.config.letterCase.toLocaleLowerCase()||"lower"==this.config.letterCase.toLocaleLowerCase());i=i[0];let a=s?"upper"==this.config.letterCase.toLocaleLowerCase()?i.toUpperCase():i.toLowerCase():i;s&&a==i?s=!1:i=a,e+=i,(o||s)&&this.otpForm.controls[r].setValue(i)}}),this.formCtrl?.setValue&&this.formCtrl.setValue(e),this.onInputChange.emit(e),this.currentVal=e}handlePaste(e){let r=e.clipboardData||window.clipboardData;if(r)var i=r.getData("Text");e.stopPropagation(),e.preventDefault(),i&&(!this.config.allowNumbersOnly||this.validateNumber(i))&&this.setValue(i)}}return t.\u0275fac=function(e){return new(e||t)(F(Xb),F(Fn))},t.\u0275cmp=an({type:t,selectors:[["ng-otp-input"]],inputs:{config:"config",formCtrl:"formCtrl"},outputs:{onInputChange:"onInputChange"},decls:1,vars:1,consts:[[3,"class","id","ngStyle",4,"ngIf"],[3,"id","ngStyle"],["autocomplete","one-time-code",3,"pattern","type","placeholder","ngStyle","class","formControl","id","paste","keyup","input","keydown",4,"ngFor","ngForOf"],["autocomplete","one-time-code",3,"pattern","type","placeholder","ngStyle","formControl","id","paste","keyup","input","keydown"],["inp",""]],template:function(e,r){1&e&&de(0,uZ,3,8,"div",0),2&e&&K("ngIf",null==r.otpForm?null:r.otpForm.controls)},dependencies:[Wi,Sc,UI,vu,qb,Qh,Ub,Xb],styles:[".otp-input[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:4px;border:solid 1px #c5c5c5;text-align:center;font-size:32px}.ng-otp-input-wrapper[_ngcontent-%COMP%]   .otp-input[_ngcontent-%COMP%]:not(:last-child){margin-right:8px}@media screen and (max-width: 767px){.otp-input[_ngcontent-%COMP%]{width:40px;font-size:24px;height:40px}}@media screen and (max-width: 420px){.otp-input[_ngcontent-%COMP%]{width:30px;font-size:18px;height:30px}}"]}),t})(),lZ=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=_t({type:t}),t.\u0275inj=yt({providers:[Xb],imports:[[Kn,KO,YO]]}),t})();const dZ=["ngOtpInput"],fZ=["resendOTP"];function hZ(t,n){1&t&&(Z(0,"div",19),He(1,"Verify your mobile number"),Q())}function pZ(t,n){1&t&&(Z(0,"div",19),He(1,"Verified"),Q())}function gZ(t,n){1&t&&(Z(0,"div",20),He(1," Invalid mobile number "),Q())}function mZ(t,n){if(1&t){const e=fc();Z(0,"div",21)(1,"div",22),Fe("click",function(){return Ri(e),Oi(qe().resendOtp())}),He(2," Resend OTP?"),Q(),Z(3,"div",23)(4,"countdown",24,25),Fe("event",function(i){return Ri(e),Oi(qe().handleResendOTPTimerEvent(i))}),Q()()()}if(2&t){const e=qe();Y(1),K("ngClass",e.resendOtpButtonState?"disable-resend-otp":""),Y(3),K("config",e.resendcountDownConfig)}}function vZ(t,n){1&t&&(Z(0,"div",20),He(1," Invalid OTP "),Q())}function yZ(t,n){if(1&t&&(Z(0,"div",26)(1,"div",27),He(2),Q()()),2&t){const e=qe();Y(2),Do("Getting you to the next step in ",e.nextStepIn,"")}}let bZ=(()=>{class t{constructor(e,r){this._router=e,this._route=r,this.enteredOTP="",this.invalidNumber=!1,this.resendOtpButtonState=!0,this.resendOtpCount=0,this.nextStepIn=5,this.countDownConfig={demand:!0,leftTime:300,format:"m:s"},this.resendcountDownConfig={demand:!0,leftTime:120,format:"m:s"},this.otpConfig={length:6,inputStyles:{width:"40px",height:"40px"},allowNumbersOnly:!0,disableAutoFocus:!0}}ngOnInit(){}generateOTP(){if(!this.invalidNumber){let e="0123456789",r="";for(let i=0;i<6;i++)r+=e[Math.floor(10*Math.random())];this.generatedOTP=r,this._handleDiv("mobile","none"),this._handleDiv("otp","flex"),this._handleAddClass("otp","fade-in-right"),this.startCountdown()}}phonenumber(){return this.mobileNo.match(/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/)?(this.invalidNumber=!1,!0):(this.invalidNumber=!0,!1)}startCountdown(){this.resendOTP.restart(),this.resendOTP.begin()}onOtpChange(e){this.enteredOTP=e,this.verifyOtp()}handleOTPExpireEvent(e){}handleResendOTPTimerEvent(e){this.resendOtpButtonState="done"!=e.action}resendOtp(){0==this.resendOtpButtonState&&this.resendOtpCount<2&&(this.resendOtpCount+=1,this.ngOtpInput.setValue(""),this.generateOTP(),this.resendOTP.restart(),this.startCountdown())}verifyOtp(){if(6==this.enteredOTP.length)if(this._handleDiv("verifyBtn","none"),this.generatedOTP==this.enteredOTP){let e=setInterval(()=>{0===this.nextStepIn?(clearInterval(e),this._router.navigate(["../password"],{relativeTo:this._route})):this.nextStepIn--},1e3)}else this._handleDiv("verifyBtn","block")}back(){this.ngOtpInput.setValue(""),this._handleDiv("otp","none"),this._handleDiv("mobile","flex"),this._handleAddClass("mobile","fade-in-left")}_handleDiv(e,r){document.getElementById(e).style.display=r}_handleAddClass(e,r){document.getElementById(e).classList.add(r)}static#e=this.\u0275fac=function(r){return new(r||t)(F(Bn),F(No))};static#t=this.\u0275cmp=an({type:t,selectors:[["app-otp"]],viewQuery:function(r,i){if(1&r&&(ka(dZ,5),ka(fZ,5)),2&r){let o;xr(o=Er())&&(i.ngOtpInput=o.first),xr(o=Er())&&(i.resendOTP=o.first)}},decls:26,vars:8,consts:[[1,"otp-page"],[1,"user-msgs"],["class","valid-user",4,"ngIf"],["id","mobile",1,"mobile"],[1,"p-inputgroup"],["type","text","pInputText","","placeholder","Mobile No.","onkeypress","return /[0-9]/i.test(event.key)",3,"ngModel","ngModelChange","input"],[1,"p-inputgroup-addon"],[1,"pi","pi-phone"],["class","error-msg",4,"ngIf"],[3,"click"],["id","otp",1,"otp"],[1,"back"],[1,"pi","pi-arrow-left"],[3,"config","onInputChange"],["ngOtpInput",""],["class","resend-div mt-2",4,"ngIf"],["id","verifyBtn"],["type","button",1,"verify",3,"click"],["class","next",4,"ngIf"],[1,"valid-user"],[1,"error-msg"],[1,"resend-div","mt-2"],["id","resendBtn",1,"resend-btn",3,"ngClass","click"],[1,"resend-countdown"],[3,"config","event"],["resendOTP",""],[1,"next"],[1,"next-step"]],template:function(r,i){1&r&&(Z(0,"div",0)(1,"div",1),de(2,hZ,2,0,"div",2),de(3,pZ,2,0,"div",2),Q(),Z(4,"div",3)(5,"div",4)(6,"input",5),Fe("ngModelChange",function(s){return i.mobileNo=s})("input",function(){return i.phonenumber()}),Q(),Z(7,"span",6),ht(8,"i",7),Q()(),ht(9,"br"),de(10,gZ,2,0,"div",8),Z(11,"p-button",9),Fe("click",function(){return i.generateOTP()}),He(12,"Send OTP"),Q()(),Z(13,"div",10)(14,"div",11)(15,"span",9),Fe("click",function(){return i.back()}),ht(16,"i",12),He(17," \xa0 Back"),Q()(),Z(18,"ng-otp-input",13,14),Fe("onInputChange",function(s){return i.onOtpChange(s)}),Q(),de(20,mZ,6,2,"div",15),de(21,vZ,2,0,"div",8),Z(22,"div",16)(23,"p-button",17),Fe("click",function(){return i.verifyOtp()}),He(24,"Verify"),Q()(),de(25,yZ,3,1,"div",18),Q()()),2&r&&(Y(2),K("ngIf",i.generatedOTP!=i.enteredOTP||""==i.enteredOTP),Y(1),K("ngIf",i.generatedOTP==i.enteredOTP&&""!=i.enteredOTP),Y(3),K("ngModel",i.mobileNo),Y(4),K("ngIf",i.invalidNumber),Y(8),K("config",i.otpConfig),Y(2),K("ngIf",i.generatedOTP!=i.enteredOTP||""==i.enteredOTP),Y(1),K("ngIf",i.enteredOTP!=i.generatedOTP&&""!=i.enteredOTP),Y(4),K("ngIf",i.generatedOTP==i.enteredOTP))},dependencies:[To,Wi,$R,Kb,vu,Qh,Fl,QO,cZ],styles:[".otp-page[_ngcontent-%COMP%]{width:80%;margin:2rem auto;text-align:center}.otp-page[_ngcontent-%COMP%]   #mobile[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;align-items:center}#otp[_ngcontent-%COMP%]{display:none;flex-direction:column;gap:1rem;align-items:center}.user-msgs[_ngcontent-%COMP%]{width:80%;margin:2rem auto;display:flex;justify-content:center;font-weight:600;font-size:1.1rem;font-family:cursive}.user-msgs[_ngcontent-%COMP%]   .valid-user[_ngcontent-%COMP%]{color:#399953}.error-msg[_ngcontent-%COMP%]{color:#d53e33;width:80%;display:flex;justify-content:center;font-weight:500;font-size:.8rem;font-family:cursive}.back[_ngcontent-%COMP%]{display:flex;width:80%;justify-content:flex-start}.resend-div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:80%}.next[_ngcontent-%COMP%]{margin:1rem;display:flex;justify-content:center;font-weight:500;font-size:1rem;font-family:cursive}.next[_ngcontent-%COMP%]   .next-step[_ngcontent-%COMP%]{color:#0c3823}[_nghost-%COMP%]     .p-button{color:#5aab619e;border:2px solid rgba(90,171,97,.6196078431);background-color:#fff}[_nghost-%COMP%]     .p-button:focus{box-shadow:none}[_nghost-%COMP%]     .p-inputgroup{max-width:20rem}[_nghost-%COMP%]     .p-inputgroup-addon{background:rgba(90,171,97,.6196078431);color:#fff}[_nghost-%COMP%]     .p-inputtext:enabled:focus{outline:0 none;outline-offset:0;box-shadow:0 0 0 .03rem #5aab619e;border-color:#5aab619e}[_nghost-%COMP%]     .p-inputtext:enabled:hover{border-color:#5aab619e}.fade-in-right[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in-right 3s cubic-bezier(.39,.575,.565,1) both}.fade-in-left[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fade-in-left 3s cubic-bezier(.39,.575,.565,1) both}@keyframes _ngcontent-%COMP%_fade-in-right{0%{transform:translate(50px);opacity:0}to{transform:translate(0);opacity:1}}@keyframes _ngcontent-%COMP%_fade-in-left{0%{transform:translate(-50px);opacity:0}to{transform:translate(0);opacity:1}}"]})}return t})();function wZ(t,n){1&t&&(Z(0,"div",12),He(1,"Set password"),Q())}function _Z(t,n){1&t&&(Z(0,"div",12),He(1,"Verified"),Q())}function CZ(t,n){1&t&&(Z(0,"span"),He(1," * Please enter New Password "),Q())}function xZ(t,n){1&t&&(Z(0,"span"),He(1," * At least 1 number (0...9) "),Q())}function EZ(t,n){1&t&&(Z(0,"span"),He(1," * At least 8 characters length "),Q())}function DZ(t,n){1&t&&(Z(0,"span"),He(1," * At least 1 lowercase letter (a...z) "),Q())}function IZ(t,n){1&t&&(Z(0,"span"),He(1," * At least 1 uppercase letter (A...Z) "),Q())}function SZ(t,n){1&t&&(Z(0,"span"),He(1," * At least 1 special symbol (!...$) "),Q())}function TZ(t,n){1&t&&(Z(0,"div",7),He(1," Password doesn't match "),Q())}const MZ=[{path:"",component:p8,children:[{path:"",redirectTo:"video",pathMatch:"full"},{path:"video",component:BY},{path:"otp",component:bZ},{path:"password",component:(()=>{class t{constructor(){this.password="",this.confirmPassword="",this.passwordType=!0,this.confirmPasswordType=!0,this.passwordValid={upper:!1,lower:!1,number:!1,special:!1}}continue(){this.password!=this.confirmPassword||""==this.password||""==this.confirmPassword?(alert("passowrd doesnt matched"),this.verfied=!1):this.verfied=!0}toggleType(e){"password"==e&&(this.passwordType=!this.passwordType),"confirm"==e&&(this.confirmPasswordType=!this.confirmPasswordType)}validPassword(){this.passwordValid.upper=/[A-Z]/.test(this.password),this.passwordValid.lower=/[a-z]/.test(this.password),this.passwordValid.number=/[0-9]/.test(this.password),this.passwordValid.special=/[#?!@$ %^&*-/+_=`~|:;.,<>(){}"']/.test(this.password)}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275cmp=an({type:t,selectors:[["app-password"]],decls:22,vars:15,consts:[[1,"password-page"],[1,"user-msgs"],["class","valid-user",4,"ngIf"],[1,"p-inputgroup"],["pInputText","","placeholder","Passowrd",3,"type","ngModel","ngModelChange","input"],[1,"p-inputgroup-addon",3,"click"],[3,"ngClass"],[1,"error-msg"],[4,"ngIf"],["pInputText","","placeholder","Passowrd",3,"type","ngModel","ngModelChange"],["class","error-msg",4,"ngIf"],[3,"click"],[1,"valid-user"]],template:function(r,i){1&r&&(Z(0,"div",0)(1,"div",1),de(2,wZ,2,0,"div",2),de(3,_Z,2,0,"div",2),Q(),Z(4,"div",3)(5,"input",4),Fe("ngModelChange",function(s){return i.password=s})("input",function(){return i.validPassword()}),Q(),Z(6,"span",5),Fe("click",function(){return i.toggleType("password")}),ht(7,"i",6),Q()(),Z(8,"div",7),de(9,CZ,2,0,"span",8),de(10,xZ,2,0,"span",8),de(11,EZ,2,0,"span",8),de(12,DZ,2,0,"span",8),de(13,IZ,2,0,"span",8),de(14,SZ,2,0,"span",8),Q(),Z(15,"div",3)(16,"input",9),Fe("ngModelChange",function(s){return i.confirmPassword=s}),Q(),Z(17,"span",5),Fe("click",function(){return i.toggleType("confirm")}),ht(18,"i",6),Q()(),de(19,TZ,2,0,"div",10),Z(20,"p-button",11),Fe("click",function(){return i.continue()}),He(21,"Continue"),Q()()),2&r&&(Y(2),K("ngIf",!i.verfied),Y(1),K("ngIf",i.verfied),Y(2),K("type",i.passwordType?"password":"text")("ngModel",i.password),Y(2),K("ngClass",i.passwordType?"pi pi-eye":"pi pi-eye-slash"),Y(2),K("ngIf",""===i.password&&i.verfied),Y(1),K("ngIf",0==i.passwordValid.number&&""!==i.password),Y(1),K("ngIf",i.password.length<8&&""!==i.password),Y(1),K("ngIf",0==i.passwordValid.lower&&""!==i.password),Y(1),K("ngIf",0==i.passwordValid.upper&&""!==i.password),Y(1),K("ngIf",0==i.passwordValid.special&&""!==i.password),Y(2),K("type",i.confirmPasswordType?"password":"text")("ngModel",i.confirmPassword),Y(2),K("ngClass",i.confirmPasswordType?"pi pi-eye":"pi pi-eye-slash"),Y(1),K("ngIf",i.password!=i.confirmPassword&&""!=i.confirmPassword))},dependencies:[To,Wi,$R,Kb,vu,Qh,Fl],styles:[".password-page[_ngcontent-%COMP%]{width:80%;margin:2rem auto;text-align:center;display:flex;flex-direction:column;gap:1rem;align-items:center}.user-msgs[_ngcontent-%COMP%]{width:80%;margin:2rem auto;display:flex;justify-content:center;font-weight:600;font-size:1.1rem;font-family:cursive}.user-msgs[_ngcontent-%COMP%]   .valid-user[_ngcontent-%COMP%]{color:#399953}.error-msg[_ngcontent-%COMP%]{color:#d53e33;width:80%;display:flex;flex-direction:column;justify-content:center;font-weight:500;font-size:.8rem;font-family:cursive;align-items:baseline}[_nghost-%COMP%]     .p-button{color:#5aab619e;border:2px solid rgba(90,171,97,.6196078431);background-color:#fff}[_nghost-%COMP%]     .p-button:focus{box-shadow:none}[_nghost-%COMP%]     .p-inputgroup{max-width:20rem}[_nghost-%COMP%]     .p-inputgroup-addon{background:rgba(90,171,97,.6196078431);color:#fff}[_nghost-%COMP%]     .p-inputtext:enabled:focus{outline:0 none;outline-offset:0;box-shadow:0 0 0 .03rem #5aab619e;border-color:#5aab619e}[_nghost-%COMP%]     .p-inputtext:enabled:hover{border-color:#5aab619e}"]})}return t})()}]}];let AZ=(()=>{class t{static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275mod=_t({type:t});static#n=this.\u0275inj=yt({imports:[Kf.forRoot(MZ),Kf]})}return t})(),RZ=(()=>{class t{constructor(){this.title="KYC-registration-frontend"}static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275cmp=an({type:t,selectors:[["app-root"]],decls:1,vars:0,template:function(r,i){1&r&&ht(0,"router-outlet")},dependencies:[Uf]})}return t})(),JO=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=_t({type:t});static \u0275inj=yt({imports:[Kn]})}return t})(),eN=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=_t({type:t});static \u0275inj=yt({imports:[Kn,Kf,JO,Kf,JO]})}return t})(),tN=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=_t({type:t});static \u0275inj=yt({imports:[Kn,Yc]})}return t})(),$Z=(()=>{class t{host;constructor(e){this.host=e}autofocus;focused=!1;ngAfterContentChecked(){if(!this.focused&&this.autofocus){const e=on.getFocusableElements(this.host.nativeElement);0===e.length&&this.host.nativeElement.focus(),e.length>0&&e[0].focus(),this.focused=!0}}static \u0275fac=function(r){return new(r||t)(F(en))};static \u0275dir=ge({type:t,selectors:[["","pAutoFocus",""]],hostAttrs:[1,"p-element"],inputs:{autofocus:"autofocus"}})}return t})(),qZ=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=_t({type:t});static \u0275inj=yt({imports:[Kn]})}return t})(),nN=(()=>{class t extends zR{static \u0275fac=function(){let e;return function(i){return(e||(e=$t(t)))(i||t)}}();static \u0275cmp=an({type:t,selectors:[["TimesIcon"]],standalone:!0,features:[Ye,Na],decls:2,vars:5,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M8.01186 7.00933L12.27 2.75116C12.341 2.68501 12.398 2.60524 12.4375 2.51661C12.4769 2.42798 12.4982 2.3323 12.4999 2.23529C12.5016 2.13827 12.4838 2.0419 12.4474 1.95194C12.4111 1.86197 12.357 1.78024 12.2884 1.71163C12.2198 1.64302 12.138 1.58893 12.0481 1.55259C11.9581 1.51625 11.8617 1.4984 11.7647 1.50011C11.6677 1.50182 11.572 1.52306 11.4834 1.56255C11.3948 1.60204 11.315 1.65898 11.2488 1.72997L6.99067 5.98814L2.7325 1.72997C2.59553 1.60234 2.41437 1.53286 2.22718 1.53616C2.03999 1.53946 1.8614 1.61529 1.72901 1.74767C1.59663 1.88006 1.5208 2.05865 1.5175 2.24584C1.5142 2.43303 1.58368 2.61419 1.71131 2.75116L5.96948 7.00933L1.71131 11.2675C1.576 11.403 1.5 11.5866 1.5 11.7781C1.5 11.9696 1.576 12.1532 1.71131 12.2887C1.84679 12.424 2.03043 12.5 2.2219 12.5C2.41338 12.5 2.59702 12.424 2.7325 12.2887L6.99067 8.03052L11.2488 12.2887C11.3843 12.424 11.568 12.5 11.7594 12.5C11.9509 12.5 12.1346 12.424 12.27 12.2887C12.4053 12.1532 12.4813 11.9696 12.4813 11.7781C12.4813 11.5866 12.4053 11.403 12.27 11.2675L8.01186 7.00933Z","fill","currentColor"]],template:function(r,i){1&r&&(tg(),Z(0,"svg",0),ht(1,"path",1),Q()),2&r&&(Eo(i.getClassNames()),bt("aria-label",i.ariaLabel)("aria-hidden",i.ariaHidden)("role",i.role))},encapsulation:2})}return t})();const KZ=["input"];function YZ(t,n){if(1&t){const e=fc();Z(0,"TimesIcon",5),Fe("click",function(){return Ri(e),Oi(qe(2).clear())}),Q()}2&t&&(K("styleClass","p-inputmask-clear-icon"),bt("data-pc-section","clearIcon"))}function XZ(t,n){}function ZZ(t,n){1&t&&de(0,XZ,0,0,"ng-template")}function QZ(t,n){if(1&t){const e=fc();Z(0,"span",6),Fe("click",function(){return Ri(e),Oi(qe(2).clear())}),de(1,ZZ,1,0,null,7),Q()}if(2&t){const e=qe(2);bt("data-pc-section","clearIcon"),Y(1),K("ngTemplateOutlet",e.clearIconTemplate)}}function JZ(t,n){if(1&t&&(bo(0),de(1,YZ,1,2,"TimesIcon",3),de(2,QZ,2,2,"span",4),wo()),2&t){const e=qe();Y(1),K("ngIf",!e.clearIconTemplate),Y(1),K("ngIf",e.clearIconTemplate)}}const eQ={provide:Zr,useExisting:ut(()=>tQ),multi:!0};let tQ=(()=>{class t{document;platformId;el;cd;type="text";slotChar="_";autoClear=!0;showClear=!1;style;inputId;styleClass;placeholder;size;maxlength;tabindex;title;ariaLabel;ariaLabelledBy;ariaRequired;disabled;readonly;unmask;name;required;characterPattern="[A-Za-z]";autoFocus;autocomplete;keepBuffer=!1;get mask(){return this._mask}set mask(e){this._mask=e,this.initMask(),this.writeValue(""),this.onModelChange(this.value)}onComplete=new $e;onFocus=new $e;onBlur=new $e;onInput=new $e;onKeydown=new $e;onClear=new $e;inputViewChild;templates;clearIconTemplate;value;_mask;onModelChange=()=>{};onModelTouched=()=>{};input;filled;defs;tests;partialPosition;firstNonMaskPos;lastRequiredNonMaskPos;len;oldVal;buffer;defaultBuffer;focusText;caretTimeoutId;androidChrome=!0;focused;constructor(e,r,i,o){this.document=e,this.platformId=r,this.el=i,this.cd=o}ngOnInit(){if(Av(this.platformId)){let e=navigator.userAgent;this.androidChrome=/chrome/i.test(e)&&/android/i.test(e)}this.initMask()}ngAfterContentInit(){this.templates.forEach(e=>{"clearicon"===e.getType()&&(this.clearIconTemplate=e.template)})}initMask(){this.tests=[],this.partialPosition=this.mask.length,this.len=this.mask.length,this.firstNonMaskPos=null,this.defs={9:"[0-9]",a:this.characterPattern,"*":`${this.characterPattern}|[0-9]`};let e=this.mask.split("");for(let r=0;r<e.length;r++){let i=e[r];"?"==i?(this.len--,this.partialPosition=r):this.defs[i]?(this.tests.push(new RegExp(this.defs[i])),null===this.firstNonMaskPos&&(this.firstNonMaskPos=this.tests.length-1),r<this.partialPosition&&(this.lastRequiredNonMaskPos=this.tests.length-1)):this.tests.push(null)}this.buffer=[];for(let r=0;r<e.length;r++){let i=e[r];"?"!=i&&this.buffer.push(this.defs[i]?this.getPlaceholder(r):i)}this.defaultBuffer=this.buffer.join("")}writeValue(e){this.value=e,this.inputViewChild&&this.inputViewChild.nativeElement&&(this.inputViewChild.nativeElement.value=null==this.value||null==this.value?"":this.value,this.checkVal(),this.focusText=this.inputViewChild.nativeElement.value,this.updateFilledState())}registerOnChange(e){this.onModelChange=e}registerOnTouched(e){this.onModelTouched=e}setDisabledState(e){this.disabled=e,this.cd.markForCheck()}caret(e,r){let i,o,s;if(this.inputViewChild?.nativeElement.offsetParent&&this.inputViewChild.nativeElement===this.inputViewChild.nativeElement.ownerDocument.activeElement){if("number"!=typeof e)return this.inputViewChild.nativeElement.setSelectionRange?(o=this.inputViewChild.nativeElement.selectionStart,s=this.inputViewChild.nativeElement.selectionEnd):this.document&&this.document.selection.createRange&&(i=this.document.createRange(),o=0-i.duplicate().moveStart("character",-1e5),s=o+i.text.length),{begin:o,end:s};o=e,s="number"==typeof r?r:o,this.inputViewChild.nativeElement.setSelectionRange?this.inputViewChild.nativeElement.setSelectionRange(o,s):this.inputViewChild.nativeElement.createTextRange&&(i=this.inputViewChild.nativeElement.createTextRange(),i.collapse(!0),i.moveEnd("character",s),i.moveStart("character",o),i.select())}}isCompleted(){for(let r=this.firstNonMaskPos;r<=this.lastRequiredNonMaskPos;r++)if(this.tests[r]&&this.buffer[r]===this.getPlaceholder(r))return!1;return!0}getPlaceholder(e){return this.slotChar.charAt(e<this.slotChar.length?e:0)}seekNext(e){for(;++e<this.len&&!this.tests[e];);return e}seekPrev(e){for(;--e>=0&&!this.tests[e];);return e}shiftL(e,r){let i,o;if(!(e<0)){for(i=e,o=this.seekNext(r);i<this.len;i++)if(this.tests[i]){if(!(o<this.len&&this.tests[i].test(this.buffer[o])))break;this.buffer[i]=this.buffer[o],this.buffer[o]=this.getPlaceholder(o),o=this.seekNext(o)}this.writeBuffer(),this.caret(Math.max(this.firstNonMaskPos,e))}}shiftR(e){let r,i,o,s;for(r=e,i=this.getPlaceholder(e);r<this.len;r++)if(this.tests[r]){if(o=this.seekNext(r),s=this.buffer[r],this.buffer[r]=i,!(o<this.len&&this.tests[o].test(s)))break;i=s}}handleAndroidInput(e){var r=this.inputViewChild?.nativeElement.value,i=this.caret();if(this.oldVal&&this.oldVal.length&&this.oldVal.length>r.length){for(this.checkVal(!0);i.begin>0&&!this.tests[i.begin-1];)i.begin--;if(0===i.begin)for(;i.begin<this.firstNonMaskPos&&!this.tests[i.begin];)i.begin++;setTimeout(()=>{this.caret(i.begin,i.begin),this.updateModel(e),this.isCompleted()&&this.onComplete.emit()},0)}else{for(this.checkVal(!0);i.begin<this.len&&!this.tests[i.begin];)i.begin++;setTimeout(()=>{this.caret(i.begin,i.begin),this.updateModel(e),this.isCompleted()&&this.onComplete.emit()},0)}}onInputBlur(e){if(this.focused=!1,this.onModelTouched(),this.keepBuffer||this.checkVal(),this.updateFilledState(),this.onBlur.emit(e),this.inputViewChild?.nativeElement.value!=this.focusText||this.inputViewChild?.nativeElement.value!=this.value){this.updateModel(e);let r=this.document.createEvent("HTMLEvents");r.initEvent("change",!0,!1),this.inputViewChild?.nativeElement.dispatchEvent(r)}}onInputKeydown(e){if(this.readonly)return;let i,o,s,a,r=e.which||e.keyCode;Av(this.platformId)&&(a=/iphone/i.test(on.getUserAgent())),this.oldVal=this.inputViewChild?.nativeElement.value,this.onKeydown.emit(e),8===r||46===r||a&&127===r?(i=this.caret(),o=i.begin,s=i.end,s-o==0&&(o=46!==r?this.seekPrev(o):s=this.seekNext(o-1),s=46===r?this.seekNext(s):s),this.clearBuffer(o,s),this.shiftL(o,this.keepBuffer?s-2:s-1),this.updateModel(e),this.onInput.emit(e),e.preventDefault()):13===r?(this.onInputBlur(e),this.updateModel(e)):27===r&&(this.inputViewChild.nativeElement.value=this.focusText,this.caret(0,this.checkVal()),this.updateModel(e),e.preventDefault())}onKeyPress(e){if(!this.readonly){var o,s,a,u,r=e.which||e.keyCode,i=this.caret();e.ctrlKey||e.altKey||e.metaKey||r<32||r>34&&r<41||(r&&13!==r&&(i.end-i.begin!=0&&(this.clearBuffer(i.begin,i.end),this.shiftL(i.begin,i.end-1)),(o=this.seekNext(i.begin-1))<this.len&&(s=String.fromCharCode(r),this.tests[o].test(s)&&(this.shiftR(o),this.buffer[o]=s,this.writeBuffer(),a=this.seekNext(o),on.isClient()&&/android/i.test(on.getUserAgent())?setTimeout(()=>{this.caret(a)},0):this.caret(a),i.begin<=this.lastRequiredNonMaskPos&&(u=this.isCompleted()),this.onInput.emit(e))),e.preventDefault()),this.updateModel(e),this.updateFilledState(),u&&this.onComplete.emit())}}clearBuffer(e,r){if(!this.keepBuffer){let i;for(i=e;i<r&&i<this.len;i++)this.tests[i]&&(this.buffer[i]=this.getPlaceholder(i))}}writeBuffer(){this.inputViewChild.nativeElement.value=this.buffer.join("")}checkVal(e){let o,s,a,r=this.inputViewChild?.nativeElement.value,i=-1;for(o=0,a=0;o<this.len;o++)if(this.tests[o]){for(this.buffer[o]=this.getPlaceholder(o);a++<r.length;)if(s=r.charAt(a-1),this.tests[o].test(s)){this.keepBuffer||(this.buffer[o]=s),i=o;break}if(a>r.length){this.clearBuffer(o+1,this.len);break}}else this.buffer[o]===r.charAt(a)&&a++,o<this.partialPosition&&(i=o);return e?this.writeBuffer():i+1<this.partialPosition?this.autoClear||this.buffer.join("")===this.defaultBuffer?(this.inputViewChild?.nativeElement.value&&(this.inputViewChild.nativeElement.value=""),this.clearBuffer(0,this.len)):this.writeBuffer():(this.writeBuffer(),this.inputViewChild.nativeElement.value=this.inputViewChild?.nativeElement.value.substring(0,i+1)),this.partialPosition?o:this.firstNonMaskPos}onInputFocus(e){if(this.readonly)return;let r;this.focused=!0,clearTimeout(this.caretTimeoutId),this.focusText=this.inputViewChild?.nativeElement.value,r=this.keepBuffer?this.inputViewChild?.nativeElement.value.length:this.checkVal(),this.caretTimeoutId=setTimeout(()=>{this.inputViewChild?.nativeElement===this.inputViewChild?.nativeElement.ownerDocument.activeElement&&(this.writeBuffer(),r==this.mask?.replace("?","").length?this.caret(0,r):this.caret(r))},10),this.onFocus.emit(e)}onInputChange(e){this.androidChrome?this.handleAndroidInput(e):this.handleInputChange(e),this.onInput.emit(e)}handleInputChange(e){this.readonly||setTimeout(()=>{var r=this.checkVal(!0);this.caret(r),this.updateModel(e),this.isCompleted()&&this.onComplete.emit()},0)}getUnmaskedValue(){let e=[];for(let r=0;r<this.buffer.length;r++){let i=this.buffer[r];this.tests[r]&&i!=this.getPlaceholder(r)&&e.push(i)}return e.join("")}updateModel(e){const r=this.unmask?this.getUnmaskedValue():e.target.value;(null!==r||void 0!==r)&&(this.value=r,this.onModelChange(this.value))}updateFilledState(){this.filled=this.inputViewChild?.nativeElement&&""!=this.inputViewChild.nativeElement.value}focus(){this.inputViewChild?.nativeElement.focus()}clear(){this.inputViewChild.nativeElement.value="",this.value=null,this.onModelChange(this.value),this.onClear.emit()}static \u0275fac=function(r){return new(r||t)(F(Fn),F(yo),F(en),F(fs))};static \u0275cmp=an({type:t,selectors:[["p-inputMask"]],contentQueries:function(r,i,o){if(1&r&&ds(o,hy,4),2&r){let s;xr(s=Er())&&(i.templates=s)}},viewQuery:function(r,i){if(1&r&&ka(KZ,7),2&r){let o;xr(o=Er())&&(i.inputViewChild=o.first)}},hostAttrs:[1,"p-element"],hostVars:6,hostBindings:function(r,i){2&r&&xo("p-inputwrapper-filled",i.filled)("p-inputwrapper-focus",i.focused)("p-inputmask-clearable",i.showClear&&!i.disabled)},inputs:{type:"type",slotChar:"slotChar",autoClear:"autoClear",showClear:"showClear",style:"style",inputId:"inputId",styleClass:"styleClass",placeholder:"placeholder",size:"size",maxlength:"maxlength",tabindex:"tabindex",title:"title",ariaLabel:"ariaLabel",ariaLabelledBy:"ariaLabelledBy",ariaRequired:"ariaRequired",disabled:"disabled",readonly:"readonly",unmask:"unmask",name:"name",required:"required",characterPattern:"characterPattern",autoFocus:"autoFocus",autocomplete:"autocomplete",keepBuffer:"keepBuffer",mask:"mask"},outputs:{onComplete:"onComplete",onFocus:"onFocus",onBlur:"onBlur",onInput:"onInput",onKeydown:"onKeydown",onClear:"onClear"},features:[gt([eQ])],decls:3,vars:21,consts:[["pInputText","","pAutoFocus","",1,"p-inputmask",3,"ngStyle","ngClass","disabled","readonly","autofocus","focus","blur","keydown","keypress","input","paste"],["input",""],[4,"ngIf"],[3,"styleClass","click",4,"ngIf"],["class","p-inputmask-clear-icon",3,"click",4,"ngIf"],[3,"styleClass","click"],[1,"p-inputmask-clear-icon",3,"click"],[4,"ngTemplateOutlet"]],template:function(r,i){1&r&&(Z(0,"input",0,1),Fe("focus",function(s){return i.onInputFocus(s)})("blur",function(s){return i.onInputBlur(s)})("keydown",function(s){return i.onInputKeydown(s)})("keypress",function(s){return i.onKeyPress(s)})("input",function(s){return i.onInputChange(s)})("paste",function(s){return i.handleInputChange(s)}),Q(),de(2,JZ,3,2,"ng-container",2)),2&r&&(K("ngStyle",i.style)("ngClass",i.styleClass)("disabled",i.disabled)("readonly",i.readonly)("autofocus",i.autoFocus),bt("id",i.inputId)("type",i.type)("name",i.name)("placeholder",i.placeholder)("title",i.title)("size",i.size)("autocomplete",i.autocomplete)("maxlength",i.maxlength)("tabindex",i.tabindex)("aria-label",i.ariaLabel)("aria-labelledBy",i.ariaLabelledBy)("aria-required",i.ariaRequired)("required",i.required)("data-pc-name","inputmask")("data-pc-section","root"),Y(2),K("ngIf",null!=i.value&&i.filled&&i.showClear&&!i.disabled))},dependencies:function(){return[To,Wi,Tc,Sc,Kb,$Z,nN]},styles:["@layer primeng{.p-inputmask-clear-icon{position:absolute;top:50%;margin-top:-.5rem;cursor:pointer}.p-inputmask-clearable{position:relative}}\n"],encapsulation:2,changeDetection:0})}return t})(),rN=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=_t({type:t});static \u0275inj=yt({imports:[Kn,Yb,qZ,nN,Yc]})}return t})();const nQ=[eN,tN,rN,qR,E2,Yb];let rQ=(()=>{class t{static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275mod=_t({type:t});static#n=this.\u0275inj=yt({imports:[Kn,nQ,eN,tN,rN,qR,E2,Yb]})}return t})(),iQ=(()=>{class t{static#e=this.\u0275fac=function(r){return new(r||t)};static#t=this.\u0275mod=_t({type:t,bootstrap:[RZ]});static#n=this.\u0275inj=yt({imports:[h6,AZ,rQ,KO,YO,sZ,lZ]})}return t})();d6().bootstrapModule(iQ).catch(t=>console.error(t))},369:()=>{},655:()=>{},118:()=>{}},ap=>{ap(ap.s=402)}]);